<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    		<meta name="keywords" content="Talk:Bottom-up parsing,Dominus" />
		<link rel="shortcut icon" href="/favicon.ico" />
		<link rel="search" type="application/opensearchdescription+xml" href="/w/opensearch_desc.php" title="Wikipedia (English)" />
		<link rel="copyright" href="../../../COPYING.html" />
    <title>Talk:Bottom-up parsing - Wikipedia, the free encyclopedia</title>
    <style type="text/css">/*<![CDATA[*/ @import "../../../skins/htmldump/main.css"; /*]]>*/</style>
    <link rel="stylesheet" type="text/css" media="print" href="../../../skins/common/commonPrint.css" />
    <!--[if lt IE 5.5000]><style type="text/css">@import "../../../skins/monobook/IE50Fixes.css";</style><![endif]-->
    <!--[if IE 5.5000]><style type="text/css">@import "../../../skins/monobook/IE55Fixes.css";</style><![endif]-->
    <!--[if IE 6]><style type="text/css">@import "../../../skins/monobook/IE60Fixes.css";</style><![endif]-->
    <!--[if IE]><script type="text/javascript" src="../../../skins/common/IEFixes.js"></script>
    <meta http-equiv="imagetoolbar" content="no" /><![endif]-->
    <script type="text/javascript" src="../../../skins/common/wikibits.js"></script>
    <script type="text/javascript" src="../../../skins/htmldump/md5.js"></script>
    <script type="text/javascript" src="../../../skins/htmldump/utf8.js"></script>
    <script type="text/javascript" src="../../../skins/htmldump/lookup.js"></script>
    <script type="text/javascript" src="../../../raw/gen.js"></script>        <style type="text/css">/*<![CDATA[*/
@import "../../../raw/MediaWiki%7ECommon.css";
@import "../../../raw/MediaWiki%7EMonobook.css";
@import "../../../raw/gen.css";
/*]]>*/</style>          </head>
  <body
    class="ns-1">
    <div id="globalWrapper">
      <div id="column-content">
	<div id="content">
	  <a name="top" id="contentTop"></a>
	        <h1 class="firstHeading">Talk:Bottom-up parsing</h1>
	  <div id="bodyContent">
	    <h3 id="siteSub">From Wikipedia, the free encyclopedia</h3>
	    <div id="contentSub"></div>
	    	    	    <!-- start content -->
	    <p><a name="Description_of_Yacc" id="Description_of_Yacc"></a></p>
<h1><span class="editsection">[<a href="../../../b/o/t/Talk%7EBottom-up_parsing_b1ba.html" title="Edit section: Description of Yacc">edit</a>]</span> <span class="mw-headline">Description of Yacc</span></h1>
<p>I wrote this up a few weeks ago, and perhaps some of it might be incorporated into this page. I hereby give permission for its incorporation, in whole or in part, under the terms of the GNU FDL. - <a href="../../../d/o/m/User%7EDominus_070e.html" title="User:Dominus">Dominus</a> 16:28, 25 May 2004 (UTC)</p>
<hr />
<p>It's easy to understand if you understand the parsing algorithm. Otherwise, it's difficult. I learned the parsing algorithm from running the C debugger on yacc parsers, but I wouldn't recommend that.</p>
<p>I'll try to summarize what's happening.</p>
<p>The parser has two main parts. It has a state machine, and it has a stack. Items on the stack have three parts:</p>
<pre>
       1. a grammar symbol
       2. the value of the symbol
       3. the state that the parser was in when it pushed the symbol
          onto the stack
</pre>
<p>The parser repeats the following loop over and over:</p>
<pre>
       1. look ahead at the next token on the input stream
       2. Consult a table to decide what to do next.
</pre>
<p>The table is indexed by the identity of the upcoming token, and by the current state of the state machine.</p>
<p>There are essentially four different things that the parser can do at each step. The simplest thing to do is to halt successfully. The next simplest is to signal a parse error.</p>
<p>Of the interesting behaviors, the simpler is to do a "shift", which just means that the next symbol is removed from the input stream, and pushed onto the stack. The current state is pushed onto the stack at the same time.</p>
<p>The other thing the parser can do is 'reduce', which corresponds to replacing the right-hand side of a grammar production with the left-hand side. In this case, the symbols on the stack that correspond to the RHS of the production are popped, and a value for the LHS is computed. The parser examines the state of the new top symbol, and uses it to index another table, which tells it what new state to go into. Then it pushes the LHS symbol and its value and the new state onto the stack.</p>
<p>Here's the simplest example grammar I can think of:</p>
<pre>
       %token NUMBER
</pre>
<pre>
       %%
       expr : NUMBER '+' expr { $$ = $1 + $3 } 
            | NUMBER          { $$ = $1 }
            ;
</pre>
<p>I'll now explain the bison .output file:</p>
<pre>
       Grammar
       rule 1    expr -&gt; NUMBER '+' expr
       rule 2    expr -&gt; NUMBER
</pre>
<p>This is for debugging; it says what the gammar rules are. Also, later on it'll refer to the rules by number.</p>
<pre>
       Terminals, with rules where they appear
</pre>
<pre>
       $ (-1)
       '+' (43) 1
       error (256)
       NUMBER (257) 1 2
</pre>
<p>'terminals' are 'terminal symbols' which are produced by the lexer. 'error' is a special fake symbol that the parser sometimes inserts when there is an error. It's an advanced feature, so ignore it. '$' represents the end-of-input condition. Inside of bison, tokens are represented by integers. The lexer function will return one of these integers to indicate what sort of token it has found; it will also set a global variable (I think named 'yylval') to contain the value of the token, if it has one. In this example grammar, NUMBER has a value which is a number.</p>
<pre>
       Nonterminals, with rules where they appear
</pre>
<pre>
       expr (5)
           on left: 1 2, on right: 1
</pre>
<p>The grammar has only one nonterminal symbol, which is 'expr'.</p>
<p>The rest of the .output file describes the state machine and what it will do on every possible input from every possible state. Initially, the state machine is in state 0.</p>
<pre>
       state 0
</pre>
<pre>
           NUMBER  shift, and go to state 1
</pre>
<pre>
           expr    go to state 4
</pre>
<p>Each state has two or three sections. Here the first section is omitted for state 0; we will see it in the explanation of the next state. The second section says what to do if the upcoming token has a certain type. In this case, if the machine is in state 0 and the upcoming token is a NUMBER, the token is shifted (pushed onto the stack) and the state machine goes into state 1. The description doesn't say so explicitly, but if the upcoming token is anything else, the parser will signal an error.</p>
<p>This is what we expect, since valid inputs to this parser must always begin with a NUMBER.</p>
<p>The third section says what to do next if the parser finds itself back here after reducing an 'expr': it should go into state 4 and continue.</p>
<pre>
       state 1
</pre>
<pre>
           expr  -&gt;  NUMBER . '+' expr   (rule 1)
           expr  -&gt;  NUMBER .   (rule 2)
</pre>
<pre>
           '+'     shift, and go to state 2
</pre>
<pre>
           $default        reduce using rule 2 (expr)
</pre>
<p>Here we see all three sections. The first section describes the place in the input that the parser expects to be while in this state. The '.' indicates the current read position in the input stream. The notations here say that when the parser is in state 1, it is either because it is in the middle of processing rule 1 of the grammar, and has already read in the first NUMBER, and is expecting to see a '+' sign followed by an 'expr', or else it has finished processing rule 2, and has already read in the NUMBER.</p>
<p>If the next input token is a '+', the parser concludes that it's actually in the 'rule 1' case rather than the 'rule 2' case. It pushes the '+' onto the stack and continues in state 2. If it sees anything else coming up (such as '$', the end-of-input token) it "reduces using rule 2", which, as you will recall, is</p>
<pre>
       rule 2    expr -&gt; NUMBER
</pre>
<p>This says that an 'expr' can be a plain NUMBER. The parser has seen the NUMBER and has it on the stack. It pops the number off and pushes an 'expr' symbol on the stack in its place. At this point it runs the associated semantic action to determine the value of the 'expr'. The semantic action is:</p>
<pre>
       { $$ = $1 }
</pre>
<p>$1 here refers to the value of the NUMBER; $$ is the resulting value. We said that the value of this expression is the same as the value of the number it comprises.</p>
<pre>
       state 2
</pre>
<pre>
           expr  -&gt;  NUMBER '+' . expr   (rule 1)
</pre>
<pre>
           NUMBER  shift, and go to state 1
</pre>
<pre>
           expr    go to state 3
</pre>
<p>The parser will be in state 2 after having seen the NUMBER and '+' tokens of an expression of the form 'NUMBER + expr'. If it sees another number, it pushes the number onto the stack and returns to state 1. If it sees anything else coming up, , it signals an error.</p>
<p>Let's pause for a moment and look at an example input. Say the input is</p>
<pre>
       NUMBER 3
       '+'
       NUMBER 4
       $
</pre>
<p>The parser starts in state 0. The next token is 'NUMBER', so the parser shifts the NUMBER onto the stack and goes into state 1.</p>
<p>In state 1, the next token is '+', so the parser shifts the '+' onto the stack and goes into state 2.</p>
<p>In state 2, the next token is 'NUMBER', so the parser shifts the NUMBER onto the stack, and goes back into state 1.</p>
<p>At this point, the stack has</p>
<pre>
       top-&gt; NUMBER (4) (state 2)
             '+'        (state 1)
             NUMBER (3) (state 0)
</pre>
<p>Now we're in state 1, and the next token is '$', which isn't explicitly listed among the shiftable tokens. So the parser takes the '$default' action, which is "reduce using rule 2".</p>
<p>Rule 2 has:</p>
<pre>
       rule 2    expr -&gt; NUMBER
</pre>
<p>The parser pops the stack and get the value of 4 from the popped symbol. It runs the associated semantic action, { $$ = $1 }. $1 is 4, so $$ is also 4. It pushes the new 'expr' symbol onto the stack with an associated semantic value of 4. The stack has:</p>
<pre>
       top-&gt; expr (4)   (state 2)
             '+'        (state 1)
             NUMBER (3) (state 0)
</pre>
<p>Finally, the parser looks at the state of the last-popped symbol, which was 2, and checks the state 2 tables to see what transition is appropriate when it has just reduced an 'expr'. State 2 says:</p>
<pre>
           expr    go to state 3
</pre>
<p>so the parser does. It is now in state 3.</p>
<pre>
       state 3
</pre>
<pre>
           expr  -&gt;  NUMBER '+' expr .   (rule 1)
</pre>
<pre>
           $default        reduce using rule 1 (expr)
</pre>
<p>The upcoming token is '$', so the parser chooses the default action, which is to reduce using rule 1. Here's rule 1:</p>
<pre>
       rule 1    expr -&gt; NUMBER '+' expr
</pre>
<p>There are three symbols on the RHS, so the parser pops three items off the stack; they are indeed a number, a '+', and an 'expr'. $1 becomes the value of the NUMBER (3). $2 becomes the value of the '+' (garbage). $3 becomes the value of the expr (4). The semantic action associated with rule 1 is executed. It is</p>
<pre>
       { $$ = $1 + $3 } 
</pre>
<p>so the value of the new symbol is 7. A new symbol of type 'expr' (the LHS of the rule) and value 7 is pushed on the stack:</p>
<pre>
       top-&gt; expr (7)   (state 3)
</pre>
<p>Moreover, as in the last reduction, the parser looks at the state of the last-popped symbol, which was 0, and checks the state 0 tables to see what transition is appropriate when it has just reduced an 'expr'. State 0 says:</p>
<pre>
           expr    go to state 4
</pre>
<p>so the parser does.</p>
<p>In state 4, the upcoming token is still '$', the end-of-input token, and state 4 says:</p>
<pre>
       state 4
</pre>
<pre>
           $       go to state 5
</pre>
<p>The parser is now in state 5. From there, it goes to state 6.</p>
<pre>
       state 5
</pre>
<pre>
           $       go to state 6
</pre>
<p><br /></p>
<p>In state 6, the parser 'accepts', which means that it signals success:</p>
<pre>
       state 6
</pre>
<pre>
           $default        accept
</pre>
<p>The value of the entire expression is the value at the top of the stack, in this case 7.</p>
<p>There are a couple of other points of interest. Sometimes one writes a grammar which is ambiguous. For example, consider:</p>
<pre>
       expr = expr '+' expr 
            | NUMBER
            ;
</pre>
<p>If the input is (NUMBER 3) + (NUMBER 4) + (NUMBER 5), then there is an ambiguity in parsing. Here's what the parser will do. First it will shift the NUMBER (3) and immediately reduce it to an 'expr'. Then it will shift the '+', and then it will shift the NUMBER (4) and immeditely reduce that to an 'expr'. The stack now has:</p>
<pre>
       top -&gt; expr (4)
              '+'
              expr (3)
</pre>
<p>The upcoming token is another '+'. The parser has two possible strategies. It could reduce the tokens on the stack immediately, or it could shift the upcoming '+' immediately and reduce later.</p>
<p>The 'reduce first' strategy goes through the following stacks:</p>
<pre>
       (reduce by rule   expr -&gt; expr '+' expr)
</pre>
<pre>
       top -&gt; expr (7)
</pre>
<pre>
       top -&gt; '+'
              expr (7)
</pre>
<pre>
       top -&gt; NUMBER (5)
              '+'
              expr (7)
</pre>
<pre>
       (reduce by rule   expr -&gt; NUMBER)
</pre>
<pre>
       top -&gt; expr (5)
              '+'
              expr (7)
</pre>
<pre>
       (reduce by rule   expr -&gt; expr '+' expr)
</pre>
<pre>
       top -&gt; expr (12)
</pre>
<p>The 'shift first' strategy foes through the following stacks:</p>
<pre>
       top -&gt; '+'
              expr (4)
              '+'
              expr (3)
</pre>
<pre>
       top -&gt; NUMBER (5)
              '+'
              expr (4)
              '+'
              expr (3)
</pre>
<pre>
       (reduce by rule   expr -&gt; NUMBER)
</pre>
<pre>
       top -&gt; expr (5)
              '+'
              expr (4)
              '+'
              expr (3)
</pre>
<pre>
       (reduce by rule   expr -&gt; expr '+' expr)
</pre>
<pre>
       top -&gt; expr (9)
              '+'
              expr (3)
</pre>
<pre>
       (reduce by rule   expr -&gt; expr '+' expr)
</pre>
<pre>
       top -&gt; expr (12)
</pre>
<p><br />
In this case the results are the same. But if the operator had been subtraction instead of addition, the results would have been different. The "reduce first" strategy would have said that "3 - 4 - 5" was -6, and the "shift first" strategy would have said that "3 - 4 - 5" was 4. In essence, the first strategy interprets the ambiguous expressions "3 + 4 + 5" as "(3 + 4) + 5" and the second as "3 + (4 + 5)". This ambiguity is called a "shift/reduce" conflict. By defeault, Yacc resolves it in favor of the shift. Yacc has directives</p>
<pre>
       %left '+'
</pre>
<p>which says that '+' should be left-associative, which juts means that this shift/reduce conflict is resolved in favor of reduction instead.</p>
<pre>
       %right '+'
</pre>
<p>says that '+' should be righty-associative, so this shift/reduce conflict is resolved in favor of 'shift'. (This is the default, but the %right directive also suppresses the warning that you would otherwise get.) Finally, there's a</p>
<pre>
       %nonassoc '+'
</pre>
<p>which says that the shift/reduce conflict should be resolved by generating a parse error.</p>
<p>I hope this clears up enough of the details that you can trace through some more complicated bison .output files and understand what it going on. Equipped with this description, yo umay also be able to step through the py parser's runs using the Perl debugger and follow what is happening with the stack and the state machine.</p>
<p>The 'py' approach was very successful, and it would probably be easy to do in PHP. I recommend it.</p>
<p>Let me know if you have any questions.</p>

<div class="printfooter">
Retrieved from "<a href="http://en.wikipedia.org../../../b/o/t/Talk%7EBottom-up_parsing_b1ba.html">http://en.wikipedia.org../../../b/o/t/Talk%7EBottom-up_parsing_b1ba.html</a>"</div>
	    	    <!-- end content -->
	    <div class="visualClear"></div>
	  </div>
	</div>
      </div>
      <div id="column-one">
	<div id="p-cactions" class="portlet">
	  <h5>Views</h5>
	  <ul>
	    <li id="ca-nstab-main"
	       	       ><a href="../../../b/o/t/Bottom-up_parsing.html">Article</a></li><li id="ca-talk"
	       class="selected"	       ><a href="../../../b/o/t/Talk%7EBottom-up_parsing_b1ba.html">Discussion</a></li><li id="ca-current"
	       	       ><a href="http://en.wikipedia.org/wiki/Talk:Bottom-up_parsing">Current revision</a></li>	  </ul>
	</div>
	<div class="portlet" id="p-logo">
	  <a style="background-image: url(../../../images/wiki-en.png);"
	    href="../../../index.html"
	    title="Main Page"></a>
	</div>
	<script type="text/javascript"> if (window.isMSIE55) fixalpha(); </script>
		<div class='portlet' id='p-navigation'>
	  <h5>Navigation</h5>
	  <div class='pBody'>
	    <ul>
	    	      <li id="n-Main-page"><a href="../../../index.html">Main page</a></li>
	     	      <li id="n-Contents"><a href="../../../c/o/n/Wikipedia%7EContents_3181.html">Contents</a></li>
	     	      <li id="n-Featured-content"><a href="../../../f/e/a/Wikipedia%7EFeatured_content_24ba.html">Featured content</a></li>
	     	      <li id="n-currentevents"><a href="../../../c/u/r/Portal%7ECurrent_events_bb60.html">Current events</a></li>
	     	    </ul>
	  </div>
	</div>
		<div class='portlet' id='p-interaction'>
	  <h5>interaction</h5>
	  <div class='pBody'>
	    <ul>
	    	      <li id="n-About-Wikipedia"><a href="../../../a/b/o/Wikipedia%7EAbout_8d82.html">About Wikipedia</a></li>
	     	      <li id="n-portal"><a href="../../../c/o/m/Wikipedia%7ECommunity_Portal_6a3c.html">Community portal</a></li>
	     	      <li id="n-contact"><a href="../../../c/o/n/Wikipedia%7EContact_us_afd6.html">Contact us</a></li>
	     	      <li id="n-sitesupport"><a href="http://wikimediafoundation.org/wiki/Fundraising">Make a donation</a></li>
	     	      <li id="n-help"><a href="../../../c/o/n/Help%7EContents_22de.html">Help</a></li>
	     	    </ul>
	  </div>
	</div>
		<div id="p-search" class="portlet">
	  <h5><label for="searchInput">Search</label></h5>
	  <div id="searchBody" class="pBody">
	    <form action="javascript:goToStatic(3)" id="searchform"><div>
	      <input id="searchInput" name="search" type="text"
	        accesskey="f" value="" />
	      <input type='submit' name="go" class="searchButton" id="searchGoButton"
	        value="Go" />
	    </div></form>
	  </div>
	</div>
	      </div><!-- end of the left (by default at least) column -->
      <div class="visualClear"></div>
      <div id="footer">
    <div id="f-poweredbyico"><a href="http://www.mediawiki.org/"><img src="../../../skins/common/images/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" /></a></div>	<div id="f-copyrightico"><a href="http://wikimediafoundation.org/"><img src="../../../images/wikimedia-button.png" border="0" alt="Wikimedia Foundation"/></a></div>	<ul id="f-list">
	  	  	  <li id="f-credits">This page was last modified 16:28, 25 May 2004 by Wikipedia user <a href="../../../d/o/m/User%7EDominus_070e.html" title="User:Dominus">Dominus</a>. </li>	  <li id="f-copyright">All text is available under the terms of the <a class='internal' href="../../../t/e/x/Wikipedia%7EText_of_the_GNU_Free_Documentation_License_702a.html" title="Wikipedia:Text of the GNU Free Documentation License">GNU Free Documentation License</a>. (See <b><a class='internal' href="../../../c/o/p/Wikipedia%7ECopyrights_92c4.html" title="Wikipedia:Copyrights">Copyrights</a></b> for details.) <br /> Wikipedia&reg; is a registered trademark of the <a href="http://www.wikimediafoundation.org">Wikimedia Foundation, Inc</a>., a US-registered <a class='internal' href="../../../5/0/1/501%28c%29.html#501.28c.29.283.29" title="501(c)(3)">501(c)(3)</a> <a href="http://wikimediafoundation.org/wiki/Deductibility_of_donations">tax-deductible</a> <a class='internal' href="../../../n/o/n/Non-profit_organization.html" title="Non-profit organization">nonprofit</a> <a href="../../../c/h/a/Charitable_organization.html" title="Charitable organization">charity</a>.<br /></li>	  <li id="f-about"><a href="../../../a/b/o/Wikipedia%7EAbout_8d82.html" title="Wikipedia:About">About Wikipedia</a></li>	  <li id="f-disclaimer"><a href="../../../g/e/n/Wikipedia%7EGeneral_disclaimer_3e44.html" title="Wikipedia:General disclaimer">Disclaimers</a></li>	  	</ul>
      </div>
    </div>
  </body>
</html>
