<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    		<meta name="keywords" content="User:AmiDaniel/VP/RSS source,WP:VPRF" />
		<link rel="shortcut icon" href="/favicon.ico" />
		<link rel="search" type="application/opensearchdescription+xml" href="/w/opensearch_desc.php" title="Wikipedia (English)" />
		<link rel="copyright" href="../../../COPYING.html" />
    <title>User:AmiDaniel/VP/RSS source - Wikipedia, the free encyclopedia</title>
    <style type="text/css">/*<![CDATA[*/ @import "../../../skins/htmldump/main.css"; /*]]>*/</style>
    <link rel="stylesheet" type="text/css" media="print" href="../../../skins/common/commonPrint.css" />
    <!--[if lt IE 5.5000]><style type="text/css">@import "../../../skins/monobook/IE50Fixes.css";</style><![endif]-->
    <!--[if IE 5.5000]><style type="text/css">@import "../../../skins/monobook/IE55Fixes.css";</style><![endif]-->
    <!--[if IE 6]><style type="text/css">@import "../../../skins/monobook/IE60Fixes.css";</style><![endif]-->
    <!--[if IE]><script type="text/javascript" src="../../../skins/common/IEFixes.js"></script>
    <meta http-equiv="imagetoolbar" content="no" /><![endif]-->
    <script type="text/javascript" src="../../../skins/common/wikibits.js"></script>
    <script type="text/javascript" src="../../../skins/htmldump/md5.js"></script>
    <script type="text/javascript" src="../../../skins/htmldump/utf8.js"></script>
    <script type="text/javascript" src="../../../skins/htmldump/lookup.js"></script>
    <script type="text/javascript" src="../../../raw/gen.js"></script>        <style type="text/css">/*<![CDATA[*/
@import "../../../raw/MediaWiki%7ECommon.css";
@import "../../../raw/MediaWiki%7EMonobook.css";
@import "../../../raw/gen.css";
/*]]>*/</style>          </head>
  <body
    class="ns-2">
    <div id="globalWrapper">
      <div id="column-content">
	<div id="content">
	  <a name="top" id="contentTop"></a>
	        <h1 class="firstHeading">User:AmiDaniel/VP/RSS source</h1>
	  <div id="bodyContent">
	    <h3 id="siteSub">From Wikipedia, the free encyclopedia</h3>
	    <div id="contentSub"><span class="subpages">&lt; <a href="../../../a/m/i/User%7EAmiDaniel_52f1.html" title="User:AmiDaniel">User:AmiDaniel</a> | <a href="../../../a/m/i/User%7EAmiDaniel_VP_8641.html" title="User:AmiDaniel/VP">VP</a></span></div>
	    	    	    <!-- start content -->
	    <p>The following is the method being used in <a href="../../../v/p/r/WP%7EVPRF_2210.html" title="WP:VPRF">VandalProof</a> version 1.3 to retrieve items from the recent changes RSS feed, and as I've had many requests for it, I decided to copy it here. This method will work for an RSS RC feed on any foundation Wiki regardless of language, etc.</p>
<p>To use it, you will need to copy the following code into a module. Then you will need to retrieve the innerHTML of the RSS feed you wish to scrape (on en.wikipedia, it can be found at <a href="http://en.wikipedia.org/w/index.php?title=Special:Recentchanges&amp;feed=rss" class="external free" title="http://en.wikipedia.org/w/index.php?title=Special:Recentchanges&amp;feed=rss" rel="nofollow">http://en.wikipedia.org/w/index.php?title=Special:Recentchanges&amp;feed=rss</a>). Then pass the innerHTML to SplitItems (like so: SplitItems WB_RSS.Document.body.innerHTML). That will then populate the RSSItems variable with every RC item it finds in the feed.</p>
<pre>
Option Explicit

Public Type RSSItem
    BodyContent As String
    sUser As String
    
    sArticleName As String
    sPageAddress As String
    
    sSummary As String
    
    sAdded As String
    sRemoved As String
    sMatches As String
    
    sNewTime As String
    sOldTime As String
End Type

Public RSSItems() As RSSItem

Public Sub SplitItems(ByVal str$)
    Dim i%
    
    On Error Resume Next
    
    i = UBound(RSSItems)
    If Err Then
        Err.Clear
        ReDim RSSItems(0)
    End If
    
    On Error GoTo 0
    
    Do Until InStr(1, LCase(str), "&lt;item&gt;") = 0
        ReDim Preserve RSSItems(i)
        With RSSItems(i)
            .BodyContent = Left(str, InStr(1, LCase(str), "&lt;item&gt;") - 1)
            .BodyContent = FindAndReplace(.BodyContent, """/w", """" &amp; GlVars.Root &amp; "/w")
            
            
            .sArticleName = BetwixtStr(.BodyContent, "&lt;title&gt;", "&lt;/title&gt;")
            .sPageAddress = BetwixtStr(.BodyContent, "&lt;link&gt;", "&lt;/link&gt;")
            .sUser = BetwixtStr(.BodyContent, "&lt;dc:creator&gt;", "&lt;/dc:creator&gt;")
        
            .sNewTime = BetwixtStr(.BodyContent, "&lt;pubDate&gt;", "&lt;/pubdate&gt;")
            
            .sSummary = BetwixtStr(.BodyContent, "&lt;p&gt;", "&lt;/p&gt;")
        
            .sSummary = FindAndReplace(.sSummary, "&lt;span class=autocomment&gt;", "/*")
            .sSummary = FindAndReplace(.sSummary, "&lt;/span&gt;", "*/")
        
            .sAdded = GetAdded(.BodyContent)
            .sRemoved = GetRemoved(.BodyContent)
            
            .BodyContent = FindAndReplace(.BodyContent, "&lt;link&gt;" &amp; .sPageAddress &amp; "&lt;/link&gt;", "&lt;H2&gt;&lt;A href=""" &amp; .sPageAddress &amp; """&gt;" &amp; .sArticleName &amp; "&lt;/A&gt; (&lt;A href=""" &amp; _
                .sPageAddress &amp; "?diff=cur""&gt;last diff&lt;/A&gt;) (&lt;A href=""" &amp; GlVars.Root &amp; "/w/index.php?title=" &amp; Trim(StrtoHTML(.sArticleName)) &amp; "&amp;action=history""&gt;hist&lt;/A&gt;)&lt;/H2&gt;")
                
            If .sArticleName = "" &amp; GlVars.SpecialText &amp; "Log/newusers" Then
                .BodyContent = .BodyContent &amp; Chr(13) &amp; Chr(10) &amp; Chr(13) &amp; Chr(10) &amp; "&lt;H3&gt;&lt;A href=""$bcur:indef-unsername""&gt;Block Username&lt;/A&gt;&lt;/H3&gt;"
            End If
        End With
            
        str = Right(str, Len(str) - InStr(1, LCase(str), "&lt;item&gt;") - Len("&lt;item&gt;") + 1)
        'If InStr(1, lastinstr, LCase(str), "&lt;item&gt;") &gt; 0 Then lastinstr = InStr(1, lastinstr, LCase(str), "&lt;item&gt;")
        i = i + 1
    Loop
End Sub
    
Public Function BetwixtStr$(ByVal sIn$, ByVal sFirst$, ByVal sLast$)
    If InStr(sIn, sLast) Then
        BetwixtStr = Left(sIn, InStrRev(sIn, sLast) - 1)
        If InStr(BetwixtStr, sFirst) Then
            BetwixtStr = Right(BetwixtStr, Len(BetwixtStr) - InStr(BetwixtStr, sFirst) - Len(sFirst) + 1)
        End If
    End If
End Function

Public Function GetAdded$(ByVal sIn$)
    Dim fields
    
    Debug.Print
    Debug.Print sIn
    
    
    If InStr(1, sIn, "&lt;p&gt;&lt;b&gt;New page&lt;/b&gt;&lt;/p&gt;") Then GetAdded = "##NEWPAGE##"
    
    Do Until InStr(1, UCase(sIn), "&lt;TD STYLE=""FONT-SIZE: SMALLER; BACKGROUND: #CFC""&gt;") = 0
        sIn = Right(sIn, Len(sIn) - InStr(1, UCase(sIn), "&lt;TD STYLE=""FONT-SIZE: SMALLER; BACKGROUND: #CFC""&gt;") - Len("&lt;TD STYLE=""FONT-SIZE: SMALLER; BACKGROUND: #CFC""&gt;") + 1)
        GetAdded = GetAdded &amp; sIn
        GetAdded = Left(GetAdded, InStr(1, LCase(GetAdded), "&lt;/td&gt;") - 1)
    Loop
    
    GetAdded = FindAndReplace(GetAdded, "&lt;span style=""FONT-WEIGHT: bold; COLOR: red""&gt;", "")
    GetAdded = FindAndReplace(GetAdded, "&lt;/span&gt;", "")
    GetAdded = FindAndReplace(GetAdded, "&lt;/sup&gt;", "")
End Function

Public Function GetRemoved$(ByVal sIn$)
    Dim fields
    
    'If InStr(1, sIn, "&lt;p&gt;&lt;b&gt;New page&lt;/b&gt;&lt;/p&gt;") Then GetRemoved = "##NEWPAGE##"
    
    Do Until InStr(1, UCase(sIn), UCase("&lt;td style=""FONT-SIZE: smaller; BACKGROUND: #ffa""&gt;")) = 0
        sIn = Right(sIn, Len(sIn) - InStr(1, UCase(sIn), UCase("&lt;td style=""FONT-SIZE: smaller; BACKGROUND: #ffa""&gt;")) - Len("&lt;td style=""FONT-SIZE: smaller; BACKGROUND: #ffa""&gt;") + 1)
        GetRemoved = GetRemoved &amp; sIn
        GetRemoved = Left(GetRemoved, InStr(1, LCase(GetRemoved), "&lt;/td&gt;") - 1)
    Loop
    
    GetRemoved = FindAndReplace(GetRemoved, "&lt;span style=""FONT-WEIGHT: bold; COLOR: red""&gt;", "")
    GetRemoved = FindAndReplace(GetRemoved, "&lt;/span&gt;", "")
    GetRemoved = FindAndReplace(GetRemoved, "&lt;/sup&gt;", "")
End Function

Function FindAndReplace(ByVal strIn$, ByVal strFind$, ByVal strReplace$)
    Dim lastInstr%, lastInstr_New%
    
    lastInstr = 1
    Do Until InStr(lastInstr, strIn, strFind) = 0
        lastInstr_New = InStr(lastInstr, strIn, strFind)
        strIn = Left(strIn, InStr(lastInstr, strIn, strFind) - 1) &amp; strReplace &amp; Right(strIn, Len(strIn) - InStr(lastInstr, strIn, strFind) - Len(strFind) + 1)
        lastInstr = lastInstr_New
    Loop
    
    FindAndReplace = strIn
End Function
</pre>
<div class="printfooter">
Retrieved from "<a href="http://en.wikipedia.org../../../a/m/i/User%7EAmiDaniel_VP_RSS_source_78ab.html">http://en.wikipedia.org../../../a/m/i/User%7EAmiDaniel_VP_RSS_source_78ab.html</a>"</div>
	    	    <!-- end content -->
	    <div class="visualClear"></div>
	  </div>
	</div>
      </div>
      <div id="column-one">
	<div id="p-cactions" class="portlet">
	  <h5>Views</h5>
	  <ul>
	    <li id="ca-nstab-user"
	       class="selected"	       ><a href="../../../a/m/i/User%7EAmiDaniel_VP_RSS_source_78ab.html">User page</a></li><li id="ca-talk"
	       class="new"	       ><a href="../../../a/m/i/User_talk%7EAmiDaniel_VP_RSS_source_35dd.html">Discussion</a></li><li id="ca-current"
	       	       ><a href="http://en.wikipedia.org/wiki/User:AmiDaniel/VP/RSS_source">Current revision</a></li>	  </ul>
	</div>
	<div class="portlet" id="p-logo">
	  <a style="background-image: url(../../../images/wiki-en.png);"
	    href="../../../index.html"
	    title="Main Page"></a>
	</div>
	<script type="text/javascript"> if (window.isMSIE55) fixalpha(); </script>
		<div class='portlet' id='p-navigation'>
	  <h5>Navigation</h5>
	  <div class='pBody'>
	    <ul>
	    	      <li id="n-Main-page"><a href="../../../index.html">Main page</a></li>
	     	      <li id="n-Contents"><a href="../../../c/o/n/Wikipedia%7EContents_3181.html">Contents</a></li>
	     	      <li id="n-Featured-content"><a href="../../../f/e/a/Wikipedia%7EFeatured_content_24ba.html">Featured content</a></li>
	     	      <li id="n-currentevents"><a href="../../../c/u/r/Portal%7ECurrent_events_bb60.html">Current events</a></li>
	     	    </ul>
	  </div>
	</div>
		<div class='portlet' id='p-interaction'>
	  <h5>interaction</h5>
	  <div class='pBody'>
	    <ul>
	    	      <li id="n-About-Wikipedia"><a href="../../../a/b/o/Wikipedia%7EAbout_8d82.html">About Wikipedia</a></li>
	     	      <li id="n-portal"><a href="../../../c/o/m/Wikipedia%7ECommunity_Portal_6a3c.html">Community portal</a></li>
	     	      <li id="n-contact"><a href="../../../c/o/n/Wikipedia%7EContact_us_afd6.html">Contact us</a></li>
	     	      <li id="n-sitesupport"><a href="http://wikimediafoundation.org/wiki/Fundraising">Make a donation</a></li>
	     	      <li id="n-help"><a href="../../../c/o/n/Help%7EContents_22de.html">Help</a></li>
	     	    </ul>
	  </div>
	</div>
		<div id="p-search" class="portlet">
	  <h5><label for="searchInput">Search</label></h5>
	  <div id="searchBody" class="pBody">
	    <form action="javascript:goToStatic(3)" id="searchform"><div>
	      <input id="searchInput" name="search" type="text"
	        accesskey="f" value="" />
	      <input type='submit' name="go" class="searchButton" id="searchGoButton"
	        value="Go" />
	    </div></form>
	  </div>
	</div>
	      </div><!-- end of the left (by default at least) column -->
      <div class="visualClear"></div>
      <div id="footer">
    <div id="f-poweredbyico"><a href="http://www.mediawiki.org/"><img src="../../../skins/common/images/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" /></a></div>	<div id="f-copyrightico"><a href="http://wikimediafoundation.org/"><img src="../../../images/wikimedia-button.png" border="0" alt="Wikimedia Foundation"/></a></div>	<ul id="f-list">
	  	  	  <li id="f-credits">This page was last modified 00:06, 30 June 2006 by Wikipedia user <a href="../../../a/m/i/User%7EAmiDaniel_52f1.html" title="User:AmiDaniel">AmiDaniel</a>. </li>	  <li id="f-copyright">All text is available under the terms of the <a class='internal' href="../../../t/e/x/Wikipedia%7EText_of_the_GNU_Free_Documentation_License_702a.html" title="Wikipedia:Text of the GNU Free Documentation License">GNU Free Documentation License</a>. (See <b><a class='internal' href="../../../c/o/p/Wikipedia%7ECopyrights_92c4.html" title="Wikipedia:Copyrights">Copyrights</a></b> for details.) <br /> Wikipedia&reg; is a registered trademark of the <a href="http://www.wikimediafoundation.org">Wikimedia Foundation, Inc</a>., a US-registered <a class='internal' href="../../../5/0/1/501%28c%29.html#501.28c.29.283.29" title="501(c)(3)">501(c)(3)</a> <a href="http://wikimediafoundation.org/wiki/Deductibility_of_donations">tax-deductible</a> <a class='internal' href="../../../n/o/n/Non-profit_organization.html" title="Non-profit organization">nonprofit</a> <a href="../../../c/h/a/Charitable_organization.html" title="Charitable organization">charity</a>.<br /></li>	  <li id="f-about"><a href="../../../a/b/o/Wikipedia%7EAbout_8d82.html" title="Wikipedia:About">About Wikipedia</a></li>	  <li id="f-disclaimer"><a href="../../../g/e/n/Wikipedia%7EGeneral_disclaimer_3e44.html" title="Wikipedia:General disclaimer">Disclaimers</a></li>	  	</ul>
      </div>
    </div>
  </body>
</html>
