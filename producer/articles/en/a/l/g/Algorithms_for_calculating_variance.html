<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    		<meta name="keywords" content="Algorithms for calculating variance,Algorithm,Arithmetic overflow,Compensated summation,Donald E. Knuth,Estimator bias,Floating-point,Formula,IEEE 754,MathWorld,Mean" />
		<link rel="shortcut icon" href="/favicon.ico" />
		<link rel="search" type="application/opensearchdescription+xml" href="/w/opensearch_desc.php" title="Wikipedia (English)" />
		<link rel="copyright" href="../../../COPYING.html" />
    <title>Algorithms for calculating variance - Wikipedia, the free encyclopedia</title>
    <style type="text/css">/*<![CDATA[*/ @import "../../../skins/htmldump/main.css"; /*]]>*/</style>
    <link rel="stylesheet" type="text/css" media="print" href="../../../skins/common/commonPrint.css" />
    <!--[if lt IE 5.5000]><style type="text/css">@import "../../../skins/monobook/IE50Fixes.css";</style><![endif]-->
    <!--[if IE 5.5000]><style type="text/css">@import "../../../skins/monobook/IE55Fixes.css";</style><![endif]-->
    <!--[if IE 6]><style type="text/css">@import "../../../skins/monobook/IE60Fixes.css";</style><![endif]-->
    <!--[if IE]><script type="text/javascript" src="../../../skins/common/IEFixes.js"></script>
    <meta http-equiv="imagetoolbar" content="no" /><![endif]-->
    <script type="text/javascript" src="../../../skins/common/wikibits.js"></script>
    <script type="text/javascript" src="../../../skins/htmldump/md5.js"></script>
    <script type="text/javascript" src="../../../skins/htmldump/utf8.js"></script>
    <script type="text/javascript" src="../../../skins/htmldump/lookup.js"></script>
    <script type="text/javascript" src="../../../raw/gen.js"></script>        <style type="text/css">/*<![CDATA[*/
@import "../../../raw/MediaWiki%7ECommon.css";
@import "../../../raw/MediaWiki%7EMonobook.css";
@import "../../../raw/gen.css";
/*]]>*/</style>          </head>
  <body
    class="ns-0">
    <div id="globalWrapper">
      <div id="column-content">
	<div id="content">
	  <a name="top" id="contentTop"></a>
	        <h1 class="firstHeading">Algorithms for calculating variance</h1>
	  <div id="bodyContent">
	    <h3 id="siteSub">From Wikipedia, the free encyclopedia</h3>
	    <div id="contentSub"></div>
	    	    <div class="usermessage">You have <a href="../../../1/2/7/User_talk%7E127.0.0.1.html" title="User talk:127.0.0.1">new messages</a> (<a href="../../../1/2/7/User_talk%7E127.0.0.1.html" title="User talk:127.0.0.1">last change</a>).</div>	    <!-- start content -->
	    <p><b><a href="../../../a/l/g/Algorithm.html" title="Algorithm">Algorithms</a> for calculating <a href="../../../v/a/r/Variance.html" title="Variance">variance</a></b> play a minor role in <a href="../../../s/t/a/Statistics.html" title="Statistics">statistical</a> computing. A key problem in the design of good algorithms for this problem is that formulas for the variance may involve sums of squares, which can lead to <a href="../../../n/u/m/Numerical_instability.html" title="Numerical instability">numerical instability</a> as well as to <a href="../../../a/r/i/Arithmetic_overflow.html" title="Arithmetic overflow">arithmetic overflow</a> when dealing with large values.</p>
<table id="toc" class="toc" summary="Contents">
<tr>
<td>
<div id="toctitle">
<h2>Contents</h2>
</div>
<ul>
<li class="toclevel-1"><a href="#Algorithm_I"><span class="tocnumber">1</span> <span class="toctext">Algorithm I</span></a></li>
<li class="toclevel-1"><a href="#Algorithm_II"><span class="tocnumber">2</span> <span class="toctext">Algorithm II</span></a></li>
<li class="toclevel-1"><a href="#Algorithm_III"><span class="tocnumber">3</span> <span class="toctext">Algorithm III</span></a></li>
<li class="toclevel-1"><a href="#Example"><span class="tocnumber">4</span> <span class="toctext">Example</span></a></li>
<li class="toclevel-1"><a href="#References"><span class="tocnumber">5</span> <span class="toctext">References</span></a></li>
<li class="toclevel-1"><a href="#External_links"><span class="tocnumber">6</span> <span class="toctext">External links</span></a></li>
</ul>
</td>
</tr>
</table>
<p><script type="text/javascript">
//<![CDATA[
 if (window.showTocToggle) { var tocShowText = "show"; var tocHideText = "hide"; showTocToggle(); } 
//]]>
</script><a name="Algorithm_I" id="Algorithm_I"></a></p>
<h2><span class="editsection">[<a href="../../../a/l/g/Algorithms_for_calculating_variance.html" title="Edit section: Algorithm I">edit</a>]</span> <span class="mw-headline">Algorithm I</span></h2>
<p>The <a href="../../../f/o/r/Formula.html" title="Formula">formula</a> for calculating the variance of an entire <a href="../../../s/t/a/Statistical_population.html" title="Statistical population">population</a> of size <i>n</i> is:</p>
<dl>
<dd><img class='tex' src="../../../math/6/a/2/6a2e33f238c24caa4f246efa035a1c9f.png" alt="\sigma^2 = \frac {\sum_{i=1}^{n} x_i^2 - (\sum_{i=1}^{n} x_i)^2/n}{n}. \!" /></dd>
</dl>
<p>The formula for calculating an <a href="../../../e/s/t/Estimator_bias.html" title="Estimator bias">unbiased</a> estimate of the population variance from a finite <a href="../../../s/t/a/Statistical_sample.html" title="Statistical sample">sample</a> of <i>n</i> observations is:</p>
<dl>
<dd><img class='tex' src="../../../math/8/5/c/85c73db61ca79a1523bc9e3cf35a6865.png" alt="s^2 = \frac {\sum_{i=1}^{n} x_i^2 - (\sum_{i=1}^{n} x_i)^2/n}{n-1}. \!" /></dd>
</dl>
<p>Therefore a naive algorithm to calculate the estimated variance is given by the following <a href="../../../p/s/e/Pseudocode.html" title="Pseudocode">pseudocode</a>:</p>
<pre>
n = 0
sum = 0
sum_sqr = 0

foreach x in data:
  n = n + 1
  sum = sum + x
  sum_sqr = sum_sqr + x*x
end for

mean = sum/n
variance = (sum_sqr - sum*mean)/(n - 1)
</pre>
<p>This algorithm can easily be adapted to compute the variance of a finite population: simply divide by <i>n</i> instead of <i>n</i> âˆ’ 1 on the last line.</p>
<p>Because <code>sum_sqr</code> and <code>sum * mean</code> can be very similar numbers, the <a href="../../../p/r/e/Precision_%28arithmetic%29.html" title="Precision (arithmetic)">precision</a> of the result can be much less than the inherent precision of the <a href="../../../f/l/o/Floating-point.html" title="Floating-point">floating-point</a> arithmetic used to perform the computation. This is particularly bad if the variance is small relative to the sum of the numbers.</p>
<p><a name="Algorithm_II" id="Algorithm_II"></a></p>
<h2><span class="editsection">[<a href="../../../a/l/g/Algorithms_for_calculating_variance.html" title="Edit section: Algorithm II">edit</a>]</span> <span class="mw-headline">Algorithm II</span></h2>
<p>An alternate approach, using a different formula for the variance, is given by the following pseudocode:</p>
<pre>
n = 0
sum1 = 0
foreach x in data:
  n = n + 1
  sum1 = sum1 + x
end for
mean = sum1/n

sum2 = 0
foreach x in data:
  sum2 = sum2 + (x - mean)^2
end for
variance = sum2/(n - 1)
</pre>
<p>This algorithm is often more numerically reliable than Algorithm I for large sets of data, although it can be worse if much of the data is very close to but not precisely equal to the mean and some are quite far away from it.</p>
<p>The results of both of these simple algorithms (I and II) can depend inordinately on the ordering of the data and can give poor results for very large data sets due to repeated roundoff error in the accumulation of the sums; techniques such as <a href="../../../c/o/m/Compensated_summation.html" title="Compensated summation">compensated summation</a> can be used to combat this to a degree.</p>
<p><a name="Algorithm_III" id="Algorithm_III"></a></p>
<h2><span class="editsection">[<a href="../../../a/l/g/Algorithms_for_calculating_variance.html" title="Edit section: Algorithm III">edit</a>]</span> <span class="mw-headline">Algorithm III</span></h2>
<p>The following formulas can be used to update the <a href="../../../m/e/a/Mean.html" title="Mean">mean</a> and (estimated) variance of the sequence, for an additional element <span class="texhtml"><i>x</i><sub>new</sub></span>. Here, <i>m</i> denotes the estimate of the population mean, <i>s</i><sup>2</sup><sub>n-1</sub> the estimate of the population variance, <i>s</i><sup>2</sup><sub>n</sub> the estimate of the sample variance, and <i>n</i> the number of elements in the sequence before the addition.</p>
<dl>
<dd><img class='tex' src="../../../math/b/f/d/bfd6707371fd9e9e2d6c86c8aa3a7dec.png" alt="m_{\mathrm{new}} = \frac{n \; m_{\mathrm{old}} + x_{\mathrm{new}}}{n+1} = m_{\mathrm{old}} + \frac{x_{\mathrm{new}} - m_{\mathrm{old}}}{n+1} \!" /></dd>
</dl>
<dl>
<dd><img class='tex' src="../../../math/7/2/1/72199990bee17c3d529f0ac7375410c2.png" alt="s^2_{\mathrm{n-1, new}} = \frac{(n-1) \; s^2_{\mathrm{n-1, old}} + (x_{\mathrm{new}} - m_{\mathrm{new}}) \, (x_{\mathrm{new}} - m_{\mathrm{old}})}{n} \; \; \, \,  \; \,     \mathrm{n&gt;0} \!" /></dd>
</dl>
<dl>
<dd><img class='tex' src="../../../math/6/1/2/61233f65c8dee60a4e034d148c547e9e.png" alt="s^2_{\mathrm{n, new}} = \frac{(n) \; s^2_{\mathrm{n, old}} + (x_{\mathrm{new}} - m_{\mathrm{new}}) \, (x_{\mathrm{new}} - m_{\mathrm{old}})}{n+1} \!" /></dd>
</dl>
<p>A numerically stable algorithm is given below. It also computes the mean. This algorithm is due to Knuth,<sup id="_ref-0" class="reference"><a href="#_note-0" title="">[1]</a></sup> who cites Welford.<sup id="_ref-1" class="reference"><a href="#_note-1" title="">[2]</a></sup></p>
<pre>
n = 0
mean = 0
S = 0

foreach x in data:
  n = n + 1
  delta = x - mean
  mean = mean + delta/n
  S = S + delta*(x - mean)      // This expression uses the new value of mean
end for

variance = S/(n - 1)
</pre>
<p>This algorithm is much less prone to loss of precision due to massive cancellation, but might not be as efficient because of the division operation inside the loop. For a particularly robust two-pass algorithm for computing the variance, first compute and subtract an estimate of the mean, and then use this algorithm on the residuals.</p>
<p>This is an example of an <a href="../../../o/n/l/Online_algorithm.html" title="Online algorithm">online algorithm</a> because only the last value of the mean and the variance is required.</p>
<p><a name="Example" id="Example"></a></p>
<h2><span class="editsection">[<a href="../../../a/l/g/Algorithms_for_calculating_variance.html" title="Edit section: Example">edit</a>]</span> <span class="mw-headline">Example</span></h2>
<p>Assume that all floating point operations use the standard <a href="../../../i/e/e/IEEE_754_beb2.html#Double-precision_64_bit" title="IEEE 754">IEEE 754 double-precision</a> arithmetic. Consider the sample (4, 7, 13, 16) from an infinite population. Based on this sample, the estimated population mean is 10, and the estimated population variance is 30. Both algorithms compute these values correctly. Next consider the sample (<span class="texhtml">10<sup>8</sup> + 4</span>, <span class="texhtml">10<sup>8</sup> + 7</span>, <span class="texhtml">10<sup>8</sup> + 13</span>, <span class="texhtml">10<sup>8</sup> + 16</span>), which gives rise to the same estimated variance as the first sample. Algorithm II computes this variance estimate correctly, but Algorithm I returns 29.333333333333332 instead of 30. While this loss of precision may be tolerable and viewed as a minor flaw of Algorithm I, it is easy to find data that reveal a major flaw in the naive algorithm: Take the sample to be (<span class="texhtml">10<sup>9</sup> + 4</span>, <span class="texhtml">10<sup>9</sup> + 7</span>, <span class="texhtml">10<sup>9</sup> + 13</span>, <span class="texhtml">10<sup>9</sup> + 16</span>). Again the estimated population variance of 30 is computed correctly by Algorithm II, but the naive algorithm now computes it as -170.66666666666666. This is a serious problem with Algorithm I, since the variance can, by definition, never be negative.</p>
<p><a name="References" id="References"></a></p>
<h2><span class="editsection">[<a href="../../../a/l/g/Algorithms_for_calculating_variance.html" title="Edit section: References">edit</a>]</span> <span class="mw-headline">References</span></h2>
<ol class="references">
<li id="_note-0"><b><a href="#_ref-0" title="">^</a></b> <a href="../../../d/o/n/Donald_E._Knuth_7273.html" title="Donald E. Knuth">Donald E. Knuth</a> (1998). <i><a href="../../../t/h/e/The_Art_of_Computer_Programming_442b.html" title="The Art of Computer Programming">The Art of Computer Programming</a></i>, volume 2: <i>Seminumerical Algorithms</i>, 3rd edn., p. 232. Boston: Addison-Wesley.</li>
<li id="_note-1"><b><a href="#_ref-1" title="">^</a></b> B. P. Welford (1962). "Note on a method for calculating corrected sums of squares and products". <i>Technometrics</i> 4(3):419â€“420.</li>
</ol>
<p><a name="External_links" id="External_links"></a></p>
<h2><span class="editsection">[<a href="../../../a/l/g/Algorithms_for_calculating_variance.html" title="Edit section: External links">edit</a>]</span> <span class="mw-headline">External links</span></h2>
<ul>
<li>Eric W. Weisstein, <i><a href="http://mathworld.wolfram.com/SampleVarianceComputation.html" class="external text" title="http://mathworld.wolfram.com/SampleVarianceComputation.html" rel="nofollow">Sample Variance Computation</a></i> at <a href="../../../m/a/t/MathWorld_3918.html" title="MathWorld">MathWorld</a>.</li>
</ul>

<div class="printfooter">
Retrieved from "<a href="http://en.wikipedia.org../../../a/l/g/Algorithms_for_calculating_variance.html">http://en.wikipedia.org../../../a/l/g/Algorithms_for_calculating_variance.html</a>"</div>
	    <div id="catlinks"><p class='catlinks'><a href="../../../c/a/t/Special%7ECategories_101d.html" title="Special:Categories">Category</a>: <span dir='ltr'><a href="../../../s/t/a/Category%7EStatistical_algorithms_e1c0.html" title="Category:Statistical algorithms">Statistical algorithms</a></span></p></div>	    <!-- end content -->
	    <div class="visualClear"></div>
	  </div>
	</div>
      </div>
      <div id="column-one">
	<div id="p-cactions" class="portlet">
	  <h5>Views</h5>
	  <ul>
	    <li id="ca-nstab-main"
	       class="selected"	       ><a href="../../../a/l/g/Algorithms_for_calculating_variance.html">Article</a></li><li id="ca-talk"
	       	       ><a href="../../../a/l/g/Talk%7EAlgorithms_for_calculating_variance_3327.html">Discussion</a></li><li id="ca-current"
	       	       ><a href="http://en.wikipedia.org/wiki/Algorithms_for_calculating_variance">Current revision</a></li>	  </ul>
	</div>
	<div class="portlet" id="p-logo">
	  <a style="background-image: url(../../../images/wiki-en.png);"
	    href="../../../index.html"
	    title="Main Page"></a>
	</div>
	<script type="text/javascript"> if (window.isMSIE55) fixalpha(); </script>
		<div class='portlet' id='p-navigation'>
	  <h5>Navigation</h5>
	  <div class='pBody'>
	    <ul>
	    	      <li id="n-Main-page"><a href="../../../index.html">Main page</a></li>
	     	      <li id="n-Contents"><a href="../../../c/o/n/Wikipedia%7EContents_3181.html">Contents</a></li>
	     	      <li id="n-Featured-content"><a href="../../../f/e/a/Wikipedia%7EFeatured_content_24ba.html">Featured content</a></li>
	     	      <li id="n-currentevents"><a href="../../../c/u/r/Portal%7ECurrent_events_bb60.html">Current events</a></li>
	     	    </ul>
	  </div>
	</div>
		<div class='portlet' id='p-interaction'>
	  <h5>interaction</h5>
	  <div class='pBody'>
	    <ul>
	    	      <li id="n-About-Wikipedia"><a href="../../../a/b/o/Wikipedia%7EAbout_8d82.html">About Wikipedia</a></li>
	     	      <li id="n-portal"><a href="../../../c/o/m/Wikipedia%7ECommunity_Portal_6a3c.html">Community portal</a></li>
	     	      <li id="n-contact"><a href="../../../c/o/n/Wikipedia%7EContact_us_afd6.html">Contact us</a></li>
	     	      <li id="n-sitesupport"><a href="http://wikimediafoundation.org/wiki/Fundraising">Make a donation</a></li>
	     	      <li id="n-help"><a href="../../../c/o/n/Help%7EContents_22de.html">Help</a></li>
	     	    </ul>
	  </div>
	</div>
		<div id="p-search" class="portlet">
	  <h5><label for="searchInput">Search</label></h5>
	  <div id="searchBody" class="pBody">
	    <form action="javascript:goToStatic(3)" id="searchform"><div>
	      <input id="searchInput" name="search" type="text"
	        accesskey="f" value="" />
	      <input type='submit' name="go" class="searchButton" id="searchGoButton"
	        value="Go" />
	    </div></form>
	  </div>
	</div>
	      </div><!-- end of the left (by default at least) column -->
      <div class="visualClear"></div>
      <div id="footer">
    <div id="f-poweredbyico"><a href="http://www.mediawiki.org/"><img src="../../../skins/common/images/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" /></a></div>	<div id="f-copyrightico"><a href="http://wikimediafoundation.org/"><img src="../../../images/wikimedia-button.png" border="0" alt="Wikimedia Foundation"/></a></div>	<ul id="f-list">
	  	  	  <li id="f-credits">This page was last modified 21:05, 30 March 2007 by Wikipedia user Dougmoby. Based on work by Wikipedia user(s) <a href="../../../z/v/i/User%7EZvika_5f01.html" title="User:Zvika">Zvika</a>, <a href="../../../r/b/o/User%7ERbonvall_37e7.html" title="User:Rbonvall">Rbonvall</a>, <a href="../../../p/i/e/User%7EPiet_Delport_08f7.html" title="User:Piet Delport">Piet Delport</a>, <a href="../../../d/e/n/User%7EDen_fj%C3%A4ttrade_ankan_996f.html" title="User:Den fjÃ¤ttrade ankan">Den fjÃ¤ttrade ankan</a>, <a href="../../../t/a/r/User%7ETardis_51e3.html" title="User:Tardis">Tardis</a>, <a href="../../../l/i/g/User%7ELigulem_20b6.html" title="User:Ligulem">Ligulem</a>, <a href="../../../m/a/r/User%7EMarkSweep_b58d.html" title="User:MarkSweep">MarkSweep</a>, <a href="../../../b/t/y/User%7EBtyner_9437.html" title="User:Btyner">Btyner</a>, <a href="../../../r/b/j/User%7ERbj_42ae.html" title="User:Rbj">Rbj</a>, <a href="../../../e/n/c/User%7EEncephalon_6951.html" title="User:Encephalon">Encephalon</a>, <a href="../../../m/a/t/User%7EMathbot_604f.html" title="User:Mathbot">Mathbot</a>, <a href="../../../m/i/c/User%7EMichael_Hardy_e932.html" title="User:Michael Hardy">Michael Hardy</a>, <a href="../../../a/g/t/User%7EAgthorr_2136.html" title="User:Agthorr">Agthorr</a>, <a href="../../../o/l/e/User%7EOleg_Alexandrov_8bb5.html" title="User:Oleg Alexandrov">Oleg Alexandrov</a>, <a href="../../../r/i/c/User%7ERichss_08f6.html" title="User:Richss">Richss</a>, Nicholas.Gimbrone, <a href="../../../g/u/a/User%7EGuanabot_b902.html" title="User:Guanabot">Guanabot</a>, <a href="../../../j/a/n/User%7EJanna_1f5b.html" title="User:Janna">Janna</a>, <a href="../../../g/u/a/User%7EGuanabot2_6dba.html" title="User:Guanabot2">Guanabot2</a>, <a href="../../../w/m/a/User%7EWmahan_ede0.html" title="User:Wmahan">Wmahan</a>, <a href="../../../s/i/m/User%7ESimonArlott_c5b6.html" title="User:SimonArlott">SimonArlott</a>, <a href="../../../t/a/k/User%7ETakanoha_aa3b.html" title="User:Takanoha">Takanoha</a>, <a href="../../../a/n/g/User%7EAngela_56ea.html" title="User:Angela">Angela</a>, <a href="../../../c/y/a/User%7ECyan_b70d.html" title="User:Cyan">Cyan</a>, <a href="../../../g/e/o/User%7EGeoffrey_54da.html" title="User:Geoffrey">Geoffrey</a> and <a href="../../../t/o/b/User%7ETobias_Hoevekamp_485e.html" title="User:Tobias Hoevekamp">Tobias Hoevekamp</a> and Anonymous user(s) of Wikipedia.</li>	  <li id="f-copyright">All text is available under the terms of the <a class='internal' href="../../../t/e/x/Wikipedia%7EText_of_the_GNU_Free_Documentation_License_702a.html" title="Wikipedia:Text of the GNU Free Documentation License">GNU Free Documentation License</a>. (See <b><a class='internal' href="../../../c/o/p/Wikipedia%7ECopyrights_92c4.html" title="Wikipedia:Copyrights">Copyrights</a></b> for details.) <br /> Wikipedia&reg; is a registered trademark of the <a href="http://www.wikimediafoundation.org">Wikimedia Foundation, Inc</a>., a US-registered <a class='internal' href="../../../5/0/1/501%28c%29.html#501.28c.29.283.29" title="501(c)(3)">501(c)(3)</a> <a href="http://wikimediafoundation.org/wiki/Deductibility_of_donations">tax-deductible</a> <a class='internal' href="../../../n/o/n/Non-profit_organization.html" title="Non-profit organization">nonprofit</a> <a href="../../../c/h/a/Charitable_organization.html" title="Charitable organization">charity</a>.<br /></li>	  <li id="f-about"><a href="../../../a/b/o/Wikipedia%7EAbout_8d82.html" title="Wikipedia:About">About Wikipedia</a></li>	  <li id="f-disclaimer"><a href="../../../g/e/n/Wikipedia%7EGeneral_disclaimer_3e44.html" title="Wikipedia:General disclaimer">Disclaimers</a></li>	  	</ul>
      </div>
    </div>
  </body>
</html>
