<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    		<meta name="keywords" content="User:Ais523/wikEd.js,Bypass your cache" />
		<link rel="shortcut icon" href="/favicon.ico" />
		<link rel="search" type="application/opensearchdescription+xml" href="/w/opensearch_desc.php" title="Wikipedia (English)" />
		<link rel="copyright" href="../../../COPYING.html" />
    <title>User:Ais523/wikEd.js - Wikipedia, the free encyclopedia</title>
    <style type="text/css">/*<![CDATA[*/ @import "../../../skins/htmldump/main.css"; /*]]>*/</style>
    <link rel="stylesheet" type="text/css" media="print" href="../../../skins/common/commonPrint.css" />
    <!--[if lt IE 5.5000]><style type="text/css">@import "../../../skins/monobook/IE50Fixes.css";</style><![endif]-->
    <!--[if IE 5.5000]><style type="text/css">@import "../../../skins/monobook/IE55Fixes.css";</style><![endif]-->
    <!--[if IE 6]><style type="text/css">@import "../../../skins/monobook/IE60Fixes.css";</style><![endif]-->
    <!--[if IE]><script type="text/javascript" src="../../../skins/common/IEFixes.js"></script>
    <meta http-equiv="imagetoolbar" content="no" /><![endif]-->
    <script type="text/javascript" src="../../../skins/common/wikibits.js"></script>
    <script type="text/javascript" src="../../../skins/htmldump/md5.js"></script>
    <script type="text/javascript" src="../../../skins/htmldump/utf8.js"></script>
    <script type="text/javascript" src="../../../skins/htmldump/lookup.js"></script>
    <script type="text/javascript" src="../../../raw/gen.js"></script>        <style type="text/css">/*<![CDATA[*/
@import "../../../raw/MediaWiki%7ECommon.css";
@import "../../../raw/MediaWiki%7EMonobook.css";
@import "../../../raw/gen.css";
/*]]>*/</style>          </head>
  <body
    class="ns-2">
    <div id="globalWrapper">
      <div id="column-content">
	<div id="content">
	  <a name="top" id="contentTop"></a>
	        <h1 class="firstHeading">User:Ais523/wikEd.js</h1>
	  <div id="bodyContent">
	    <h3 id="siteSub">From Wikipedia, the free encyclopedia</h3>
	    <div id="contentSub"><span class="subpages">&lt; <a href="../../../a/i/s/User%7EAis523_9dee.html" title="User:Ais523">User:Ais523</a></span></div>
	    	    <div class="usermessage">You have <a href="../../../1/2/7/User_talk%7E127.0.0.1.html" title="User talk:127.0.0.1">new messages</a> (<a href="../../../1/2/7/User_talk%7E127.0.0.1.html" title="User talk:127.0.0.1">last change</a>).</div>	    <!-- start content -->
	    <p><span id="clearyourcache"><b>Note:</b> After saving, you have to <a href="../../../b/y/p/Wikipedia%7EBypass_your_cache_1dae.html" title="Wikipedia:Bypass your cache">bypass your browser's cache</a> to see the changes. <b>Firefox/Mozilla/Safari:</b> hold down <i>Shift</i> while clicking <i>Reload</i> (or press <i>Ctrl-Shift-R</i>), <b>Internet Explorer:</b> press <i>Ctrl-F5</i>, <b>Opera/Konqueror:</b> press <i>F5</i>. 
</span>
</p><pre>// This line is numbered 2 in IE
// This is a copy of [[User:Cacycle/wikEd.js]], so I have my own modifiable copy
/* {{en:User:Cacycle/wikEd_template}} &lt;pre clear=&quot;all&quot;&gt;&lt;nowiki&gt;

/*
Name:      wikEd (wikEd.js)
Version:   wikEd 0.9.x (beta) (December, 2006). The code is currently under active development and might change rapidly
What:      Comfortable JavaScript editor for Wikipedia and other MediaWikis
Update:    press SHIFT-Reload to update to the newest version
Homepage:  http://en.wikipedia.org/wiki/User:Cacycle/wikEd
Help:      http://en.wikipedia.org/wiki/User:Cacycle/wikEd_help
Code:      http://en.wikipedia.org/wiki/User:Cacycle/wikEd.js
Author:    Cacycle (http://en.wikipedia.org/wiki/User:Cacycle)
Browsers:  The program works ONLY for Mozilla-based browsers (Mozilla, Mozilla Firefox, and Mozilla SeaMonkey).
           User:ais523 is trying to get it to work on IE.
License:   This code has been released into the public domain
Important: This file might have to be saved as UTF-16 in your editor to preserve the Unicode characters at the end
*/

// version information
var wikEdProgramVersion  = '0.9.12a (beta)';
var wikEdProgramDate     = 'December 2, 2006';


//
// user configurable variables
//


// user readable texts, preset as wikEdText[''] = '';
// copy changes to http://en.wikipedia.org/wiki/User:Cacycle/wikEd_international_en.js
var wikEdText = wikEdText || [];
WikEdInitObject(wikEdText, {

// logo
	'wikEdLogo alt':               'WikEd',
	'wikEdLogo title':             'WikEd {wikEdProgramVersion} ({wikEdProgramDate}) Click to disable',
	'wikEdLogo error alt':         'WikEd error',
	'wikEdLogo error title':       'Loading error - WikEd {wikEdProgramVersion} ({wikEdProgramDate}) Click to disable',
	'wikEdLogo disabled alt':      '(WikEd)',
	'wikEdLogo disabled title':    'Disabled - WikEd {wikEdProgramVersion} ({wikEdProgramDate}) Click to enable',

// standard preview jumper
	'wikEdScrollToButtons4 alt':   'Scroll buttons',
	'wikEdScrollToButtons4 title': 'Scroll to edit buttons',
	'wikEdScrollToInput4 alt':     'Scroll edit',
	'wikEdScrollToInput4 title':   'Scroll to edit window',

// formatting buttons, top row
	'wikEdUndo alt':               'Undo',
	'wikEdUndo title':             'Undo',
	'wikEdRedo alt':               'Redo',
	'wikEdRedo title':             'Redo',
	'wikEdBold alt':               'Bold',
	'wikEdBold title':             'Bold text',
	'wikEdItalic alt':             'Italic',
	'wikEdItalic title':           'Italic text',
	'wikEdUnderline alt':          'Underline',
	'wikEdUnderline title':        'Underline text',
	'wikEdStrikethrough alt':      'Strikethrough',
	'wikEdStrikethrough title':    'Strikethrough text',
	'wikEdNowiki alt':             'Nowiki',
	'wikEdNowiki title':           'Nowiki markup text',
	'wikEdSuperscript alt':        'Superscript',
	'wikEdSuperscript title':      'Superscript text',
	'wikEdSubscript alt':          'Subscript',
	'wikEdSubscript title':        'Subscript text',
	'wikEdCase alt':               'Case',
	'wikEdCase title':             'Toggle between lowercase, uppercase first, and uppercase',
	'wikEdUndoAll alt':            'Undo all',
	'wikEdUndoAll title':          'Undo all changes',
	'wikEdRedoAll alt':            'Redo all',
	'wikEdRedoAll title':          'Redo all changes',
	'wikEdUpdateSyntax alt':       'Syntax',
	'wikEdUpdateSyntax title':     'Update syntax highlighting',

// formatting buttons, bottom row
	'wikEdWikiLink alt':           'Link',
	'wikEdWikiLink title':         'Wiki link',
	'wikEdWebLink alt':            'Weblink',
	'wikEdWebLink title':          'External weblink',
	'wikEdDecreaseHeading alt':    'Heading-',
	'wikEdDecreaseHeading title':  'Decrease heading levels',
	'wikEdIncreaseHeading alt':    'Heading+',
	'wikEdIncreaseHeading title':  'Increase heading levels',
	'wikEdBulletList alt':         'Bullet list',
	'wikEdBulletList title':       'Bulleted list',
	'wikEdNumberList alt':         'Number list',
	'wikEdNumberList title':       'Numbered list',
	'wikEdIndentList alt':         'Indent list',
	'wikEdIndentList title':       'Indented list',
	'wikEdDefinitionList alt':     'Def list',
	'wikEdDefinitionList title':   'Definition list',
	'wikEdImage alt':              'Image',
	'wikEdImage title':            'Image',
	'wikEdTable alt':              'Table',
	'wikEdTable title':            'Table',
	'wikEdRedirect alt':           'Redirect',
	'wikEdRedirect title':         'Create redirect, deletes whole text',
	'wikEdWikify alt':             'Wikify',
	'wikEdWikify title':           'Wikify pasted content',
	'wikEdTextify alt':            'Textify',
	'wikEdTextify title':          'Convert pasted content to plain text',

// wikEd control buttons, top row
	'wikEdTextZoom alt':           'Text zoom',
	'wikEdTextZoom title':         'Text zoom cycling',
	'wikEdClearHistory alt':       'Clear history',
	'wikEdClearHistory title':     'Clear the find, replace, and summary history',
	'wikEdScrollToButtons alt':    'Scroll buttons',
	'wikEdScrollToButtons title':  'Scroll to edit buttons',
	'wikEdScrollToInput alt':      'Scroll edit',
	'wikEdScrollToInput title':    'Scroll to edit window',

// wikEd control buttons, bottom row
	'wikEdUseWikEd alt':           'Use wikEd',
	'wikEdUseWikEd title':         'Toggle between classic text area and wikEd',
	'wikEdHighlightSyntax alt':    'Syntax',
	'wikEdHighlightSyntax title':  'Toggle automatic syntax highlighting',
	'wikEdSource alt':             'Source',
	'wikEdSource title':           'Show the source code for testing purposes',
	'wikEdUsing alt':              'Using',
	'wikEdUsing title':            'Automatically add \'\'…using wikEd\'\' to summaries',
	'wikEdFullScreen alt':         'Fullscreen',
	'wikEdFullScreen title':       'Toggle the fullscreen mode',

// find and replace buttons, top row
	'wikEdGetFind alt':            'Get find',
	'wikEdGetFind title':          'Copy selection to find field (double click: copy selection to find and to replace field)',
	'wikEdFindAll alt':            'Find all',
	'wikEdFindAll title':          'Not yet implemented. Find all matches in whole text or selection',
	'wikEdFindPrev alt':           'Find prev',
	'wikEdFindPrev title':         'Find previous match',

	'wikEdFindNext alt':           'Find next',
	'wikEdFindNext title':         'Find next match',
	'wikEdUpdown alt':             'Jump up/down',
	'wikEdUpdown title':           'Jump to the top / bottom',
	'wikEdPrevPos alt':            'Jump prev',
	'wikEdPrevPos title':          'Jump to previously changed position',
	'wikEdLastPos alt':            'Jump next',
	'wikEdLastPos title':          'Jump back to last position',

// find and replace buttons, bottom row
	'wikEdGetFind alt':            'Get find + replace',
	'wikEdGetFind title':          'Copy selection to find and replace fields',
	'wikEdClearFind alt':          'Clear find',
	'wikEdClearFind title':        'Clear the find field (to search for selected text)',
	'wikEdReplaceAll alt':         'Replace all',
	'wikEdReplaceAll title':       'Not yet implemented. Replace all matches in whole text or selection',
	'wikEdReplacePrev alt':        'Replace prev',
	'wikEdReplacePrev title':      'Replace previous match',

	'wikEdReplaceNext alt':        'Replace next',
	'wikEdReplaceNext title':      'Replace next match',
	'wikEdCaseSensitive alt':      'Case sensitive',
	'wikEdCaseSensitive title':    'Search is case sensitive',
	'wikEdRegExp alt':             'RegExp',
	'wikEdRegExp title':           'Search field is a regular expression',
	'wikEdFindAhead alt':          'Find ahead',
	'wikEdFindAhead title':        'Find ahead as you type (case-insensitive non-regexp search)',

// fix buttons, top row
	'wikEdFixBasic alt':           'Fix basic',
	'wikEdFixBasic title':         'Fix blanks and empty lines, also done by other fixing functions',
	'wikEdFixHtml alt':            'Fix html',
	'wikEdFixHtml title':          'Fix html to wikicode',
	'wikEdFixCaps alt':            'Fix caps',
	'wikEdFixCaps title':          'Fix caps in headers and lists',
	'wikEdfixUnicode alt':         'Fix Unicode',
	'wikEdfixUnicode title':       'Fix Unicode character representations',
	'wikEdFixAll alt':             'Fix all',
	'wikEdFixAll title':           'Fix basic, html, capitalization, and Unicode',
	'wikEdFixRegExTypo alt':       'Fix typos',
	'wikEdFixRegExTypo title':     'Fix typos using the AutoWikiBrowser RegExTypoFixer rules',

// fix buttons, bottom row
	'wikEdFixDashes alt':          'Fix dashes',
	'wikEdFixDashes title':        'Fix dashes',
	'wikEdFixPunct alt':           'Fix puntuation',
	'wikEdFixPunct title':         'Fix spaces before puntuation',
	'wikEdFixMath alt':            'Fix math',
	'wikEdFixMath title':          'Fix math',
	'wikEdFixChem alt':            'Fix chem',
	'wikEdFixChem title':          'Fix chemical formulas',
	'wikEdFixUnits alt':           'Fix units',
	'wikEdFixUnits title':         'Fix units',

// summary buttons
	'wikEdClearSummary alt':       'Clear summary',
	'wikEdClearSummary title':     'Clear the summary field',
	'wikEdPresetSummary': [
		'copyedit', 'reply', 'article created', 'intro rewrite',
		'linkfix', 'fixing typos', 'removing linkspam', 'reverting test',
		'reverting vandalism', 'formatting source text', '{wikEdUsing}'
	],
	'wikEdSummaryUsing':           '…using [[User:Cacycle/wikEd|wikEd]]',

// submit buttons
	'wikEdLocalPreviewImg alt':    'Preview below',
	'wikEdLocalPreview title':     'Show preview below',
	'wikEdLocalDiffImg alt':       'Changes below',
	'wikEdLocalDiff title':        'Show current changes below',
	'wikEdHelpPageLink':           ' | &lt;a href=&quot;http://en.wikipedia.org/wiki/User:Cacycle/wikEd_help&quot; target=&quot;helpwindow&quot;&gt;wikEd help&lt;/a&gt;',

// preview and changes buttons, top
	'wikEdPreview alt':            'Preview title',
	'wikEdPreview title':          'Show preview below',
	'wikEdDiff alt':               'Changes title',
	'wikEdDiff title':             'Show current changes below',
	'wikEdClose alt':              'Close title',
	'wikEdClose title':            'Close preview box',
	'wikEdScrollToButtons2 alt':   'Scroll buttons',
	'wikEdScrollToButtons2 title': 'Scroll to edit buttons',
	'wikEdScrollToInput2 alt':     'Scroll edit',
	'wikEdScrollToInput2 title':   'Scroll to edit window',

// preview and changes buttons, bottom
	'wikEdPreview2 alt':           'Preview title',
	'wikEdPreview2 title':         'Show preview above',
	'wikEdDiff2 alt':              'Changes title',
	'wikEdDiff2 title':            'Show current changes above',
	'wikEdClose alt':              'Close title',
	'wikEdClose title':            'Close preview box',
	'wikEdScrollToButtons3 alt':   'Scroll buttons',
	'wikEdScrollToButtons3 title': 'Scroll to edit buttons',
	'wikEdScrollToInput3 alt':     'Scroll edit',
	'wikEdScrollToInput3 title':   'Scroll to edit window',

// formatting functions
	'image filename':              'filename',
	'image width':                 'width',
	'table caption':               'caption',
	'table heading':               'heading',
	'table cell':                  'cell',
	'redirect article link':       'article link',

// fixing functions
	'External links':              'External links',
	'See also':                    'See also',
	'References':                  'References',

// language specific wiki code
	'wikicode Image':              'Image',
	'wikicode Category':           'Category',

// shortened button texts
	'shortenedPreview':            'Preview',
	'shortenedChanges':            'Changes'
});

// edit-frame css rules, preset as wikEdFrameCSS[''] = '';
var wikEdFrameCSS = wikEdFrameCSS || [];
WikEdInitObject(wikEdFrameCSS, {

// frame body
	'.wikedFrameBody':   'background: #FFFFFF; margin: 0px; padding: 0.2em; overflow: -moz-scrollbars-vertical; overflow-x: auto; font-family: monospace;',

// syntax highlighting
	'.wikEdBlock':       'background-color: #e8e8e8;',
	'.wikEdBlockTag':    'color: #0000e0;',
	'.wikEdInlineTag':   'color: #0000e0;',
	'.wikEdUnknown':     'background-image: url({wikEdUnknown});',
	'.wikEdSubscript':   'position: relative; top: 0.3em;',
	'.wikEdSuperscript': 'position: relative; top: -0.3em;',
	'.wikEdBold':        'font-weight: bold;',
	'.wikEdComment':     'background-color: #fff0d0;',
	'.wikEdDel':         'text-decoration: line-through;',
	'.wikEdIns':         'text-decoration: underline;',
	'.wikEdItalic':      'font-style: italic;',
//	'.wikEdRGB':         '',

// horizontal rule
	'.wikEdHR':          'background-color: #d0d0d0;',
	'.wikEdHRInline':    'background-color: #d0d0d0;',

// wiki code
	'.wikEdWiki':        'color: #0000e0;',
	'.wikEdWikiRedir':   'color: #0000e0; background-color: #ffffff; font-weight: bold;',

// headings
	'.wikEdHeading':     'background-color: #e0e0e0; font-weight: bold;',
	'.wikEdHeadingWp':   'background-color: #d8e0ff; font-weight: bold;',

// tables
	'.wikEdTableBlock':  'background-color: #e8e8e8;',
	'.wikEdTableLine':   'background-color: #e8e8e8;',
	'.wikEdTableTag':    'background-color: #e8e8e8; color: #0000e0;',

// list
	'.wikEdListBlock':   'background-color: #e8e8e8;',
	'.wikEdListLine':    'background-color: #f0f0f0',
	'.wikEdListTag':     'background-color: #e8e8e8; color: #0000e0; font-weight: bold;',

// space-pre
	'.wikEdSpaceBlock':  'background-color: #e8e8e8;',
	'.wikEdSpaceLine':   'background-color: #e8e8e8;',
	'.wikEdSpaceTag':    'color: #0000e0; font-weight: bold;',

// wiki links, images, categories, templates
	'.wikEdLinkTag':     'color: #0000e0;',
//	'.wikEdLink':        '',
	'.wikEdImage':       'background-color: #d5ffaa;',
	'.wikEdCat':         'background-color: #d0d8ff;',
	'.wikEdTempl':       'background-color: #e0e8ff;',

// interlanguage
//	'.wikEdInter':       '',
	'.wikEdLinkInter':   'background-color: #c8c8ff;',
	'.wikEdImageInter':  'background-color: #c8c8ff;',
	'.wikEdCatInter':    'background-color: #c8c8ff;',
	'.wikEdTemplInter':  'background-color: #c8c8ff;',

// name
	'.wikEdLinkName':    'color: #f00000; font-weight: bold;',
	'.wikEdImageName':   'font-weight: bold;',
	'.wikEdCatName':     'color: #f00000; font-weight: bold;',
	'.wikEdTemplName':   'color: #f00000; font-weight: bold;',
	'.wikEdURLLink':     'color: #f00000; font-weight: bold;',

// pasted html
	'.wikEdPastedHtml':  'background-color: #FFC080;',

// text and parameters
	'.wikEdLinkText':    'font-weight: bold;',
//	'.wikEdImageText':   '',
//	'.wikEdCatText':     '',
//	'.wikEdTemplText':   '',
	'.wikEdURLText':     'font-weight: bold;',

// insert wikicode here
	'.wikEdInsertHere':  'background-color: orange; font-style: italic;',

// invisibles, control chars, and strange spaces
	'.wikEdTab':         'white-space: pre; background-image: url({wikEdTab}); background-position: right bottom; background-repeat: no-repeat;',
	'.wikEdTabPlain':    'white-space: pre;',
	'.wikEdCtrl':        'white-space: pre; background-image: url({wikEdCtrl}); background-position: left center; background-repeat: repeat-x; background-color: white;',
	'.wikEdCtrl:before': 'content: \'\u00a0\'',
	'.wikEdBlank':       'white-space: -moz-pre-wrap; background-image: url({wikEdBlank}); background-position: left center; background-repeat: repeat-x; background-color: white;'
});

// main window css rules, preset as wikEdMainCSS[''] = '';
var wikEdMainCSS = wikEdMainCSS || [];
WikEdInitObject(wikEdMainCSS, {

// combo input box
	'.wikEdCombo':                'font-size: smaller; padding-left: 0.1em; padding-right: 0.1em; margin-left: 0.1em; margin-right: 0.1em; height: 1.6em; vertical-align: bottom;',

// wikEd button areas
	'.wikEdButtonsFormat':        'background: #d4d0cc; border: 1px black solid; padding: 0.1em; margin: 0.2em  0.6em 0 0    ; float: left;',
	'.wikEdButtonsFind':          'background: #d4d0cc; border: 1px black solid; padding: 0.1em; margin: 0.2em  0.6em 0 0    ; float: left;',
	'.wikEdButtonsFix':           'background: #d4d0cc; border: 1px black solid; padding: 0.1em; margin: 0.2em  0.6em 0 0    ; float: left',
	'.wikEdButtonsControl':       'background: #d4d0cc; border: 1px black solid; padding: 0.1em; margin: 0.2em  0     0 0    ; float: right;',
	'.wikEdButtonsPreview':       'background: #d4d0cc; border: 1px black solid; padding: 0.1em; margin: -0.2em 0     0 0.6em; float: right;',
	'.wikEdButtonsPreviewFull':   'background: #d4d0cc; border: 1px black solid; padding: 0.1em; margin: -0.2em 0     0 0.6em; float: right;',
	'.wikEdButtonsPreview2':      'background: #d4d0cc; border: 1px black solid; padding: 0.1em; margin: 0.2em  0     0.4em 0; float: right;',
	'.wikEdButtonsJump':          'padding: 0.1em; margin: 0 0 0 0.6em; float: right;',

// wikEd buttons
	'.wikEdButton':               'vertical-align: text-top; font-size: small; text-decoration: underline; margin: 1px 2px; padding: 0; background: #d4d0cc; border: 1px #d4d0cc solid; cursor: pointer;',
	'.wikEdButton:hover':         'background: #e4e0dd; border: 1px outset; cursor: pointer;',
	'.wikEdButton:active':        'background: #e4e0dc; border: 1px inset;  cursor: pointer;',
	'.wikEdButtonSolo':           'vertical-align: text-top; font-size: small; text-decoration: underline; margin: 1px 2px; padding: 0; background: #d4d0cc; border: 1px solid; border-color: white black black white; cursor: pointer;',
	'.wikEdButtonSolo:hover':     'background: #e4e0dd; cursor: pointer;',
	'.wikEdButtonChecked':        'vertical-align: text-top; font-size: small; text-decoration: none; margin: 1px 2px; padding: 0; background: #ccc8c3; border: 1px solid; border-color: black white white black; cursor: pointer;',
	'.wikEdButtonUnchecked':      'vertical-align: text-top; font-size: small; text-decoration: none; margin: 1px 2px; padding: 0; background: #ddd8d3; border: 1px solid; border-color: white black black white; cursor: pointer;',
	'.wikEdButtonPressed':        'vertical-align: text-top; font-size: small; text-decoration: none; margin: 1px 2px; padding: 0; background: #ccc8c3; border: 1px solid; border-color: black white white black; cursor: wait;',
	'.wikEdButtonInactive':       'vertical-align: text-top; font-size: small; text-decoration: underline; margin: 1px 2px; padding: 0; background: #c0c0c0; border: 1px #b0b0b0 solid; cursor: not-allowed',
	'.wikEdLocalPreview':         'vertical-align: top; margin: 0 0.33em 0 0.15em; padding: 0;',
	'.wikEdLocalDiff':            'vertical-align: top; margin: 0 0.33em 0 -0.18em; padding: 0;',
	'.wikEdClearSummary':         'vertical-align: middle; margin: 0 0.1em 0 0.5em; padding: 0 0 0.2em 0;',

// preview box
	'.wikEdPreviewBoxOuter':      'clear: both; margin-top: 0.5em; margin-bottom: 0; border-width: 1px; border-style: solid; border-color: #808080 #d0d0d0 #d0d0d0 #808080;',
	'.wikEdPreviewBox':           'background-color: #f9f9f9; padding: 5px; border-width: 1px; border-style: solid; border-color: #404040 #ffffff #ffffff #404040;',

// find field
	'.wikEdFindComboInput':       'position: relative; padding: 0; margin: 0 0.2em; font-style: normal;',
	'#wikEdFindText':             'height: 1.4em; font-family: monospace; padding: 0; margin: 0; position: absolute; left: 0; top: 0; z-index: 2;',
	'#wikEdFindSelect':           'height: 1.5em; font-family: monospace; border: none; padding: 0; margin: 0; position: relative; vertical-align: baseline; z-index: 1;',

// replace field
	'.wikEdReplaceComboInput':    'position: relative; padding: 0; margin: 0 0.2em; font-style: normal;',
	'#wikEdReplaceText':          'height: 1.4em; font-family: monospace; padding: 0; margin: 0; position: absolute; left: 0; top: 0; z-index: 2;',
	'#wikEdReplaceSelect':        'height: 1.5em; font-family: monospace; border: none; padding: 0; margin: 0; position: relative; vertical-align: baseline; z-index: 1;',

// summary field
	'.wikEdSummaryComboInput':    'position: relative;',
	'.wikEdSummaryText':          'padding: 0; margin: 0; position: absolute; left: 0; top: 0; z-index: 2;',
	'.wikEdSummarySelect':        'border: none; padding: 0; margin: 0; position: relative; vertical-align: middle; z-index: 1;',

// space around submit buttons
	'.editButtons':               'margin-top: 0.5em; margin-bottom: 0.5em;',

// frame
	'.wikEdFrameOuter':           'width: 100%; margin-top: 0.5em; margin-bottom: 0.1em; border-width: 1px; border-style: solid; border-color: #808080 #d0d0d0 #d0d0d0 #808080;',
	'.wikEdFrameInner':           'padding: 0; border-width: 1px; border-style: solid; border-color: #404040 #ffffff #ffffff #404040;',
	'.wikEdFrame':                'width: 100%; padding: 0; margin: 0; border: none;',

// summary
	'.wikEdSummaryWrapper':       'margin: 0.25em 0 0.4em 0;',
	'#wpSummaryLabel':            'margin-right: 0.2em',
	'.editOptions':               'position: relative; top: 0.1em;',

// input wrapper
	'.wikEdInputWrapper':         'z-index: 100;',
	'.wikEdInputWrapperFull':     'position: fixed; top: 0; left: 0; right: 0; padding: 4px; background: white; z-index: 100;',

// other wrappers
//	'.wikEdToolbarWrapper':       '',
//	'.wikEdTextareaWrapper':      '',
//	'.wikEdFrameWrapper':         '',
//	'.wikEdConsoleWrapper':       '',
//	'.wikEdButtonsWrapper':       '',
	'.wikEdSummaryInputWrapper':  'display: inline;',
	'.wikEdSummaryOptions':       'display: inline;',
//	'.wikEdSubmitWrapper':        '',
//	'.wikEdSubmitButtonsWrapper': '',
//	'.wikEdLocalPrevWrapper':     '',
//	'.wikEdInsertWrapper':        '',

// various
//	'.wikEdHelpSpan':             '',
	'#editpage-specialchars':     'clear: both;'
});

// use local copies of images for testing (set to true in local copy of edit page)
var wikEdUseLocalImages = wikEdUseLocalImages || false;

// path to local images for testing
var wikEdImagePathLocal = wikEdImagePathLocal || 'file:///D:/wikEd/images/';

// path to images
var wikEdImagePath = wikEdImagePath || 'http://upload.wikimedia.org/wikipedia/commons/';

// image filenames
var wikEdImage = wikEdImage || [];

// image URLs, preset as wikEdImage[''] = '';
WikEdInitObject(wikEdImage, {
	'blank':           '5/51/WikEd_blank.png',
	'bold':            '5/59/WikEd_bold.png',
	'bulletList':      '6/62/WikEd_bullet_list.png',
	'case':            'a/aa/WikEd_case.png',
	'caseSensitive':   '0/0d/WikEd_case_sensitive.png',
	'clearFind':       'f/f0/WikEd_clear_find.png',
	'clearHistory':    'c/c8/WikEd_clear_history.png',
	'clearSummary':    '2/2c/WikEd_clear_summary.png',
	'close':           '9/97/WikEd_close.png',
	'ctrl':            '1/10/WikEd_ctrl.png',
	'decreaseHeading': '7/72/WikEd_decrease_heading.png',
	'definitionList':  'f/f5/WikEd_definition_list.png',
	'diff':            'd/db/WikEd_diff.png',
	'disabled':        '0/07/WikEd_disabled.png',
	'error':           '3/3e/WikEd_error.png',
	'findAhead':       '3/34/WikEd_find_ahead.png',
	'findAll':         '7/75/WikEd_find_all.png',
	'findNext':        'a/ad/WikEd_find_next.png',
	'findPrev':        'f/f5/WikEd_find_prev.png',
	'fixAll':          '8/86/WikEd_fix_all.png',
	'fixBasic':        '3/30/WikEd_fix_basic.png',
	'fixCaps':         '0/00/WikEd_fix_caps.png',
	'fixUnicode':      'd/d4/WikEd_fix_unicode.png',
	'fixChem':         'e/e7/WikEd_fix_chem.png',
	'fixDash':         'e/e5/WikEd_fix_dash.png',
	'fixHtml':         '0/05/WikEd_fix_html.png',
	'fixMath':         '3/3f/WikEd_fix_math.png',
	'fixPunct':        'd/db/WikEd_fix_punct.png',
	'fixRegExTypo':    '9/94/WikEd_fix_reg-ex-typo.png',
	'fixUnits':        '6/69/WikEd_fix_units.png',
	'textZoom':        '7/71/WikEd_font_size.png',
	'fullScreen':      'd/d3/WikEd_fullscreen.png',
	'getFind':         '9/96/WikEd_get_selection.png',
	'highlightSyntax': '6/67/WikEd_syntax.png',
	'image':           '3/37/WikEd_image.png',
	'increaseHeading': '5/50/WikEd_increase_heading.png',
	'indentList':      '7/7a/WikEd_indent_list.png',
	'italic':          'd/d4/WikEd_italic.png',
	'jumpTopBottom':   '5/5d/WikEd_jump_top_bottom.png',
	'lastPos':         '5/54/WikEd_jump_next.png',
	'logo':            '6/67/WikEd_logo.png',
	'nowiki':          '5/5a/WikEd_nowiki.png',
	'numberList':      '3/3b/WikEd_number_list.png',
	'prevPos':         'c/c7/WikEd_jump_prev.png',
	'preview':         '3/31/WikEd_preview.png',
	'redirect':        'f/fa/WikEd_redirect.png',
	'redo':            'd/d7/WikEd_redo.png',
	'redoAll':         '2/2d/WikEd_redo_all.png',
	'regExp':          '6/6a/WikEd_regexp.png',
	'replaceAll':      '2/2a/WikEd_replace_all.png',
	'replaceNext':     'b/b0/WikEd_replace_next.png',
	'replacePrev':     'a/a1/WikEd_replace_prev.png',
	'scrollToButtons': '0/01/WikEd_align_buttons.png',
	'scrollToText':    '1/13/WikEd_align_top.png',
	'source':          '0/02/WikEd_source.png',
	'strikethrough':   '0/06/WikEd_strikethrough.png',
	'subscript':       '9/9e/WikEd_subscript.png',
	'superscript':     'b/bf/WikEd_superscript.png',
	'tab':             'e/e7/WikEd_tab.png',
	'table':           'b/bd/WikEd_table.png',
	'textify':         'c/cd/WikEd_textify.png',
	'underline':       '2/21/WikEd_underline.png',
	'undo':            'e/e6/WikEd_undo.png',
	'undoAll':         '0/08/WikEd_undo_all.png',
	'unknown':         '8/8a/WikEd_unknown.png',
	'updateSyntax':    '6/67/WikEd_syntax.png',
	'useWikEd':        '6/67/WikEd_logo.png',
	'using':           'e/e0/WikEd_using.png',
	'webLink':         '1/16/WikEd_weblink.png',
	'wikify':          '9/9f/WikEd_wikify.png',
	'wikiLink':        '2/21/WikEd_wikilink.png'
});

// history length for find, replace, and summary fields
var wikEdHistoryLength = wikEdHistoryLength || [];
wikEdHistoryLength['find'] = 10;
wikEdHistoryLength['replace'] = 10;
wikEdHistoryLength['summary'] = 10;

// presets for combo input fields dropdown options, {wikEdUsing} appends a link to this script
var wikEdComboPresetOptions = wikEdComboPresetOptions || [];
wikEdComboPresetOptions['summary'] = wikEdComboPresetOptions['summary'] || wikEdText['wikEdPresetSummary'];

// text for summary link to this script
var wikEdSummaryUsing = wikEdSummaryUsing || wikEdText['wikEdSummaryUsing'];

// expiration time span for history cookies in seconds
var wikEdCookieExpireSec = wikEdCookieExpireSec || (30 * 24 * 60 * 60);

// find ahead as you type checkbox preset
var wikEdFindAheadSelected = wikEdFindAheadSelected || true;

// highlight syntax preset (set to false by single-session cookie wikEdSyntaxOff)
var wikEdHighlightSyntax = wikEdHighlightSyntax || true;

// enable wikEd preset (set to false by single-session cookie wikEdUseClassic)
var wikEdUseWikEd = wikEdUseWikEd || true;

// add '...using wikEd' to summary preset (set to true by single-session cookie wikEdSummaryUsing)
var wikEdUsing = wikEdUsing || false;

// fullscreen mode preset (set to true by single-session cookie wikEdFullscreen)
var wikEdFullScreenMode = wikEdFullScreenMode || false;

// initial text zoom for edit window (percentage)
var wikEdTextZoom = wikEdTextZoom || 100;

// remove invisible syntax highlighting comments after closing tag
var wikEdRemoveHighlightComments = wikEdRemoveHighlightComments || true;

// show the edit toolbar when the rich-text edit-frame is active
var wikEdShowToolbar = wikEdShowToolbar || true;

// show the text-to-source button for testing purposes
var wikEdShowSourceButton = wikEdShowSourceButton || false;

// remove linebreak before minor edit checkbox
var wikEdNoLinebreak = wikEdNoLinebreak || true;

// This is the wikEd help page link to be displayed after the editing help link, an empty string disables the link
var wikEdHelpPageLink = wikEdHelpPageLink || wikEdText['wikEdHelpPageLink'];

// use RegExTypoFix (http://en.wikipedia.org/wiki/User:Mboverload/RegExTypoFix), needs Wikipedia:AutoWikiBrowser/typos.js
var wikEdRegExTypoFix = wikEdRegExTypoFix || true;


//
// end of user configurable variables
//


// global variables

var wikEdLoaded = wikEdLoaded || false;
var wikEdDisabled = false;

// history
var wikEdFieldHist = [];
var wikEdCookieName = [];
var wikEdInputElement = [];
var wikEdSelectElement = [];

var wikEdCheckMarker = [];
wikEdCheckMarker[true] = '\u2022';
wikEdCheckMarker[false] = '\u22c5';

// cache the parsed DOM object
var wikEdFrameDOMCache = null;

// undo all, redo all
var wikEdOrigVersion = '';
var wikEdLastVersion = null;

// global dom elements
var wikEdLogo = {};
var wikEdLogoList = {};

var wikEdTextarea = {};
var wikEdFrame = {};
var wikEdFrameBody = {};
var wikEdFrameDocument = {};
var wikEdFrameWindow = {};

var wikEdInputWrapper = {};
var wikEdToolbarWrapper = {};
var wikEdTextareaWrapper = {};
var wikEdFrameWrapper = {};
var wikEdConsoleWrapper = {};
var wikEdButtonsWrapper = {};
var wikEdSummaryWrapper = {};
var wikEdSummaryInputWrapper = {};
var wikEdSummaryOptions = {};
var wikEdSubmitWrapper = {};
var wikEdSubmitButtonsWrapper = {};
var wikEdLocalPrevWrapper = {};
var wikEdInsertWrapper = {};

var wikEdButtonsFormat = {};
var wikEdButtonsFind = {};
var wikEdButtonsFix = {};
var wikEdButtonsControl = {};
var wikEdButtonsPreview = {};
var wikEdPreviewBox = {};
var wikEdButtonsPreview2 = {};
var wikEdButtonsJump = {};

var wikEdCaseSensitive = {};
var wikEdRegExp = {};
var wikEdFindAhead = {};

var wikEdFindText = {};
var wikEdReplaceText = {};
var wikEdSummaryText = {};

// various
var wikEdTextareaHeight;
var wikEdLastPosObj = null;

// counters
var i;
var j;

// wiki file paths for use in regexps
var wikEdServer = wgServer || '';
var wikEdArticlePath = wgArticlePath || '';
var wikEdScriptPath = wgScriptPath || '';
wikEdServer = wikEdServer.replace(/(\W)/g, '\\$1');
wikEdArticlePath = wikEdArticlePath.replace(wgServer, '');
wikEdScriptPath = wikEdScriptPath.replace(wgServer, '');
wikEdArticlePath = wikEdArticlePath.replace(/\$1$/, '');
wikEdScriptPath = wikEdScriptPath.replace(/\/?$/, '/');;
wikEdArticlePath = wikEdArticlePath.replace(/(\W)/g, '\\$1');
wikEdScriptPath = wikEdScriptPath.replace(/(\W)/g, '\\$1');


// add setup routine to addOnloadHook
if (window.addOnloadHook != null) {
	addOnloadHook(WikEdSetup);
}


//
// WikEdInitObject: initialize object, keep pre-defined values
//

function WikEdInitObject(array, preset) {

	for (var key in preset) {
		if (array[key] == null) {
			array[key] = preset[key];
		}
	}
	return;
}


//
// insertTags: override the insertTags function in wikibits.js, used for the standard button toolbar
//

function insertTags(tagOpen, tagClose, sampleText) {

	if (wikEdUseWikEd == true) {
		WikEdEditButton('wikEdInsertTags', [tagOpen, tagClose, sampleText]);
	}

//   apply tagOpen / tagClose to selection in textarea,
//   use sampleText instead of selection if there is none
//   taken from wikibits.js
	else {
		if (wikEdTextarea.selectionStart || wikEdTextarea.selectionStart == '0') {
			var replaced = false;
			var startPos = wikEdTextarea.selectionStart;
			var endPos = wikEdTextarea.selectionEnd;
			if (endPos - startPos) {
				replaced = true;
			}
			var scrollTop = wikEdTextarea.scrollTop;
			var myText = (wikEdTextarea.value).substring(startPos, endPos);
			if (! myText) {
				myText = sampleText;
			}

// exclude ending space char, if any
			if (myText.charAt(myText.length - 1) == ' ') {
				subst = tagOpen + myText.substring(0, (myText.length - 1)) + tagClose + ' ';
			}
			else {
				subst = tagOpen + myText + tagClose;
			}
			wikEdTextarea.value = wikEdTextarea.value.substring(
				0, startPos) + subst + wikEdTextarea.value.substring(endPos, wikEdTextarea.value.length
			);
			wikEdTextarea.focus();

// set new selection
			if (replaced) {
				var cPos = startPos+(tagOpen.length + myText.length + tagClose.length);
				wikEdTextarea.selectionStart = cPos;
				wikEdTextarea.selectionEnd = cPos;
			}
			else {
				wikEdTextarea.selectionStart = startPos + tagOpen.length;
				wikEdTextarea.selectionEnd = startPos + tagOpen.length + myText.length;
			}
			wikEdTextarea.scrollTop = scrollTop;
		}

// reposition cursor if possible
		if (wikEdTextarea.createTextRange) {
			wikEdTextarea.caretPos = document.selection.createRange().duplicate();
		}
	}

	return;
}


//
// WikEdSetup: setup routine, called on page load
//

function WikEdSetup(scrollToText) {

	var html = '';

// add image path to image filename
	if (wikEdLogo.id == null) {
		if (wikEdUseLocalImages == true) {

// remove MediaWiki path prefixes
			for (i in wikEdImage) {
				wikEdImage[i] = wikEdImagePathLocal + wikEdImage[i].replace(/^[0-9a-f]+\/[0-9a-f]+\//, '');
			}
		}
		else {
			for (i in wikEdImage) {
				wikEdImage[i] = wikEdImagePath + wikEdImage[i];
			}
		}

// insert logo into personal toolbar
		wikEdLogo = document.createElement('img');
		wikEdLogo.id = 'wikEdLogoImg';
		wikEdLogo.onclick = WikEdMainSwitch;

		wikEdLogoList = document.createElement('li');
		wikEdLogoList.id = 'wikEdLogoList';
		wikEdLogoList.appendChild(wikEdLogo);

		var personalTools = document.getElementById('p-personal');
		if (personalTools != null) {
			personalTools.getElementsByTagName('ul')[0].appendChild(wikEdLogoList);
		}
	}

// check if disabled
	var cookie = WikEdGetCookie('wikEdDisabled');
	if (cookie != '') {
		wikEdDisabled = true;
		WikEdSetLogo();
		return;
	}

// check if setup was already run
	if (wikEdLoaded == true) {
		return;
	}
	wikEdLoaded = true;

// set error logo
	WikEdSetLogo('error');
/*
// at the moment this works only for mozilla browsers (Mozilla, Mozilla Firefox, Mozilla SeaMonkey)
	if (navigator.appName == null) {
		return;
	}
	var nameMatch = navigator.appName.match(/Netscape/i);
	if (nameMatch == null) {
		return;
	}
	var name = nameMatch[0];
	if ( (name == null) || (name == '') ) {
		return;
	}
	var version = navigator.appVersion.match(/\d+(\.\d+)/)[0];
	if ( (version == null) || (version &lt; 5.0) ) {
		return;
	}
*/
// check if this is an edit page
	wikEdTextarea = document.getElementById('wpTextbox1');
	if (wikEdTextarea == null) {

// reset error indicator
		WikEdSetLogo();
		return;
	}

// check if RegExTypoFix is available
	if (typeof(AWRegExTypoFix) != 'function') {
		wikEdRegExTypoFix = false;
	}

// get initial textarea height
	wikEdTextareaHeight = wikEdTextarea.offsetHeight;

// setup the undo buffers and save the original text for local changes view
	wikEdOrigVersion = wikEdTextarea.value;

// add stylesheet definitions
	var mainStyle = new WikEdStyleSheet();
        WEDBA(1);
	for (var rule in wikEdMainCSS) {
		mainStyle.addRule(rule, wikEdMainCSS[rule]);
	}
        WEDBA(2);
// get button settings from cookies
	var cookie = WikEdGetCookie('wikEdSummaryUsing');
	if (cookie != '') {
		wikEdUsing = true;
	}

	cookie = WikEdGetCookie('wikEdUseClassic');
	if (cookie != '') {
		wikEdUseWikEd = false;
	}

	cookie = WikEdGetCookie('wikEdSyntaxOff');
	if (cookie != '') {
		wikEdHighlightSyntax = false;
	}

	cookie = WikEdGetCookie('wikEdFullscreen');
	if (cookie != '') {
		wikEdFullScreenMode = true;
	}

	if (window.location.search.match('wikedpreview') != null) {
		wikEdFullScreenMode = false;
	}

// preset frame related styles to avoid browser crashes
	var styleFrameWrapperPosition;
	var styleFrameWrapperVisibility;
	var styleFrameBody;
	if (wikEdUseWikEd == true) {
		styleFrameBody = 'style=&quot;display: block;&quot; ';
		styleFrameWrapperPosition = 'static';
		styleFrameWrapperVisibility = 'visible';
		styleTextareaWrapperPosition = 'absolute';
		styleTextareaWrapperVisibility = 'hidden';
	}
	else {
		styleFrameBody = 'style=&quot;display: none;&quot; ';
		styleFrameWrapperPosition = 'absolute';
		styleFrameWrapperVisibility = 'hidden';
		styleTextareaWrapperPosition = 'static';
		styleTextareaWrapperVisibility = 'visible';
	}
	if (wikEdFullScreenMode == true) {
		wikEdInputWrapperClass = 'wikEdInputWrapperFull';
	}
	else {
		wikEdInputWrapperClass = 'wikEdInputWrapper';
	}

// create wikEd element wrappers
        WEDBA(3);
// create input wrapper, this contains the whole fullscreen content
	wikEdInputWrapper = document.createElement('div');
	wikEdInputWrapper.id = 'wikEdInputWrapper';
	wikEdInputWrapper.className = wikEdInputWrapperClass;
	wikEdTextarea.parentNode.insertBefore(wikEdInputWrapper, wikEdTextarea);

// create toolbar wrapper
	wikEdToolbarWrapper = document.createElement('div');
	wikEdToolbarWrapper.id = 'wikEdToolbarWrapper';
	wikEdToolbarWrapper.className = 'wikEdToolbarWrapper';
	wikEdInputWrapper.appendChild(wikEdToolbarWrapper);

// create textarea wrapper
	wikEdTextareaWrapper = document.createElement('div');
	wikEdTextareaWrapper.id = 'wikEdTextareaWrapper';
	wikEdTextareaWrapper.className = 'wikEdTextareaWrapper';
	wikEdTextareaWrapper.style.position = styleTextareaWrapperPosition;
	wikEdTextareaWrapper.style.visibility = styleTextareaWrapperVisibility;
	wikEdInputWrapper.appendChild(wikEdTextareaWrapper);

// create frame wrapper
	wikEdFrameWrapper = document.createElement('div');
	wikEdFrameWrapper.id = 'wikEdFrameWrapper';
	wikEdFrameWrapper.style.position = styleFrameWrapperPosition;
	wikEdFrameWrapper.style.visibility = styleFrameWrapperVisibility;
	wikEdInputWrapper.appendChild(wikEdFrameWrapper);

// create console wrapper for buttons, summary, and submit
	wikEdConsoleWrapper = document.createElement('div');
	wikEdConsoleWrapper.id = 'wikEdConsoleWrapper';
	wikEdConsoleWrapper.className = 'wikEdConsoleWrapper';
	wikEdInputWrapper.appendChild(wikEdConsoleWrapper);

// create buttons wrapper for wikEd buttons
	wikEdButtonsWrapper = document.createElement('div');
	wikEdButtonsWrapper.id = 'wikEdButtonsWrapper';
	wikEdButtonsWrapper.className = 'wikEdButtonsWrapper';
	wikEdConsoleWrapper.appendChild(wikEdButtonsWrapper);

// create summary wrapper for summary, minor edit, and watch this page
	wikEdSummaryWrapper = document.createElement('div');
	wikEdSummaryWrapper.id = 'wikEdSummaryWrapper';
	wikEdSummaryWrapper.className = 'wikEdSummaryWrapper';
	wikEdConsoleWrapper.appendChild(wikEdSummaryWrapper);

// create summary input wrapper
	wikEdSummaryInputWrapper = document.createElement('div');
	wikEdSummaryInputWrapper.id = 'wikEdSummaryInputWrapper';
	wikEdSummaryInputWrapper.className = 'wikEdSummaryInputWrapper';
	wikEdSummaryWrapper.appendChild(wikEdSummaryInputWrapper);

// create minor edit and watch page wrapper
	wikEdSummaryOptions = document.createElement('div');
	wikEdSummaryOptions.id = 'wikEdSummaryOptions';
	wikEdSummaryOptions.className = 'wikEdSummaryOptions';
	wikEdSummaryWrapper.appendChild(wikEdSummaryOptions);

// create submit wrapper for submit buttons and help links
	wikEdSubmitWrapper = document.createElement('div');
	wikEdSubmitWrapper.id = 'wikEdSubmitWrapper';
	wikEdSubmitWrapper.className = 'wikEdSubmitWrapper';
	wikEdConsoleWrapper.appendChild(wikEdSubmitWrapper);

// create submit wrapper for submit buttons and help links
	wikEdSubmitButtonsWrapper = document.createElement('div');
	wikEdSubmitButtonsWrapper.id = 'wikEdSubmitButtonsWrapper';
	wikEdSubmitButtonsWrapper.className = 'wikEdSubmitButtonsWrapper';
	wikEdSubmitWrapper.appendChild(wikEdSubmitButtonsWrapper);

// create preview wrapper for preview and diff box
	wikEdLocalPrevWrapper = document.createElement('div');
	wikEdLocalPrevWrapper.id = 'wikEdLocalPrevWrapper';
	wikEdLocalPrevWrapper.className = 'wikEdLocalPrevWrapper';
	wikEdLocalPrevWrapper.style.display = 'none';
	wikEdInputWrapper.appendChild(wikEdLocalPrevWrapper);

// create insert wrapper for insert special chars links
	wikEdInsertWrapper = document.createElement('div');
	wikEdInsertWrapper.id = 'wikEdInsertWrapper';
	wikEdInsertWrapper.className = 'wikEdInsertWrapper';
	wikEdInputWrapper.appendChild(wikEdInsertWrapper);

// append input wrapper to document
	wpEditform = document.getElementById('editform');
	wpEditform.insertBefore(wikEdInputWrapper, wpEditform.firstChild);

// fill the wrappers
        WEDBA(4);
// add toolbar to toolbar wrapper
//	wpToolbar = document.getElementById('toolbar');
//	if (wpToolbar != null) {
//		wikEdToolbarWrapper.appendChild(wpToolbar);
//	}

// call wikibits:mwSetupToolbar() now because it would terminate with an error after setting textarea to display: none
//	if (wpToolbar != null) {
//		if (wpToolbar.getElementsByTagName('IMG').length == 0) {
//			if (typeof(mwSetupToolbar) == 'function') {
//				mwSetupToolbar();
//			}
//			window.removeEventListener('load', mwSetupToolbar, false);
//		}
//	}

// add summary elements to summary input wrapper
	var summaryLabel = document.getElementById('wpSummaryLabel');
	wikEdSummaryInputWrapper.appendChild(summaryLabel);

	wikEdSummaryText = document.getElementById('wpSummary');
	wikEdSummaryInputWrapper.appendChild(wikEdSummaryText);
        WEDBA(5);
// move editpage-copywarn out of summary wrapper
// needs to be done before appending editOptions to summary wrapper otherwise a linebreak stays (Mozilla bug)
	var copywarn = document.getElementById('editpage-copywarn');
	if (copywarn != null) {
		wikEdInputWrapper.parentNode.insertBefore(copywarn, wikEdInputWrapper.nextSibling);
	}

// add summary elements to summary options wrapper
// crashes Mozilla when appended after filling the iframe
	var editOptions = document.getElementById('wpMinoredit').parentNode;
	wikEdSummaryOptions.appendChild(editOptions);


// add textarea to textarea wrapper
	wikEdTextareaWrapper.appendChild(wikEdTextarea);

// add edit-frame to frame wrapper
// any DOM changes to a starting iframe in designmode may crash the browser, including DOM move, display: none; and position: absolute;
        WEDBA(6);
// create the iframe
	html = '';
	html += '&lt;div id=&quot;wikEdFrameOuter&quot; class=&quot;wikEdFrameOuter&quot;&gt;';
	html += '&lt;div id=&quot;wikEdFrameInner&quot; class=&quot;wikEdFrameInner&quot;&gt;';
	html += '&lt;/div&gt;';
	html += '&lt;iframe id=&quot;wikEdFrame&quot; class=&quot;wikEdFrame&quot; name=&quot;wikEdFrame&quot; style=&quot;height: ' + wikEdTextareaHeight + 'px;&quot;&gt;&lt;/iframe&gt;';
	html += '&lt;/div&gt;';
	html += '&lt;/div&gt;';

	wikEdFrameWrapper.innerHTML = html;
	wikEdInputWrapper.insertBefore(wikEdFrameWrapper, wikEdTextareaWrapper);

// fill the frame with content
	html = '';
	html += '&lt;html&gt;&lt;head&gt;&lt;/head&gt;';
	html += '&lt;body id=&quot;wikEdFrameBody&quot; class=&quot;wikedFrameBody&quot;' + styleFrameBody + '&gt;;';
	html += '&lt;/body&gt;&lt;/html&gt;';

	wikEdFrame = document.getElementById('wikEdFrame');
	wikEdFrameWindow = wikEdFrame.contentWindow;
	wikEdFrameDocument = wikEdFrameWindow.document;
        wikEdFrameDocument.designMode = 'on';
	wikEdFrameDocument.open();
	wikEdFrameDocument.write(html);
	wikEdFrameDocument.close();
	wikEdFrameBody = wikEdFrameDocument.getElementById('wikEdFrameBody');

// add wikEd buttons to buttons wrapper
        WEDBA(7);
// format buttons
	html = '';
	html += '&lt;div class=&quot;wikEdButtonsFormat&quot; id=&quot;wikEdButtonsFormat&quot;&gt;';

	html += '&lt;img class=&quot;wikEdButtonInactive&quot;  src=&quot;' + wikEdImage['undo']            + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdUndo&quot;                  alt=&quot;' + wikEdText['wikEdUndo alt']                  + '&quot; title=&quot;' + wikEdText['wikEdUndo title']                  + '&quot; onClick=&quot;javascript:WikEdEditButton(\'wikEdUndo\');&quot;&gt;';
	html += '&lt;img class=&quot;wikEdButtonInactive&quot;  src=&quot;' + wikEdImage['redo']            + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdRedo&quot;                  alt=&quot;' + wikEdText['wikEdRedo alt']                  + '&quot; title=&quot;' + wikEdText['wikEdRedo title']                  + '&quot; onClick=&quot;javascript:WikEdEditButton(\'wikEdRedo\');&quot;&gt;';
	html += '&lt;img class=&quot;wikEdButton&quot;          src=&quot;' + wikEdImage['bold']            + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdBold&quot;                  alt=&quot;' + wikEdText['wikEdBold alt']                  + '&quot; title=&quot;' + wikEdText['wikEdBold title']                  + '&quot; onClick=&quot;javascript:WikEdEditButton(\'wikEdBold\');&quot;&gt;';
	html += '&lt;img class=&quot;wikEdButton&quot;          src=&quot;' + wikEdImage['italic']          + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdItalic&quot;                alt=&quot;' + wikEdText['wikEdItalic alt']                + '&quot; title=&quot;' + wikEdText['wikEdItalic title']                + '&quot; onClick=&quot;javascript:WikEdEditButton(\'wikEdItalic\');&quot;&gt;';
	html += '&lt;img class=&quot;wikEdButton&quot;          src=&quot;' + wikEdImage['underline']       + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdUnderline&quot;             alt=&quot;' + wikEdText['wikEdUnderline alt']             + '&quot; title=&quot;' + wikEdText['wikEdUnderline title']             + '&quot; onClick=&quot;javascript:WikEdEditButton(\'wikEdUnderline\');&quot;&gt;';
	html += '&lt;img class=&quot;wikEdButton&quot;          src=&quot;' + wikEdImage['strikethrough']   + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdStrikethrough&quot;         alt=&quot;' + wikEdText['wikEdStrikethrough alt']         + '&quot; title=&quot;' + wikEdText['wikEdStrikethrough title']         + '&quot; onClick=&quot;javascript:WikEdEditButton(\'wikEdStrikethrough\');&quot;&gt;';
	html += '&lt;img class=&quot;wikEdButton&quot;          src=&quot;' + wikEdImage['nowiki']          + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdNowiki&quot;                alt=&quot;' + wikEdText['wikEdNowiki alt']                + '&quot; title=&quot;' + wikEdText['wikEdNowiki title']                + '&quot; onClick=&quot;javascript:WikEdEditButton(\'wikEdNowiki\');&quot;&gt;';
	html += '&lt;img class=&quot;wikEdButton&quot;          src=&quot;' + wikEdImage['superscript']     + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdSuperscript&quot;           alt=&quot;' + wikEdText['wikEdSuperscript alt']           + '&quot; title=&quot;' + wikEdText['wikEdSuperscript title']           + '&quot; onClick=&quot;javascript:WikEdEditButton(\'wikEdSuperscript\');&quot;&gt;';
	html += '&lt;img class=&quot;wikEdButton&quot;          src=&quot;' + wikEdImage['subscript']       + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdSubscript&quot;             alt=&quot;' + wikEdText['wikEdSubscript alt']             + '&quot; title=&quot;' + wikEdText['wikEdSubscript title']             + '&quot; onClick=&quot;javascript:WikEdEditButton(\'wikEdSubscript\');&quot;&gt;';
	html += '&lt;img class=&quot;wikEdButton&quot;          src=&quot;' + wikEdImage['case']            + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdCase&quot;                  alt=&quot;' + wikEdText['wikEdCase alt']                  + '&quot; title=&quot;' + wikEdText['wikEdCase title']                  + '&quot; onClick=&quot;javascript:WikEdEditButton(\'wikEdCase\');&quot;&gt;';
	html += '&lt;img class=&quot;wikEdButton&quot;          src=&quot;' + wikEdImage['undoAll']         + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdUndoAll&quot;               alt=&quot;' + wikEdText['wikEdUndoAll alt']               + '&quot; title=&quot;' + wikEdText['wikEdUndoAll title']               + '&quot; onClick=&quot;javascript:WikEdEditButton(\'wikEdUndoAll\');&quot;&gt;';
	html += '&lt;img class=&quot;wikEdButtonInactive&quot;  src=&quot;' + wikEdImage['redoAll']         + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdRedoAll&quot;               alt=&quot;' + wikEdText['wikEdRedoAll alt']               + '&quot; title=&quot;' + wikEdText['wikEdRedoAll title']               + '&quot; onClick=&quot;javascript:WikEdEditButton(\'wikEdRedoAll\');&quot;&gt;';
	html += '&lt;img class=&quot;wikEdButton&quot;          src=&quot;' + wikEdImage['updateSyntax']    + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdUpdateSyntax&quot;          alt=&quot;' + wikEdText['wikEdUpdateSyntax alt']          + '&quot; title=&quot;' + wikEdText['wikEdUpdateSyntax title']          + '&quot; onClick=&quot;javascript:WikEdEditButton(\'wikEdUpdateSyntax\');&quot;&gt;';
	html += '&lt;br /&gt;';

	html += '&lt;img class=&quot;wikEdButton&quot;          src=&quot;' + wikEdImage['wikiLink']        + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdWikiLink&quot;              alt=&quot;' + wikEdText['wikEdWikiLink alt']              + '&quot; title=&quot;' + wikEdText['wikEdWikiLink title']              + '&quot; onClick=&quot;javascript:WikEdEditButton(\'wikEdWikiLink\');&quot;&gt;';
	html += '&lt;img class=&quot;wikEdButton&quot;          src=&quot;' + wikEdImage['webLink']         + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdWebLink&quot;               alt=&quot;' + wikEdText['wikEdWebLink alt']               + '&quot; title=&quot;' + wikEdText['wikEdWebLink title']               + '&quot; onClick=&quot;javascript:WikEdEditButton(\'wikEdWebLink\');&quot;&gt;';
	html += '&lt;img class=&quot;wikEdButton&quot;          src=&quot;' + wikEdImage['decreaseHeading'] + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdDecreaseHeading&quot;       alt=&quot;' + wikEdText['wikEdDecreaseHeading alt']       + '&quot; title=&quot;' + wikEdText['wikEdDecreaseHeading title']       + '&quot; onClick=&quot;javascript:WikEdEditButton(\'wikEdDecreaseHeading\');&quot;&gt;';
	html += '&lt;img class=&quot;wikEdButton&quot;          src=&quot;' + wikEdImage['increaseHeading'] + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdIncreaseHeading&quot;       alt=&quot;' + wikEdText['wikEdIncreaseHeading alt']       + '&quot; title=&quot;' + wikEdText['wikEdIncreaseHeading title']       + '&quot; onClick=&quot;javascript:WikEdEditButton(\'wikEdIncreaseHeading\');&quot;&gt;';
	html += '&lt;img class=&quot;wikEdButton&quot;          src=&quot;' + wikEdImage['bulletList']      + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdBulletList&quot;            alt=&quot;' + wikEdText['wikEdBulletList alt']            + '&quot; title=&quot;' + wikEdText['wikEdBulletList title']            + '&quot; onClick=&quot;javascript:WikEdEditButton(\'wikEdBulletList\');&quot;&gt;';
	html += '&lt;img class=&quot;wikEdButton&quot;          src=&quot;' + wikEdImage['numberList']      + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdNumberList&quot;            alt=&quot;' + wikEdText['wikEdNumberList alt']            + '&quot; title=&quot;' + wikEdText['wikEdNumberList title']            + '&quot; onClick=&quot;javascript:WikEdEditButton(\'wikEdNumberList\');&quot;&gt;';
	html += '&lt;img class=&quot;wikEdButton&quot;          src=&quot;' + wikEdImage['indentList']      + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdIndentList&quot;            alt=&quot;' + wikEdText['wikEdIndentList alt']            + '&quot; title=&quot;' + wikEdText['wikEdIndentList title']            + '&quot; onClick=&quot;javascript:WikEdEditButton(\'wikEdIndentList\');&quot;&gt;';
	html += '&lt;img class=&quot;wikEdButton&quot;          src=&quot;' + wikEdImage['definitionList']  + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdDefinitionList&quot;        alt=&quot;' + wikEdText['wikEdDefinitionList alt']        + '&quot; title=&quot;' + wikEdText['wikEdDefinitionList title']        + '&quot; onClick=&quot;javascript:WikEdEditButton(\'wikEdDefinitionList\');&quot;&gt;';
	html += '&lt;img class=&quot;wikEdButton&quot;          src=&quot;' + wikEdImage['image']           + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdImage&quot;                 alt=&quot;' + wikEdText['wikEdImage alt']                 + '&quot; title=&quot;' + wikEdText['wikEdImage title']                 + '&quot; onClick=&quot;javascript:WikEdEditButton(\'wikEdImage\');&quot;&gt;';
	html += '&lt;img class=&quot;wikEdButton&quot;          src=&quot;' + wikEdImage['table']           + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdTable&quot;                 alt=&quot;' + wikEdText['wikEdTable alt']                 + '&quot; title=&quot;' + wikEdText['wikEdTable title']                 + '&quot; onClick=&quot;javascript:WikEdEditButton(\'wikEdTable\');&quot;&gt;';
	html += '&lt;img class=&quot;wikEdButton&quot;          src=&quot;' + wikEdImage['redirect']        + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdRedirect&quot;              alt=&quot;' + wikEdText['wikEdRedirect alt']              + '&quot; title=&quot;' + wikEdText['wikEdRedirect title']              + '&quot; onClick=&quot;javascript:WikEdEditButton(\'wikEdRedirect\');&quot;&gt;';
	html += '&lt;img class=&quot;wikEdButton&quot;          src=&quot;' + wikEdImage['wikify']          + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdWikify&quot;                alt=&quot;' + wikEdText['wikEdWikify alt']                + '&quot; title=&quot;' + wikEdText['wikEdWikify title']                + '&quot; onClick=&quot;javascript:WikEdEditButton(\'wikEdWikify\');&quot;&gt;';
	html += '&lt;img class=&quot;wikEdButton&quot;          src=&quot;' + wikEdImage['textify']         + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdTextify&quot;               alt=&quot;' + wikEdText['wikEdTextify alt']               + '&quot; title=&quot;' + wikEdText['wikEdTextify title']               + '&quot; onClick=&quot;javascript:WikEdEditButton(\'wikEdTextify\');&quot;&gt;';
	html += '&lt;/div&gt;';

// wikEd control buttons
	html += '&lt;div class=&quot;wikEdButtonsControl&quot; id=&quot;wikEdButtonsControl&quot;&gt;';
	html += '&lt;img class=&quot;wikEdButton&quot;          src=&quot;' + wikEdImage['textZoom']        + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdTextZoom&quot;              alt=&quot;' + wikEdText['wikEdTextZoom alt']              + '&quot; title=&quot;' + wikEdText['wikEdTextZoom title']              + '&quot; onClick=&quot;javascript:WikEdButton(\'wikEdTextZoom\');&quot;&gt;';
	html += '&lt;img class=&quot;wikEdButton&quot;          src=&quot;' + wikEdImage['clearHistory']    + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdClearHistory&quot;          alt=&quot;' + wikEdText['wikEdClearHistory alt']          + '&quot; title=&quot;' + wikEdText['wikEdClearHistory title']          + '&quot; onClick=&quot;javascript:WikEdButton(\'wikEdClearHistory\');&quot;&gt;';
	html += '&lt;img class=&quot;wikEdButton&quot;          src=&quot;' + wikEdImage['scrollToButtons'] + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdScrollToButtons&quot;       alt=&quot;' + wikEdText['wikEdScrollToButtons alt']       + '&quot; title=&quot;' + wikEdText['wikEdScrollToButtons title']       + '&quot; onClick=&quot;javascript:WikEdButton(\'wikEdScrollToButtons\');&quot;&gt;';
	html += '&lt;img class=&quot;wikEdButton&quot;          src=&quot;' + wikEdImage['scrollToText']    + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdScrollToInput&quot;         alt=&quot;' + wikEdText['wikEdScrollToInput alt']         + '&quot; title=&quot;' + wikEdText['wikEdScrollToInput title']         + '&quot; onClick=&quot;javascript:WikEdButton(\'wikEdScrollToInput\');&quot;&gt;';
	html += '&lt;br /&gt;';

	html += '&lt;img class=&quot;wikEdButtonChecked&quot;   src=&quot;' + wikEdImage['useWikEd']        + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdUseWikEd&quot;              alt=&quot;' + wikEdText['wikEdUseWikEd alt']              + '&quot; title=&quot;' + wikEdText['wikEdUseWikEd title']              + '&quot; onClick=&quot;javascript:WikEdButton(\'wikEdUseWikEd\', true);&quot;&gt;';
	html += '&lt;img class=&quot;wikEdButtonUnchecked&quot; src=&quot;' + wikEdImage['highlightSyntax'] + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdHighlightSyntax&quot;       alt=&quot;' + wikEdText['wikEdHighlightSyntax alt']       + '&quot; title=&quot;' + wikEdText['wikEdHighlightSyntax title']       + '&quot; onClick=&quot;javascript:WikEdButton(\'wikEdHighlightSyntax\', true);&quot;&gt;';
	if (wikEdShowSourceButton == true) {
		html += '&lt;img class=&quot;wikEdButton&quot;        src=&quot;' + wikEdImage['source']          + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdSource&quot;                alt=&quot;' + wikEdText['wikEdSource alt']                + '&quot; title=&quot;' + wikEdText['wikEdSource title']                + '&quot; onClick=&quot;javascript:WikEdEditButton(\'wikEdSource\');&quot;&gt;';
	}
	html += '&lt;img class=&quot;wikEdButtonUnchecked&quot; src=&quot;' + wikEdImage['using']           + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdUsing&quot;                 alt=&quot;' + wikEdText['wikEdUsing alt']                 + '&quot; title=&quot;' + wikEdText['wikEdUsing title']                 + '&quot; onClick=&quot;javascript:WikEdButton(\'wikEdUsing\', true);&quot;&gt;';
	html += '&lt;img class=&quot;wikEdButton&quot;          src=&quot;' + wikEdImage['fullScreen']      + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdFullScreen&quot;            alt=&quot;' + wikEdText['wikEdFullScreen alt']            + '&quot; title=&quot;' + wikEdText['wikEdFullScreen title']            + '&quot; onClick=&quot;javascript:WikEdButton(\'wikEdFullScreen\', true);&quot;&gt;';
	html += '&lt;/div&gt;';

// find / replace buttons
	html += '&lt;div class=&quot;wikEdButtonsFind&quot; id=&quot;wikEdButtonsFind&quot;&gt;';

	html += '&lt;img class=&quot;wikEdButton&quot;          src=&quot;' + wikEdImage['getFind']         + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdGetFind&quot;               alt=&quot;' + wikEdText['wikEdGetFind alt']               + '&quot; title=&quot;' + wikEdText['wikEdGetFind title']               + '&quot; onClick=&quot;javascript:WikEdEditButton(\'wikEdGetFind\');&quot; ondblclick=&quot;javascript:WikEdEditButton(\'wikEdGetFindReplace\');&quot;&gt;';
	html += '&lt;img class=&quot;wikEdButton&quot;          src=&quot;' + wikEdImage['findAll']         + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdFindAll&quot;               alt=&quot;' + wikEdText['wikEdFindAll alt']               + '&quot; title=&quot;' + wikEdText['wikEdFindAll title']               + '&quot; onClick=&quot;javascript:WikEdEditButton(\'wikEdFindAll\');&quot;&gt;';
	html += '&lt;img class=&quot;wikEdButton&quot;          src=&quot;' + wikEdImage['findPrev']        + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdFindPrev&quot;              alt=&quot;' + wikEdText['wikEdFindPrev alt']              + '&quot; title=&quot;' + wikEdText['wikEdFindPrev title']              + '&quot; onClick=&quot;javascript:WikEdEditButton(\'wikEdFindPrev\');&quot;&gt;';

	html += '&lt;span class=&quot;wikEdFindComboInput&quot; id=&quot;wikEdFindComboInput&quot;&gt;';
	html += '&lt;input class=&quot;wikEdCombo&quot; id=&quot;wikEdFindText&quot; type=&quot;text&quot; value=&quot;&quot; onfocus=&quot;javascript:this.setSelectionRange(0, this.textLength);&quot;&gt;';
	html += '&lt;select class=&quot;wikEdCombo&quot; id=&quot;wikEdFindSelect&quot; onfocus=&quot;javascript:WikEdSetComboOptions(\'find\')&quot; onChange=&quot;javascript:WikEdChangeComboInput(\'find\');&quot;&gt;';
	html += '&lt;/select&gt;';
	html += '&lt;/span&gt;';

	html += '&lt;img class=&quot;wikEdButton&quot;          src=&quot;' + wikEdImage['findNext']        + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdFindNext&quot;              alt=&quot;' + wikEdText['wikEdFindNext alt']              + '&quot; title=&quot;' + wikEdText['wikEdFindNext title']              + '&quot; onClick=&quot;javascript:WikEdEditButton(\'wikEdFindNext\');&quot;&gt;';
	html += '&lt;img class=&quot;wikEdButton&quot;          src=&quot;' + wikEdImage['jumpTopBottom']   + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdUpdown&quot;                alt=&quot;' + wikEdText['wikEdUpdown alt']                + '&quot; title=&quot;' + wikEdText['wikEdUpdown title']                + '&quot; onClick=&quot;javascript:WikEdEditButton(\'wikEdUpdown\');&quot;&gt;';
	html += '&lt;img class=&quot;wikEdButtonInactive&quot;  src=&quot;' + wikEdImage['prevPos']         + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdPrevPos&quot;               alt=&quot;' + wikEdText['wikEdPrevPos alt']               + '&quot; title=&quot;' + wikEdText['wikEdPrevPos title']               + '&quot; onClick=&quot;javascript:WikEdEditButton(\'wikEdPrevPos\');&quot;&gt;';
	html += '&lt;img class=&quot;wikEdButtonInactive&quot;  src=&quot;' + wikEdImage['lastPos']         + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdLastPos&quot;               alt=&quot;' + wikEdText['wikEdLastPos alt']               + '&quot; title=&quot;' + wikEdText['wikEdLastPos title']               + '&quot; onClick=&quot;javascript:WikEdEditButton(\'wikEdLastPos\');&quot;&gt;';
	html += '&lt;br /&gt;';

	html += '&lt;img class=&quot;wikEdButton&quot;          src=&quot;' + wikEdImage['clearFind']       + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdClearFind&quot;             alt=&quot;' + wikEdText['wikEdClearFind alt']             + '&quot; title=&quot;' + wikEdText['wikEdClearFind title']             + '&quot; onClick=&quot;javascript:WikEdButton(\'wikEdClearFind\');&quot;&gt;';
	html += '&lt;img class=&quot;wikEdButton&quot;          src=&quot;' + wikEdImage['replaceAll']      + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdReplaceAll&quot;            alt=&quot;' + wikEdText['wikEdReplaceAll alt']            + '&quot; title=&quot;' + wikEdText['wikEdReplaceAll title']            + '&quot; onClick=&quot;javascript:WikEdEditButton(\'wikEdReplaceAll\');&quot;&gt;';
	html += '&lt;img class=&quot;wikEdButton&quot;          src=&quot;' + wikEdImage['replacePrev']     + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdReplacePrev&quot;           alt=&quot;' + wikEdText['wikEdReplacePrev alt']           + '&quot; title=&quot;' + wikEdText['wikEdReplacePrev title']           + '&quot; onClick=&quot;javascript:WikEdEditButton(\'wikEdReplacePrev\');&quot;&gt;';

	html += '&lt;span class=&quot;wikEdReplaceComboInput&quot; id=&quot;wikEdReplaceComboInput&quot;&gt;';
	html += '&lt;input class=&quot;wikEdCombo&quot; id=&quot;wikEdReplaceText&quot; type=&quot;text&quot; value=&quot;&quot; onfocus=&quot;this.setSelectionRange(0, this.textLength);&quot;&gt;';
	html += '&lt;select class=&quot;wikEdCombo&quot; id=&quot;wikEdReplaceSelect&quot; onfocus=&quot;WikEdSetComboOptions(\'replace\')&quot; onChange=&quot;javascript:WikEdChangeComboInput(\'replace\');&quot;&gt;';
	html += '&lt;/select&gt;';
	html += '&lt;/span&gt;';

	html += '&lt;img class=&quot;wikEdButton&quot;          src=&quot;' + wikEdImage['replaceNext']     + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdReplaceNext&quot;           alt=&quot;' + wikEdText['wikEdReplaceNext alt']           + '&quot; title=&quot;' + wikEdText['wikEdReplaceNext title']           + '&quot; onClick=&quot;javascript:WikEdEditButton(\'wikEdReplaceNext\');&quot;&gt;';
	html += '&lt;img class=&quot;wikEdButtonUnchecked&quot; src=&quot;' + wikEdImage['caseSensitive']   + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdCaseSensitive&quot;         alt=&quot;' + wikEdText['wikEdCaseSensitive alt']         + '&quot; title=&quot;' + wikEdText['wikEdCaseSensitive title']         + '&quot; onClick=&quot;javascript:WikEdButton(\'wikEdCaseSensitive\', true);&quot;&gt;';
	html += '&lt;img class=&quot;wikEdButtonUnchecked&quot; src=&quot;' + wikEdImage['regExp']          + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdRegExp&quot;                alt=&quot;' + wikEdText['wikEdRegExp alt']                + '&quot; title=&quot;' + wikEdText['wikEdRegExp title']                + '&quot; onClick=&quot;javascript:WikEdButton(\'wikEdRegExp\', true);&quot;&gt;';
	html += '&lt;img class=&quot;wikEdButtonUnchecked&quot; src=&quot;' + wikEdImage['findAhead']       + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdFindAhead&quot;             alt=&quot;' + wikEdText['wikEdFindAhead alt']             + '&quot; title=&quot;' + wikEdText['wikEdFindAhead title']             + '&quot; onClick=&quot;javascript:WikEdButton(\'wikEdFindAhead\', true);&quot;&gt;';
	html += '&lt;/div&gt;';

// fixing buttons
	html += '&lt;div class=&quot;wikEdButtonsFix&quot; id=&quot;wikEdButtonsFix&quot;&gt;';

	html += '&lt;img class=&quot;wikEdButton&quot;          src=&quot;' + wikEdImage['fixBasic']        + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdFixBasic&quot;              alt=&quot;' + wikEdText['wikEdFixBasic alt']              + '&quot; title=&quot;' + wikEdText['wikEdFixBasic title']              + '&quot; onClick=&quot;javascript:WikEdEditButton(\'wikEdFixBasic\');&quot;&gt;';
	html += '&lt;img class=&quot;wikEdButton&quot;          src=&quot;' + wikEdImage['fixHtml']         + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdFixHtml&quot;               alt=&quot;' + wikEdText['wikEdFixHtml alt']               + '&quot; title=&quot;' + wikEdText['wikEdFixHtml title']               + '&quot; onClick=&quot;javascript:WikEdEditButton(\'wikEdFixHtml\');&quot;&gt;';
	html += '&lt;img class=&quot;wikEdButton&quot;          src=&quot;' + wikEdImage['fixCaps']         + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdFixCaps&quot;               alt=&quot;' + wikEdText['wikEdFixCaps alt']               + '&quot; title=&quot;' + wikEdText['wikEdFixCaps title']               + '&quot; onClick=&quot;javascript:WikEdEditButton(\'wikEdFixCaps\');&quot;&gt;';
	html += '&lt;img class=&quot;wikEdButton&quot;          src=&quot;' + wikEdImage['fixUnicode']      + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdfixUnicode&quot;            alt=&quot;' + wikEdText['wikEdfixUnicode alt']            + '&quot; title=&quot;' + wikEdText['wikEdfixUnicode title']            + '&quot; onClick=&quot;javascript:WikEdEditButton(\'wikEdfixUnicode\');&quot;&gt;';
	html += '&lt;img class=&quot;wikEdButton&quot;          src=&quot;' + wikEdImage['fixAll']          + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdFixAll&quot;                alt=&quot;' + wikEdText['wikEdFixAll alt']                + '&quot; title=&quot;' + wikEdText['wikEdFixAll title']                + '&quot; onClick=&quot;javascript:WikEdEditButton(\'wikEdFixAll\');&quot;&gt;';
	html += '&lt;img class=&quot;wikEdButton&quot;          src=&quot;' + wikEdImage['fixRegExTypo']    + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdFixRegExTypo&quot;          alt=&quot;' + wikEdText['wikEdFixRegExTypo alt']          + '&quot; title=&quot;' + wikEdText['wikEdFixRegExTypo title']          + '&quot; onClick=&quot;javascript:WikEdEditButton(\'wikEdFixRegExTypo\');&quot;&gt;';
	html += '&lt;br /&gt;';

	html += '&lt;img class=&quot;wikEdButton&quot;          src=&quot;' + wikEdImage['fixDash']         + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdFixDashes&quot;             alt=&quot;' + wikEdText['wikEdFixDashes alt']             + '&quot; title=&quot;' + wikEdText['wikEdFixDashes title']             + '&quot; onClick=&quot;javascript:WikEdEditButton(\'wikEdFixDashes\');&quot;&gt;';
	html += '&lt;img class=&quot;wikEdButton&quot;          src=&quot;' + wikEdImage['fixPunct']        + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdFixPunct&quot;              alt=&quot;' + wikEdText['wikEdFixPunct alt']              + '&quot; title=&quot;' + wikEdText['wikEdFixPunct title']              + '&quot; onClick=&quot;javascript:WikEdEditButton(\'wikEdFixPunct\');&quot;&gt;';
	html += '&lt;img class=&quot;wikEdButton&quot;          src=&quot;' + wikEdImage['fixMath']         + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdFixMath&quot;               alt=&quot;' + wikEdText['wikEdFixMath alt']               + '&quot; title=&quot;' + wikEdText['wikEdFixMath title']               + '&quot; onClick=&quot;javascript:WikEdEditButton(\'wikEdFixMath\');&quot;&gt;';
	html += '&lt;img class=&quot;wikEdButton&quot;          src=&quot;' + wikEdImage['fixChem']         + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdFixChem&quot;               alt=&quot;' + wikEdText['wikEdFixChem alt']               + '&quot; title=&quot;' + wikEdText['wikEdFixChem title']               + '&quot; onClick=&quot;javascript:WikEdEditButton(\'wikEdFixChem\');&quot;&gt;';
	html += '&lt;img class=&quot;wikEdButton&quot;          src=&quot;' + wikEdImage['fixUnits']        + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdFixUnits&quot;              alt=&quot;' + wikEdText['wikEdFixUnits alt']              + '&quot; title=&quot;' + wikEdText['wikEdFixUnits title']              + '&quot; onClick=&quot;javascript:WikEdEditButton(\'wikEdFixUnits\');&quot;&gt;';
	html += '&lt;/div&gt;';
	html += '&lt;br style=&quot;clear: both;&quot;&gt;';
        WEDBA(8);
// add html to buttons wrapper
	wikEdButtonsWrapper.innerHTML = html;
	wikEdButtonsFormat = document.getElementById('wikEdButtonsFormat');
	wikEdButtonsFind = document.getElementById('wikEdButtonsFind');
	wikEdButtonsFix = document.getElementById('wikEdButtonsFix');
	wikEdButtonsControl = document.getElementById('wikEdButtonsControl');
	wikEdCaseSensitive = document.getElementById('wikEdCaseSensitive');
	wikEdRegExp = document.getElementById('wikEdRegExp');
	wikEdFindAhead = document.getElementById('wikEdFindAhead');
	wikEdFindText = document.getElementById('wikEdFindText');
	wikEdReplaceText = document.getElementById('wikEdReplaceText');

// add submit buttons to submit wrapper
	var wpEditButtons = document.getElementById('wpSave').parentNode;
	wikEdSubmitButtonsWrapper.appendChild(wpEditButtons);

// add preview box top bar to submit wrapper
	var buttonsPreview = document.createElement('div');
	buttonsPreview.id = 'wikEdButtonsPreview';
	buttonsPreview.className = 'wikEdButtonsPreview';
        WEDBA(9);
	html = '';
	html += '&lt;img class=&quot;wikEdButton&quot;          src=&quot;' + wikEdImage['preview']         + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdPreview&quot;               alt=&quot;' + wikEdText['wikEdPreview alt']               + '&quot; title=&quot;' + wikEdText['wikEdPreview title']               + '&quot; onClick=&quot;javascript:WikEdButton(\'wikEdPreview\');&quot;&gt;';
	html += '&lt;img class=&quot;wikEdButton&quot;          src=&quot;' + wikEdImage['diff']            + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdDiff&quot;                  alt=&quot;' + wikEdText['wikEdDiff alt']                  + '&quot; title=&quot;' + wikEdText['wikEdDiff title']                  + '&quot; onClick=&quot;javascript:WikEdButton(\'wikEdDiff\');&quot;&gt;';
	html += '&lt;img class=&quot;wikEdButton&quot;          src=&quot;' + wikEdImage['close']           + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdClose&quot;                 alt=&quot;' + wikEdText['wikEdClose alt']                 + '&quot; title=&quot;' + wikEdText['wikEdClose title']                 + '&quot; onClick=&quot;javascript:WikEdButton(\'wikEdClose\');&quot;&gt;';
	html += '&lt;img class=&quot;wikEdButton&quot;          src=&quot;' + wikEdImage['scrollToButtons'] + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdScrollToButtons2&quot;      alt=&quot;' + wikEdText['wikEdScrollToButtons2 alt']      + '&quot; title=&quot;' + wikEdText['wikEdScrollToButtons2 title']      + '&quot; onClick=&quot;javascript:WikEdButton(\'wikEdScrollToButtons2\');&quot;&gt;';
	html += '&lt;img class=&quot;wikEdButton&quot;          src=&quot;' + wikEdImage['scrollToText']    + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdScrollToInput2&quot;        alt=&quot;' + wikEdText['wikEdScrollToInput2 alt']        + '&quot; title=&quot;' + wikEdText['wikEdScrollToInput2 title']        + '&quot; onClick=&quot;javascript:WikEdButton(\'wikEdScrollToInput2\');&quot;&gt;';

	buttonsPreview.innerHTML = html;
	wikEdSubmitWrapper.insertBefore(buttonsPreview, wikEdSubmitWrapper.firstChild);
	wikEdButtonsPreview = document.getElementById('wikEdButtonsPreview');

// add preview box and its bottom bar to preview wrapper
	html = '';
	html += '&lt;div id=&quot;wikEdPreviewBoxOuter&quot; class=&quot;wikEdPreviewBoxOuter&quot;&gt;';
	html += '&lt;div id=&quot;wikEdPreviewBox&quot; class=&quot;wikEdPreviewBox&quot;&gt;';
	html += '&lt;/div&gt;';
	html += '&lt;/div&gt;';

	html += '&lt;div id=&quot;wikEdButtonsPreview2&quot; class=&quot;wikEdButtonsPreview2&quot;&gt;';
	html += '&lt;img class=&quot;wikEdButton&quot;          src=&quot;' + wikEdImage['preview']         + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdPreview2&quot;              alt=&quot;' + wikEdText['wikEdPreview2 alt']              + '&quot; title=&quot;' + wikEdText['wikEdPreview2 title']              + '&quot; onClick=&quot;javascript:WikEdButton(\'wikEdPreview2\');&quot;&gt;';
	html += '&lt;img class=&quot;wikEdButton&quot;          src=&quot;' + wikEdImage['diff']            + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdDiff2&quot;                 alt=&quot;' + wikEdText['wikEdDiff2 alt']                 + '&quot; title=&quot;' + wikEdText['wikEdDiff2 title']                 + '&quot; onClick=&quot;javascript:WikEdButton(\'wikEdDiff2\');&quot;&gt;';
	html += '&lt;img class=&quot;wikEdButton&quot;          src=&quot;' + wikEdImage['close']           + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdClose2&quot;                alt=&quot;' + wikEdText['wikEdClose2 alt']                + '&quot; title=&quot;' + wikEdText['wikEdClose2 title']                + '&quot; onClick=&quot;javascript:WikEdButton(\'wikEdClose2\');&quot;&gt;';
	html += '&lt;img class=&quot;wikEdButton&quot;          src=&quot;' + wikEdImage['scrollToButtons'] + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdScrollToButtons3&quot;      alt=&quot;' + wikEdText['wikEdScrollToButtons3 alt']      + '&quot; title=&quot;' + wikEdText['wikEdScrollToButtons3 title']      + '&quot; onClick=&quot;javascript:WikEdButton(\'wikEdScrollToButtons3\');&quot;&gt;';
	html += '&lt;img class=&quot;wikEdButton&quot;          src=&quot;' + wikEdImage['scrollToText']    + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdScrollToInput3&quot;        alt=&quot;' + wikEdText['wikEdScrollToInput3 alt']        + '&quot; title=&quot;' + wikEdText['wikEdScrollToInput3 title']        + '&quot; onClick=&quot;javascript:WikEdButton(\'wikEdScrollToInput3\');&quot;&gt;';
	html += '&lt;/div&gt;';

	wikEdLocalPrevWrapper.innerHTML = html;
	wikEdPreviewBox = document.getElementById('wikEdPreviewBox');
	wikEdButtonsPreview2 = document.getElementById('wikEdButtonsPreview2');
        WEDBA(10);
// add jump box to standard preview
	var wikiPreview = document.getElementById('wikiPreview');
	if (wikiPreview != null) {
		if (wikiPreview.firstChild != null) {

			var buttonsJump = document.createElement('div');
			buttonsJump.id = 'wikEdButtonsJump';
			buttonsJump.className = 'wikEdButtonsJump';

			html = '';
			html += '&lt;img class=&quot;wikEdButtonSolo&quot; src=&quot;' + wikEdImage['scrollToButtons'] + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdScrollToButtons4&quot;      alt=&quot;' + wikEdText['wikEdScrollToButtons4 alt']      + '&quot; title=&quot;' + wikEdText['wikEdScrollToButtons4 title']      + '&quot; onClick=&quot;javascript:WikEdButton(\'wikEdScrollToButtons4\');&quot;&gt;';
			html += '&lt;img class=&quot;wikEdButtonSolo&quot; src=&quot;' + wikEdImage['scrollToText']    + '&quot; width=&quot;16&quot; height=&quot;16&quot; id=&quot;wikEdScrollToInput4&quot;        alt=&quot;' + wikEdText['wikEdScrollToInput4 alt']        + '&quot; title=&quot;' + wikEdText['wikEdScrollToInput4 title']        + '&quot; onClick=&quot;javascript:WikEdButton(\'wikEdScrollToInput4\');&quot;&gt;';

			buttonsJump.innerHTML = html;
			wikiPreview.insertBefore(buttonsJump, wikiPreview.firstChild);
			wikEdButtonsJump = document.getElementById('wikEdButtonsJump');
		}
	}

// add insert special chars to insert wrapper
	var wpSpecialchars = document.getElementById('editpage-specialchars');
	if (wpSpecialchars != null) {
		wikEdInsertWrapper.appendChild(wpSpecialchars);
	}

// wrappers filled
        WEDBA(11);
// add local preview button next to submit button
	var localPreview = document.createElement('button');
	//localPreview.type = 'button'; Property is read-only in IE but defaults to 'button'
	localPreview.id = 'wikEdLocalPreview';
	localPreview.title = 'Show preview below';
	localPreview.className = 'wikEdLocalPreview';
	var localPreviewImg = document.createElement('img');
	localPreviewImg.id = 'wikEdLocalPreviewImg';
	localPreviewImg.src = wikEdImage['preview'];
	localPreviewImg.alt = 'Preview below';
	localPreview.appendChild(localPreviewImg);
	var previewButton = document.getElementById('wpPreview');
	previewButton.parentNode.insertBefore(localPreview, previewButton.nextSibling);
// add local diff button next to submit button
	var localDiff = document.createElement('button');
	//localDiff.type = 'button';
	localDiff.id = 'wikEdLocalDiff';
	localDiff.title = 'Show current changes below';
	localDiff.className = 'wikEdLocalDiff';

	var localDiffImg = document.createElement('img');
	localDiffImg.id = 'wikEdLocalDiffImg';
	localDiffImg.src = wikEdImage['diff'];
	localDiffImg.alt = 'Changes below';

	localDiff.appendChild(localDiffImg);
	var previewButton = document.getElementById('wpDiff');
	previewButton.parentNode.insertBefore(localDiff, previewButton.nextSibling);
// initialize image buttons
	WikEdButton('wikEdHighlightSyntax', null, wikEdHighlightSyntax);
	WikEdButton('wikEdUseWikEd', null, wikEdUseWikEd);
	WikEdButton('wikEdFullScreen', null, wikEdFullScreenMode);
	WikEdButton('wikEdUsing', null, wikEdUsing);
	WikEdButton('wikEdCaseSensitive', null, false);
	WikEdButton('wikEdRegExp', null, false);
	WikEdButton('wikEdFindAhead', null, wikEdFindAheadSelected);
	WikEdButton('wikEdPreview', null, false, 'wikEdButton');
	WikEdButton('wikEdDiff', null, false, 'wikEdButton');
	WikEdButton('wikEdClose', null, false, 'wikEdButton');
	WikEdButton('wikEdPreview2', null, false, 'wikEdButton');
	WikEdButton('wikEdDiff2', null, false, 'wikEdButton');
	WikEdButton('wikEdClose2', null, false, 'wikEdButton');

	if (wikEdRegExTypoFix == false) {
		document.getElementById('wikEdFixRegExTypo').className = 'wikEdButtonInactive';
	}
// no linebreak before minor edit checkbox
	if (wikEdNoLinebreak == true) {
		var wpMinoredit = document.getElementById('wpMinoredit');
		var node = wpMinoredit.previousSibling;
		while (node != null) {
			if (node.tagName == 'BR') {
				node.parentNode.removeChild(node);
				break;
			}
			node = node.previousSibling;
		}
	}
// add a clear summary button left to the summary input field
	var clearSummary = document.createElement('button');
//	clearSummary.type = 'button';
	clearSummary.id = 'wikEdClearSummary';
	clearSummary.className = 'wikEdClearSummary';
	clearSummary.alt = wikEdText['wikEdClearSummary alt'];
	clearSummary.title = wikEdText['wikEdClearSummary title'];
	clearSummary.style.height = (wikEdSummaryText.clientHeight + 1) +'px';
// clear the summary onclick function
	clearSummary.onclick = function() {

// clear the summary if it is only a paragraph name
		if ( /^\/\* .*? \*\/ *$/.test(wikEdSummaryText.value) ) {
			wikEdSummaryText.value = '';
		}

// clear the summary but leave paragraph names
		else {
			wikEdSummaryText.value = wikEdSummaryText.value.replace(/^((\/\* .*? \*\/ )?).*/, '$1');
		}
		return;
	}
	var clearSummaryImg = document.createElement('img');
	clearSummaryImg.id = 'wikEdClearSummaryImg';
	clearSummaryImg.src = wikEdImage['clearSummary'];
	clearSummaryImg.alt = 'Clear summary';
	clearSummary.appendChild(clearSummaryImg);
	wikEdSummaryText.parentNode.insertBefore(clearSummary, wikEdSummaryText);
// make the summary a combo box

// style needs to be declared here so that it is not overridden by monobook.css
	wikEdSummaryText.style.width = 'auto';
	wikEdSummaryText.className = 'wikEdSummaryText';

	var summaryComboInput = document.createElement('span');
	summaryComboInput.id = 'wikEdSummaryComboInput';
	summaryComboInput.className = 'wikEdSummaryComboInput';

	var summarySelect = document.createElement('select');
	summarySelect.id = 'wikEdSummarySelect';
	summarySelect.className = 'wikEdSummarySelect';
	summarySelect.onchange = function() {
		WikEdChangeComboInput('summary');
	}
	summarySelect.onfocus = function() {
		WikEdSetComboOptions('summary');
	}

	summaryComboInput = wikEdSummaryText.parentNode.insertBefore(summaryComboInput, wikEdSummaryText);
	summaryComboInput.appendChild(wikEdSummaryText);
	summaryComboInput.appendChild(summarySelect);
        WEDBA(12);
// shorten submit button texts
	document.getElementById('wpPreview').value = wikEdText['shortenedPreview'];
	document.getElementById('wpDiff').value = wikEdText['shortenedChanges'];

// set up combo input boxes with history
	wikEdFieldHist ['find'] = [];
	wikEdCookieName['find'] = 'wikEdFindHistory';
	wikEdInputElement['find'] = new Object(wikEdFindText);
	wikEdSelectElement['find'] = new Object(document.getElementById('wikEdFindSelect'));
	wikEdSelectElement['find'].style.height = (wikEdInputElement['find'].clientHeight + 1) +'px';

	wikEdFieldHist ['replace'] = [];
	wikEdCookieName['replace'] = 'wikEdReplaceHistory';
	wikEdInputElement['replace'] = new Object(wikEdReplaceText);
	wikEdSelectElement['replace'] = new Object(document.getElementById('wikEdReplaceSelect'));
	wikEdSelectElement['replace'].style.height = (wikEdInputElement['replace'].clientHeight + 1) +'px';

	wikEdFieldHist ['summary'] = [];
	wikEdCookieName['summary'] = 'wikEdSummaryHistory';
	wikEdInputElement['summary'] = new Object(wikEdSummaryText);
	wikEdSelectElement['summary'] = new Object(document.getElementById('wikEdSummarySelect'));
	wikEdSelectElement['summary'].style.height = (wikEdInputElement['summary'].clientHeight + 1) +'px';
	WikEdResizeComboInput('find');
	WikEdResizeComboInput('replace');
	WikEdResizeComboInput('summary');

// display only the textarea or the iframe, dont change the frame
	if (wikEdUseWikEd == true) {
		WikEdSetEditArea(true, true);
	}
	else {
		WikEdSetEditArea(false, true);
	}

// add a link to the wikEd help page
	if ( (wikEdHelpPageLink != '') &amp;&amp; (wikEdHelpPageLink != null) ) {
		var editHelpParent = previewButton;
		do {
			editHelpParent = editHelpParent.nextSibling;
		} while (editHelpParent.tagName != 'SPAN');

		var editHelp = editHelpParent.lastChild;
		while (editHelp.tagName != 'A') {
			editHelp = editHelp.previousSibling;
		}

		var wikEdHelpSpan = document.createElement('span');
		wikEdHelpSpan.className = 'wikEdHelpSpan';
		wikEdHelpSpan.innerHTML = wikEdHelpPageLink;
		editHelpParent.insertBefore(wikEdHelpSpan, editHelp.nextSibling);
	}
        WEDBA(13);
// add frame stylesheet definition
	wikEdFrameBody.style.fontSize = parseInt(wikEdTextZoom) + '%';
        WEDBA(13.05);
	var frameStyle = new WikEdStyleSheet(wikEdFrameDocument);
        WEDBA(13.1);
	for (var ruleName in wikEdFrameCSS) {
		var ruleStyle = wikEdFrameCSS[ruleName];
		ruleStyle = ruleStyle.replace(/\{wikEdUnknown\}/g, wikEdImage['unknown']);
		ruleStyle = ruleStyle.replace(/\{wikEdTab\}/g, wikEdImage['tab']);
		ruleStyle = ruleStyle.replace(/\{wikEdCtrl\}/g, wikEdImage['ctrl']);
		ruleStyle = ruleStyle.replace(/\{wikEdBlank\}/g, wikEdImage['blank']);
		if(ruleStyle!='') frameStyle.addRule(ruleName, ruleStyle);
	}
        WEDBA(13.3);
// copy the textarea content to the iframe
	if (wikEdUseWikEd == true) {
		WikEdUpdateFrame();
	}
        WEDBA(13.5);
// set frame events
        if(wikEdFrameDocument.addEventListener)
        {
	  wikEdFrameDocument.addEventListener('keydown', WikEdKeyFrame, true);
	  wikEdFrameDocument.addEventListener('keyup', WikEdKeyFrame, true);
	  wikEdFrameDocument.addEventListener('keypress', WikEdKeyFrame, true);
	  wikEdFrameDocument.addEventListener('mouseup', WikEdKeyFrame, true);
// find ahead events
	  wikEdFindText.addEventListener('keyup', WikEdFindAhead, true);
        }
        else
        {
	  wikEdFrameDocument.attachEvent('keydown', WikEdKeyFrame);
	  wikEdFrameDocument.attachEvent('keyup', WikEdKeyFrame);
	  wikEdFrameDocument.attachEvent('keypress', WikEdKeyFrame);
	  wikEdFrameDocument.attachEvent('mouseup', WikEdKeyFrame);
// find ahead events
	  wikEdFindText.attachEvent('keyup', WikEdFindAhead, true);
        }
        WEDBA(14);
// submit button events
	var saveButton = document.getElementById('wpSave');
	var previewButton = document.getElementById('wpPreview');
	var diffButton = document.getElementById('wpDiff');
	var localPreview = document.getElementById('wikEdLocalPreview');
	var localDiff = document.getElementById('wikEdLocalDiff');

// 'Save page' onclick function
	saveButton.onclick = function() {
		if (wikEdUseWikEd == true) {
			WikEdUpdateTextarea();
		}

// add &quot;using wikEd&quot; to summary
		var text = wikEdSummaryText.value;
		text = text.replace(/^[, ]+/, '');
		text = text.replace(/[, ]+$/, '');
		WikEdAddToHistory('summary');
		if ( (wikEdUsing == true) &amp;&amp; (text != '') ) {
			if (text.lastIndexOf(wikEdSummaryUsing) &lt; 0) {
				text += ' ' + wikEdSummaryUsing;
			}
		}
		wikEdSummaryText.value = text;
		saveButton.onclick = null;
		saveButton.click();
		return;
	};

// 'Show preview' onclick function
	previewButton.onclick = function() {
		if (wikEdUseWikEd == true) {
			WikEdUpdateTextarea();
		}
		previewButton.onclick = null;
		previewButton.click();
		return;
	};

// 'Show changes' onclick function
	diffButton.onclick = function() {
		if (wikEdFullScreenMode == true) {
			WikEdFullScreen(false);
		}
		if (wikEdUseWikEd == true) {
			WikEdUpdateTextarea();
		}
		diffButton.onclick = null;
		diffButton.click();
		return;
	};

// 'Show preview' image button onclick function
	localPreview.onclick = function() {
		WikEdButton('wikEdLocalPreview');
		return;
	};

// 'Show changes' image button onclick function
	localDiff.onclick = function() {
		WikEdButton('wikEdLocalDiff');
		return;
	};

// disable scrolling to edit window on next preview page
	document.getElementById('editform').action += '&amp;wikedpreview';

// scroll to edit window if it is not a preview page
	if (scrollToText != false) {
		if (window.location.search.match('wikedpreview') == null) {
			window.scroll(0, WikEdGetOffsetTop(wikEdInputWrapper) - 2);
		}

// focus the edit area
		if (wikEdUseWikEd == true) {
			wikEdFrameWindow.focus();
		}
		else {
			wikEdTextarea.setSelectionRange(0, 0);
			wikEdTextarea.focus();
		}
	}

// fullscreen mode
	if (wikEdFullScreenMode == true) {
		WikEdFullScreen(wikEdFullScreenMode, true);
	}

// reset error indicator
	WikEdSetLogo();
        WEDBA(15);
	return;
}


//
// WikEdSetLogo: set the logo on top of the page
//

function WikEdSetLogo(state) {

	if (state == 'error') {
		wikEdLogo.src = wikEdImage['error'];
		wikEdLogo.alt = wikEdText['wikEdLogo error alt'];
		wikEdLogo.title = wikEdText['wikEdLogo error title'];
	}
	else {
		if (wikEdDisabled == true) {
			wikEdLogo.src = wikEdImage['disabled'];
			wikEdLogo.alt = wikEdText['wikEdLogo disabled alt'];
			wikEdLogo.title = wikEdText['wikEdLogo disabled title'];
		}
		else {
			wikEdLogo.src = wikEdImage['logo'];
			wikEdLogo.alt = wikEdText['wikEdLogo alt'];
			wikEdLogo.title = wikEdText['wikEdLogo title'];
		}
	}

	wikEdLogo.title = wikEdLogo.title.replace(/\{wikEdProgramVersion\}/g, wikEdProgramVersion);
	wikEdLogo.title = wikEdLogo.title.replace(/\{wikEdProgramDate\}/g, wikEdProgramDate);

	return;
}


//
// WikEdSetEditArea: apply css changes to switch between classic textarea and rich text frame
//

function WikEdSetEditArea(useFrame, notFrame) {

// turn rich text frame on
	if (useFrame == true) {
		wikEdTextareaWrapper.style.position = 'absolute';
		wikEdTextareaWrapper.style.visibility = 'hidden';
		wikEdTextarea.style.display = 'none';

		if (notFrame != true) {
			wikEdFrameWrapper.style.position = 'static';
			wikEdFrameWrapper.style.visibility = 'visible';
			wikEdFrameBody.style.display = 'block';
		}

		if (document.getElementById('toolbar') != null) {
			if (wikEdShowToolbar == true) {
				document.getElementById('toolbar').style.display = 'block';
			}
			else {
				document.getElementById('toolbar').style.display = 'none';
			}
		}
		wikEdButtonsFormat.style.display = 'block';
		wikEdButtonsFind.style.display = 'block';
		wikEdButtonsFix.style.display = 'block';
		wikEdButtonsControl.style.display = 'block';
	}

// turn classic textarea on
	else {
		if (notFrame != true) {
			wikEdFrameWrapper.style.position = 'absolute';
			wikEdFrameWrapper.style.visibility = 'hidden';
			wikEdFrameBody.style.display = 'none';
		}

		wikEdTextareaWrapper.style.position = 'static';
		wikEdTextareaWrapper.style.visibility = 'visible';
		wikEdTextarea.style.display = 'block';

		if (document.getElementById('toolbar') != null) {
			document.getElementById('toolbar').style.display = 'block';
		}
		wikEdButtonsFormat.style.display = 'none';
		wikEdButtonsFind.style.display = 'none';
		wikEdButtonsFix.style.display = 'none';
		wikEdButtonsControl.style.display = 'block';
	}
	return;
}


//
// WikEdButton: toggle or set button checked state
//   used for buttons that do not require nor change the text. Faster than WikEdEditButton()

function WikEdButton(whichButton, toggleButton, setButton, classButton, doButton) {

// get the button object
	var buttonObj = document.getElementById(whichButton);
	if (buttonObj == null) {
		alert('Unknown button \'' + whichButton + '\'');
		return;
	}

// check if the button is disabled
	if (buttonObj.className == 'wikEdButtonInactive') {
		return;
	}

// set button to pressed, set cursor to hourglass
	buttonObj.style.cursor = 'wait';

// init the button
	if (setButton != null) {
		if (setButton == false) {
			buttonObj.checked = false;
			if (classButton == null) {
				buttonObj.className = 'wikEdButtonUnchecked';
			}
		}
		else {
			buttonObj.checked = true;
			if (classButton == null) {
				buttonObj.className = 'wikEdButtonChecked';
			}
		}
	}
	else if (classButton != null) {
		buttonObj.className = classButton;
	}

// toggle the button
	if (toggleButton != null) {
		if (toggleButton == true) {
			if (buttonObj.checked == true) {
				buttonObj.checked = false;
				buttonObj.className = 'wikEdButtonUnchecked';
			}
			else {
				buttonObj.checked = true;
				buttonObj.className = 'wikEdButtonChecked';
			}
		}
	}

// perform specific actions
	if ( ( (setButton == null) &amp;&amp; (classButton == null) ) || (doButton == true) ) {

// remove active content
		WikEdRemoveElements(['script', 'object', 'applet', 'embed']);

		switch (whichButton) {

// switch between syntax highlighting and plain text
			case 'wikEdHighlightSyntax':
				var obj = {};
				obj.html = wikEdFrameBody.innerHTML;
				obj.html = obj.html.replace(/(&lt;br\b[^&gt;]*&gt;)\n* */g, '$1');
				if (buttonObj.checked == true) {
					WikEdRemoveHighlighting(obj);
					wikEdHighlightSyntax = true;
					obj.html = obj.html.replace(/&lt;br\b[^&gt;]*&gt;/g, '\n');
					WikEdHighlightSyntax(obj);
					obj.html = obj.html.replace(/\n/g, '&lt;br /&gt;');
					var cookieExpire = new Date();
					cookieExpire.setTime(cookieExpire.getTime() - 60 * 60 * 1000);
					WikEdSetCookie('wikEdSyntaxOff', '', cookieExpire.toGMTString(), '/');
				}
				else {
					wikEdHighlightSyntax = false;
					WikEdRemoveHighlighting(obj);
					obj.html = obj.html.replace(/(\t)/g, '&lt;span class=&quot;wikEdTabPlain&quot;&gt;$1&lt;/span&gt;&lt;!--wikEdTabPlain--&gt;');
					WikEdSetCookie('wikEdSyntaxOff', 'true', null, '/');
				}
				wikEdFrameBody.innerHTML = obj.html;
				break;

// align textbox with display top
			case 'wikEdScrollToInput':
			case 'wikEdScrollToInput2':
			case 'wikEdScrollToInput3':
			case 'wikEdScrollToInput4':
				var wikEdInputWrapper = document.getElementById('wikEdInputWrapper');
				var inputWrapperTop = WikEdGetOffsetTop(wikEdInputWrapper);
				window.scroll(0, inputWrapperTop);
				break;

// align edit buttons with display top
			case 'wikEdScrollToButtons':
			case 'wikEdScrollToButtons2':
			case 'wikEdScrollToButtons3':
			case 'wikEdScrollToButtons4':
				var wikEdConsoleWrapper = document.getElementById('wikEdConsoleWrapper');
				var consoleWrapperTop = WikEdGetOffsetTop(wikEdConsoleWrapper);
				window.scroll(0, consoleWrapperTop);
				break;

// cycle through different font sizes
			case 'wikEdTextZoom':
				wikEdTextZoom = wikEdTextZoom / 1.2;
				if (wikEdTextZoom &lt; 60) {
					wikEdTextZoom = Math.round(wikEdTextZoom * Math.pow(1.2, 4) );
				}
				wikEdFrameBody.style.fontSize = parseInt(wikEdTextZoom) + '%;';
				break;

// display local preview box
			case 'wikEdPreview':
			case 'wikEdPreview2':
			case 'wikEdLocalPreview':
				if (wikEdFullScreenMode == true) {
					WikEdFullScreen(false);
				}
				if (wikEdUseWikEd == true) {
					WikEdUpdateTextarea();
				}
				wikEdPreviewBox.innerHTML = wiki2html(wikEdTextarea.value);
				wikEdLocalPrevWrapper.style.display = 'block';
				break;

// display local diff box
			case 'wikEdDiff':
			case 'wikEdDiff2':
			case 'wikEdLocalDiff':
				if (wikEdFullScreenMode == true) {
					WikEdFullScreen(false);
				}
				if (wikEdUseWikEd == true) {
					WikEdUpdateTextarea();
				}
				var diffText = wikEdTextarea.value;
				diffText = StringDiff(wikEdOrigVersion, diffText);
				wikEdPreviewBox.innerHTML = diffText;
				wikEdLocalPrevWrapper.style.display = 'block';
				break;

// close the preview / diff box
			case 'wikEdClose':
			case 'wikEdClose2':
				wikEdLocalPrevWrapper.style.display = 'none';
				break;

// switch between textarea and frame display
//   switching an iframe in design mode immediately after initialization between absolute/static may crash mozilla
			case 'wikEdUseWikEd':

// enble wikEd
				if (buttonObj.checked == true) {
					WikEdUpdateFrame();

// turn rich text frame on
					WikEdSetEditArea(true);
					wikEdUseWikEd = true;
					var cookieExpire = new Date();
					cookieExpire.setTime(cookieExpire.getTime() - 60 * 60 * 1000);
					WikEdSetCookie('wikEdUseClassic', '', cookieExpire.toGMTString(), '/');
				}

// disable wikEd
				else {
					if (wikEdFullScreenMode == true) {
						WikEdFullScreen(false);
					}
					WikEdUpdateTextarea();

// turn classic textarea on
					WikEdSetEditArea(false);
					wikEdUseWikEd = false;
					WikEdSetCookie('wikEdUseClassic', 'true', null, '/');
				}
				break;


// add &quot;using wikEd&quot; to summaries
			case 'wikEdUsing':
				if (buttonObj.checked == true) {
					wikEdUsing = true;
					WikEdSetCookie('wikEdSummaryUsing', 'true', null, '/');
				}
				else {
					wikEdUsing = false;
					var cookieExpire = new Date();
					cookieExpire.setTime(cookieExpire.getTime() - 60 * 60 * 1000);
					WikEdSetCookie('wikEdSummaryUsing', '', cookieExpire.toGMTString(), '/');
				}
				break;

// just toggle the case sensitive search button
			case 'wikEdCaseSensitive':
				break;

// just toggle the regexp search button
			case 'wikEdRegExp':
				break;

// just toggle the find-ahead-as-you-type search button
			case 'wikEdFindAhead':
				break;

// switch to fullscreen edit area
			case 'wikEdFullScreen':
				if (buttonObj.checked == true) {
					WikEdFullScreen(true);
					WikEdSetCookie('wikEdFullscreen', 'true', null, '/');
				}
				else {
					WikEdFullScreen(false);
					var cookieExpire = new Date();
					cookieExpire.setTime(cookieExpire.getTime() - 60 * 60 * 1000);
					WikEdSetCookie('wikEdFullscreen', '', cookieExpire.toGMTString(), '/');
				}
				break;

// clear the find, replace, and summary history stored in cookies
			case 'wikEdClearHistory':
				WikEdClearHistory('find');
				WikEdClearHistory('replace');
				WikEdClearHistory('summary');
				break;

// clear the search find field to search for the selected text
			case 'wikEdClearFind':
				wikEdInputElement['find'].value = '';
				break;

// for testing
			case 'wikEdPlaceholder':
				break;
		}
	}

// reset the frame DOM cache because the frame content might have changed
	wikEdFrameDOMCache = null;

// reset cursor to normal
	buttonObj.style.cursor = 'pointer';

	return;
}


//
// WikEdEditButton: editing functions
//   used for buttons that require or change the text. More tome consuming than WikEdButton()


function WikEdEditButton(whichButton, parameterArray) {

// get the button object
	var buttonObj = document.getElementById(whichButton);

// check if button is disabled
	if (buttonObj != null) {
		if (buttonObj.className == 'wikEdButtonInactive') {
			return;
		}
	}

// remove active content
	WikEdRemoveElements(['script', 'object', 'applet', 'embed', 'textarea']);

// get ranges to apply the changes to:
// whole text, selection, cursor, word and line under cursor and selection
	var obj = {};

// setup whole object for the whole text
	obj.whole = {};
	obj.whole.plainArray = [];
	obj.whole.plainNode = [];
	obj.whole.plainStart = [];
	obj.whole.from = 'whole';

// get whole range
	obj.whole.range = document.createRange();
	obj.whole.range.setStartBefore(wikEdFrameBody.firstChild);
	obj.whole.range.setEndAfter(wikEdFrameBody.lastChild);

// get whole plain text
	WikEdGetInnerHTML(obj.whole, wikEdFrameBody);
	obj.whole.code = obj.whole.html;
	WikEdRemoveHighlightingWikify(obj.whole);
	obj.whole.plain = obj.whole.html;
	obj.whole.plain = obj.whole.plain.replace(/&lt;br\b[^&gt;]*&gt;/g, '\n');
	obj.whole.plain = obj.whole.plain.replace(/\u00a0/g, ' ');
	obj.whole.range.setStartBefore(wikEdFrameBody.firstChild);
	obj.whole.range.setEndAfter(wikEdFrameBody.lastChild);

// setup selection object for the selected text
	obj.selection = {};
	obj.selection.from = 'selection';

// set selection range
	obj.sel = wikEdFrameWindow.getSelection();
	obj.selection.range = obj.sel.getRangeAt(obj.sel.rangeCount - 1);

// copy range to document fragment
	var documentFragment = obj.selection.range.cloneContents();

// get selected text
	WikEdGetInnerHTML(obj.selection, documentFragment);
	obj.selection.code = obj.selection.html;
	WikEdRemoveHighlightingWikify(obj.selection);
	obj.selection.plain = obj.selection.html;
	obj.selection.plain = obj.selection.plain.replace(/&lt;br\b[^&gt;]*&gt;/g, '\n');
	obj.selection.plain = obj.selection.plain.replace(/\u00a0/g, ' ');

// setup cursor object for the cursor position
	obj.cursor = {};
	obj.cursor.from = 'cursor';
	obj.cursor.range = document.createRange();
	obj.cursor.range.setStart(obj.sel.focusNode, obj.sel.focusOffset);
	obj.cursor.range.setEnd(obj.sel.focusNode, obj.sel.focusOffset);
	obj.cursor.plain = '';

// setup focusWord object for the word under the cursor
	obj.focusWord = {};
	obj.focusWord.from = 'focusWord';
	obj.focusWord.range = document.createRange();

// setup focusLine object for the line under the cursor
	obj.focusLine = {};
	obj.focusLine.from = 'focusLine';
	obj.focusLine.range = document.createRange();

// setup selectionWord object for the words under the selection
	obj.selectionWord = {};
	obj.selectionWord.from = 'selectionWord';
	obj.selectionWord.range = document.createRange();

// setup selectionLine object for the lines under the selection
	obj.selectionLine = {};
	obj.selectionLine.from = 'selectionLine';
	obj.selectionLine.range = document.createRange();

// find the respective word and line boundaries
	WikEdFindBoundaries(obj.focusWord, obj.focusLine, obj.whole, obj.cursor);
	WikEdFindBoundaries(obj.selectionWord, obj.selectionLine, obj.whole, obj.selection);

// get the wikified plain text for the word under the cursor
	var documentFragment = obj.focusWord.range.cloneContents();
	WikEdGetInnerHTML(obj.focusWord, documentFragment);
	obj.focusWord.code = obj.focusWord.html;
	WikEdRemoveHighlightingWikify(obj.focusWord);
	obj.focusWord.plain = obj.focusWord.html;
	obj.focusWord.plain = obj.focusWord.plain.replace(/&lt;br\b[^&gt;]*&gt;/g, '\n');
	obj.focusWord.plain = obj.focusWord.plain.replace(/\u00a0/g, ' ');

// get the wikified plain text for the line under the cursor
	var documentFragment = obj.focusLine.range.cloneContents();
	WikEdGetInnerHTML(obj.focusLine, documentFragment);
	obj.focusLine.code = obj.focusLine.html;
	WikEdRemoveHighlightingWikify(obj.focusLine);
	obj.focusLine.plain = obj.focusLine.html;
	obj.focusLine.plain = obj.focusLine.plain.replace(/&lt;br\b[^&gt;]*&gt;/g, '\n');
	obj.focusLine.plain = obj.focusLine.plain.replace(/\u00a0/g, ' ');

// get the wikified plain text for the words under the selection
	var documentFragment = obj.selectionWord.range.cloneContents();
	WikEdGetInnerHTML(obj.selectionWord, documentFragment);
	obj.selectionWord.code = obj.selectionWord.html;
	WikEdRemoveHighlightingWikify(obj.selectionWord);
	obj.selectionWord.plain = obj.selectionWord.html;
	obj.selectionWord.plain = obj.selectionWord.plain.replace(/&lt;br\b[^&gt;]*&gt;/g, '\n');
	obj.selectionWord.plain = obj.selectionWord.plain.replace(/\u00a0/g, ' ');

// get the wikified plain text for the lines under the selection
	var documentFragment = obj.selectionLine.range.cloneContents();
	WikEdGetInnerHTML(obj.selectionLine, documentFragment);
	obj.selectionLine.code = obj.selectionLine.html;
	WikEdRemoveHighlightingWikify(obj.selectionLine);
	obj.selectionLine.plain = obj.selectionLine.html;
	obj.selectionLine.plain = obj.selectionLine.plain.replace(/&lt;br\b[^&gt;]*&gt;/g, '\n');
	obj.selectionLine.plain = obj.selectionLine.plain.replace(/\u00a0/g, ' ');

// select the appropriate object to change (whole, selection, cursor, focusWord, focusLine, selectionWord, or selectionLine)
	obj.changed = {};
	switch (whichButton) {

// undo: whole
		case 'wikEdUndo':
		case 'wikEdRedo':
			obj.changed = obj.cursor; // dummy
			break;

// whole text changes: whole
		case 'wikEdUndoAll':
		case 'wikEdRedoAll':
			obj.changed = obj.whole;
			break;

// basic wiki character formatting: selection / focusWord / cursor
		case 'wikEdBold':
		case 'wikEdItalic':
		case 'wikEdUnderline':
		case 'wikEdStrikethrough':
		case 'wikEdNowiki':
		case 'wikEdSuperscript':
		case 'wikEdSubscript':
		case 'wikEdWikiLink':
		case 'wikEdWebLink':
			if (obj.selection.plain != '') {
				obj.changed = obj.selection;
			}
			else if (obj.focusWord.plain != '') {
				obj.changed = obj.focusWord;
			}
			else  {
				obj.changed = obj.cursor;
			}
			break;

// character formatting: selection / focusWord
		case 'wikEdCase':
			if (obj.selection.plain != '') {
				obj.changed = obj.selection;
			}
			else {
				obj.changed = obj.focusWord;
			}
			break;

// update syntax highlighting: selection / whole
		case 'wikEdUpdateSyntax':
			if (obj.selection.plain != '') {
				obj.changed = obj.selection;
			}
			else {
				obj.changed = obj.whole;
			}
			break;

// multiple line changes: selectionLine
		case 'wikEdDecreaseHeading':
		case 'wikEdIncreaseHeading':
		case 'wikEdBulletList':
		case 'wikEdNumberList':
		case 'wikEdIndentList':
		case 'wikEdDefinitionList':
			if (obj.selection.plain != '') {
				obj.changed = obj.selectionLine;
			}
			else {
				obj.changed = obj.focusLine;
			}
			break;

// image: selectionWord (if text is selected) / cursor
		case 'wikEdImage':
			if (obj.selection.plain != '') {
				obj.changed = obj.selectionWord;
			}
			else  {
				obj.changed = obj.cursor;
			}
			break;

// table: selectionLine / cursor
		case 'wikEdTable':
			if (obj.selection.plain != '') {
				obj.changed = obj.selectionLine;
			}
			else  {
				obj.changed = obj.cursor;
			}
			break;

// wikify, textify: selection / whole
		case 'wikEdWikify':
		case 'wikEdTextify':
			if (obj.selection.plain != '') {
				obj.changed = obj.selection;
			}
			else {
				obj.changed = obj.whole;
			}
			break;

// redirect: whole
		case 'wikEdRedirect':
			obj.changed = obj.whole;
			break;

// character formatting: selection / focusWord
		case 'wikEdGetFind':
		case 'wikEdGetFindReplace':
			if (obj.selection.plain != '') {
				obj.changed = obj.selection;
			}
			else {
				obj.changed = obj.focusWord;
			}
			break;

// find and replace: find value / selection / focusWord
		case 'wikEdFindPrev':
		case 'wikEdFindNext':
		case 'wikEdReplacePrev':
		case 'wikEdReplaceNext':
			if (obj.selection.plain != '') {
				obj.changed = obj.selection;
			}
			else if (obj.focusWord.plain != '') {
				obj.changed = obj.focusWord;
			}
			else {
				obj.changed.plain = null;
			}
			break;

// replaceall: selection / whole
		case 'wikEdFindAll':
		case 'wikEdReplaceAll':
			if (obj.selection.plain != '') {
				obj.changed = obj.selection;
			}
			else {
				obj.changed = obj.whole;
			}
			break;

// jump to top or bottom: dummy
		case 'wikEdUpdown':
			obj.changed = obj.cursor; //dummy
			break;

// jump to position: dummy
		case 'wikEdPrevPos':
		case 'wikEdLastPos':
			obj.changed = obj.cursor; //dummy
			break;

// fixing buttons: selection / whole
		case 'wikEdFixBasic':
		case 'wikEdfixUnicode':
		case 'wikEdFixAll':
		case 'wikEdFixHtml':
		case 'wikEdFixRegExTypo':
			if (obj.selection.plain != '') {
				obj.changed = obj.selection;
			}
			else {
				obj.changed = obj.whole
			}
			break;

// fixing buttons: selection / focusLine
		case 'wikEdFixPunct':
		case 'wikEdFixMath':
		case 'wikEdFixUnits':
		case 'wikEdFixDashes':
		case 'wikEdFixCaps':
		case 'wikEdFixChem':
			if (obj.selection.plain != '') {
				obj.changed = obj.selection;
			}
			else {
				obj.changed = obj.focusLine;
			}
			break;

// fixing buttons: selection / focusWord
			if (obj.selection.plain != '') {
				obj.changed = obj.selection;
			}
			else {
				obj.changed = obj.focusWord;
			}
			break;

// source: selection / whole
		case 'wikEdSource':
			if (obj.selection.plain != '') {
				obj.changed = obj.selection;
			}
			else {
				obj.changed = obj.whole;
			}
			break;

// insert tags: selection / focusWord / cursor
		case 'wikEdInsertTags':
			if (obj.selection.plain != '') {
				obj.changed = obj.selection;
			}
			else if (obj.focusWord.plain != '') {
				obj.changed = obj.focusWord;
			}
			else {
				obj.changed = obj.cursor;
			}
			break;

// unknown edit function
		default:
			alert('Unknown edit function \'' + whichButton + '\'');

// reset button to active, reset cursor
			if (buttonObj != null) {
				if (buttonObj.className != 'wikEdButtonInactive') {
					buttonObj.className = 'wikEdButton';
				}
			}
			wikEdFrameBody.style.cursor = 'auto';

			return;
	}

// exit
	if (obj.changed == null) {
		wikEdFrameWindow.focus();

// reset button to active, reset cursor
		if (buttonObj != null) {
			if (buttonObj.className != 'wikEdButtonInactive') {
				buttonObj.className = 'wikEdButton';
			}
		}
		return;
	}

// set local syntax highlighting flag
	var highlightSyntax = wikEdHighlightSyntax;

// manipulate the text
	var selectChange = true;
	switch (whichButton) {

// undo
		case 'wikEdUndo':
			if (wikEdLastVersion == null) {
				wikEdLastVersion = obj.changed.plain;
			}
			WikEdFrameExecCommand('undo');
			obj.changed.range = obj.sel.getRangeAt(obj.sel.rangeCount - 1);
			obj.changed.plain = null;
			break;

// redo
		case 'wikEdRedo':
			WikEdFrameExecCommand('redo');
			obj.changed.range = obj.sel.getRangeAt(obj.sel.rangeCount - 1);
			obj.changed.plain = null;
			break;

// bold
		case 'wikEdBold':
			if ( /\'\'\'([^\'].*?)\'\'\'/.test(obj.changed.plain) ) {
				obj.changed.plain = obj.changed.plain.replace(/\'\'\'([^\'].*?)\'\'\'/g, '$1');
			}
			else {
				obj.changed.plain = '\'\'\'' + obj.changed.plain + '\'\'\'';
				obj.changed.plain = obj.changed.plain.replace(/(\'\'\')( *)(.*?)( *)(\'\'\')/, '$2$1$3$5$4');
			}
			obj.changed.plain = obj.changed.plain.replace(/\'{6,}/g, '\'\'\'\'\'');
			break;

// italic
		case 'wikEdItalic':
			if ( /(\'{3,})\'\'([^\'].*?)\'\'(\'{3,})/.test(obj.changed.plain) ) {
				obj.changed.plain = obj.changed.plain.replace(/(\'{3,})\'\'([^\'].*?)\'\'(\'{3,})/g, '$1$2$3');
			}
			else if ( /(^|[^\'])\'\'([^\'].*?)\'\'([^\']|$)/.test(obj.changed.plain) ) {
				obj.changed.plain = obj.changed.plain.replace(/(^|[^\'])\'\'([^\'].*?)\'\'([^\']|$)/g, '$1$2$3');
			}
			else {
				obj.changed.plain = '\'\'' + obj.changed.plain + '\'\'';
				obj.changed.plain = obj.changed.plain.replace(/(\'\')( *)(.*?)( *)(\'\')/, '$2$1$3$5$4');
			}
			obj.changed.plain = obj.changed.plain.replace(/\'{6,}/g, '\'\'\'\'\'');
			break;

// underline
		case 'wikEdUnderline':
			if ( /&amp;lt;u&amp;gt;(.*?)&amp;lt;\/u&amp;gt;/i.test(obj.changed.plain) ) {
				obj.changed.plain = obj.changed.plain.replace(/&amp;lt;u&amp;gt;(.*?)&amp;lt;\/u&amp;gt;/g, '$1');
			}
			else {
				obj.changed.plain = '&amp;lt;u&amp;gt;' + obj.changed.plain + '&amp;lt;\/u&amp;gt;';
				obj.changed.plain = obj.changed.plain.replace(/(&amp;lt;u&amp;gt;)( *)(.*?)( *)(&amp;lt;\/u&amp;gt;)/, '$2$1$3$5$4');
			}
			break;

// strikethrough
		case 'wikEdStrikethrough':
			if ( /&amp;lt;s&amp;gt;(.*?)&amp;lt;\/s&amp;gt;/i.test(obj.changed.plain) ) {
				obj.changed.plain = obj.changed.plain.replace(/&amp;lt;s&amp;gt;(.*?)&amp;lt;\/s&amp;gt;/g, '$1');
			}
			else {
				obj.changed.plain = '&amp;lt;s&amp;gt;' + obj.changed.plain + '&amp;lt;\/s&amp;gt;';
				obj.changed.plain = obj.changed.plain.replace(/(&amp;lt;s&amp;gt;)( *)(.*?)( *)(&amp;lt;\/s&amp;gt;)/, '$2$1$3$5$4');
			}
			break;

// nowiki
		case 'wikEdNowiki':
			if ( /&amp;lt;nowiki&amp;gt;(.*?)&amp;lt;\/nowiki&amp;gt;/i.test(obj.changed.plain) ) {
				obj.changed.plain = obj.changed.plain.replace(/&amp;lt;nowiki&amp;gt;(.*?)&amp;lt;\/nowiki&amp;gt;/g, '$1');
			}
			else {
				obj.changed.plain = '&amp;lt;nowiki&amp;gt;' + obj.changed.plain + '&amp;lt;\/nowiki&amp;gt;';
				obj.changed.plain = obj.changed.plain.replace(/(&amp;lt;nowiki&amp;gt;)( *)(.*?)( *)(&amp;lt;\/nowiki&amp;gt;)/, '$2$1$3$5$4');
			}
			break;

// superscript
		case 'wikEdSuperscript':
			if ( /&amp;lt;sup&amp;gt;(.*?)&amp;lt;\/sup&amp;gt;/i.test(obj.changed.plain) ) {
				obj.changed.plain = obj.changed.plain.replace(/&amp;lt;sup&amp;gt;(.*?)&amp;lt;\/sup&amp;gt;/g, '$1');
			}
			else {
				obj.changed.plain = '&amp;lt;sup&amp;gt;' + obj.changed.plain + '&amp;lt;/sup&amp;gt;';
				obj.changed.plain = obj.changed.plain.replace(/(&amp;lt;sup&amp;gt;)( *)(.*?)( *)(&amp;lt;\/sup&amp;gt;)/, '$2$1$3$5$4');
			}
			break;

// subscript
		case 'wikEdSubscript':
			if ( /&amp;lt;sub&amp;gt;(.*?)&amp;lt;\/sub&amp;gt;/i.test(obj.changed.plain) ) {
				obj.changed.plain = obj.changed.plain.replace(/&amp;lt;sub&amp;gt;(.*?)&amp;lt;\/sub&amp;gt;/g, '$1');
			}
			else {
				obj.changed.plain = '&amp;lt;sub&amp;gt;' + obj.changed.plain + '&amp;lt;/sub&amp;gt;';
				obj.changed.plain = obj.changed.plain.replace(/(&amp;lt;sub&amp;gt;)( *)(.*?)( *)(&amp;lt;\/sub&amp;gt;)/, '$2$1$3$5$4');
			}
			break;

// toggle lowercase / uppercase
		case 'wikEdCase':

// lowercase all uppercased text
			if (obj.changed.plain.toUpperCase() == obj.changed.plain) {
				obj.changed.plain = obj.changed.plain.toLowerCase();
			}

// first-letter-uppercase all lowercased text
			else if (obj.changed.plain.toLowerCase() == obj.changed.plain) {
				obj.changed.plain = obj.changed.plain.replace(/\b(\w)(\w*)/g,
					function (p, p1, p2) {
						return(p1.toUpperCase() + p2.toLowerCase());
					}
				);
			}

// uppercase mixed upper and lowercased text
			else {
				obj.changed.plain = obj.changed.plain.toUpperCase();
			}
			break;

// undo all
		case 'wikEdUndoAll':
			if (wikEdLastVersion == null) {
				wikEdLastVersion = obj.changed.plain;
			}
			obj.changed.plain = wikEdOrigVersion;
			obj.changed.plain = obj.changed.plain.replace(/&amp;/g, '&amp;amp;');
			obj.changed.plain = obj.changed.plain.replace(/&gt;/g, '&amp;gt;');
			obj.changed.plain = obj.changed.plain.replace(/&lt;/g, '&amp;lt;');
			break;

// redo all
		case 'wikEdRedoAll':
			if (wikEdLastVersion != null) {
				obj.changed.plain = wikEdLastVersion;
			}
			break;

// update syntax highlighting
		case 'wikEdUpdateSyntax':
			highlightSyntax = true;
			break;

// create wikilink
		case 'wikEdWikiLink':
			if ( /\[\[(.*?)\]\]/.test(obj.changed.plain) ) {
				obj.changed.plain = obj.changed.plain.replace(/\[\[(.*?)\]\]/g, '$1');
			}
			else {
				obj.changed.plain = '\[\[' + obj.changed.plain + '\]\]';
				obj.changed.plain = obj.changed.plain.replace(/(\[\[)( *)(.*?)( *)(\]\])/, '$2$1$3$5$4');
			}
			break;

// create weblink
		case 'wikEdWebLink':
			if ( /\[(.*?)\]/.test(obj.changed.plain) ) {
				obj.changed.plain = obj.changed.plain.replace(/\[(.*?)\]/g, '$1');
			}
			else {
				obj.changed.plain = '\[' + obj.changed.plain + '\]';
				obj.changed.plain = obj.changed.plain.replace(/(\[)( *)(.*?)( *)(\])/, '$2$1$3$5$4');
			}
			break;

// decrease heading level
		case 'wikEdDecreaseHeading':
			obj.changed.plain = obj.changed.plain.replace(/(^|\n)=(=+) *([^\n]*?) *=+(?=\n|$)/g, '$1$2 $3 $2'); // decrease heading
			obj.changed.plain = obj.changed.plain.replace(/(^|\n)=(?!=) *([^\n]*?) *=+(?=\n|$)/g, '$1$2'); // remove heading
			obj.changed.plain = obj.changed.plain.replace(/(^|\n)(=+) *([^\n]*?) *=+(?=\n|$)/g, '$1$2 $3 $2'); // adjust closing tags
			break;

// increase heading level
		case 'wikEdIncreaseHeading':
			obj.changed.plain = obj.changed.plain.replace(/(^|\n)(=+) *([^\n]*?) *=+(?=\n|$)/g, '$1=$2 $3 $2='); // increase heading
			obj.changed.plain = obj.changed.plain.replace(/(^|\n)([^=\n\s][^\n]*?)(?=\n|$)/g, '$1== $2 =='); // create new heading
			obj.changed.plain = obj.changed.plain.replace(/(^|\n)(=+) *([^\n]*?) *=+(?=\n|$)/g, '$1$2 $3 $2'); // adjust closing tags
			break;

// create bullet list
		case 'wikEdBulletList':
			obj.changed.plain = obj.changed.plain.replace(/([^\n]+)/g,
				function (p, p1) {
					p1 = p1.replace(/^ *([\*\#\:\;]*) */g, '*$1 ');
					p1 = p1.replace(/^(\*{4,})([\*\#\:\;]*)/g, '$2');
					return(p1);
				}
			);
			break;

// create numbered list
		case 'wikEdNumberList':
			obj.changed.plain = obj.changed.plain.replace(/([^\n]+)/g,
				function (p, p1) {
					p1 = p1.replace(/^ *([\*\#\:\;]*) */g, '#$1 ');
					p1 = p1.replace(/^(\*{4,})([\*\#\:\;]*)/g, '$2');
					return(p1);
				}
			);
			break;

// create indented list
		case 'wikEdIndentList':
			obj.changed.plain = obj.changed.plain.replace(/([^\n]+)/g,
				function (p, p1) {
					p1 = p1.replace(/^ *([\*\#\:\;]*) */g, ':$1 ');
					p1 = p1.replace(/^(\*{4,})([\*\#\:\;]*)/g, '$2');
					return(p1);
				}
			);
			break;

// create definition list
		case 'wikEdDefinitionList':
			obj.changed.plain = obj.changed.plain.replace(/([^\n]+)/g,
				function (p, p1) {
					p1 = p1.replace(/^ *([^\s\;]+) */g, '; $1 : ');
					return(p1);
				}
			);
			break;

// create image
		case 'wikEdImage':
			if (obj.changed.plain != '') {
				obj.changed.plain = '[[Image:&lt;span class=&quot;wikEdInsertHere&quot;&gt;' + wikEdText['image filename'] + '&lt;/span&gt;|thumb|&lt;span class=&quot;wikEdInsertHere&quot;&gt;' + wikEdText['image width'] + '&lt;/span&gt;px|' + obj.changed.plain + ']]';
			}
			else {
				obj.changed.plain = '[[Image:&lt;span class=&quot;wikEdInsertHere&quot;&gt;' + wikEdText['image filename'] + '&lt;/span&gt;|thumb|&lt;span class=&quot;wikEdInsertHere&quot;&gt;' + wikEdText['image width'] + '&lt;/span&gt;px|&lt;span class=&quot;wikEdInsertHere&quot;&gt; &lt;/span&gt;]]';
				if (obj.focusWord.plain != '') {
					obj.changed.plain = ' ' + obj.changed.plain + ' ';
				}
			}
			break;

// create table
		case 'wikEdTable':
			if (obj.changed.plain != '') {
				obj.changed.plain = obj.changed.plain.replace(/(^|\n) */g, '\n|-\n| ');
				obj.changed.plain = obj.changed.plain.replace(/^\n\|\-\n/, '\n{| class=&quot;wikitable&quot;\n');
				obj.changed.plain = obj.changed.plain.replace(/$/g, '\n|}\n');
			}
			else {
				obj.changed.plain = '\n{| class=&quot;wikitable&quot;\n|+ &lt;span class=&quot;wikEdInsertHere&quot;&gt;' + wikEdText['table caption'] + '&lt;/span&gt;\n! &lt;span class=&quot;wikEdinserthere&quot;&gt;' + wikEdText['table heading'] + '&lt;/span&gt; !! &lt;span class=&quot;wikEdInsertHere&quot;&gt;' + wikEdText['table heading'] + '&lt;/span&gt;\n|-\n| &lt;span class=&quot;wikEdInsertHere&quot;&gt;' + wikEdText['table cell'] + '&lt;/span&gt; || &lt;span class=&quot;wikEdInsertHere&quot;&gt;' + wikEdText['table cell'] + '&lt;/span&gt;\n|-\n| &lt;span class=&quot;wikEdInsertHere&quot;&gt;' + wikEdText['table cell'] + '&lt;/span&gt; || &lt;span class=&quot;wikEdInsertHere&quot;&gt;' + wikEdText['table cell'] + '&lt;/span&gt;\n|}\n';
				if (obj.focusLine.plain != '') {
					obj.changed.plain = '\n' + obj.changed.plain + '\n';
				}
			}
			break;

// wikify: always done above
		case 'wikEdWikify':
			break;

// textify: strip html from pasted content
		case 'wikEdTextify':
			var objTextify = {};

// get inner html without wikifying
			if (obj.changed.from == 'whole') {
				WikEdGetInnerHTML(objTextify, wikEdFrameBody);
			}
			else {
				obj.selection.range = obj.sel.getRangeAt(obj.sel.rangeCount - 1);
				var documentFragment = obj.selection.range.cloneContents();
				WikEdGetInnerHTML(objTextify, documentFragment);
			}

			WikEdTextify(objTextify);
			obj.changed.plain = objTextify.plain;
			obj.changed.plain = obj.changed.plain.replace(/\n/g, '&lt;br /&gt;');
			break;

// redirect
		case 'wikEdRedirect':
			var linkTarget;
			if (obj.selection.plain != '') {
				linkTarget = obj.selection.plain;
			}
			else if (obj.selectionWord.plain != '') {
				linkTarget = obj.selectionWord.plain;
			}
			else {
				linkTarget = '&lt;span class=&quot;wikEdInsertHere&quot;&gt;' + wikEdText['redirect article link'] + '&lt;/span&gt;';
			}

// remove leading and trailing spaces
			linkTarget = linkTarget.replace(/^\s+|\s+$/g, '');

// remove link text
			linkTarget = linkTarget.replace(/\|.*?(\]|$)/g, '$1');

// remove square brackets
			linkTarget = linkTarget.replace(/\[|\]/g, '');

// remove link leftovers
			linkTarget = linkTarget.replace(/ +\| +/g, ' ');

			obj.changed.plain = '#redirect [[' + linkTarget + ']]';

// append to summary
			wikEdInputElement['summary'].value =
				WikEdAppendToSummary(wikEdInputElement['summary'].value, '#redirect [[' + linkTarget + ']]');
			selectChange = false;
			break;

// copy selection to find field
		case 'wikEdGetFind':
			wikEdInputElement['find'].value = obj.changed.plain;
			obj.changed.plain = null;
			break;

// copy selection to find and to replace field
		case 'wikEdGetFindReplace':
			wikEdInputElement['find'].value = obj.changed.plain;
			wikEdInputElement['replace'].value = obj.changed.plain;
			obj.changed.plain = null;
			break;

// find and replace
		case 'wikEdFindPrev':
		case 'wikEdFindNext':
		case 'wikEdReplacePrev':
		case 'wikEdReplaceNext':
		case 'wikEdFindAll':
		case 'wikEdReplaceAll':

// get the find text
			var findText;
			if (wikEdInputElement['find'].value != '') {
				findText = wikEdInputElement['find'].value;
			}
			else {
				if (obj.selection.plain == '') {
					obj.changed.plain = null;
					break;
				}
				else {
					findText = obj.selection.plain;
				}
			}

// get the replace text
			var replaceText = wikEdInputElement['replace'].value;

// format the find and replace texts as regexp or plain text
			if (wikEdRegExp.checked == false) {
				findText = findText.replace(/([\\^\$\*\+\?\.\(\)\[\]\{\}\:\=\!\|\,\-])/g, '\\$1');
			}

// replace \n with newline character
			else {
				replaceText = replaceText.replace(/((^|[^\\])(\\\\)*)\\n/g, '$1\n');
			}

// set regexp flags
			var regExpFlags = 'g';
			if ( ! wikEdCaseSensitive.checked ) {
				regExpFlags += 'i';
			}

// create regexp
			var regExpFind = new RegExp(findText, regExpFlags);

// replace all
			var replacedFlag = false;
			if (whichButton == 'wikEdReplaceAll') {
				if (regExpFind.test(obj.changed.plain)) {
					obj.changed.plain = obj.changed.plain.replace(regExpFind, replaceText);
					replacedFlag = true;
				}
				else {
					obj.changed.plain = null;
				}
			}

// find all
			if (whichButton == 'wikEdFindAll') {
////////////////////////// set selection with multiple ranges
				obj.changed.plain = null;
				break;
			}

// replace an existing selection
			else if ( (whichButton == 'wikEdReplacePrev') || (whichButton == 'wikEdReplaceNext') ) {
				if (regExpFind.test(obj.selection.plain)) {
					obj.changed.plain = obj.selection.plain.replace(regExpFind, replaceText);
					replacedFlag = true;
				}
				else {
					obj.changed.plain = null;
				}
			}
			else if ( (whichButton == 'wikEdFindNext') || (whichButton == 'wikEdFindPrev') ) {
				obj.changed.plain = null;
			}

			if ( (whichButton == 'wikEdFindNext') || (whichButton == 'wikEdFindPrev') || (whichButton == 'wikEdReplaceNext')  || (whichButton == 'wikEdReplacePrev') ) {
				if (replacedFlag == false) {

// get direction
					var backwards = false;
					if ( (whichButton == 'wikEdFindPrev') || (whichButton == 'wikEdReplacePrev') ) {
						backwards = true;
					}

// get case sensitive
					var caseSensitive = false;
					if (wikEdCaseSensitive.checked == true) {
						caseSensitive = true;
					}

// find the text
					if (wikEdRegExp.checked) {
						WikEdFind(obj, findText, caseSensitive, backwards, regExpFind);
					}
					else {
						WikEdFind(obj, findText, caseSensitive, backwards, null);
						selectChange = false;
					}
				}
			}

// save search history to cookie
			if ( (whichButton == 'wikEdFindPrev') || (whichButton == 'wikEdFindNext') ) {
				WikEdAddToHistory('find');
			}
			if ( (whichButton == 'wikEdReplacePrev') || (whichButton == 'wikEdReplaceNext') || (whichButton == 'wikEdReplaceAll') ) {
				WikEdAddToHistory('find');
				WikEdAddToHistory('replace');
			}
			break;

// jump to top or bottom
		case 'wikEdUpdown':

// jump to bottom
/////////////////////// also check which is closer!!!!!
			if ( (obj.cursor.range.startContainer == wikEdFrameBody) &amp;&amp; (obj.cursor.range.startOffset == 0) ) {
				obj.changed.range.setEndAfter(wikEdFrameBody.lastChild);
				obj.changed.range.collapse(false);
				wikEdFrameBody.scrollTop = wikEdFrameBody.scrollHeight;
			}

// jump to top
			else {
				obj.changed.range.setStartBefore(wikEdFrameBody.firstChild);
				obj.changed.range.collapse(true);
				wikEdFrameBody.scrollTop = 0;
			}
			obj.changed.plain = null;
			break;

// jump to previously changed position
		case 'wikEdPrevPos':
			if (wikEdFrameDocument.queryCommandEnabled('undo') == true) {
				WikEdFrameExecCommand('undo');
				WikEdFrameExecCommand('redo');
				wikEdLastPosObj = obj.cursor;
			}
			obj.changed.plain = null
			break;

// jump back to last position
		case 'wikEdLastPos':
			if (wikEdLastPosObj != null) {
				obj.changed = wikEdLastPosObj;
				wikEdLastPosObj = null;
				obj.changed.plain = null;
			}
			else {
				obj.changed.plain = null;
			}
			break;

// fixbasic: fix characters, spaces, empty lines, certain headings, needed for all fixing functions
// to do: only certain changes in multiline tags: comments, tables, subst
		case 'wikEdFixBasic':
			WikEdFixBasic(obj.changed);
			break;
		case 'wikEdFixPunct':
			WikEdFixPunct(obj.changed);
			break;
		case 'wikEdFixMath':
			WikEdFixMath(obj.changed);
			break;
		case 'wikEdFixChem':
			WikEdFixChem(obj.changed);
			break;
		case 'wikEdfixUnicode':
			WikEdFixUnicode(obj.changed);
			break;
		case 'wikEdFixUnits':
			WikEdFixUnits(obj.changed);
			break;
		case 'wikEdFixDashes':
			WikEdFixDashes(obj.changed);
			break;
		case 'wikEdFixHtml':
			WikEdFixHTML(obj.changed);
			break;
		case 'wikEdFixRegExTypo':
			if (typeof(AWRegExTypoFix) == 'function') {
				var objFix = {}
				objFix.str = obj.changed.plain;
				AWRegExTypoFix(objFix);
				obj.changed.plain = objFix.str;
			}
			else {
				obj.changed.plain = null;
			}
			break;
		case 'wikEdFixCaps':
			WikEdFixCaps(obj.changed);
			break;
		case 'wikEdFixAll':
			WikEdFixAll(obj.changed);
			break;

// source on
		case 'wikEdSource':
			obj.changed.plain = obj.changed.code;
			obj.changed.plain = obj.changed.plain.replace(/(&lt;(br|p)\b[^&gt;]*&gt;)/g, '$1\n');
			obj.changed.plain = obj.changed.plain.replace(/&amp;/g, '&amp;amp;');
			obj.changed.plain = obj.changed.plain.replace(/&lt;/g, '&amp;lt;');
			obj.changed.plain = obj.changed.plain.replace(/&gt;/g, '&amp;gt;');
			highlightSyntax = false;
			break;

// insert tags
		case 'wikEdInsertTags':
			var tagOpen = parameterArray[0] || '';
			var tagClose = parameterArray[1] || '';
			var sampleText = parameterArray[2] || '';
			tagOpen = tagOpen.replace(/&amp;/g, '&amp;amp;');
			tagOpen = tagOpen.replace(/&lt;/g, '&amp;lt;');
			tagOpen = tagOpen.replace(/&gt;/g, '&amp;gt;');
			tagClose = tagClose.replace(/&amp;/g, '&amp;amp;');
			tagClose = tagClose.replace(/&lt;/g, '&amp;lt;');
			tagClose = tagClose.replace(/&gt;/g, '&amp;gt;');
			tagsampleText = sampleText.replace(/&amp;/g, '&amp;amp;');
			tagsampleText = sampleText.replace(/&lt;/g, '&amp;lt;');
			tagsampleText = sampleText.replace(/&gt;/g, '&amp;gt;');
			if ( (obj.changed.plain == '') &amp;&amp; (sampleText.length &gt; 0) ) {
				obj.changed.plain = tagOpen + sampleText + tagClose;
			}
			obj.changed.plain = tagOpen + obj.changed.plain + tagClose;
			break;

// default
		default:
			alert('Unknown edit function \'' + whichButton + '\'');
	}

// update the selection only, do not change the text
	if (obj.changed.plain == null) {
		obj.sel.removeAllRanges();
		obj.sel.addRange(obj.changed.range);

// scroll the selected text into the viewport by using a backwards find
		if (selectChange != false) {

// get the plain text of the selection
			var plainText = obj.sel.getRangeAt(obj.sel.rangeCount - 1).cloneContents().textContent;

// collapse the selection to the end and search backwards
			if (plainText.length &gt; 0) {
				if (plainText.indexOf('\n') &lt; 0) {
					obj.changed.range.collapse(false);

// function: window.find(string, caseSensitive, backwards, wrapAround, wholeWord, searchInFrames, showDialog)
					wikEdFrameWindow.find(plainText, true, true, false, false, false, false);
				}
			}
		}
	}

// apply text changes
	else {

// a text change erases the last version for redo all
		if ( (whichButton != 'wikEdUndo') &amp;&amp; (whichButton != 'wikEdRedo') &amp;&amp; (whichButton != 'wikEdUndoAll') ) {
			wikEdLastVersion = null;
		}

// highlight the syntax
		obj.html = obj.changed.plain;
		if (highlightSyntax == true) {
			WikEdHighlightSyntax(obj);
		}

// display tabs
		else {
			obj.html = obj.html.replace(/(\t)/g, '&lt;span class=&quot;wikEdTabPlain&quot;&gt;$1&lt;/span&gt;&lt;!--wikEdTabPlain--&gt;');
		}

// display multiple blanks as blank-&amp;nbsp;
		obj.html = obj.html.replace(/  /g, '&amp;nbsp; ');
		obj.html = obj.html.replace(/  /g, '&amp;nbsp; ');

// newlines to &lt;br /&gt;
		obj.html = obj.html.replace(/\n/g, '&lt;br /&gt;');

// make changed range text the current selection
		obj.sel.removeAllRanges();
		obj.sel.addRange(obj.changed.range);

// get the scroll position
		var frameSrollTop;
		if (obj.changed.from == 'whole') {
			frameSrollTop = wikEdFrameBody.scrollTop;
		}

// replace the selection with changed text
		if (obj.html != '') {
			WikEdFrameExecCommand('inserthtml', obj.html);
		}
		else {
			WikEdFrameExecCommand('delete');
		}

// select the whole text after replacing the whole text and scroll to same height
		if (obj.changed.from == 'whole') {
			wikEdFrameBody.scrollTop = frameSrollTop;
			var range = document.createRange();
			range.setStartBefore(wikEdFrameBody.firstChild);
			range.setEndAfter(wikEdFrameBody.lastChild);
			obj.sel.addRange(range);
			selectChange = false;
		}

// select the changed text and scroll it into the viewport by using a backwards find
		if (selectChange != false) {

// get the text content of the changed text
			var div = document.createElement('div');
			div.innerHTML = obj.changed.plain;
			var plainText = div.textContent;

// find the text
			if (plainText.length &gt; 0) {
				if (plainText.indexOf('\n') &lt; 0) {

// function: window.find(string, caseSensitive, backwards, wrapAround, wholeWord, searchInFrames, showDialog)
					wikEdFrameWindow.find(plainText, true, true, false, false, false, false);
				}
			}
		}
	}

// reset button to active, reset cursor
	if (buttonObj != null) {
		if (buttonObj.className != 'wikEdButtonInactive') {
			buttonObj.className = 'wikEdButton';
		}
		buttonObj.style.cursor = 'auto';
	}

// grey out inactive buttons
	WikEdInactiveButtons();

// reset the frame DOM cache because the frame content has been changed
	wikEdFrameDOMCache = null;

// focus the frame
	if (wikEdUseWikEd == true) {
		wikEdFrameWindow.focus();
	}

	return;
}

// This line is numbered 2918

//
// WikEdFind: custom find function with regexp properties, sets obj.changed.range, uses obj ranges
//

function WikEdFind(obj, findText, caseSensitive, backwards, regExp) {

	var range = obj.sel.getRangeAt(obj.sel.rangeCount - 1);

// empty the range to avoid error messages for reverse direction ranges
	obj.changed.range = document.createRange();

// use the fast built-in find function for non-regexp searches
	if (regExp == null) {

// function: window.find(string, caseSensitive, backwards, wrapAround, wholeWord, searchInFrames, showDialog)
		var found = wikEdFrameWindow.find(findText, caseSensitive, backwards, false, false, false, false);
		if (found == false) {
			obj.changed.range.setStart(range.startContainer, range.startOffset);
			obj.changed.range.setEnd(range.endContainer, range.endOffset);
			obj.changed.range.collapse(backwards);
		}
		else {
			range = obj.sel.getRangeAt(obj.sel.rangeCount - 1);
			obj.changed.range.setStart(range.startContainer, range.startOffset);
			obj.changed.range.setEnd(range.endContainer, range.endOffset);
		}
	}

// slow javascript regexp find and replace
	else {

// perform find
		WikEdParseDOM(obj, wikEdFrameBody);
		var regExpMatch = [];

// find next, search to the right
		if (backwards == false) {

// set start position for search to right
			regExp.lastIndex = obj.plainFocus;

// execute the regexp search to the right
			regExpMatch = regExp.exec(obj.plain);

// collapse the selection to its end for no find
			if (regExpMatch == null) {
				obj.changed.range.setEnd(range.endContainer, range.endOffset);
				obj.changed.range.collapse(false);
			}
		}

// find previous, search to the left
		else {

// cycle through the matches to the left
			var regExpMatchNext;
			do {
				regExpMatch = regExpMatchNext;
				regExpMatchNext = regExp.exec(obj.plain);
				if (regExpMatchNext == null) {
					break;
				}
			} while (regExpMatchNext.index &lt; obj.plainAnchor);

// collapse the selection to its start for no find
			if (regExpMatch == null) {
				obj.changed.range.setStart(range.startContainer, range.startOffset);
				obj.changed.range.collapse(true);
			}
		}

// select the find
		if (regExpMatch != null) {
			i = 0;
			while ( (obj.plainStart[i + 1] &lt;= regExpMatch.index) &amp;&amp; (obj.plainStart[i + 1] != null) ) {
				i ++;
			}
			j = i;
			while ( (obj.plainStart[j + 1] &lt;= regExpMatch.index + regExpMatch[0].length) &amp;&amp; (obj.plainStart[j + 1] != null) ) {
				j ++;
			}
			obj.changed.range.setEnd  (obj.plainNode[j], regExpMatch.index + regExpMatch[0].length - obj.plainStart[j]);
			obj.changed.range.setStart(obj.plainNode[i], regExpMatch.index - obj.plainStart[i]);
		}
	}
	return;
}


//
// WikEdTextify: strip html off of text
//

function WikEdTextify(obj) {

// convert html to plain
	obj.plain = obj.html;
	obj.plain = obj.plain.replace(/\n/g, ' ');

// delete tags
	obj.plain = obj.plain.replace(/&lt;(style|script|object|applet|embed)\b[^&gt;]*&gt;.*?&lt;\/\1&gt;/g, '');

// newlines
	obj.plain = obj.plain.replace(/&lt;(br)\b[^&gt;]*&gt;/g, '\n');

// remove highlighting pre tags
	var isRemove = [];
	obj.plain = obj.plain.replace(/(&lt;(\/?)pre\b([^&gt;]*)&gt;)/g,
		function (p, p1, p2, p3) {
			if (p2 == '') {
				if (/\bclass=\&quot;wikEd\w+\&quot;/.test(p3)) {
					isRemove.push(true);
					return('');
				}
				isRemove.push(false);
				return(p1);
			}
			if (isRemove.pop() == true) {
				return('');
			}
			return(p1);
		}
	);

// blocks
	obj.plain = obj.plain.replace(/&lt;\/?(address|blockquote|center|div|h1|h2|h3|h4|h5|h6|hr|isindex|p|pre)\b[^&gt;]*&gt;/g, '\u0000\u0000');

// lists
	obj.plain = obj.plain.replace(/&lt;\/?(dir|dl|menu|ol|ul)\b[^&gt;]*&gt;/g, '\u0000');
	obj.plain = obj.plain.replace(/&lt;\/(dd|dt|li)&gt;/g, '\u0000');

// forms
	obj.plain = obj.plain.replace(/&lt;\/?(select|textarea)\b[^&gt;]*&gt;/g, '\u0000');
	obj.plain = obj.plain.replace(/&lt;\/(option|legend|optgroup)&gt;/g, '\u0000');

// table
	obj.plain = obj.plain.replace(/&lt;\/?(table|caption)\b[^&gt;]*&gt;/g, '\u0000');
	obj.plain = obj.plain.replace(/&lt;\/(tr|th|td)&gt;/g, '\u0000');

// finish html to plain conversion
	obj.plain = obj.plain.replace(/&lt;[^&gt;]*&gt;/g, '');

// remove spaces
	obj.plain = obj.plain.replace(/[ \t\u00a0]+(\u0000)/g, '$1');
	obj.plain = obj.plain.replace(/(\u0000)[ \t\u00a0]+/g, '$1');

// trim down \u0000 and \n
	obj.plain = obj.plain.replace(/\u0000+/g, '\n');

	return;
}


//
// WikEdInactiveButtons: grey out inactive buttons, called after every change and click
//

function WikEdInactiveButtons() {

// undo, prevpos
	if (wikEdFrameDocument.queryCommandEnabled('undo') == true ) {
		document.getElementById('wikEdUndo').className = 'wikEdButton';
		document.getElementById('wikEdPrevPos').className = 'wikEdButton';
		document.getElementById('wikEdUndoAll').className = 'wikEdButton';
	}
	else {
		document.getElementById('wikEdUndo').className = 'wikEdButtonInactive';
		document.getElementById('wikEdPrevPos').className = 'wikEdButtonInactive';
		document.getElementById('wikEdUndoAll').className = 'wikEdButtonInactive';
	}

// redo
	if (wikEdFrameDocument.queryCommandEnabled('redo') == true ) {
		document.getElementById('wikEdRedo').className = 'wikEdButton';
	}
	else {
		document.getElementById('wikEdRedo').className = 'wikEdButtonInactive';
	}

// redo all
	if (wikEdLastVersion != null) {
		document.getElementById('wikEdRedoAll').className = 'wikEdButton';
	}
	else {
		document.getElementById('wikEdRedoAll').className = 'wikEdButtonInactive';
	}

// lastpos
	if (wikEdLastPosObj != null) {
		document.getElementById('wikEdLastPos').className = 'wikEdButton';
	}
	else {
		document.getElementById('wikEdLastPos').className = 'wikEdButtonInactive';
	}

	return;
}

//
// WikEdFixBasic: fix characters, spaces, empty lines, certain headings, needed for all fixing functions
//

/// change: double spaces ok after dot

function WikEdFixBasic(obj) {

// non-breaking space character to normal space
	obj.plain = obj.plain.replace(/(\u00a0)/g, ' ');

// remove trailing spaces
	obj.plain = obj.plain.replace(/( |&amp;nbsp;)+\n/g, '\n');

// empty line before and after headings, spaces around word (lookahead)
	obj.plain = obj.plain.replace(/\n+(=+) *([^\n]*?) *(=+)(?=\n)\n*/g, '\n\n$1 $2 $3\n\n');

// uppercase well known headings
	var regExp = new RegExp('\\n=+ ' + wikEdText['External links'] + '? =+\\n', 'gi');
	obj.plain = obj.plain.replace(regExp, '\n== ' + wikEdText['External links'] + ' ==\n');
	regExp = new RegExp('\\n=+ ' + wikEdText['See also'] + ' =+\\n', 'gi');
	obj.plain = obj.plain.replace(regExp, '\n== ' + wikEdText['See also'] + ' ==\n');
	regExp = new RegExp('\\n=+ ' + wikEdText['References'] + '? =+\\n', 'gi');
	obj.plain = obj.plain.replace(regExp, '\n== ' + wikEdText['References'] + ' ==\n');

// add space after * # : ; (list) and after {| |- | (table)
	obj.plain = obj.plain.replace(/(^|\n)([\*\#\:\;]+|\{\||\|\-|\|\}|\|) */g, '$1$2 ');
	obj.plain = obj.plain.replace(/ +\n/g, '\n');

// empty line before and after tables
	obj.plain = obj.plain.replace(/\n+(\{\|)/g, '\n\n$1');
	obj.plain = obj.plain.replace(/(\n\|\}) *([^\n]*)[\n|$]+/g, '$1\n\n$2\n\n');

// empty line before and after lists
	obj.plain = obj.plain.replace(/(^|\n)([^\*\#\:\;].*?)\n+([\*\#\:\;])/g, '$1$2\n\n$3');
	obj.plain = obj.plain.replace(/(^|\n)([\*\#\:\;].*?)\n+([^\*\#\:\;])/g, '$1$2\n\n$3');

// split into lines and change single lines, used to handle tables
	var lines = obj.plain.split('\n');
	obj.plain = '';
	var tableflag = false;
	for (var i = 0; i &lt; lines.length; i++) {
		var line = lines[i];

// do not change lines starting with a blank
		if ( ! line.match(/^ /) ) {

// detect table
			if ( line.match(/^(\{\||\!|\|[^}])/) ) {
				tableflag = true;
			}
			else if ( line.match(/^\|\}/) ) {
				tableflag = false;
			}

// changes only to be done in tables
			if (tableflag) {

// add spaces around ||
				line = line.replace(/ *\|\| */g, ' || ');
			}

// changes not to be done in tables
			if ( ! tableflag) {

// empty line before and after images
				var regExp = new RegExp('^(\\[\\[' + wikEdText['wikicode Image'] + ':.*?\\]\\])', 'ig');
				line = line.replace(regExp, '\n$1');

				regExp = new RegExp('(\\[\\[' + wikEdText['wikicode Image'] + ':.*?(\\[\\[.*?\\]\\].*?)*\\]\\])$', 'ig');
				line = line.replace(regExp, '$1\n');

// empty line before and after includes
				line = line.replace(/^(\{\{.*?\}\})/g, '\n$1');
				line = line.replace(/(\{\{.*?\}\})$/g, '$1\n');

// to be done: convert single newlines into spaces
//      line = line.replace(/(\n[^\n \*\#\:\;\|\{].*?)\n([^\n \*\#\:\;\|\{])/g, '$1 $2');
			}
		}

// concatenate the lines
		obj.plain += line;
		if (i &lt; lines.length - 1) {
			obj.plain += '\n';
		}
	}

// remove spaces in wikilinks
	obj.plain = obj.plain.replace(/\[\[ *([^\n]*?) *\]\]/g, '[[$1]]');

// remove spaces in external links
	obj.plain = obj.plain.replace(/\[ *([^\n]*?) *\]/g, '[$1]');

// no space around pipes before brackets
	obj.plain = obj.plain.replace(/ +\| +\]\]/g, '|]]');

// no space around pipes before curly brackets
	obj.plain = obj.plain.replace(/ +\| +\}\}/g, '|}}');

// no empty line between headings and includes
	obj.plain = obj.plain.replace(/\n(=+ [^\n]*? =+\n)\n+(\{\{.*?\}\})/g, '\n$1$2');

// spaces in comments
	obj.plain = obj.plain.replace(/(&amp;lt;!--) *([^\n]*?) *(--&amp;gt;)/g, '$1 $2 $3');


/* ????
// empty lines around html comments
	obj.plain = obj.plain.replace(/\n+(&amp;lt;!--.*?--&amp;gt;)\n+/g, '\n$1\n\n');
	obj.plain = obj.plain.replace(/^(&amp;lt;!--.*?--&amp;gt;)\n+/g, '$1\n');
	obj.plain = obj.plain.replace(/\n+(&amp;lt;!--.*?--&amp;gt;)$/g, '\n$1');
*/

// empty line before and after categories
	var regExp = new RegExp('( |\\n)*(\\[\\[' + wikEdText['wikicode Category'] + ':[^\\n]*?\\]\\])( |\\n)*', 'gi');
	obj.plain = obj.plain.replace(regExp, '\n\n$2\n\n');

// categories not separated by empty lines (lookahead)
	regExp = new RegExp('(\\[\\[category:[^\\n]*?\\]\\])\\n*(?=\\[\\[' + wikEdText['wikicode Category'] + ':[^\\n]*?\\]\\])', 'gi');
	obj.plain = obj.plain.replace(regExp, '$1\n');

// single empty lines only
	obj.plain = obj.plain.replace(/\n{3,}/g, '\n\n');

// remove leading and trailing newlines
	obj.plain = obj.plain.replace(/^\n+/, '');
	obj.plain = obj.plain.replace(/\n{2,}$/, '\n');

	return;
}


//
// WikEdFixPunct: remove space before .,:;
//

function WikEdFixPunct(obj) {
	WikEdFixBasic(obj);

	obj.plain = obj.plain.replace(/([\w\'\&quot;\â€\]\}\)]) +([\.\,\:\;])(\s+|$)/g, '$1$2 ');
	obj.plain = obj.plain.replace(/\s+$/g, '');

	return;
}


//
// WikEdFixUnicode: fix unicode character representations
//

function WikEdFixUnicode(obj) {

// replace supported chars: change decimal, hex, and character entities into actual char
	for (i = 0; i &lt; wikEdSupportedChars.length; i ++) {
		var replaceChar = String.fromCharCode(parseInt(wikEdSupportedChars[i][0], 16));

// decimal representation
		var regExpStr = '&amp;#0*' + parseInt(wikEdSupportedChars[i][0], 16) + ';|';

// hex representation
		regExpStr += '&amp;#x0*' + wikEdSupportedChars[i][0] + ';';

// case insensitive replace
		var regExp = new RegExp(regExpStr, 'gi');
		obj.plain = obj.plain.replace(regExp, replaceChar);

// character entity representation
		regExpStr = '&amp;amp;' + wikEdSupportedChars[i][1] + ';';

// case sensitive replace
		regExp = new RegExp(regExpStr, 'g');
		obj.plain = obj.plain.replace(regExp, replaceChar);
	}

// replace unsupported chars in IE6: change decimal, hex, and chars into character entities
	for (i = 0; i &lt; wikEdProblemChars.length; i ++) {
		replaceChar = '&amp;' + wikEdProblemChars[i][1] + ';';

// decimal representation
		regExpStr = '&amp;#0*' + parseInt(wikEdProblemChars[i][0], 16) + ';|';

// hex representation
		regExpStr += '&amp;#x0*' + wikEdProblemChars[i][0] + ';';

// case insensitive replace
		regExp = new RegExp(regExpStr, 'gi');
		obj.plain = obj.plain.replace(regExp, replaceChar);

// actual character representation
		regExpStr = '\\u' + wikEdProblemChars[i][0];

// case sensitive replace
		regExp = new RegExp(regExpStr, 'g');
		obj.plain = obj.plain.replace(regExp, replaceChar);
	}

// replace special chars (spaces and invisible characters): change decimal, hex, and chars into character entities
	for (i = 0; i &lt; wikEdSpecialChars.length; i ++) {
		var replaceChar = '&amp;amp;' + wikEdSpecialChars[i][1] + ';';

// decimal representation
		var regExpStr = '&amp;#0*' + parseInt(wikEdSpecialChars[i][0], 16) + ';|';

// hex representation
		regExpStr += '&amp;#x0*' + wikEdSpecialChars[i][0] + ';';

// case insensitive replace
		var regExp = new RegExp(regExpStr, 'gi');
		obj.plain = obj.plain.replace(regExp, replaceChar);

// actual character representation
		regExpStr = '\\u' + wikEdSpecialChars[i][0];

// case sensitive replace
		var regExp = new RegExp(regExpStr, 'g');
		obj.plain = obj.plain.replace(regExp, replaceChar);
	}

// unicode line separator and paragraph separator
	obj.plain = obj.plain.replace(/\u2028/g, '\n');
	obj.plain = obj.plain.replace(/\u2029/g, '\n\n');

	return;
}


//
// WikEdFixMath: math character fixer, originally from User:Omegatron
//

function WikEdFixMath(obj) {

	WikEdFixBasic(obj);

// change only outside &lt;math&gt; &lt;/math&gt; wikicode
	obj.plain = obj.plain.replace(/(.*?)((&amp;lt;math(\b.*?)&amp;gt;.*?&amp;lt;\/math&amp;gt;)|$)/gi,
		function (p, p1, p2) {

// convert html entities into actual dash characters
			p1 = p1.replace(/&amp;plus;/g, '+');
			p1 = p1.replace(/&amp;minus;/g, '\u2212');
			p1 = p1.replace(/&amp;middot;/g, 'Â·');

// convert dash next to a number into a minus sign character
			p1 = p1.replace(/([^\w\,\{])-(\d)/g, '$1\u2212$2');

// changes 2x3 to 2Ã—3
			p1 = p1.replace(/(\d *)x( *\d)/g, '$1\u00d7$2');

// changes 10^3 to 10&lt;sup&gt;3&lt;/sup&gt;
			p1 = p1.replace(/(\d*\.?\d+)\^(\u2212?\d+\.?\d*)/g, '$1&amp;lt;sup&amp;gt;$2&amp;lt;/sup&amp;gt;');

// change x^3 to x&lt;sup&gt;3&lt;/sup&gt;
			p1 = p1.replace(/([\w])\^(\u2212?\d+\.?\d*) /g, '$1&amp;lt;sup&amp;gt;$2&amp;lt;/sup&amp;gt;');

// change +/- to Â±
			p1 = p1.replace(/( |\d)\+\/(-|\u2212)( |\d)/g, '$1\u00b1$3');

// htmlize single char superscripts
			p1 = p1.replace(/(\u00b9|&amp;sup1;)/g, '&amp;lt;sup&amp;gt;1&amp;lt;/sup&amp;gt;');
			p1 = p1.replace(/(\u00b2|&amp;sup2;)/g, '&amp;lt;sup&amp;gt;2&amp;lt;/sup&amp;gt;');
			p1 = p1.replace(/(\u00b3|&amp;sup3;)/g, '&amp;lt;sup&amp;gt;3&amp;lt;/sup&amp;gt;');

			return(p1 + p2);
		}
	);
	return;
}


//
// WikEdFixChem: fix chemical formulas
//

function WikEdFixChem(obj) {

	WikEdFixBasic(obj);

	var realElements = 'H|He|Li|Be|B|C|N|O|F|Ne|Na|Mg|Al|Si|P|S|Cl|Ar|K|Ca|Sc|Ti|V|Cr|Mn|Fe|Co|Ni|Cu|Zn|Ga|Ge|As|Se|Br|Kr|Rb|Sr|Y|Zr|Nb|Mo|Tc|Ru|Rh|Pd|Ag|Cd|In|Sn|Sb|Te|I|Xe|Cs|Ba|Hf|Ta|W|Re|Os|Ir|Pt|Au|Hg|Tl|Pb|Bi|Po|At|Rn|Fr|Ra|Rf|Db|Sg|Bh|Hs|Mt|Ds|Rg|La|Ce|Pr|Nd|Pm|Sm|Eu|Gd|Tb|Dy|Ho|Er|Tm|Yb|Lu|Ac|Th|Pa|U|Np|Pu|Am|Cm|Bk|Cf|Es|Fm|Md|No|Lr';
	var pseudoElements = '|Me|Et|Pr|Bu|e';

// fix common typos
	obj.plain = obj.plain.replace(/(^|[^a-z])h2o([^a-z]|$)/g, '$1H2O$2');
	obj.plain = obj.plain.replace(/(^|[^a-z])h3o+/g, '$1H3O+');
	obj.plain = obj.plain.replace(/(^|[^a-z])oh-/g, '$1OH+');

// uppercase lowercased elements
	var regExp = new RegExp('(^|[^a-zA-Z])(' + realElements.toLowerCase() + pseudoElements.toLowerCase() + ')([^a-zA-Z]|$)', 'g');
	obj.plain = obj.plain.replace(regExp,
		function (p, p1, p2, p3) {
			if (p2 != 'e') {
				p2 = p2.substr(0, 1).toUpperCase() + p2.substr(1).toLowerCase();
			}
			return(p1 + p2 + p3);
		}
	);

// fix superscripts
	obj.plain = obj.plain.replace(/&amp;plus;/g, '+');
	obj.plain = obj.plain.replace(/&amp;minus;/g, '\u2212');
	obj.plain = obj.plain.replace(/&amp;middot;/g, 'Â·');
	regExp = new RegExp('(' + realElements + pseudoElements + '|\\))(\\d*(\\+|-|\\u2212))', 'g');
	obj.plain = obj.plain.replace(regExp,
		function (p, p1, p2, p3) {
			p2 = p2.replace(/-/g, '\u2212');
			return(p1 + '&amp;lt;sup&amp;gt;' + p2 + '&amp;lt;/sup&amp;gt;');
		}
	);

// fix indices
	regExp = new RegExp('(' + realElements + pseudoElements + '|\\))(\\d+)', 'g');
	obj.plain = obj.plain.replace(regExp, '$1&amp;lt;sub&amp;gt;$2&amp;lt;/sub&amp;gt;');

// fix prefixes
	regExp = new RegExp('(\\d+) *(\\(|' + realElements + pseudoElements + ')', 'g');
	obj.plain = obj.plain.replace(regExp, '$1$2');

// fix arrows
	obj.plain = obj.plain.replace(/ *-+&amp;gt; */g, ' \u2192 ');
	obj.plain = obj.plain.replace(/ *&amp;lt;-+ */g, ' \u2190 ');

// &amp;hdarr; and &quot;leftwards harpoon over rightwards harpoon&quot; not supported in IE6
//	obj.plain = obj.plain.replace(/ *(&amp;lt;=+&amp;gt;|&amp;hdarr;|&amp;harr;|\u2190 *\u2192) */g, ' \u21cc ');
	obj.plain = obj.plain.replace(/ *(&amp;lt;==+&amp;gt;|&amp;hdarr;|&amp;harr;|\u21cc|\u2190 *\u2192) */g, ' &lt;=&gt; ');

// fix -
	obj.plain = obj.plain.replace(/(\w|\)|&amp;gt;) +(-|\u2212) +(\w|\()/g, '$1 \u2212 $3');

	return;
}


//
// WikEdFixUnits: unit formatter - new tab adds spaces between number and units, makes units consistent
// originally from User:Omegatron
//

function WikEdFixUnits(obj) {
	WikEdFixBasic(obj);
/*
// convert all &amp;deg; into actual Â° symbol
	obj.plain = obj.plain.replace(/&amp;deg;/g, 'Â°');

// convert the word ohm(s) or the html entity into the actual Omega symbol (not the actual ohm symbol &amp;#8486;) and make sure it's spaced
	obj.plain = obj.plain.replace(/(\d) ?(Y|Z|E|P|T|G|M|k|K|h|da|d|c|m|&amp;mu;|Âµ|&amp;micro;|n|p|f|a|z|y)? ?(&amp;Omega;|&amp;#8486;|(ohm|Ohm)s?)([\s.,:;\'\&quot;\/\)])/g, '$1 $2\u03a9$5');

// convert various micro symbols into the actual micro symbol, make sure it's spaced
	obj.plain = obj.plain.replace(/(\d) ?(&amp;mu;|&amp;micro;)(g|s|m|A|K|mol|cd|rad|sr|Hz|N|J|W|Pa|lm|lx|C|V|O|F|Wb|T|H|S|Bq|Gy|Sv|kat|Â°C|M)([\s.,:;\'\&quot;\/\)])/g, '$1 Âµ$3$4');

// convert capital K to lowercase k in units
	obj.plain = obj.plain.replace(/(\d) ?K(g|s|m|A|K|mol|cd|rad|sr|Hz|N|J|W|Pa|lm|lx|C|V|O|F|Wb|T|H|S|Bq|Gy|Sv|kat|Â°C|M)([\s.,:;\'\&quot;\/\)])/g, '$1 k$2$3');

// capitalize units correctly
	obj.plain = obj.plain.replace(/(\d) ?(khz)([ ,.])/gi, '$1 kHz$3');
	obj.plain = obj.plain.replace(/(\d) ?(mhz)([ ,.])/gi, '$1 MHz$3');
	obj.plain = obj.plain.replace(/(\d) ?(ghz)([ ,.])/gi, '$1 GHz$3');
	obj.plain = obj.plain.replace(/(\d) ?(Y|Z|E|P|T|G|M|k|K|h|da|d|c|m|&amp;mu;|Âµ|&amp;micro;|n|p|f|a|z|y)?(hz|HZ)([\s.,:;\'\&quot;\/\)])/g, '$1 $2Hz$4');
	obj.plain = obj.plain.replace(/(\d) ?(Y|Z|E|P|T|G|M|k|K|h|da|d|c|m|&amp;mu;|Âµ|&amp;micro;|n|p|f|a|z|y)?(pa|PA)([\s.,:;\'\&quot;\/\)])/g, '$1 $2Pa$4');

// add a space before dB
	obj.plain = obj.plain.replace(/(\d) ?(dB)([\s.,:;\'\&quot;\/\)])/g, '$1 $2$3');

// add a space before any units that were missed before
	obj.plain = obj.plain.replace(/(\d) ?(Y|Z|E|P|T|G|M|k|K|h|da|d|c|m|&amp;mu;|Âµ|&amp;micro;|n|p|f|a|z|y)?(g|m|A|K|mol|cd|rad|sr|Hz|N|J|W|Pa|lm|lx|C|V|O|F|Wb|T|H|S|Bq|Gy|Sv|kat|Â°C|M)([\s.,:;\'\&quot;\/\)])/g, '$1 $2$3$4');

// separate one for seconds since they give a lot of false positives like &quot;1970s&quot;. Only difference is mandatory prefix.
	obj.plain = obj.plain.replace(/(\d) ?(Y|Z|E|P|T|G|M|k|K|h|da|d|c|m|&amp;mu;|Âµ|&amp;micro;|n|p|f|a|z|y)(s)([\s.,:;\'\&quot;\/\)])/g, '$1 $2$3$4');

// bps or b/s or bits/s --&gt; bit/s
	obj.plain = obj.plain.replace(/([KkMmGgTtPpEeYyZz])(bps|bits?\/s|b\/s)/g, '$1bit/s');

// Bps or byte/s or bytes/s --&gt; B/s
	obj.plain = obj.plain.replace(/([KkMmGgTtPpEeYyZz])(Bps|bytes?\/s)/g, '$1B/s');

// after that, make capitalization correct
	obj.plain = obj.plain.replace(/K(bit|B)\/s/g, 'k$1/s');
	obj.plain = obj.plain.replace(/m(bit|B)\/s/g, 'M$1/s');
	obj.plain = obj.plain.replace(/g(bit|B)\/s/g, 'G$1/s');
	obj.plain = obj.plain.replace(/t(bit|B)\/s/g, 'T$1/s');
	obj.plain = obj.plain.replace(/e(bit|B)\/s/g, 'E$1/s');
	obj.plain = obj.plain.replace(/y(bit|B)\/s/g, 'Y$1/s');
	obj.plain = obj.plain.replace(/z(bit|B)\/s/g, 'Z$1/s');

// fix a common error
	obj.plain = obj.plain.replace(/mibi(bit|byte)/g, 'mebi$1');
*/
	return;
}


//
// WikEdFixDashes: dash fixer - adds a tab that fixes several obvious en/em dash, minus sign, and such special characters.
// originally from User:Omegatron
//

function WikEdFixDashes(obj) {
	WikEdFixBasic(obj);

// convert html entities into actual dash characters
	obj.plain = obj.plain.replace(/&amp;mdash;/g, 'â€”');
	obj.plain = obj.plain.replace(/&amp;ndash;/g, 'â€“');
	obj.plain = obj.plain.replace(/&amp;minus;/g, '\u2212');

// convert -- and em dashes with or without spaces to em dash surrounded by spaces
	obj.plain = obj.plain.replace(/([a-zA-Z\'\&quot;â€\]\}\)]) *(--|â€”|&amp;mdash;) *([a-zA-Z\'\&quot;â€œ\[\{\(])/g, '$1 â€” $3');

// convert - or en dashes with spaces to em dash character surrounded by spaces
	obj.plain = obj.plain.replace(/([a-zA-Z\'\&quot;â€\]\}])( |&amp;nbsp;)+(\u2212|â€“|&amp;ndash;) +([a-zA-Z\'\&quot;â€œ\[\{])/g, '$1$2â€” $4');

// convert hyphen next to lone number into a minus sign character
	obj.plain = obj.plain.replace(/([a-zA-Z\'\&quot;â€\]\&gt;] )-(\d)/g, '$1\u2212$2');

// convert dashes to en dashes in dates
	obj.plain = obj.plain.replace(/([ \(][12]\d\d\d) ?(--?|â€”|&amp;mdash;) ?([12]\d\d\d|\d\d)([ \),.;])/g, '$1â€“$3$4');

	return;
}


//
// WikEdFixHTML: fix html to wikicode
//

function WikEdFixHTML(obj) {
	WikEdFixBasic(obj);

// remove syntax highlighting
	obj.html = obj.plain;
	obj.html = obj.html.replace(/\n/g, '&lt;br /&gt;');
	WikEdRemoveHighlighting(obj);

// turn visible html code into real html, exclude comments
	obj.html = obj.html.replace(/&amp;lt;(\/?\w.*?)&amp;gt;/g, '&lt;$1&gt;');

// wikify, keep user added attribute
	WikEdWikifyHTML(obj, true);

// turn real html into visible html code
	obj.html = obj.html.replace(/&lt;br\b[^&gt;]*&gt;/g, '\n');
	obj.html = obj.html.replace(/&lt;/g, '&amp;lt;');
	obj.html = obj.html.replace(/&gt;/g, '&amp;gt;');
	obj.plain = obj.html;

	return;
}


//
// WikEdFixCaps: fix capitalizing of lists, linklists, images, headings
//

function WikEdFixCaps(obj) {
	WikEdFixBasic(obj);
/*
// uppercase lists
// start (listcode (char-ent|tag|category..|digit|non-word,non-ret))(word,non-digit..) end
	obj.plain = obj.plain.replace(/^([\*\#\:\;]+ (\&amp;\w+\;|&amp;lt;[^\n]*?&amp;gt;|\{\{.*?\}\}[^\n]*|\d|[^\w\n])*)([^\W\d].*?)?$/gm,
		function (p, p1, p2, p3) {
			if ( ! p3.match(/^(http|ftp|alpha|beta|gamma|delta|epsilon|kappa|lambda|$)/) ) {
				p3 = p3.substr(0, 1).toUpperCase() + p3.substr(1);
			}
			return(p1 + p3);
		}
	);

// uppercase link lists (link)
	obj.plain = obj.plain.replace(/^([\*\#\:\;]+ \[\[)([^\n]*?)(\]\])/gm,
		function (p, p1, p2, p3) {

// uppercase link
			p2 = p2.replace(/^((\&amp;\w+\;|\W|\d)*)([^\W\d].*)$/,
				function (p, p1, p2, p3) {
					if ( ! p3.match(/^(http|ftp|alpha|beta|gamma|delta|epsilon|kappa|lambda)/) ) {
						p3 = p3.substr(0, 1).toUpperCase() + p3.substr(1);
					}
					return(p1 + p3);
				}
			);

// uppercase comment
			p2 = p2.replace(/(\| *(\&amp;\w+\;|&amp;lt;[^\n]*?&amp;gt;|\W|\d)*)([^\W\d].*)$/,
				function (p, p1, p2, p3) {
					if ( ! p3.match(/^(http|ftp|alpha|beta|gamma|delta|epsilon|kappa|lambda)/) ) {
						p3 = p3.substr(0, 1).toUpperCase() + p3.substr(1);
					}
					return(p1 + p3);
				}
			);
			return(p1 + p2 + p3);
		}
	);

// uppercase headings
	obj.plain = obj.plain.replace(/^(=+ (\&amp;\w+\;|&amp;lt;[^\n]*?&amp;gt;|\d|[^\w\n])*)([^\W\d].*? =+)$/gm,
		function (p, p1, p2, p3) {
			if ( ! p3.match(/^(http|ftp|alpha|beta|gamma|delta|epsilon|kappa|lambda)/) ) {
				p3 = p3.substr(0, 1).toUpperCase() + p3.substr(1);
			}
			return(p1 + p3);
		}
	);

// uppercase images
	regExp = new RegExp('(\\[\\[)' + wikEdText['wikicode Image'] + ':(\\w)([^\\n]*\\]\\])', 'igm');
	obj.plain = obj.plain.replace(regExp,
		function (p, p1, p2, p3) {
			return(p1 + wikEdText['wikicode Image'] + ':' + p2.toUpperCase() + p3);
		}
	);
*/
	return;
}

//
// WikEdFixAll:
//

function WikEdFixAll(obj) {
	WikEdFixBasic(obj);
	WikEdFixUnicode(obj);
	WikEdFixHTML(obj);
	WikEdFixCaps(obj);
	return;
}


//
// WikEdRemoveElements: remove elements by tag name
//

function WikEdRemoveElements(tagNameArray) {

// cycle through the element names
        var tagNameI;
	for(tagNameI in tagNameArray) {
		var elementArray = wikEdFrameDocument.getElementsByTagName(tagNameArray[tagNameI]);
		for (i = 0; i &lt; elementArray.length; i ++) {
			elementArray[i].parentNode.removeChild(elementArray[i]);
		}
	}
	return;
}


//
// WikEdFindBoundaries: find word boundaries and line boundaries starting from selection.range
//

function WikEdFindBoundaries(word, line, whole, selection) {

// get the start node and offset
	var startNode = selection.range.startContainer;
	var startNodeOffset = selection.range.startOffset;

// get the end node and offset
	var endNode = selection.range.endContainer;
	var endNodeOffset = selection.range.endOffset;

	if (startNode.nodeType == 1) {
		startNode = startNode.childNodes[startNodeOffset];
		startNodeOffset = 0;
	}
	if (endNode.nodeType == 1) {
		endNode = endNode.childNodes[endNodeOffset];
		endNodeOffset = 0;
	}

// find the start and end nodes in the whole plain text arrays
	var startNodeIndex;
	var endNodeIndex;
	for (i = 0; i &lt; whole.plainNode.length; i ++) {
		if (startNode == whole.plainNode[i]) {
			startNodeIndex = i;
		}
		if (endNode == whole.plainNode[i]) {
			endNodeIndex = i;
			break;
		}
	}

// find last previous word and line boundary
	var foundWord = false;
	var foundLine = false;
	var regExp = new RegExp('.*[^\\w\\-]', 'g');
	var plain = '';

// check text nodes left-wise for a boundary
	for (i = startNodeIndex; i &gt;= 0; i --) {
		plain = whole.plainArray[i];

				plain = plain.replace(/&amp;amp;/g, '&amp;');
				plain = plain.replace(/&amp;lt;/g, '&lt;');
				plain = plain.replace(/&amp;gt;/g, '&gt;');

// boundary is a newline
		if (plain == '\n') {

// current newline is the start node
			if (i == startNodeIndex) {
				if (! foundWord) {
					word.range.setStartBefore(whole.plainNode[i]);
					foundWord = true;
				}
				line.range.setStartBefore(whole.plainNode[i]);
			}
			else {
				if (! foundWord) {
					word.range.setStartAfter(whole.plainNode[i]);
					foundWord = true;
				}
				line.range.setStartAfter(whole.plainNode[i]);
			}
			foundLine = true;
			break;
		}

// check text node for a word boundary
		else if (! foundWord) {
			if (i == startNodeIndex) {
				plain = plain.substr(0, startNodeOffset);

				plain = plain.replace(/&amp;amp;/g, '&amp;');
				plain = plain.replace(/&amp;lt;/g, '&lt;');
				plain = plain.replace(/&amp;gt;/g, '&gt;');
			}
			regExp.lastIndex = 0;
			if (regExp.exec(plain) != null) {
				word.range.setStart(whole.plainNode[i], regExp.lastIndex); /////
				foundWord = true;
			}
		}
	}

// boundary is start of text
	if (! foundLine) {
		line.range.setStartBefore(whole.plainNode[0]);
		if (! foundWord) {
			word.range.setStartBefore(whole.plainNode[0]);
		}
	}

// find next word and line boundary
	regExp = new RegExp('[^\\w\\-]', 'g');
	foundWord = false;
	foundLine = false;

// check text nodes right-wise for a boundary
	for (i = endNodeIndex; i &lt; whole.plainArray.length; i ++) {
		plain = whole.plainArray[i];

				plain = plain.replace(/&amp;amp;/g, '&amp;');
				plain = plain.replace(/&amp;lt;/g, '&lt;');
				plain = plain.replace(/&amp;gt;/g, '&gt;');

// boundary is a newline
		if (plain == '\n') {
			if (! foundWord) {
				word.range.setEndBefore(whole.plainNode[i]);
				foundWord = true;
			}
			line.range.setEndBefore(whole.plainNode[i]);
			foundLine = true;
			break;
		}

// check text node for a word boundary
		else if (! foundWord) {
			if (i == endNodeIndex) {
				regExp.lastIndex = endNodeOffset;
			}
			else {
				regExp.lastIndex = 0;
			}
			var regExpArray = regExp.exec(plain);
			if (regExpArray != null) {
				word.range.setEnd(whole.plainNode[i], regExpArray.index);
				foundWord = true;
			}
		}
	}

// boundary is end of text
	if (! foundLine) {
		line.range.setEndAfter(whole.plainNode[whole.plainArray.length - 1]);
		if (! foundWord) {
			word.range.setEndAfter(whole.plainNode[whole.plainArray.length - 1]);
		}
	}
	return;
}


//
// remove syntax highlighting and wikify
//

function WikEdRemoveHighlightingWikify(obj) {

	if (obj.html != '') {

// remove syntax highlighting
		WikEdRemoveHighlighting(obj);

// wikify, don't allow many attributes
		if (obj.htmlCode == true) {
			WikEdWikifyHTML(obj, false);
		}
	}
	return;
}


//
// WikEdWikifyHTML:
//   obj.html contains the text to be wikified
//   expects &lt; &gt; &amp;lt; &amp;gt; &amp;amp;  spaces instead of &amp;nbsp;  \n instead of &lt;br /&gt;

/*
	allowed and converted tags:
			br|p
			h1|h2|h3|h4|h5|h6
			hr
			i|dfn|cite|em|var
			b|strong
			table|caption|col|thead|tfoot|tbody|tr|td|th
			dl|dt|dd|li|ol|ul
			a
	not allowed yet:
			bdo|q|kbd|samp|abbr|acronym|label
	other allowed tags:
			big|blockquote|colgroup|center|code|del|div|font|ins|pre|s|small|span|strike|sub|sup|tt|u|rb|rp|rt|ruby
	mediawiki tags:
			nowiki|math|gallery|noinclude|includeonly|ref|references
*/

function WikEdWikifyHTML(obj, relaxed) {

	var regExpStr;
	var regExp;
	var regExpMatch;

// delete tags: &lt;style&gt;
	obj.html = obj.html.replace(/&lt;(style)\b[^&gt;]*&gt;.*?&lt;\/\1&gt;/g, '');

// sanitize &lt;span&gt; &lt;div&gt; &lt;p&gt;
	obj.html = obj.html.replace(/&lt;(span|div|p)\b *(.*?) *\/?&gt;/g,
		function (p, p1, p2) {
			return('&lt;' + p1 + WikEdSanitizeAttributes(p1, p2, relaxed) +  '&gt;');
		}
	);

// remove &lt;span&gt; ... &lt;/span&gt; pairs withhout attributes
	var isRemove = [];
	obj.html = obj.html.replace(/(&lt;(\/?)span\b([^&gt;]*)&gt;)/g,
		function (p, p1, p2, p3) {
			if (p2 == '') {
				if (p3 == '') {
					isRemove.push(true);
					return('');
				}
				isRemove.push(false);
				return(p1);
			}
			if (isRemove.pop() == true) {
				return('');
			}
			return(p1);
		}
	);

// remove &lt;p&gt; ... &lt;/p&gt; pairs withhout attributes
	var isRemove = [];
	obj.html = obj.html.replace(/(&lt;(\/?)p\b([^&gt;]*)&gt;)/g,
		function (p, p1, p2, p3) {
			if (p2 == '') {
				if (p3 == '') {
					isRemove.push(true);
					return('\u0000\u0000');
				}
				isRemove.push(false);
				return(p1);
			}
			if (isRemove.pop() == true) {
				return('\u0000\u0000');
			}
			return(p1);
		}
	);

// escape character entities
	obj.html = obj.html.replace(/&amp;(?!(amp;|lt;|gt;))/g, '&amp;amp;');

// remove MediaWiki table of contents
	obj.html = obj.html.replace(/&lt;table\b[^&gt;]*?\bid=\&quot;toc\&quot;[^&gt;]*&gt;.*?&lt;\/table&gt;/g, '');

// remove MediaWiki print footer
	obj.html = obj.html.replace(/&lt;div\b[^&gt;]*?\bclass=\&quot;printfooter\&quot;[^&gt;]*&gt;[^&lt;&gt;\&quot;]+\&quot;&lt;a\b[^&gt;]*&gt;[^&lt;]+&lt;\/a&gt;\&quot;&lt;\/div&gt; */g, '');

// remove MediaWiki category list tags
	regExp = /&lt;div\b[^&gt;]*\bid=\&quot;catlinks\&quot;[^&gt;]*&gt;(.*?)&lt;\/div&gt;/g;
	while(regExp.test(obj.html) == true) {
		obj.html = obj.html.replace(regExp, '$1');
	}
	regExp = /&lt;p\b[^&gt;]*?\bclass=\&quot;catlinks\&quot;[^&gt;]*&gt;(.*?)&lt;a\b[^&gt;]*&gt;[^&lt;&gt;]+&lt;\/a&gt;: (.*?)&lt;\/p&gt;/g;
	while(regExp.test(obj.html) == true) {
		obj.html = obj.html.replace(regExp, '$1$2');
	}

// remove comments
	obj.html = obj.html.replace(/&lt;!--.*?--&gt;/g, '');

// &lt;hr&gt; horizontal rule
	obj.html = obj.html.replace(/(\n|\u0000|\s)*&lt;hr\b[^&gt;]*&gt;(\n|\u0000|\s)*/i, '\u0000\u0000----\u0000\u0000');

// &lt;i&gt; &lt;em&gt; &lt;dfn&gt; &lt;var&gt; &lt;cite&gt; italic
	obj.html = obj.html.replace(/&lt;(i|em|dfn|var|cite)\b[^&gt;]*&gt;/g, '\'\'');
	obj.html = obj.html.replace(/&lt;\/(i|em|dfn|var|cite)\b[^&gt;]*&gt;/g, '\'\'');

// &lt;b&gt; &lt;strong&gt; bold
	obj.html = obj.html.replace(/&lt;(b|strong)\b[^&gt;]*&gt;/g, '\'\'\'');
	obj.html = obj.html.replace(/&lt;\/(b|strong)\b[^&gt;]*&gt;/g, '\'\'\'');

// &lt;h1&gt; .. &lt;h6&gt; headings
	obj.html = obj.html.replace(/&lt;span class=\&quot;editsection\&quot;&gt;.*?&lt;\/span&gt; */g, '');

	obj.html = obj.html.replace(/[\s\u0000]*&lt;h1\b[^&gt;]*&gt;(.*?)&lt;\/h1&gt;[\s\u0000]*/g, '\u0000\u0000= $1 =\u0000\u0000');
	obj.html = obj.html.replace(/[\s\u0000]*&lt;h2\b[^&gt;]*&gt;(.*?)&lt;\/h2&gt;[\s\u0000]*/g, '\u0000\u0000== $1 ==\u0000\u0000');
	obj.html = obj.html.replace(/[\s\u0000]*&lt;h3\b[^&gt;]*&gt;(.*?)&lt;\/h3&gt;[\s\u0000]*/g, '\u0000\u0000=== $1 ===\u0000\u0000');
	obj.html = obj.html.replace(/[\s\u0000]*&lt;h4\b[^&gt;]*&gt;(.*?)&lt;\/h4&gt;[\s\u0000]*/g, '\u0000\u0000==== $1 ====\u0000\u0000');
	obj.html = obj.html.replace(/[\s\u0000]*&lt;h5\b[^&gt;]*&gt;(.*?)&lt;\/h5&gt;[\s\u0000]*/g, '\u0000\u0000===== $1 =====\u0000\u0000');
	obj.html = obj.html.replace(/[\s\u0000]*&lt;h6\b[^&gt;]*&gt;(.*?)&lt;\/h6&gt;[\s\u0000]*/g, '\u0000\u0000====== $1 ======\u0000\u0000');

	obj.html = obj.html.replace(/&lt;span\b[^&gt;]*\bclass=\&quot;mw-headline\&quot;&gt;(.*?)&lt;\/span&gt; */g, '$1');

// remove &lt;thead&gt; &lt;tbody&gt; &lt;tfoot&gt;
	obj.html = obj.html.replace(/([\s\u0000])&lt;\/?(thead|tbody|tfoot)\b[^&gt;]*&gt;[\s\u0000]*/g, '$1');

// remove &lt;col&gt;&lt;/col&gt; and &lt;colgroup&gt;&lt;/colgroup&gt;
	obj.html = obj.html.replace(/[\s\u0000]*&lt;(col)\b[^&gt;]*&gt;.*?&lt;\/\1&gt;[\s\u0000]*/g, '');
	obj.html = obj.html.replace(/[\s\u0000]*&lt;(colgroup)\b[^&gt;]*&gt;.*?&lt;\/\1&gt;[\s\u0000]*/g, '');

// line breaks in table cells
	obj.html = obj.html.replace(/(&lt;(td|th|caption)\b[^&gt;]*&gt;)(.*?)(&lt;\/\2&gt;)/g,
		function(p, p1, p2, p3, p4) {
			p3 = p3.replace(/^(\s|\u0000|&lt;br\b[^&gt;]*&gt;)+/g, '');
			p3 = p3.replace(/(\s|\u0000|&lt;br\b[^&gt;]*&gt;)+$/g, '');
			p3 = p3.replace(/&lt;br\b[^&gt;]*&gt; */g, '&amp;lt;br /&amp;gt;');
			return(p1 + p3 + p4);
		}
	);

// remove table closing tags
	obj.html = obj.html.replace(/[\s\u0000]*&lt;\/(tr|thead|tbody|tfoot)&gt;[\s\u0000]*/g, '');

// &lt;td&gt; table cells
	obj.html = obj.html.replace(/[\s\u0000]*&lt;td&gt;[\s\u0000]*/g, '\u0000| ');
	obj.html = obj.html.replace(/[\s\u0000]*&lt;(td) +([^&gt;]*)&gt;[\s\u0000]*/g,
		function (p, p1, p2) {
			p2 = WikEdSanitizeAttributes(p1, p2, relaxed);
			if (p2 == '') {
				return('\u0000| ');
			}
			else {
				return('\u0000|' + p2 + ' | ');
			}
		}
	);

// &lt;th&gt; table cells
	obj.html = obj.html.replace(/[\s\u0000]*&lt;th&gt;[\s\u0000]*/g, '\u0000| ');
	obj.html = obj.html.replace(/[\s\u0000]*&lt;(th) +([^&gt;]*)&gt;[\s\u0000]*/g,
		function (p, p1, p2) {
			p2 = WikEdSanitizeAttributes(p1, p2, relaxed);
			if (p2 == '') {
				return('\u0000| ');
			}
			else {
				return('\u0000|' + p2 + ' | ');
			}
		}
	);

// &lt;tr&gt; table rows
	obj.html = obj.html.replace(/[\s\u0000]*&lt;tr&gt;[\s\u0000]*/g, '\u0000|-\u0000');
	obj.html = obj.html.replace(/[\s\u0000]*&lt;(tr) +([^&gt;]*)&gt;[\s\u0000]*/g,
		function (p, p1, p2) {
			return('\u0000|-' + WikEdSanitizeAttributes(p1, p2, relaxed) + '\u0000');
		}
	);

// &lt;caption&gt; table caption
	obj.html = obj.html.replace(/[\s\u0000]*&lt;caption&gt;[\s\u0000]*/g, '\u0000|+ ');
	obj.html = obj.html.replace(/[\s\u0000]*&lt;(caption) +([^&gt;]*)&gt;[\s\u0000]*/g,
		function (p, p1, p2) {
			p2 = WikEdSanitizeAttributes(p1, p2, relaxed);
			if (p2 == '') {
				return('\u0000|+ ');
			}
			else {
				return('\u0000|+' + p2 + ' | ');
			}
		}
	);

// remove closing tags
	obj.html = obj.html.replace(/\s*&lt;\/(td|th|caption)&gt;\s*/g, '');

// line breaks in table cells (continued)
	obj.html = obj.html.replace(/&lt;br\b[^&gt;]*&gt;/g, '\u0000');

// &lt;table&gt;

	obj.html = obj.html.replace(/[\s\u0000]*&lt;table&gt;[\s\u0000]*(\|-(?=[\n\u0000]))?/g, '\u0000\u0000{|\u0000');
	obj.html = obj.html.replace(/[\s\u0000]*&lt;(table) +([^&gt;]*)&gt;[\s\u0000]*(\|-(?=[\n\u0000]))?/g,
		function (p, p1, p2) {
			return('\u0000{|' + WikEdSanitizeAttributes(p1, p2));
		}
	);
	obj.html = obj.html.replace(/[\s\u0000]*&lt;\/table&gt;[\s\u0000]*/g, '\u0000|}\u0000\u0000');

// convert links
	var regExpMatch = [];
	var regExpStr = '(&lt;a(\\b[^&gt;]*)&gt;(.*?)&lt;/a&gt;)';
	var regExp = new RegExp(regExpStr, 'gi');
	obj.html = obj.html.replace(regExp,
		function (p, p1, p2, p3) {
			var linkPar = p2;
			var linkText = p3;
			var linkArticle = '';
			var linkTitle = '';
			var imgWidth = '';

// internal wiki links

// get the title=&quot;&quot; parameter
			regExpStr = ' href=\\&quot;' + wikEdServer + '(' + wikEdArticlePath + '|' + wikEdScriptPath + ')([^\\&quot;&gt;]*)\\&quot;';
			regExp = new RegExp(regExpStr);
			regExpMatch = regExp.exec(linkPar);
			if (regExpMatch != null) {
				regExpStr = ' title=\\&quot;([^\\&quot;&gt;]*)\\&quot;';
				regExp = new RegExp(regExpStr);
				regExpMatch = regExp.exec(linkPar);
				if (regExpMatch != null) {
					linkTitle = regExpMatch[1];
				}
			}

// get wiki article name from url parameter list
			regExpStr = ' href=\\&quot;' + wikEdServer + wikEdScriptPath + 'index\\.php\\?[^\\&quot;]*?\\btitle=([^\\&quot;]*?)(&amp;amp;|\\&quot;)';
			regExp = new RegExp(regExpStr);
			regExpMatch = regExp.exec(linkPar);
			if (regExpMatch != null) {
				linkArticle = regExpMatch[1];
				if (linkArticle != '') {
					linkArticle = linkArticle.replace(/_/g, ' ');
					linkArticle = decodeURIComponent(linkArticle);

// ISBN links
					regExpStr = ' href=\\&quot;' + wikEdServer + wikEdScriptPath + 'index\\.php\\?[^\\&quot;]*?\\bisbn=(\\d+)(&amp;amp;|\\&quot;)';
					regExp = new RegExp(regExpStr);
					regExpMatch = regExp.exec(linkPar);
					if (regExpMatch != null) {
						return('ISBN ' + regExpMatch[1]);
					}
				}
			}

// get wiki article name from url
			if (linkArticle == '') {
				regExpStr = ' href=\\&quot;' + wikEdServer + wikEdArticlePath + '([^\\&quot;]*)\\&quot;';
				regExp = new RegExp(regExpStr);
				regExpMatch = regExp.exec(linkPar);
				if (regExpMatch != null) {
					linkArticle = regExpMatch[1];
					if (linkArticle != '') {
						linkArticle = linkArticle.replace(/_/g, ' ');
						linkArticle = decodeURIComponent(linkArticle);
					}
				}
			}

// format wiki link
			if (linkArticle != '') {

// check for wiki image
				regExpStr = '^&lt;img\\b[^&gt;]*?\\bwidth=\\&quot;(\\d+)\\&quot;[^&gt;]*?&gt;$';
				regExp = new RegExp(regExpStr);
				regExpMatch = regExp.exec(linkText);
				if (regExpMatch != null) {
					imgWidth = regExpMatch[1];
					imgWidth = '|' + imgWidth + 'px';
					if ( (linkTitle != '') &amp;&amp; (linkTitle != 'Enlarge') ) {
						linkTitle = '|' + linkTitle;
						return('[[' + linkArticle + imgWidth + linkTitle + ']]');
					}
					else {
						return('[[' + linkArticle + imgWidth + ']]');
					}
				}

// ISBN link
				regExpStr = '^' + wikEdServer + wikEdScriptPath + 'index\\.php\\?.*?\\btitle=.*?&amp;amp;isbn=(\d+)';
				regExp = new RegExp(regExpStr);
				regExpMatch = regExp.exec(linkAddr);
				if (regExpMatch != null) {
					return('ISBN ' + regExpMatch[1]);
				}

// category link
				var regExp = new RegExp('^' + wikEdText['wikicode Category'] + ':(.*)','i');
				regExpMatch = regExp.exec(linkArticle);
				if (regExpMatch != null) {
					return('[[' + wikEdText['wikicode Category'] + ':' + regExpMatch[1].substr(0, 1).toUpperCase() + linkText.substr(1) + ']]');
				}

// wiki link
				if (linkArticle == linkText.substr(0, 1).toUpperCase() + linkText.substr(1)) {
					return('[[' + linkText + ']]');
				}

// date link (English only)
				regExpMatch = /^(January|February|March|April|May|June|July|August|September|October|November|December) (\d{1,2})$/.exec(linkArticle);
				if (regExpMatch != null) {
					var month = regExpMatch[1];
					var day = regExpMatch[2];
					if (linkText == (day + ' ' + month) ) {
						return('[[' + linkArticle + ']]');
					}
				}

// lowercase the article name if the first char of the link text can exist in lower/uppercase and is lowercase
				if ( linkText.substr(0, 1).toLowerCase() != linkText.substr(0, 1).toUpperCase() ) {
					if ( linkText.substr(0, 1) == linkText.substr(0, 1).toLowerCase() ) {
						linkArticle = linkArticle.substr(0, 1).toLowerCase() + linkArticle.substr(1);
					}
				}

// suffix links
				regExpStr = '^' + linkArticle.replace(/(\W)/, '\\$1') + '(\\w+)$';
				regExp = new RegExp(regExpStr);
				regExpMatch = regExp.exec(linkText);
				if (regExpMatch != null) {
					return('[[' + linkText + ']]' + regExpMatch[1]);
				}
				return('[[' + linkArticle + '|' + linkText + ']]');
			}

// external link
			regExpMatch = linkPar.match(/ href=\&quot;([^\&quot;&gt;]*)\&quot;/);
			if (regExpMatch != null) {
				var linkAddr = regExpMatch[1];
				if (linkAddr != '') {

// PubMed link
					regExpMatch = /^http:\/\/www\.ncbi\.nlm\.nih\.gov\/entrez\/query\.fcgi\?cmd=Retrieve&amp;amp;db=pubmed&amp;amp;.*?&amp;amp;list_uids=(\d+)/.exec(linkAddr);
					if (regExpMatch != null) {
						return('PMID ' + regExpMatch[1]);
					}

// DOI link
					regExpMatch = /^http:\/\/dx\.doi\.org\/(.*)/.exec(linkAddr);
					if (regExpMatch != null) {
						return('{{doi|' + regExpMatch[1] + '}}');
					}

// other external link
					return('[' + linkAddr + ' ' + linkText + ']');
				}
			}

// return unchanged text
			return(p1);
		}
	);

// clean up MediaWiki category list
	var regExp = new RegExp('&lt;span\\b[^&gt;]*&gt;(\\[\\[' + wikEdText['wikicode Category'] + ':[^\\]]+\\]\\])&lt;\\/span&gt;[\\s\\u0000\\|]*', 'gi');
	obj.html = obj.html.replace(regExp, '$1\u0000');

// clean up DOI
	obj.html = obj.html.replace(/\[\[Digital object identifier\|DOI\]\]:(\{\{doi\|[^\}\s]+\}\})/gi, '$1');

// convert images
	obj.html = obj.html.replace(/&lt;img\b([^&gt;]*)&gt;/g,
		function (p, p1) {

// get and format parameters
			var address = '';
			var regExpMatch = /\bsrc\s*=\s*(\'|\&quot;)([^\'\&quot;]*)(\'|\&quot;)/i.exec(p1);
			if (regExpMatch != null) {
				address = regExpMatch[2].replace(/^ +| +$/g, '');
			}

			var imgAlt = '';
			regExpMatch = /\balt\s*=\s*(\'|\&quot;)([^\'\&quot;]*)(\'|\&quot;)/i.exec(p1);
			if (regExpMatch != null) {
				imgAlt = regExpMatch[2].replace(/^ +| +$/g, '');
				imgAlt = imgAlt.replace(/&amp;amp;nbsp;|[\n\u0000]/g, ' ');
				imgAlt = imgAlt.replace(/ {2,}/g, ' ');
				imgAlt = imgAlt.replace(/^ | $/g, '');
				if (imgAlt != '') {
					imgAlt = '|' + imgAlt;
				}
			}

			var imgWidth = '';
			regExpMatch = /\bwidth\s*=\s*(\'|\&quot;)([^\'\&quot;]*)(\'|\&quot;)/i.exec(p1);
			if (regExpMatch != null) {
				imgWidth = '|' + regExpMatch[2].replace(/^ +| +$/g, '') + 'px';
			}

			var imgLink = '';
			regExpMatch = /([^\/]+)$/.exec(address);
			if (regExpMatch != null) {
				imgLink = regExpMatch[1];
				if (imgLink != '') {
					return('[[' + wikEdText['wikicode Image'] + ':' + imgLink + imgWidth + imgAlt + ']]');
				}
			}
			return('');
		}
	);

// convert lists: * # : ;
	var listObj = {};
	listObj.prefix = '';
	obj.html = obj.html.replace(/[\s\u0000]*&lt;(\/?(ol|ul|li|dl|dd|dt))\b[^&gt;]*&gt;[\s\u0000]*/g,
		function (p, p1, p2, p3, p4) {
			switch (p1.toLowerCase()) {
				case 'ol':
					listObj.prefix += '#';
					return('\u0000');
				case 'ul':
					listObj.prefix += '*';
					return('\u0000');
				case 'dl':
					listObj.prefix += ':';
					return('\u0000');
				case '/ol':
				case '/ul':
				case '/dl':
					listObj.prefix = listObj.prefix.substr(0, listObj.prefix.length - 1);
					return('\u0000\u0000');
				case 'li':
				case 'dd':
					return('\u0000' + listObj.prefix + ' ');
				case 'dt':
					return('\u0000' + listObj.prefix.replace(/:$/, ';') + ' ');
				case '/li':
				case '/dt':
				case '/dd':
					return('');
			}
		}
	);
	obj.html = obj.html.replace(/[\n|\u0000]+[#\*:\;]+ (?=[\n|\u0000])/g, '');

// &lt;&gt; remove not allowed tags
	obj.html = obj.html.replace(/(&lt;\/?)(\/?)(\w+)(.*?&gt;)/g,
		function (p, p1, p2, p3, p4) {
			if ( /^(big|blockquote|colgroup|center|code|del|div|font|ins|p|pre|s|small|span|strike|sub|sup|tt|u|rb|rp|rt|ruby|nowiki|math|gallery|noinclude|includeonly|ref|references)$/i.test(p3) ) {
				return(p1 + p2 + p3 + p4);
			}
			else {
				return('');
			}
		}
	);

// sanitize attributes in opening html tags
	obj.html = obj.html.replace(/&lt;(\w+) +(.*?) *(\/?)&gt;/g,
		function (p, p1, p2, p3) {
			if (p3 != '') {
				p3 = ' ' + p3;
			}
			return('&lt;' + p1 + WikEdSanitizeAttributes(p1, p2, relaxed) + p3 + '&gt;');
		}
	);

// remove space-only lines
	obj.html = obj.html.replace(/([\s\u0000]*\u0000[\s\u0000]*)/g,
		function (p, p1) {
			return(p1.replace(/\n/g, '\u0000'));
		}
	);
	obj.html = obj.html.replace(/\u0000\s+(?=\u0000)/g, '\u0000');

// remove leading and trailing spaces
	obj.html = obj.html.replace(/&gt;\s+\u0000/g, '&gt;\u0000');
	obj.html = obj.html.replace(/\u0000\s+&lt;/g, '\u0000&lt;');

// remove empty inline and block tag pairs
	obj.html = obj.html.replace(/( *)&lt;(big|colgroup|code|del|font|ins|pre|s|small|span|strike|sub|sup|tt|u|rb|rp|rt|ruby|nowiki)\b[^&gt;]*&gt;&lt;\/\1&gt; */g, '$1');
	obj.html = obj.html.replace(/[\s\u0000]*&lt;(blockquote|center|div|math|gallery|noinclude|includeonly|ref|references)\b[^&gt;]*&gt;&lt;\/\1&gt;[\s\u0000]*/g, '\u0000\u0000');

// remove empty lines from div tags
	obj.html = obj.html.replace(/(&lt;div\b[^&gt;]*&gt;)[\s\u0000]+/g, '$1');
	obj.html = obj.html.replace(/[\s\u0000]+(&lt;\/div&gt;)/g, '$1');

// escape &lt; &gt;
	obj.html = obj.html.replace(/&lt;/g, '&amp;lt;');
	obj.html = obj.html.replace(/&gt;/g, '&amp;gt;');

// newlines to &lt;br /&gt;
	obj.html = obj.html.replace(/\n{2,}\u0000+\n/g, '\n\n');
	obj.html = obj.html.replace(/\n\u0000+\n{2,}/g, '\n\n');
	obj.html = obj.html.replace(/\u0000+\n{2,}/g, '\n\n');
	obj.html = obj.html.replace(/\n{2,}\u0000+/g, '\n\n');
	obj.html = obj.html.replace(/\u0000+\n/g, '\n');
	obj.html = obj.html.replace(/\n\u0000+/g, '\n');
	obj.html = obj.html.replace(/\u0000{2,}/g, '\n\n');
	obj.html = obj.html.replace(/\u0000/g, '\n');
	obj.html = obj.html.replace(/\n/g, '&lt;br /&gt;');

	return;
}


//
// WikEdSanitizeAttributes: see Sanitizer.php
//

function WikEdSanitizeAttributes(tag, attributes, relaxed) {
	var common;
	var tablealign;
	var tablecell;
	var table;
	if (relaxed == true) {
		common = 'lang|dir|style|class'; // not needed: id|title
		tablealign = '|align|char|charoff|valign';
		table = '|summary|width|border|frame|rules|cellspacing|cellpadding|align|bgcolor';
		tablecell = '|abbr|axis|headers|scope|rowspan|colspan|nowrap|width|height|bgcolor';
	}
	else {
		common = 'lang|dir';
		table = '|border|cellspacing|cellpadding|align|bgcolor';
		tablealign = '|align|valign';
		tablecell = '|rowspan|colspan|nowrap|bgcolor';
	}
	tag = tag.toLowerCase();
	var sanitized = '';
	var regExp = /(\w+)\s*=\s*(\'|\&quot;)([^\'\&quot;]*)(\'|\&quot;)/g;
	var regExpMatch;
	while (regExpMatch = regExp.exec(attributes)) {
		var attrib = regExpMatch[1];
		var attribValue = regExpMatch[3];
		if (attribValue == '') {
			continue;
		}
		var valid = false;

// relaxed
		if (relaxed == true) {
			if ('center|em|strong|cite|code|var|sub|supdl|dd|dt|tt|b|i|big|small|strike|s|u|rb|rp|ruby'.indexOf(tag) &gt;= 0) {
				if (common.indexOf(attrib) &gt;= 0) { valid = true; }
			}
			else if ('div|span|h1|h2|h3|h4|h5|h6|p'.indexOf(tag) &gt;= 0) {
				if ((common + '|align').indexOf(attrib) &gt;= 0) { valid = true; }
			}
			else if ('blockquote'.indexOf(tag) &gt;= 0) {
				if ((common + '|cite').indexOf(attrib) &gt;= 0) { valid = true; }
			}
			else if ('br'.indexOf(tag) &gt;= 0) {
				if ('style|clear'.indexOf(attrib) &gt;= 0) { valid = true; }
			}
			else if ('pre'.indexOf(tag) &gt;= 0) {
				if ((common + '|width').indexOf(attrib) &gt;= 0) { valid = true; }
			}
			else if ('ins|del'.indexOf(tag) &gt;= 0) {
				if ((common + '|cite|datetime').indexOf(attrib) &gt;= 0) { valid = true; }
			}
			else if ('ul'.indexOf(tag) &gt;= 0) {
				if ((common + '|type').indexOf(attrib) &gt;= 0) { valid = true; }
			}
			else if ('ol'.indexOf(tag) &gt;= 0) {
				if ((common + '|type|start').indexOf(attrib) &gt;= 0) { valid = true; }
			}
			else if ('li'.indexOf(tag) &gt;= 0) {
				if ((common + '|type|value').indexOf(attrib) &gt;= 0) { valid = true; }
			}
			else if ('table'.indexOf(tag) &gt;= 0) {
				if ((common + table).indexOf(attrib) &gt;= 0) { valid = true; }
			}
			else if ('caption'.indexOf(tag) &gt;= 0) {
				if ((common + '|align').indexOf(attrib) &gt;= 0) { valid = true; }
			}
			else if ('thead|tfoot|tbody'.indexOf(tag) &gt;= 0) {
				if ((common + tablealign).indexOf(attrib) &gt;= 0) { valid = true; }
			}
			else if ('colgroup|col'.indexOf(tag) &gt;= 0) {
				if ((common + '|span|width' + tablealign).indexOf(attrib) &gt;= 0) { valid = true; }
			}
			else if ('tr'.indexOf(tag) &gt;= 0) {
				if ((common + '|bgcolor' + tablealign).indexOf(attrib) &gt;= 0) { valid = true; }
			}
			else if ('td|th'.indexOf(tag) &gt;= 0) {
				if ((common + tablecell + tablealign).indexOf(attrib) &gt;= 0) { valid = true; }
			}
			else if ('font'.indexOf(tag) &gt;= 0) {
				if ((common + '|size|color|face').indexOf(attrib) &gt;= 0) { valid = true; }
			}
			else if ('hr'.indexOf(tag) &gt;= 0) {
				if ((common + '|noshade|size|width').indexOf(attrib) &gt;= 0) { valid = true; }
			}
			else if ('rt'.indexOf(tag) &gt;= 0) {
				if ((common + '|rbspan').indexOf(attrib) &gt;= 0) { valid = true; }
			}
			else if ('ref'.indexOf(tag) &gt;= 0) {
				if (('name').indexOf(attrib) &gt;= 0) { valid = true; }
			}
			else if ('references'.indexOf(tag) &gt;= 0) {
			}
		}

// strict
		else {
			if ('center|em|strong|cite|code|var|sub|supdl|dd|dt|tt|b|i|big|small|strike|s|u|rb|rp|ruby|blockquote|pre|ins|del'.indexOf(tag) &gt;= 0) {
				if (common.indexOf(attrib) &gt;= 0) { valid = true; }
			}
			else if ('div|span|h1|h2|h3|h4|h5|h6|p'.indexOf(tag) &gt;= 0) {
				if ((common + '|align').indexOf(attrib) &gt;= 0) { valid = true; }
			}
			else if ('br'.indexOf(tag) &gt;= 0) {
				if ('clear'.indexOf(attrib) &gt;= 0) { valid = true; }
			}
			else if ('ul'.indexOf(tag) &gt;= 0) {
				if ((common + '|type').indexOf(attrib) &gt;= 0) { valid = true; }
			}
			else if ('ol'.indexOf(tag) &gt;= 0) {
				if ((common + '|type|start').indexOf(attrib) &gt;= 0) { valid = true; }
			}
			else if ('li'.indexOf(tag) &gt;= 0) {
				if ((common + '|type|value').indexOf(attrib) &gt;= 0) { valid = true; }
			}
			else if ('table'.indexOf(tag) &gt;= 0) {
				if ((common + table).indexOf(attrib) &gt;= 0) { valid = true; }
			}
			else if ('caption'.indexOf(tag) &gt;= 0) {
				if ((common + '|align').indexOf(attrib) &gt;= 0) { valid = true; }
			}
			else if ('thead|tfoot|tbody'.indexOf(tag) &gt;= 0) {
				if ((common + tablealign).indexOf(attrib) &gt;= 0) { valid = true; }
			}
			else if ('colgroup|col'.indexOf(tag) &gt;= 0) {
				if ((common + '|span' + tablealign).indexOf(attrib) &gt;= 0) { valid = true; }
			}
			else if ('tr'.indexOf(tag) &gt;= 0) {
				if ((common + '|bgcolor' + tablealign).indexOf(attrib) &gt;= 0) { valid = true; }
			}
			else if ('td|th'.indexOf(tag) &gt;= 0) {
				if ((common + tablecell + tablealign).indexOf(attrib) &gt;= 0) { valid = true; }
			}
			else if ('font'.indexOf(tag) &gt;= 0) {
				if ((common + '|color').indexOf(attrib) &gt;= 0) { valid = true; }
			}
			else if ('hr'.indexOf(tag) &gt;= 0) {
				if ((common + '|noshade|size').indexOf(attrib) &gt;= 0) { valid = true; }
			}
			else if ('rt'.indexOf(tag) &gt;= 0) {
				if ((common + '|rbspan').indexOf(attrib) &gt;= 0) { valid = true; }
			}
			else if ('ref'.indexOf(tag) &gt;= 0) {
				if (('name').indexOf(attrib) &gt;= 0) { valid = true; }
			}
			else if ('references'.indexOf(tag) &gt;= 0) {
			}
		}

		if (valid == true) {

// remove non-standard styles and clean up
			if (attrib == 'style') {
				attribValue = attribValue.replace(/(^| )(-moz-[\w\-]+): [\w\-]+; */g, '$1');
				attribValue = attribValue.replace(/(^| )([\w\-]+): [^;]*(-moz-[\w\-]+|windowtext)[^;]*; */g, '$1');
				attribValue = attribValue.replace(/\b0(%|in|cm|mm|em|ex|pt|pc|px)\b/g, '0');
				attribValue = attribValue.replace(/[\w\-]+ *\: *\; */g, '');
				attribValue = attribValue.replace(/ *(;|:) */g, '$1 ');
				attribValue = attribValue.replace(/( |;)+$/g, ';');
			}
			else if (attrib == 'class') {
				attribValue = attribValue.replace(/^Ms.*$/g, '');
			}
			if (attribValue != '') {
				sanitized += ' ' + attrib + '=&quot;' + attribValue + '&quot;';
			}
		}
	}
	return(sanitized);
}


//
//
// WikEdRemoveHighlighting: remove syntax highlighting in obj.plain; sets obj.htmlCode if text contains html code
//

function WikEdRemoveHighlighting(obj) {

// remove highlighting and atttribute-free span tags
	var isRemove = [];
	obj.html = obj.html.replace(/(&lt;(\/?)span\b([^&gt;]*)&gt;)/g,
		function (p, p1, p2, p3) {
			if (p2 == '') {
				if (/\bclass=\&quot;wikEd\w+\&quot;/.test(p3)) {
					isRemove.push(true);
					return('');
				}
				isRemove.push(false);
				return(p1);
			}
			if (isRemove.pop() == true) {
				return('');
			}
			return(p1);
		}
	);

// remove highlighting div tags
	var isRemove = [];
	obj.html = obj.html.replace(/(&lt;(\/?)div\b([^&gt;]*)&gt;)/g,
		function (p, p1, p2, p3) {
			if (p2 == '') {
				if (/\bclass=\&quot;wikEd\w+\&quot;/.test(p3)) {
					isRemove.push(true);
					return('');
				}
				isRemove.push(false);
				return(p1);
			}
			if (isRemove.pop() == true) {
				return('');
			}
			return(p1);
		}
	);

// remove highlighting and pre tags
	var isRemove = [];
	obj.html = obj.html.replace(/(&lt;(\/?)pre\b([^&gt;]*)&gt;)/g,
		function (p, p1, p2, p3) {
			if (p2 == '') {
				if (/\bclass=\&quot;wikEd\w+\&quot;/.test(p3)) {
					isRemove.push(true);
					return('');
				}
				isRemove.push(false);
				return(p1);
			}
			if (isRemove.pop() == true) {
				return('');
			}
			return(p1);
		}
	);

// comments
	obj.html = obj.html.replace(/&lt;!--wikEd\w+--&gt;/g, '');
	obj.html = obj.html.replace(/\n|\r/g, '');

// check for pasted html content
	if (obj.html.match(/&lt;(?!br\b)/)) {
		obj.htmlCode = true;
	}
	else {
		obj.htmlCode = false;
	}

	return;
}


//
//
// WikEdHighlightSyntax: highlight syntax in obj.html; if singleLine is set, no block syntax will be highlighted; call WikEdRemoveHighlighting first
//   expects &lt; &gt; &amp;lt; &amp;gt; &amp;amp;  spaces instead of &amp;nbsp;  \n instead of &lt;br /&gt;

function WikEdHighlightSyntax(obj, singleLine) {

// block elements

// various blocks
	if (singleLine != true) {
		obj.html = obj.html.replace(/(&amp;lt;(blockquote|center|div|pre)\b.*?&amp;gt;)/gi, '&lt;span class=&quot;wikEdBlock&quot;&gt;$1');
		obj.html = obj.html.replace(/(&amp;lt;\/(blockquote|center|div|pre)\b.*?&amp;gt;)/gi, '$1&lt;/span&gt;&lt;!--wikEdBlock--&gt;');
	}

// lists * # : ;
	obj.html = obj.html.replace(/^([\*\#\:\;]+)(.*?)$/gm, '&lt;span class=&quot;wikEdListLine&quot;&gt;&lt;span class=&quot;wikEdListTag&quot;&gt;$1&lt;/span&gt;&lt;!--wikEdListTag--&gt;$2&lt;/span&gt;&lt;!--wikEdListLine--&gt;');
	if (singleLine != true) {
		obj.html = obj.html.replace(/((&lt;span class=\&quot;wikEdListLine\&quot;&gt;[^\n]*\n)+)/g, '&lt;span class=&quot;wikEdListBlock&quot;&gt;$1');
		obj.html = obj.html.replace(/(&lt;span class=\&quot;wikEdListLine\&quot;&gt;[^\n]*)(\n)(?!&lt;span class=\&quot;wikEdListLine\&quot;&gt;)/g, '$1&lt;/span&gt;&lt;!--wikEdListBlock--&gt;$2');
	}


// #redirect (finish)
	obj.html = obj.html.replace(/(&lt;span class=\&quot;wikEdWikiRedir\&quot;&gt;)(.*?&lt;\/span&gt;&lt;!--wikEdWikiRedir--&gt;)/g, '$1#$2');

// space-pre
	if (singleLine != true) {
		obj.html = obj.html.replace(/^ ( *)(.*?)$/gm, '&lt;span class=&quot;wikEdSpaceLine&quot;&gt;&lt;span class=&quot;wikEdSpaceTag&quot;&gt;&amp;nbsp;$1&lt;/span&gt;&lt;!--wikEdSpaceTag--&gt;$2&lt;/span&gt;&lt;!--wikEdSpaceLine--&gt;');
		obj.html = obj.html.replace(/((&lt;span class=\&quot;wikEdSpaceLine\&quot;&gt;[^\n]*\n)+)/g, '&lt;span class=&quot;wikEdSpaceBlock&quot;&gt;$1');
		obj.html = obj.html.replace(/(&lt;span class=\&quot;wikEdSpaceLine\&quot;&gt;[^\n]*)(\n)(?!&lt;span class=&quot;wikEdSpaceLine&quot;&gt;)/g, '$1&lt;/span&gt;&lt;!--wikEdSpaceBlock--&gt;$2');
	}

// ---- &lt;hr&gt; horizontal rule
	obj.html = obj.html.replace(/(^|\n|&lt;[^&gt;]*&gt;)(----)(\n|&lt;[^&gt;]*&gt;|$)/g, '$1&lt;span class=&quot;wikEdHR&quot;&gt;$2&lt;/span&gt;&lt;!--wikEdHR--&gt;$3');
	obj.html = obj.html.replace(/(&amp;lt;hr&amp;gt;)/g, '&lt;span class=&quot;wikEdHRInline&quot;&gt;$1&lt;/span&gt;&lt;!--wikEdHRInline--&gt;');

// == headings
	obj.html = obj.html.replace(/(^|\n|&lt;[^&gt;]*&gt;)(=+ *)([^\n]*?)( *=+ *)(\n|&lt;[^&gt;]*&gt;|$)/g,
		function (p, p1, p2, p3, p4, p5) {
			p2 = p2.replace(/(=+)/g, '&lt;span class=&quot;wikEdWiki&quot;&gt;$1&lt;/span&gt;&lt;!--wikEdWiki--&gt;');
			p4 = p4.replace(/(=+)/g, '&lt;span class=&quot;wikEdWiki&quot;&gt;$1&lt;/span&gt;&lt;!--wikEdWiki--&gt;');
			if ( /^(external links?|see also|references?)$/i.test(p3) ) {
				p1 = p1 + '&lt;span class=&quot;wikEdHeadingWp&quot;&gt;';
				p5 = '&lt;/span&gt;&lt;!--wikEdHeadingWp--&gt;' + p5;
			}
			else {
				p1 = p1 + '&lt;span class=&quot;wikEdHeading&quot;&gt;';
				p5 = '&lt;/span&gt;&lt;!--wikEdHeading--&gt;' + p5;
			}
			return(p1 + p2 + p3 + p4 + p5);
		}
	);

// tables                         {|   |+   |-   !  |}   |
	obj.html = obj.html.replace(/^(\{\||\|\+|\|\-|\!|\|\}|\|)(.*?)$/gm, '&lt;span class=&quot;wikEdTableLine&quot;&gt;&lt;span class=&quot;wikEdTableTag&quot;&gt;$1&lt;/span&gt;&lt;!--wikEdTableTag--&gt;$2&lt;/span&gt;&lt;!--wikEdTableLine--&gt;');
	if (singleLine != true) {
		obj.html = obj.html.replace(/(^|\n)((&lt;[^&gt;]*&gt;)*\{\|)/g, '$1&lt;span class=&quot;wikEdTableBlock&quot;&gt;$2');
		obj.html = obj.html.replace(/(^|\n)((&lt;[^&gt;]*&gt;)*\|\}(&lt;[^&gt;]*&gt;)*)/g, '$1$2&lt;/span&gt;&lt;!--wikEdTableBlock--&gt;');
		obj.html = obj.html.replace(/(&amp;lt;table\b.*?&amp;gt;)/gi, '&lt;span class=&quot;wikEdTableBlock&quot;&gt;$1');
		obj.html = obj.html.replace(/(&amp;lt;\/table\b.*?&amp;gt;)/gi, '$1&lt;/span&gt;&lt;!--wikEdTableBlock--&gt;');
	}

// &lt;gallery&gt; wiki markup
	if (singleLine != true) {
		obj.html = obj.html.replace(/(&amp;lt;(gallery)\b.*?&amp;gt;)/gi, '&lt;span class=&quot;wikEdWiki&quot;&gt;$1');
		obj.html = obj.html.replace(/(&amp;lt;\/(gallery)\b.*?&amp;gt;)/gi, '$1&lt;/span&gt;&lt;!--wikEdWiki--&gt;');
	}

// various block tags
	obj.html = obj.html.replace(/(&amp;lt;\/?(blockquote|center|div|pre)\b.*?&amp;gt;)/gi, '&lt;span class=&quot;wikEdBlockTag&quot;&gt;$1&lt;/span&gt;&lt;!--wikEdBlockTag--&gt;');
// This line is numbered 4661
// &lt;p&gt; ... &lt;/p&gt; pairs with (wikEdBlockTag) and withhout attributes (wikEdUnknown)
	var isRemove = [];
	obj.html = obj.html.replace(/(&amp;lt;(\/?)p\b(.*?)&amp;gt;)/g,
		function (p, p1, p2, p3) {
			if (p2 == '') {
				if (p3 == '') {
					isRemove.push(true);
					return('&lt;span class=&quot;wikEdUnknown&quot;&gt;' + p1 + '&lt;/span&gt;&lt;!--wikEdUnknown--&gt;');
				}
				if (/\/$/.test(p3)) {
					return('&lt;span class=&quot;wikEdUnknown&quot;&gt;' + p1 + '&lt;/span&gt;&lt;!--wikEdUnknown--&gt;');
				}
				isRemove.push(false);
				return('&lt;span class=&quot;wikEdBlockTag&quot;&gt;' + p1 + '&lt;/span&gt;&lt;!--wikEdBlockTag--&gt;');
			}
			if (isRemove.pop() == true) {
				return('&lt;span class=&quot;wikEdUnknown&quot;&gt;' + p1 + '&lt;/span&gt;&lt;!--wikEdUnknown--&gt;');
			}
			return('&lt;span class=&quot;wikEdBlockTag&quot;&gt;' + p1 + '&lt;/span&gt;&lt;!--wikEdBlockTag--&gt;');
		}
	);

// inline elements

// &lt;sup&gt; &lt;/sub&gt; &lt;ins&gt; &lt;del&gt;
	obj.html = obj.html.replace(/((&amp;lt;)sup\b.*?(&amp;gt;)(.*?)(&amp;lt;)\/sup\b.*?(&amp;gt;))/gi, '&lt;span class=&quot;wikEdSuperscript&quot;&gt;$1&lt;/span&gt;&lt;!--wikEdSuperscript--&gt;');
	obj.html = obj.html.replace(/((&amp;lt;)sub\b.*?(&amp;gt;)(.*?)(&amp;lt;)\/sub\b.*?(&amp;gt;))/gi, '&lt;span class=&quot;wikEdSubscript&quot;&gt;$1&lt;/span&gt;&lt;!--wikEdSubscript--&gt;');
	obj.html = obj.html.replace(/((&amp;lt;)(ins|u)\b.*?(&amp;gt;)(.*?)(&amp;lt;)\/(ins|u)\b.*?(&amp;gt;))/gi, '&lt;span class=&quot;wikEdIns&quot;&gt;$1&lt;/span&gt;&lt;!--wikEdIns--&gt;');
	obj.html = obj.html.replace(/((&amp;lt;)(del|s|strike)\b.*?(&amp;gt;)(.*?)(&amp;lt;)\/(del|s|strike)\b.*?(&amp;gt;))/gi, '&lt;span class=&quot;wikEdDel&quot;&gt;$1&lt;/span&gt;&lt;!--wikEdDel--&gt;');

// various inline tags
	obj.html = obj.html.replace(/(&amp;lt;\/?(sub|sup|ins|u|del|s|strike|big|br|colgroup|code|font|small|span|tt|rb|rp|rt|ruby)\b.*?&amp;gt;)/gi, '&lt;span class=&quot;wikEdInlineTag&quot;&gt;$1&lt;/span&gt;&lt;!--wikEdInlineTag--&gt;');

// unsupported or not needed &lt;&gt; tags
	obj.html = obj.html.replace(/(&amp;lt;\/?)(\w+)(.*?\/?&amp;gt;)/g,
		function (p, p1, p2, p3) {
			if ( ! /^(col|thead|tfoot|tbody|big|br|blockquote|colgroup|center|code|del|div|font|ins|p|pre|s|small|span|strike|sub|sup|tt|u|rb|rp|rt|ruby|nowiki|math|gallery|noinclude|includeonly|ref|references)$/i.test(p2) ) {
				p1 = '&lt;span class=&quot;wikEdUnknown&quot;&gt;' + p1;
				p3 = p3 + '&lt;/span&gt;&lt;!--wikEdUnknown--&gt;';
			}
			return(p1 + p2 + p3);
		}
	);

// comments
	obj.html = obj.html.replace(/(&amp;lt;!--.*?--&amp;gt;)/g, '&lt;span class=&quot;wikEdComment&quot;&gt;$1&lt;/span&gt;&lt;!--wikEdComment--&gt;');

// &lt;nowiki&gt; &lt;math&gt; &lt;noinclude&gt; &lt;includeonly&gt; &lt;ref&gt; &lt;references&gt; wiki markup
	obj.html = obj.html.replace(/((&amp;lt;)(nowiki|math|gallery|noinclude|includeonly|ref|references)\b.*?(&amp;gt;)(.*?)(&amp;lt;)\/(nowiki|math|gallery|noinclude|includeonly|ref|references)\b.*?(&amp;gt;))/gi, '&lt;span class=&quot;wikEdWiki&quot;&gt;$1&lt;/span&gt;&lt;!--wikEdWiki--&gt;');

// URLs, allowed chars: \w / . &amp; ? = - @ # % ~ + (; allowed because of &amp;amp; and common misuse)
	obj.html = obj.html.replace(/((http:\/\/|https:\/\/|ftp:\/\/|irc:\/\/|gopher:\/\/|news:|mailto:)[^\u0000-\u0020\!\&quot;\$\'\(\)\*\,\:\&lt;\&gt;\[\\\]\^\`\{-\|\}\u007f-\uffff]*)/gi,
		function (p, p1, p2) {
			p1 = p1.replace(/(.*)/, '&lt;span class=&quot;wikEdURLLink&quot;&gt;$1&lt;/span&gt;&lt;!--wikEdURLLink--&gt;');
			return(p1);
		}
	);

// URLs with text
	obj.html = obj.html.replace(/(\[)( *&lt;span class=\&quot;wikEdURLLink\&quot;&gt;.*?&lt;\!--wikEdURLLink--&gt; *)([^\]\n]*?)( *\])/gi,
		function (p, p1, p2, p3, p4) {

// link text
			p3 = p3.replace(/(.*)/, '&lt;span class=&quot;wikEdURLText&quot;&gt;$1&lt;/span&gt;&lt;!--wikEdURLText--&gt;');

// link tags
			p1 = p1.replace(/(\[)/, '&lt;span class=&quot;wikEdLinkTag&quot;&gt;$1&lt;/span&gt;&lt;!--wikEdLinkTag--&gt;');
			p4 = p4.replace(/(\])/, '&lt;span class=&quot;wikEdLinkTag&quot;&gt;$1&lt;/span&gt;&lt;!--wikEdLinkTag--&gt;');

			return(p1 + p2 + p3 + p4);
		}
	);

// [[ ]] links, images, categories
	obj.html = obj.html.replace(/(\[\[)([^\]]*)(\]\])/g,
		function (p, p1, p2, p3) {

// image
//////////////   detect common uploads
			var regExpImg = new RegExp('^\\s*' + wikEdText['wikicode Image'] + '\\s*:', 'i');
			var regExpCat = new RegExp('^\\s*' + wikEdText['wikicode Category'] + '\\s*:', 'i');
			if (regExpImg.test(p2)) {
				var regExp = new RegExp('\\s*\\w+\\s*:\\s*' + wikEdText['wikicode Image'] + '\\s*:', 'i');
				if (p2.match(regExp)) {
					p1 = '&lt;span class=&quot;wikEdImageInter&quot;&gt;' + p1;
					p3 = p3 + '&lt;/span&gt;&lt;!--wikEdImageInter--&gt;';
				}
				else {
					p1 = '&lt;span class=&quot;wikEdImage&quot;&gt;' + p1;
					p3 = p3 + '&lt;/span&gt;&lt;!--wikEdImage--&gt;';
				}
				p2 = p2.replace(/^(\s*)(.*:)+/, '$1&lt;span class=&quot;wikEdInter&quot;&gt;$2&lt;/span&gt;&lt;!--wikEdInter--&gt;');
				p2 = p2.replace(/(\s*)([^&gt;:\|]+)(\s*\|\s*|$)/, '$1&lt;span class=&quot;wikEdImageName&quot;&gt;$2&lt;/span&gt;&lt;!--wikEdImageName--&gt;$3');
				p2 = p2.replace(/(\|\s*)(.*)/,
					function (p, p1, p2) {
						p2 = p2.replace(/(.*?)(\s*(\||$))/g, '&lt;span class=&quot;wikEdImageText&quot;&gt;$1&lt;/span&gt;&lt;!--wikEdImageText--&gt;$2');
						return(p1 + p2);
					}
				);
			}

// category
			else if (regExpCat.test(p2)) {
				var regExp = new RegExp('\\s*\\w+\\s*:\\s*' + wikEdText['wikicode Category'] + '\\s*:', 'i');
				if (p2.match(regExp)) {
					p1 = '&lt;span class=&quot;wikEdCatInter&quot;&gt;' + p1;
					p3 = p3 + '&lt;/span&gt;&lt;!--wikEdCatInter--&gt;';
				}
				else {
					p1 = '&lt;span class=&quot;wikEdCat&quot;&gt;' + p1;
					p3 = p3 + '&lt;/span&gt;&lt;!--wikEdCat--&gt;';
				}
				p2 = p2.replace(/^(\s*)(.*:)+/, '$1&lt;span class=&quot;wikEdInter&quot;&gt;$2&lt;/span&gt;&lt;!--wikEdInter--&gt;');
				p2 = p2.replace(/(\s*)([^&gt;:\|]+)(\s*\|\s*|$)/, '$1&lt;span class=&quot;wikEdCatName&quot;&gt;$2&lt;/span&gt;&lt;!--wikEdCatName--&gt;$3');
				p2 = p2.replace(/(\|\s*)(.*)/,
					function (p, p1, p2) {
						p2 = p2.replace(/(.*?)(\s*(\||$))/g, '&lt;span class=&quot;wikEdCatText&quot;&gt;$1&lt;/span&gt;&lt;!--wikEdCatText--&gt;$2');
						return(p1 + p2);
					}
				);
			}

// wikilink
			else {
				if (p2.match(/^\s*\w+\s*:/)) {
					p1 = '&lt;span class=&quot;wikEdLinkInter&quot;&gt;' + p1;
					p3 = p3 + '&lt;/span&gt;&lt;!--wikEdLinkInter--&gt;';
				}
				else {
					p1 = '&lt;span class=&quot;wikEdLink&quot;&gt;' + p1;
					p3 = p3 + '&lt;/span&gt;&lt;!--wikEdLink--&gt;';
				}
				p2 = p2.replace(/^(\s*)(.*:)+/, '$1&lt;span class=&quot;wikEdInter&quot;&gt;$2&lt;/span&gt;&lt;!--wikEdInter--&gt;');
				p2 = p2.replace(/(\s*)([^&gt;:\|]+)(\s*\|\s*|$)/, '$1&lt;span class=&quot;wikEdLinkName&quot;&gt;$2&lt;/span&gt;&lt;!--wikEdLinkName--&gt;$3');
				p2 = p2.replace(/(\|\s*)(.*)/,
					function (p, p1, p2) {
						p2 = p2.replace(/(.*?)(\s*(\||$))/g, '&lt;span class=&quot;wikEdLinkText&quot;&gt;$1&lt;/span&gt;&lt;!--wikEdLinkText--&gt;$2');
						return(p1 + p2);
					}
				);
			}

// link tags
			p1 = p1.replace(/(\[+)/, '&lt;span class=&quot;wikEdLinkTag&quot;&gt;$1&lt;/span&gt;&lt;!--wikEdLinkTag--&gt;');
			p2 = p2.replace(/(\|)/gi, '&lt;span class=&quot;wikEdLinkTag&quot;&gt;$1&lt;/span&gt;&lt;!--wikEdLinkTag--&gt;');
			p3 = p3.replace(/(\]+)/, '&lt;span class=&quot;wikEdLinkTag&quot;&gt;$1&lt;/span&gt;&lt;!--wikEdLinkTag--&gt;');
			return(p1 + p2 + p3);
		}
	);

// {{ }}, {{{ }}} templates
	obj.html = obj.html.replace(/(\{\{+)([^\}]*)(\}\}+)/g,
		function (p, p1, p2, p3) {
			if (p2.match(/^\s*\w+\s*:/)) {
				p1 = '&lt;span class=&quot;wikEdTemplInter&quot;&gt;' + p1;
				p3 = p3 + '&lt;/span&gt;&lt;!--wikEdTemplInter--&gt;';
			}
			else {
				p1 = '&lt;span class=&quot;wikEdTempl&quot;&gt;' + p1;
				p3 = p3 + '&lt;/span&gt;&lt;!--wikEdTempl--&gt;';
			}
			p2 = p2.replace(/^(\s*)(.*:)+/, '$1&lt;span class=&quot;wikEdInter&quot;&gt;$2&lt;/span&gt;&lt;!--wikEdInter--&gt;');
			p2 = p2.replace(/(\s*)([^&gt;:\|]+)(\s*\|\s*|$)/, '$1&lt;span class=&quot;wikEdTemplName&quot;&gt;$2&lt;/span&gt;&lt;!--wikEdTemplName--&gt;$3');
			p2 = p2.replace(/(\|\s*)(.*)/,
				function (p, p1, p2) {
					p2 = p2.replace(/(.*?)(\s*(\||$))/g, '&lt;span class=&quot;wikEdTemplText&quot;&gt;$1&lt;/span&gt;&lt;!--wikEdTemplText--&gt;$2');
					return(p1 + p2);
				}
			);

// template tags
			p1 = p1.replace(/(\{+)/, '&lt;span class=&quot;wikEdLinkTag&quot;&gt;$1&lt;/span&gt;&lt;!--wikEdLinkTag--&gt;');
			p2 = p2.replace(/(\|)/g, '&lt;span class=&quot;wikEdLinkTag&quot;&gt;$1&lt;/span&gt;&lt;!--wikEdLinkTag--&gt;');
			p3 = p3.replace(/(\}+)/, '&lt;span class=&quot;wikEdLinkTag&quot;&gt;$1&lt;/span&gt;&lt;!--wikEdLinkTag--&gt;');
			return(p1 + p2 + p3);
		}
	);

// #redirect
	obj.html = obj.html.replace(/(^|\n)(#)(redirect\b)/g, '$1&lt;span class=&quot;wikEdWikiRedir&quot;&gt;$3&lt;/span&gt;&lt;!--wikEdWikiRedir--&gt;');


/////////// blocks original place

// &lt;b&gt; &lt;i&gt;
	obj.html = obj.html.replace(/(\'\'\')(\'*)(.*?)(\'*)(\'\'\')/g, '&lt;span class=&quot;wikEdBold&quot;&gt;$2$3$4&lt;/span&gt;&lt;!--wikEdBold--&gt;');
	obj.html = obj.html.replace(/(\'\')(.*?)(\'\')/g, '&lt;span class=&quot;wikEdItalic&quot;&gt;$1$2$3&lt;/span&gt;&lt;!--wikEdItalic--&gt;');
	obj.html = obj.html.replace(/(&lt;span class=\&quot;wikEdBold\&quot;&gt;)/g, '$1\'\'\'');
	obj.html = obj.html.replace(/(&lt;\/span&gt;&lt;!--wikEdBold--&gt;)/g, '\'\'\'$1');
	obj.html = obj.html.replace(/(\'{2,})/g, '&lt;span class=&quot;wikEdWiki&quot;&gt;$1&lt;/span&gt;&lt;!--wikEdWiki--&gt;');

// named colors
	obj.html = obj.html.replace(/(\b(red|orange|yellow|fuchsia|white|lime|aqua|silver)\b)/g, '&lt;span style=&quot;background-color: $1;&quot; class=&quot;wikEdColors&quot;&gt;$1&lt;/span&gt;&lt;!--wikEdColors--&gt;');
	obj.html = obj.html.replace(/(\b(maroon|olive|purple|green|navy|teal|blue|black|gray)\b)/g, '&lt;span style=&quot;color: white; background-color: $1;&quot; class=&quot;wikEdColors&quot;&gt;$1&lt;/span&gt;&lt;!--wikEdColors--&gt;');

// RGB colors
	obj.html = obj.html.replace(/(#[0-9a-fA-F]{6})([\s\'\&quot;;])/g, '&lt;span style=&quot;background-color: $1;&quot; class=&quot;wikEdColors&quot;&gt;$1&lt;/span&gt;&lt;!--wikEdColors--&gt;$2');
	obj.html = obj.html.replace(/(rgb\(\s*\d+,\s*\d+,\s*\d+\s*\))/gi, '&lt;span style=&quot;background-color: $1;&quot; class=&quot;wikEdColors&quot;&gt;$1&lt;/span&gt;&lt;!--wikEdColors--&gt;');

// display control chars with popup title
	var regExpStr = '';
	for (var decimalValue in wikEdControlChars) {
		regExpStr += String.fromCharCode(decimalValue);
	}
	var regExp = new RegExp('([' + regExpStr + '])', 'g');
	obj.html = obj.html.replace(regExp,
		function (p, p1) {
			if (p1 == '\u0009') {
				p1 =  '&lt;span class=&quot;wikEdTab&quot; title=&quot;' + wikEdControlChars[p1.charCodeAt(0).toString()] + '&quot;&gt;' + p1 + '&lt;/span&gt;&lt;!--wikEdTab--&gt;';
			}
			else if (p1 != '\u000a') {
				p1 = '&lt;span class=&quot;wikEdCtrl&quot; title=&quot;' + wikEdControlChars[p1.charCodeAt(0).toString()] + '&quot;&gt;' + p1 + '&lt;/span&gt;&lt;!--wikEdCtrl--&gt;';
			}
			return(p1);
		}
	);

// display strange spaces with popup title
	var regExpStr = '';
	for (var decimalValue in wikEdStrangeSpaces) {
		regExpStr += String.fromCharCode(decimalValue);
	}
	var regExp = new RegExp('([' + regExpStr + '])', 'g');
	obj.html = obj.html.replace(regExp,
		function (p, p1) {
			if (p1 != '\u000a') {
				p1 = '&lt;span class=&quot;wikEdBlank&quot; title=&quot;' + wikEdStrangeSpaces[p1.charCodeAt(0).toString()] + '&quot;&gt;' + p1 + '&lt;/span&gt;&lt;!--wikEdBlank--&gt;';
			}
			return(p1);
		}
	);

// remove comments
	if (wikEdRemoveHighlightComments == true) {
		obj.html = obj.html.replace(/&lt;!--wikEd\w+--&gt;/g, '');
	}

	return;
}



//
// WikEdUpdateTextarea: copy frame content to textarea
//

function WikEdUpdateTextarea() {

// get frame content
	var obj = {};
	obj.html = wikEdFrameBody.innerHTML;
	obj.html = obj.html.replace(/(&lt;br\b[^&gt;]*&gt;)\n* */g, '$1');

// textify so that no html formatting is submitted
	WikEdTextify(obj);
	obj.plain = obj.plain.replace(/&amp;nbsp;/g, ' ');
	obj.plain = obj.plain.replace(/&amp;lt;/g, '&lt;');
	obj.plain = obj.plain.replace(/&amp;gt;/g, '&gt;');
	obj.plain = obj.plain.replace(/&amp;amp;/g, '&amp;');

// copy to textarea
	wikEdTextarea.value = obj.plain;

	return;
}


//
// WikEdUpdateFrame: copy textarea content to frame
//

function WikEdUpdateFrame() {

// get frame content
	var obj = {};
	obj.html = wikEdTextarea.value;
	obj.html = obj.html.replace(/&amp;/g, '&amp;amp;');
	obj.html = obj.html.replace(/&gt;/g, '&amp;gt;');
	obj.html = obj.html.replace(/&lt;/g, '&amp;lt;');

// highlight the syntax
	if (wikEdHighlightSyntax == true) {
		WikEdHighlightSyntax(obj);
	}

// display tabs
	else {
		obj.html = obj.html.replace(/(\t)/g, '&lt;span class=&quot;wikEdTabPlain&quot;&gt;$1&lt;/span&gt;&lt;!--wikEdTabPlain--&gt;');
	}

// multiple blanks to blank-&amp;nbsp;
	obj.html = obj.html.replace(/  /g, '&amp;nbsp; ');
	obj.html = obj.html.replace(/  /g, '&amp;nbsp; ');
	obj.html = obj.html.replace(/ \n/g, '&amp;nbsp;\n');

// newlines to &lt;br /&gt;
	obj.html = obj.html.replace(/\n/g, '&lt;br /&gt;');

// set frame content
	wikEdFrameBody.innerHTML = obj.html;

	return;
}


//
// WikEdKeyFrame: event handler for key and mouse events in the frame
//

function WikEdKeyFrame(event) {

	if ( (wikEdDisabled == false) &amp;&amp; (wikEdUseWikEd == true) ) {
		switch (event.type) {

// trap the tab key
			case 'keydown':
				switch (event.keyCode) {
					case 9:
						if (event.shiftKey == false) {
							event.preventDefault();

// scroll to text input top
							if (wikEdFullScreenMode == false) {
								var wikEdInputWrapper = document.getElementById('wikEdInputWrapper');
								var inputWrapperTop = WikEdGetOffsetTop(wikEdInputWrapper);
								window.scroll(0, inputWrapperTop);
							}

// focus the summary
							wikEdSummaryText.focus();
						}
						break;
				}
				break;

// trap any other frame event
			case 'keyup':
			case 'keypress':
			case 'mouseup':

// grey out inactive buttons
				WikEdInactiveButtons();

// reset the frame DOM cache
				wikEdFrameDOMCache = null;
				break;
		}
	}

	return;
}


//
// WikEdFrameExecCommand: wrapper for execCommand method
//

function WikEdFrameExecCommand(command, option) {

	wikEdFrameDocument.execCommand(command, false, option);
	return;
}


//
// WikEdFindAhead: non-regexp and case-insensitive find-as-you-type, event handler for find field
//

function WikEdFindAhead() {

	if (wikEdFindAhead.checked == true) {

// get the find text
		var findText = wikEdFindText.value;
		if (findText == '') {
			return;
		}

// remember position
		var sel = wikEdFrameWindow.getSelection();
		var range = sel.getRangeAt(sel.rangeCount - 1).cloneRange();
		var rangeClone = range.cloneRange();
		var frameSrollTop = wikEdFrameBody.scrollTop;

// function: window.find(string, caseSensitive, backwards, wrapAround, wholeWord, searchInFrames, showDialog)
		sel.removeAllRanges();
		sel.addRange(range);
		range.collapse(true);

// function: window.find(string, caseSensitive, backwards, wrapAround, wholeWord, searchInFrames, showDialog)
		var found = wikEdFrameWindow.find(findText, false, false, true, false, false, false);

// start from top if not found
		if (found == false) {

// set cursor to start and search again
			sel.collapse(wikEdFrameBody, 0);
			found = wikEdFrameWindow.find(findText, false, false, true, false, false, false);

// add original selection
			if (found == false) {
				wikEdFrameBody.scrollTop = frameSrollTop;
				sel.removeAllRanges();
				sel.addRange(rangeClone);
			}
		}
	}
	return;
}


//
// WikEdMainSwitch: onclick handler for program logo
//

function WikEdMainSwitch() {


// enable wikEd
	if (wikEdDisabled == true) {
		wikEdDisabled = false;
		WikEdSetLogo();
		var cookieExpire = new Date();
		cookieExpire.setTime(cookieExpire.getTime() - 60 * 60 * 1000);
		WikEdSetCookie('wikEdDisabled', '', cookieExpire.toGMTString(), '/');

// turn rich text frame on
		if (wikEdLoaded == true) {
			WikEdUpdateFrame();
			WikEdSetEditArea(true);
			wikEdButtonsControl.style.display = 'block';
			wikEdButtonsPreview.style.display = 'block';
			wikEdButtonsJump.style.display = 'block';
		}

// setup wikEd
		else {
			WikEdSetup(false);
			return;
		}
	}

// disable wikEd
	else {
		wikEdDisabled = true;
		WikEdSetLogo();
		var cookieExpire = new Date();
		cookieExpire.setTime(cookieExpire.getTime() + wikEdCookieExpireSec * 1000);
		WikEdSetCookie('wikEdDisabled', 'true', cookieExpire.toGMTString(), '/');
		if (wikEdLoaded == true) {
			if (wikEdFullScreenMode == true) {
				WikEdFullScreen(false);
			}

// turn classic textarea on
			WikEdUpdateTextarea();
			WikEdSetEditArea(false);
			wikEdButtonsControl.style.display = 'none';
			wikEdButtonsPreview.style.display = 'none';
			wikEdLocalPrevWrapper.style.display = 'none';
			wikEdButtonsJump.style.display = 'none';
		}
	}

	return;
}


//
// WikEdFullScreen: change to fullscreen edit area  or back to normal view
//

function WikEdFullScreen(fullscreen, notFrame) {

// get dom nodes
	var wikEdButtonsPreview = document.getElementById('wikEdButtonsPreview');

// hide or show elements
	var displayStyle;
	if (fullscreen == true) {
		displayStyle = 'none';
	}
	else {
		displayStyle = 'block';
	}

// elements above input wrapper
	var node = document.getElementById('editform').previousSibling;
	while (node != null) {
		if ( (node.nodeName == 'DIV') || (node.nodeName == 'H3') ) {
			node.style.display = displayStyle;
		}
		node = node.previousSibling;
	}
	document.getElementsByTagName('H1')[0].style.display = displayStyle;

// divs below input wrapper
	var node = wikEdInputWrapper.nextSibling;
	while (node != null) {
		if (node.nodeName == 'DIV') {
			node.style.display = displayStyle;
		}
		node = node.nextSibling;
	}

// divs below input wrapper, some levels up
	var node = document.getElementById('column-one');
	while (node != null) {
		if (node.nodeName == 'DIV') {
			node.style.display = displayStyle;
		}
		node = node.nextSibling;
	}

// insert wrapper
	document.getElementById('wikEdInsertWrapper').style.display = displayStyle;

// change styles
	if (fullscreen) {
		if (notFrame != true) {
			wikEdInputWrapper.className = 'wikEdInputWrapperFull';
		}
		wikEdButtonsPreview.className = 'wikEdButtonsPreviewFull';
	}
	else {
		if (notFrame != true) {
			wikEdInputWrapper.className = 'wikEdInputWrapper';
		}
		wikEdButtonsPreview.className = 'wikEdButtonsPreview';
	}

// resize the frame
		if (fullscreen) {
			var consoleTop = WikEdGetOffsetTop(wikEdConsoleWrapper);
			var consoleHeight = wikEdConsoleWrapper.offsetHeight;
			var frameHeight = wikEdFrame.offsetHeight;
			var windowHeight = window.innerHeight;
			var windowWidth = window.innerWidth;
			var frameHeightNew =  frameHeight + (windowHeight - (consoleTop + consoleHeight) ) - 2;
			wikEdFrame.style.height = frameHeightNew + 'px';
		}
		else {
			wikEdFrame.style.height = wikEdTextareaHeight + 'px';
		}

// scroll to edit-frame
	if (fullscreen == false) {
		window.scroll(0, WikEdGetOffsetTop(wikEdInputWrapper) - 2);
	}

// set the fullscreen button state
	WikEdButton('wikEdFullScreen', null, fullscreen);

// grey out or re-activate scroll-to buttons
	var buttonClass;
	if (fullscreen) {
		buttonClass = 'wikEdButtonInactive';
	}
	else {
		buttonClass = 'wikEdButton';
	}
	document.getElementById('wikEdScrollToInput').className = buttonClass;
	document.getElementById('wikEdScrollToInput2').className = buttonClass;
	document.getElementById('wikEdScrollToButtons').className = buttonClass;
	document.getElementById('wikEdScrollToButtons2').className = buttonClass;

	wikEdFullScreenMode = fullscreen;

	return;
}


//
// WikEdResizeComboInput: set the size of the background select boxes so that the button is visible
//

function WikEdResizeComboInput(field) {

// add a dummy option
	var dummy;
	if (wikEdSelectElement[field].options.length == 0) {
		wikEdSelectElement[field].options[0] = new Option('');
		dummy = true;
	}

// set option widths to 0
	for (i = 0; i &lt; wikEdSelectElement[field].options.length; i ++) {
		wikEdSelectElement[field].options[i].style.width = '0';
	}

// calculate select width
	var inputWidth = wikEdInputElement[field].clientWidth;
	var selectWidth = wikEdSelectElement[field].clientWidth;
	var optionWidth = wikEdSelectElement[field].options[0].offsetWidth;
	var border = wikEdInputElement[field].offsetWidth - wikEdInputElement[field].clientWidth;
	wikEdSelectElement[field].style.width = (selectWidth - optionWidth + inputWidth - border) + 'px';

// delete dummy option
	if (dummy == true) {
		wikEdSelectElement[field].options[0] = null;
	}

// set option widths to auto
	for (i = 0; i &lt; wikEdSelectElement[field].options.length; i ++) {
		wikEdSelectElement[field].options[i].style.width = 'auto';
	}
	return;
}


//
// WikEdChangeComboInput: set the input value to selected option; onchange event handler for select boxes
//

function WikEdChangeComboInput(field) {

// get selection index (-1 for unselected)
	var selected = wikEdSelectElement[field].selectedIndex;
	if (selected &gt;= 0) {

// get selected option
		var option = wikEdSelectElement[field].options[selected];
		if (option.text != '') {

// add a tag to the summary box
			if (field == 'summary') {
				wikEdInputElement[field].value = WikEdAppendToSummary(wikEdInputElement[field].value, option.text);
			}

// add case and regexp checkboxes to find / replace fields
			else if (option.value == 'setcheck') {
				WikEdButton('wikEdCaseSensitive', null, (option.text.charAt(0) == wikEdCheckMarker[true]) );
				WikEdButton('wikEdRegExp',        null, (option.text.charAt(1) == wikEdCheckMarker[true]) );
				wikEdInputElement[field].value = option.text.substr(3);
			}

// add option text
			else {
				wikEdInputElement[field].value = option.text;
			}
		}
	}

// find the new text
	if ( (field == 'find') &amp;&amp; (wikEdFindAhead.checked == true) ) {
		WikEdFindAhead();
	}

	return;
}


//
// WikEdAppendToSummary: append a phrase to the summary text
//

function WikEdAppendToSummary(summary, append) {

	summary = summary.replace(/^[, ]+/, '');
	summary = summary.replace(/[, ]+$/, '');
	if (summary != '') {
		if (summary.match(/ \*\/$/) != null) {
			summary += ' ';
		}
		else if (summary.match(/[\.\;\:]$/) != null) {
			summary += ' ';
		}
		else if (summary.match(/^[\w\(\)\&quot;\'\+\-]/) == null) {
			summary += ' ';
		}
		else {
			summary += ', ';
		}
	}
	summary += append;

	return(summary);
}


//
// WikEdAddToHistory: add an input value to the cookie history
//

function WikEdAddToHistory(field) {

	if (wikEdInputElement[field].value != '') {

// load history from cookie
		WikEdLoadHistoryFromCookie(field);

// add current value to history
		wikEdFieldHist[field].unshift(wikEdInputElement[field].value);

// add case and regexp checkboxes to find / replace value
		if ( (field == 'find') || (field == 'replace') ) {
			wikEdFieldHist[field][0] =
				wikEdCheckMarker[ document.getElementById('wikEdCaseSensitive').checked ] +
				wikEdCheckMarker[ document.getElementById('wikEdRegExp').checked ] +
				' ' + wikEdFieldHist[field][0];
		}

// remove paragraph names from summary
		if (field == 'summary') {
			wikEdFieldHist[field][0] = wikEdFieldHist[field][0].replace(/^\/\* .*? \*\/ */, '');
		}

// remove multiple old copies from history
		i = 1;
		while (i &lt; wikEdFieldHist[field].length) {
			if (wikEdFieldHist[field][i] == wikEdFieldHist[field][0]) {
				wikEdFieldHist[field].splice(i, 1);
			}
			else {
				i ++;
			}
		}

// remove new value if it is a preset value
		if (wikEdComboPresetOptions[field] != null) {
			i = 0;
			while (i &lt; wikEdComboPresetOptions[field].length) {
				if (wikEdComboPresetOptions[field][i] == wikEdFieldHist[field][0]) {
					wikEdFieldHist[field].shift();
					break;
				}
				else {
					i ++;
				}
			}
		}

// cut history number to maximal history length
		wikEdFieldHist[field] = wikEdFieldHist[field].slice(0, wikEdHistoryLength[field]);

// saved history to cookie
		if (wikEdFieldHist[field][0] != '') {
			WikEdSaveHistoryToCookie(field);
		}
	}
	return;
}


//
// WikEdSetComboOptions: generate the select options from cookie history; onfocus handler for select box
//

function WikEdSetComboOptions(field) {

// load history from cookie
	WikEdLoadHistoryFromCookie(field);

	var option = {};
	var selected = null;

// delete options
	var options = wikEdSelectElement[field].options;
	for (i = 0; i &lt; options.length; i ++) {
		wikEdSelectElement[field].remove(i);
	}

// delete optgroup
	option = document.getElementById(field + 'Optgroup');
	if (option != null) {
		wikEdSelectElement[field].removeChild(option);
	}

// workaround for onchange not firing when selecting first option from unselected dropdown
	option = document.createElement('option');
	option.style.display = 'none';
	j = 0;
	wikEdSelectElement[field].options[j++] = option;

// add history entries
	for (i = 0; i &lt; wikEdFieldHist[field].length; i ++) {
		if (wikEdFieldHist[field][i] != null) {
			if (wikEdFieldHist[field][i] == wikEdInputElement[field].value) {
				selected = j;
			}
			option = document.createElement('option');
			option.text = wikEdFieldHist[field][i];
			if ( (field == 'find') || (field == 'replace') ) {
				option.value = 'setcheck';
			}
			wikEdSelectElement[field].options[j++] = option;
		}
	}

// add preset entries
	if (wikEdComboPresetOptions[field] != null) {
		var startPreset = j;
		for (i = 0; i &lt; wikEdComboPresetOptions[field].length; i ++) {
			if (wikEdComboPresetOptions[field][i] != null) {
				if (wikEdComboPresetOptions[field][i] == wikEdInputElement[field].value) {
					selected = j;
				}
				option = document.createElement('option');
				option.text = wikEdComboPresetOptions[field][i];
				if (field == 'summary') {
					option.text = option.text.replace(/\{wikEdUsing\}/g, wikEdSummaryUsing);
				}
				wikEdSelectElement[field].options[j++] = option;
			}
		}

// add a blank separator
		if (startPreset &gt; 1) {
			option = document.createElement('optgroup');
			option.label = '\u00a0';
			option.id = field + 'Optgroup';
			wikEdSelectElement[field].insertBefore(option, wikEdSelectElement[field].options[startPreset]);
		}
	}

// set the selection
	wikEdSelectElement[field].selectedIndex = selected;
	return;
}


//
// WikEdClearHistory: clear the history of combo input fields
//

function WikEdClearHistory(field) {
	var cookieExpire = new Date();
	cookieExpire.setTime( cookieExpire.getTime() + wikEdCookieExpireSec * 1000 );
	WikEdSetCookie(wikEdCookieName[field], '', cookieExpire.toGMTString(), '/');
	WikEdSetComboOptions(field);
	return;
}


//
// WikEdLoadHistoryFromCookie: get the input box history from the respective cookie
//

function WikEdLoadHistoryFromCookie(field) {
	var cookie = WikEdGetCookie(wikEdCookieName[field]);
	if (cookie != '') {
		cookie = decodeURIComponent(cookie);
		wikEdFieldHist[field] = cookie.split('\n');
	}
	else {
		wikEdFieldHist[field] = [];
	}
	return;
}


//
// WikEdSaveHistoryToCookie: save the input box history to the respective cookie
//

function WikEdSaveHistoryToCookie(field) {
	var cookieExpire = new Date();
	cookieExpire.setTime( cookieExpire.getTime() + wikEdCookieExpireSec * 1000 );
	var cookie = '';
	cookie = wikEdFieldHist[field].join('\n')
	cookie = cookie.replace(/\n$/, '');
	cookie = encodeURIComponent(cookie);
	WikEdSetCookie(wikEdCookieName[field], cookie, cookieExpire.toGMTString(), '/');
	return;
}


// WikEdGetStyle: get computed style properties for non-inline css definitions
function WikEdGetStyle(element, styleProperty) {
	var style;
	if (element != null) {
		style = document.defaultView.getComputedStyle(element, null).getPropertyValue(styleProperty);
	}
	return(style);
}


//
// WikEdGetCookie
//

function WikEdGetCookie(name) {
	var cookie = ' ' + document.cookie;
	var search = ' ' + name + '=';
	var setStr = '';
	var offset = 0;
	var end = 0;
	offset = cookie.indexOf(search);
	if (offset != -1) {
		offset += search.length;
		end = cookie.indexOf(';', offset)
		if (end == -1) {
			end = cookie.length;
		}
		setStr = cookie.substring(offset, end);
		setStr = setStr.replace(/\\+/g, ' ');
		setStr = decodeURIComponent(setStr);
	}
	return(setStr);
}


//
// WikEdSetCookie
//

function WikEdSetCookie(name, value, expires, path, domain, secure) {
	var cookie = name + '=' + encodeURIComponent(value);
	if (expires != null) {
		cookie += '; expires=' + expires
	}
	if (path != null) {
		cookie += '; path=' + path;
	}
	if (domain != null)  {
		cookie += '; domain=' + domain;
	}
	if (secure != null) {
		cookie += '; secure';
	}
	document.cookie = cookie;
}


//
// WikEdGetOffsetTop: get element offset relative to window top
//

function WikEdGetOffsetTop(element) {
	var offset = 0;
	do {
		offset += element.offsetTop;
	} while ( (element = element.offsetParent) != null );
	return(offset);
}


//
// WikEdGetOffsetLeft: get element offset relative to left window border
//

function WikEdGetOffsetLeft(element) {
	var offset = 0;
	do {
		offset += element.offsetLeft;
	} while ( (element = element.offsetParent) != null );
	return(offset);
}


// define leaf elements for WikEdGetInnerHTML
var wikEdLeafElements = [];
wikEdLeafElements['IMG'] = true;
wikEdLeafElements['HR'] = true;
wikEdLeafElements['BR'] = true;
wikEdLeafElements['INPUT'] = true;


//
// WikEdParseDOM: wikEdFrameDOMCache contains the last parse if the frame has not changed
//

function WikEdParseDOM(obj, topNode) {

/* problematic because of obj.changed //////////////////////
	if (wikEdFrameDOMCache != null) {
		obj = wikEdFrameDOMCache;
		return;
	}
*/

	obj.plainLength = 0;
	obj.plainArray = [];
	obj.plainNode = [];
	obj.plainStart = [];
	obj.plainPos = [];
	WikEdParseDOMRecursive(obj, topNode);
	obj.plain = obj.plainArray.join('');
	wikEdFrameDOMCache = obj;
	return;
}


//
// WikEdParseDOMRecursive:
//

function WikEdParseDOMRecursive(obj, currentNode) {

// cycle through the child nodes of currentNode
        var childNode, childNodeI;
	for(childNodeI in currentNode.childNodes) {
                childNode=currentNode.childNodes[childNodeI];
		if (childNode == null) {
			break;
		}

// check for selection
		if (childNode == obj.sel.focusNode) {
			obj.plainFocus = obj.plainLength + obj.sel.focusOffset;
		}
		if (childNode == obj.sel.anchorNode) {
			obj.plainAnchor = obj.plainLength + obj.sel.anchorOffset;
		}
		var value = null;

// get text of child node
		switch (childNode.nodeType) {
			case 1:
				if ( (childNode.childNodes.length == 0) &amp;&amp; (wikEdLeafElements[childNode.nodeName] == true) ) {
					if (childNode.nodeName == 'BR') {
						value = '\n';
					}
				}
				else {
					WikEdParseDOMRecursive(obj, childNode);
				}
				break;
			case 3:
				value = childNode.nodeValue;
				value = value.replace(/\n/g, ' ');
				break;
			case 5:
				value = '&amp;' + childNode.nodeName + ';';
				break;
		}

// add text to text object
		if (value != null) {

// array of text fragments
			obj.plainArray.push(value);

// array of text fragment node references
			obj.plainNode.push(childNode);

// array of text fragment text positions
			obj.plainStart.push(obj.plainLength);

// node references containing text positions
			obj.plainPos[childNode] = obj.plainLength;

// current text length
			obj.plainLength += value.length;
		}
	}
	return;
}


//
// WikEdGetInnerHTML: get the innerHTML from a document fragment
//

function WikEdGetInnerHTML(obj, currentNode) {

// initialize string
	if (obj.html == null) {
		obj.html = '';
	}
	if (obj.plain == null) {
		obj.plain = '';
	}
	if (obj.plainArray == null) {
		obj.plainArray = [];
		obj.plainNode = [];
		obj.plainStart = [];
	}

	for (var i = 0; i &lt; currentNode.childNodes.length; i ++) {
		var childNode = currentNode.childNodes.item(i);
		switch (childNode.nodeType) {
			case 1:
				obj.html += '&lt;' + childNode.nodeName.toLowerCase();
				for (var j = 0; j &lt; childNode.attributes.length; j ++) {
					if (childNode.attributes.item(j).nodeValue != null) {
						obj.html += ' ' + childNode.attributes.item(j).nodeName + '=&quot;' + childNode.attributes.item(j).nodeValue.replace(/&lt;/g, '&amp;lt;').replace(/&gt;/g, '&amp;gt;') + '&quot;';
					}
				}
				if ( (childNode.childNodes.length == 0) &amp;&amp; wikEdLeafElements[childNode.nodeName] ) {
					obj.html += '&gt;';
					if (childNode.nodeName == 'BR') {
						obj.plainArray.push('\n');
						obj.plainNode.push(childNode);
						obj.plainStart.push(obj.plain.length);
						obj.plain += '\n';
					}
				}
				else {
					obj.html += '&gt;';
					WikEdGetInnerHTML(obj, childNode);
					obj.html += '&lt;/' + childNode.nodeName.toLowerCase() + '&gt;'
				}
				break;
			case 3:
				var value = childNode.nodeValue;
				value = value.replace(/\n/g, ' '); // important for pasted page content
				obj.plainArray.push(value);        // plain array contains &amp; &lt; &gt; instead of &amp;amp; &amp;lt; &amp;gt;
				obj.plainNode.push(childNode);
				obj.plainStart.push(obj.plain.length);
				value = value.replace(/&amp;/g, '&amp;amp;');
				value = value.replace(/&lt;/g, '&amp;lt;');
				value = value.replace(/&gt;/g, '&amp;gt;');
				obj.html += value;
				obj.plain += value;
				break;
			case 4: obj.html += '&lt;![CDATA[' + childNode.nodeValue + ']]&gt;';
				break;
			case 5:
				var value = '&amp;' + childNode.nodeName + ';';
				obj.plainArray.push(value);
				obj.plainNode.push(childNode);
				obj.plainStart.push(obj.plain.length);
				value = value.replace(/&amp;/g, '&amp;amp;');
				obj.html += value;
				obj.plain += value;
				break;
			case 8: obj.html += '&lt;!--' + childNode.nodeValue + '--&gt;';
				break;
		}
	}
	return;
}


// WikEdStyleSheet: create a new style sheet object
function WikEdStyleSheet(documentObject) {

	this.styleElement = null;
	if (documentObject == null) {
		documentObject = document;
	}

// IE
	if (documentObject.createStyleSheet) {
		this.styleElement = documentObject.createStyleSheet();
	}

// standards compliant browsers
	else {
		this.styleElement = documentObject.createElement('style');
		this.styleElement.from = 'text/css';
		var insert = documentObject.getElementsByTagName('head')[0];
		if (insert != null) {
			insert.appendChild(this.styleElement);
		}
	}

// add-a-rule method

// IE
	this.addRule = function(selector, declaration) {
		if (this.styleElement.addRule) {
			this.styleElement.addRule(selector, declaration);
		}

// standards compliant browsers
		else {
			if (this.styleElement.sheet != null) {
				if (this.styleElement.sheet.insertRule != null) {
					this.styleElement.sheet.insertRule(selector + ' { ' + declaration + ' } ', 0);
				}
			}
		}
	};
	return;
}


// WED: shortcut for WikEdDebug
function WED(objectName, object) {

	WikEdDebug(objectName, object);
	return;
}

// WEDBA: tracing function that puts up alerts
function WEDBA(value) { alert('Initializing: phase '+value); }

// WikEdDebug: print the value of variables

function WikEdDebug(objectName, object) {

	document.getElementById('wikEdTextareaWrapper').style.position = 'static';
	document.getElementById('wikEdTextareaWrapper').style.visibility = 'visible';
	wikEdTextarea.style.display = 'block';
	if (objectName == null) {
		wikEdTextarea.value = '';
		wikEdTextarea.style.height = '25em';
	}
	else {
		wikEdTextarea.value += objectName + ': ' + object + '\n';
	}
	return;
}

//This line is numbered 5856
//
// character tables used in FixUnicode()
//   see http://kmi.open.ac.uk/projects/ceryle/doc/docs/NOTE-charents.html
//   removed because of internal use: &lt; ['003c', 'lt']; &gt; ['003e', 'gt']; &amp; ['0026', 'amp'], ['00a0', 'nbsp']

// supported chars in Mozilla and IE
var wikEdSupportedChars = [
	['00a1', 'iexcl'],  // ¡
	['00a2', 'cent'],   // ¢
	['00a3', 'pound'],  // £
	['00a4', 'curren'], // ¤
	['00a5', 'yen'],    // ¥
	['00a6', 'brvbar'], // ¦
	['00a7', 'sect'],   // §
	['00a8', 'uml'],    // ¨
	['00a9', 'copy'],   // ©
	['00aa', 'ordf'],   // ª
	['00ab', 'laquo'],  // «
	['00ac', 'not'],    // ¬
	['00ae', 'reg'],    // ®
	['00af', 'macr'],   // ¯
	['00b0', 'deg'],    // °
	['00b1', 'plusmn'], // ±
	['00b2', 'sup2'],   // ²
	['00b3', 'sup3'],   // ³
	['00b4', 'acute'],  // ´
	['00b5', 'micro'],  // µ
	['00b6', 'para'],   // ¶
	['00b7', 'middot'], // ·
	['00b8', 'cedil'],  // ¸
	['00b9', 'sup1'],   // ¹
	['00ba', 'ordm'],   // º
	['00bb', 'raquo'],  // »
	['00bc', 'frac14'], // ¼
	['00bd', 'frac12'], // ½
	['00be', 'frac34'], // ¾
	['00bf', 'iquest'], // ¿
	['00c0', 'Agrave'], // À
	['00c1', 'Aacute'], // Á
	['00c2', 'Acirc'],  // Â
	['00c3', 'Atilde'], // Ã
	['00c4', 'Auml'],   // Ä
	['00c5', 'Aring'],  // Å
	['00c6', 'AElig'],  // Æ
	['00c7', 'Ccedil'], // Ç
	['00c8', 'Egrave'], // È
	['00c9', 'Eacute'], // É
	['00ca', 'Ecirc'],  // Ê
	['00cb', 'Euml'],   // Ë
	['00cc', 'Igrave'], // Ì
	['00cd', 'Iacute'], // Í
	['00ce', 'Icirc'],  // Î
	['00cf', 'Iuml'],   // Ï
	['00d0', 'ETH'],    // Ð
	['00d1', 'Ntilde'], // Ñ
	['00d2', 'Ograve'], // Ò
	['00d3', 'Oacute'], // Ó
	['00d4', 'Ocirc'],  // Ô
	['00d5', 'Otilde'], // Õ
	['00d6', 'Ouml'],   // Ö
	['00d7', 'times'],  // ×
	['00d8', 'Oslash'], // Ø
	['00d9', 'Ugrave'], // Ù
	['00da', 'Uacute'], // Ú
	['00db', 'Ucirc'],  // Û
	['00dc', 'Uuml'],   // Ü
	['00dd', 'Yacute'], // Ý
	['00de', 'THORN'],  // Þ
	['00df', 'szlig'],  // ß
	['00e0', 'agrave'], // à
	['00e1', 'aacute'], // á
	['00e2', 'acirc'],  // â
	['00e3', 'atilde'], // ã
	['00e4', 'auml'],   // ä
	['00e5', 'aring'],  // å
	['00e6', 'aelig'],  // æ
	['00e7', 'ccedil'], // ç
	['00e8', 'egrave'], // è
	['00e9', 'eacute'], // é
	['00ea', 'ecirc'],  // ê
	['00eb', 'euml'],   // ë
	['00ec', 'igrave'], // ì
	['00ed', 'iacute'], // í
	['00ee', 'icirc'],  // î
	['00ef', 'iuml'],   // ï
	['00f0', 'eth'],    // ð
	['00f1', 'ntilde'], // ñ
	['00f2', 'ograve'], // ò
	['00f3', 'oacute'], // ó
	['00f4', 'ocirc'],  // ô
	['00f5', 'otilde'], // õ
	['00f6', 'ouml'],   // ö
	['00f7', 'divide'], // ÷
	['00f8', 'oslash'], // ø
	['00f9', 'ugrave'], // ù
	['00fa', 'uacute'], // ú
	['00fb', 'ucirc'],  // û
	['00fc', 'uuml'],   // ü
	['00fd', 'yacute'], // ý
	['00fe', 'thorn'],  // þ
	['00ff', 'yuml'],   // ÿ
	['0027', 'apos'],   // '
	['0022', 'quot'],   // &quot;
	['0152', 'OElig'],  // Œ
	['0153', 'oelig'],  // œ
	['0160', 'Scaron'], // Š
	['0161', 'scaron'], // š
	['0178', 'Yuml'],   // Ÿ
	['02c6', 'circ'],   // ˆ
	['02dc', 'tilde'],  // ˜
	['2013', 'ndash'],  // –
	['2014', 'mdash'],  // —
	['2018', 'lsquo'],  // ‘
	['2019', 'rsquo'],  // ’
	['201a', 'sbquo'],  // ‚
	['201c', 'ldquo'],  // “
	['201d', 'rdquo'],  // ”
	['201e', 'bdquo'],  // „
	['2020', 'dagger'], // †
	['2021', 'Dagger'], // ‡
	['2030', 'permil'], // ‰
	['2039', 'lsaquo'], // ‹
	['203a', 'rsaquo'], // ›
	['20ac', 'euro'],   // €
	['0192', 'fnof'],   // ƒ
	['0391', 'Alpha'],  // Α
	['0392', 'Beta'],   // Β
	['0393', 'Gamma'],  // Γ
	['0394', 'Delta'],  // Δ
	['0395', 'Epsilon'],// Ε
	['0396', 'Zeta'],   // Ζ
	['0397', 'Eta'],    // Η
	['0398', 'Theta'],  // Θ
	['0399', 'Iota'],   // Ι
	['039a', 'Kappa'],  // Κ
	['039b', 'Lambda'], // Λ
	['039c', 'Mu'],     // Μ
	['039d', 'Nu'],     // Ν
	['039e', 'Xi'],     // Ξ
	['039f', 'Omicron'],// Ο
	['03a0', 'Pi'],     // Π
	['03a1', 'Rho'],    // Ρ
	['03a3', 'Sigma'],  // Σ
	['03a4', 'Tau'],    // Τ
	['03a5', 'Upsilon'],// Υ
	['03a6', 'Phi'],    // Φ
	['03a7', 'Chi'],    // Χ
	['03a8', 'Psi'],    // Ψ
	['03a9', 'Omega'],  // Ω
	['03b1', 'alpha'],  // α
	['03b2', 'beta'],   // β
	['03b3', 'gamma'],  // γ
	['03b4', 'delta'],  // δ
	['03b5', 'epsilon'],// ε
	['03b6', 'zeta'],   // ζ
	['03b7', 'eta'],    // η
	['03b8', 'theta'],  // θ
	['03b9', 'iota'],   // ι
	['03ba', 'kappa'],  // κ
	['03bb', 'lambda'], // λ
	['03bc', 'mu'],     // μ
	['03bd', 'nu'],     // ν
	['03be', 'xi'],     // ξ
	['03bf', 'omicron'],// ο
	['03c0', 'pi'],     // π
	['03c1', 'rho'],    // ρ
	['03c2', 'sigmaf'], // ς
	['03c3', 'sigma'],  // σ
	['03c4', 'tau'],    // τ
	['03c5', 'upsilon'],// υ
	['03c6', 'phi'],    // φ
	['03c7', 'chi'],    // χ
	['03c8', 'psi'],    // ψ
	['03c9', 'omega'],  // ω
	['2022', 'bull'],   // •
	['2026', 'hellip'], // …
	['2032', 'prime'],  // ′
	['2033', 'Prime'],  // ″
	['203e', 'oline'],  // ‾
	['2044', 'frasl'],  // ⁄
	['2122', 'trade'],  // ™
	['2190', 'larr'],   // ←
	['2191', 'uarr'],   // ↑
	['2192', 'rarr'],   // →
	['2193', 'darr'],   // ↓
	['2194', 'harr'],   // ↔
	['21d2', 'rArr'],   // ⇒
	['21d4', 'hArr'],   // ⇔
	['2200', 'forall'], // ∀
	['2202', 'part'],   // ∂
	['2203', 'exist'],  // ∃
	['2207', 'nabla'],  // ∇
	['2208', 'isin'],   // ∈
	['220b', 'ni'],     // ∋
	['220f', 'prod'],   // ∏
	['2211', 'sum'],    // ∑
	['2212', 'minus'],  // −
	['221a', 'radic'],  // √
	['221d', 'prop'],   // ∝
	['221e', 'infin'],  // ∞
	['2220', 'ang'],    // ∠
	['2227', 'and'],    // ∧
	['2228', 'or'],     // ∨
	['2229', 'cap'],    // ∩
	['222a', 'cup'],    // ∪
	['222b', 'int'],    // ∫
	['2234', 'there4'], // ∴
	['223c', 'sim'],    // ∼
	['2248', 'asymp'],  // ≈
	['2260', 'ne'],     // ≠
	['2261', 'equiv'],  // ≡
	['2264', 'le'],     // ≤
	['2265', 'ge'],     // ≥
	['2282', 'sub'],    // ⊂
	['2283', 'sup'],    // ⊃
	['2286', 'sube'],   // ⊆
	['2287', 'supe'],   // ⊇
	['2295', 'oplus'],  // ⊕
	['22a5', 'perp'],   // ⊥
	['25ca', 'loz'],    // ◊
	['2660', 'spades'], // ♠
	['2663', 'clubs'],  // ♣
	['2665', 'hearts'], // ♥
	['2666', 'diams']   // ♦
];

// special chars (spaces and invisible characters)
//
var wikEdSpecialChars = [
	['2002', 'ensp'],   //   en space
	['00ad', 'shy'],    // ­ soft hyphen
	['2003', 'emsp'],   //   em space
	['2009', 'thinsp'], //    thin space
	['200c', 'zwnj'],   // ‌ zero width non-joiner
	['200d', 'zwj'],    // ‍ zero width joiner
	['200e', 'lrm'],    // ‎ left-to-right mark
	['200f', 'rlm']     // ‏ right-to-left mark
];

// unsupported chars in IE6
var wikEdProblemChars = [
	['03d1', 'thetasym'], // ϑ
	['03d2', 'upsih'],    // ϒ
	['03d6', 'piv'],      // ϖ
	['2118', 'weierp'],   // ℘
	['2111', 'image'],    // ℑ
	['211c', 'real'],     // ℜ
	['2135', 'alefsym'],  // ℵ
	['21b5', 'crarr'],    // ↵
	['21d0', 'lArr'],     // ⇐
	['21d1', 'uArr'],     // ⇑
	['21d3', 'dArr'],     // ⇓
	['2205', 'empty'],    // ∅
	['2209', 'notin'],    // ∉
	['2217', 'lowast'],   // ∗
	['2245', 'cong'],     // ≅
	['2284', 'nsub'],     // ⊄
	['22a5', 'perp'],     // ⊥
	['2297', 'otimes'],   // ⊗
	['22c5', 'sdot'],     // ⋅
	['2308', 'lceil'],    // ⌈
	['2309', 'rceil'],    // ⌉
	['230a', 'lfloor'],   // ⌊
	['230b', 'rfloor'],   // ⌋
	['2329', 'lang'],     // 〈
	['232a', 'rang']      // 〉
];

// ASCII control characters and invisibles, used for syntax highlighting
var wikEdControlChars = {
	'0': 'null',
	'1': 'start of heading',
	'2': 'start of text',
	'3': 'end of text',
	'4': 'end of transmission',
	'5': 'enquiry',
	'6': 'acknowledge',
	'7': 'bell',
	'8': 'backspace',
	'9': 'horizontal tab',
	'10': 'line feed, new line',
	'11': 'vertical tab',
	'12': 'form feed, new page',
	'13': 'carriage return',
	'14': 'shift out',
	'15': 'shift in',
	'16': 'data link escape',
	'17': 'device control 1',
	'18': 'device control 2',
	'19': 'device control 3',
	'20': 'device control 4',
	'21': 'negative acknowledge',
	'22': 'synchronous idle',
	'23': 'end of trans. block',
	'24': 'cancel',
	'25': 'end of medium',
	'25': 'substitute',
	'26': 'escape',
	'27': 'file separator',
	'28': 'group separator',
	'29': 'record separator',
	'30': 'unit separator',
	'173' : 'soft hyphen',           // \u00ad
	'8204': 'zero width non-joiner', // \u200c
	'8205': 'zero width joiner',     // \u200d
	'8206': 'left-to-right mark',    // \u200e
	'8207': 'right-to-left mark',    // \u200f
	'8232': 'line separator',        // \u2028
	'8233': 'paragraph separator'    // \u2028
};

// strange spaces, used for syntax highlighting
var wikEdStrangeSpaces = {
	'31': 'non-breaking space', // \u00a0
	'8194': 'en space',         // \u2002
	'8195': 'em space',         // \u2003
	'8201': 'thin space'        // \u2009
};

// &lt;/nowiki&gt;&lt;/pre&gt;
</pre><div class="printfooter">
Retrieved from "<a href="http://en.wikipedia.org../../../a/i/s/User%7EAis523_wikEd.js_4421.html">http://en.wikipedia.org../../../a/i/s/User%7EAis523_wikEd.js_4421.html</a>"</div>
	    	    <!-- end content -->
	    <div class="visualClear"></div>
	  </div>
	</div>
      </div>
      <div id="column-one">
	<div id="p-cactions" class="portlet">
	  <h5>Views</h5>
	  <ul>
	    <li id="ca-nstab-user"
	       class="selected"	       ><a href="../../../a/i/s/User%7EAis523_wikEd.js_4421.html">User page</a></li><li id="ca-talk"
	       class="new"	       ><a href="../../../a/i/s/User_talk%7EAis523_wikEd.js_e2a0.html">Discussion</a></li><li id="ca-current"
	       	       ><a href="http://en.wikipedia.org/wiki/User:Ais523/wikEd.js">Current revision</a></li>	  </ul>
	</div>
	<div class="portlet" id="p-logo">
	  <a style="background-image: url(../../../images/wiki-en.png);"
	    href="../../../index.html"
	    title="Main Page"></a>
	</div>
	<script type="text/javascript"> if (window.isMSIE55) fixalpha(); </script>
		<div class='portlet' id='p-navigation'>
	  <h5>Navigation</h5>
	  <div class='pBody'>
	    <ul>
	    	      <li id="n-Main-page"><a href="../../../index.html">Main page</a></li>
	     	      <li id="n-Contents"><a href="../../../c/o/n/Wikipedia%7EContents_3181.html">Contents</a></li>
	     	      <li id="n-Featured-content"><a href="../../../f/e/a/Wikipedia%7EFeatured_content_24ba.html">Featured content</a></li>
	     	      <li id="n-currentevents"><a href="../../../c/u/r/Portal%7ECurrent_events_bb60.html">Current events</a></li>
	     	    </ul>
	  </div>
	</div>
		<div class='portlet' id='p-interaction'>
	  <h5>interaction</h5>
	  <div class='pBody'>
	    <ul>
	    	      <li id="n-About-Wikipedia"><a href="../../../a/b/o/Wikipedia%7EAbout_8d82.html">About Wikipedia</a></li>
	     	      <li id="n-portal"><a href="../../../c/o/m/Wikipedia%7ECommunity_Portal_6a3c.html">Community portal</a></li>
	     	      <li id="n-contact"><a href="../../../c/o/n/Wikipedia%7EContact_us_afd6.html">Contact us</a></li>
	     	      <li id="n-sitesupport"><a href="http://wikimediafoundation.org/wiki/Fundraising">Make a donation</a></li>
	     	      <li id="n-help"><a href="../../../c/o/n/Help%7EContents_22de.html">Help</a></li>
	     	    </ul>
	  </div>
	</div>
		<div id="p-search" class="portlet">
	  <h5><label for="searchInput">Search</label></h5>
	  <div id="searchBody" class="pBody">
	    <form action="javascript:goToStatic(3)" id="searchform"><div>
	      <input id="searchInput" name="search" type="text"
	        accesskey="f" value="" />
	      <input type='submit' name="go" class="searchButton" id="searchGoButton"
	        value="Go" />
	    </div></form>
	  </div>
	</div>
	      </div><!-- end of the left (by default at least) column -->
      <div class="visualClear"></div>
      <div id="footer">
    <div id="f-poweredbyico"><a href="http://www.mediawiki.org/"><img src="../../../skins/common/images/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" /></a></div>	<div id="f-copyrightico"><a href="http://wikimediafoundation.org/"><img src="../../../images/wikimedia-button.png" border="0" alt="Wikimedia Foundation"/></a></div>	<ul id="f-list">
	  	  	  <li id="f-credits">This page was last modified 10:33, 14 December 2006 by Wikipedia user <a href="../../../a/i/s/User%7EAis523_9dee.html" title="User:Ais523">Ais523</a>. </li>	  <li id="f-copyright">All text is available under the terms of the <a class='internal' href="../../../t/e/x/Wikipedia%7EText_of_the_GNU_Free_Documentation_License_702a.html" title="Wikipedia:Text of the GNU Free Documentation License">GNU Free Documentation License</a>. (See <b><a class='internal' href="../../../c/o/p/Wikipedia%7ECopyrights_92c4.html" title="Wikipedia:Copyrights">Copyrights</a></b> for details.) <br /> Wikipedia&reg; is a registered trademark of the <a href="http://www.wikimediafoundation.org">Wikimedia Foundation, Inc</a>., a US-registered <a class='internal' href="../../../5/0/1/501%28c%29.html#501.28c.29.283.29" title="501(c)(3)">501(c)(3)</a> <a href="http://wikimediafoundation.org/wiki/Deductibility_of_donations">tax-deductible</a> <a class='internal' href="../../../n/o/n/Non-profit_organization.html" title="Non-profit organization">nonprofit</a> <a href="../../../c/h/a/Charitable_organization.html" title="Charitable organization">charity</a>.<br /></li>	  <li id="f-about"><a href="../../../a/b/o/Wikipedia%7EAbout_8d82.html" title="Wikipedia:About">About Wikipedia</a></li>	  <li id="f-disclaimer"><a href="../../../g/e/n/Wikipedia%7EGeneral_disclaimer_3e44.html" title="Wikipedia:General disclaimer">Disclaimers</a></li>	  	</ul>
      </div>
    </div>
  </body>
</html>
