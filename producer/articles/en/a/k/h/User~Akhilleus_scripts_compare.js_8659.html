<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    		<meta name="keywords" content="User:Akhilleus/scripts/compare.js,Bypass your cache" />
		<link rel="shortcut icon" href="/favicon.ico" />
		<link rel="search" type="application/opensearchdescription+xml" href="/w/opensearch_desc.php" title="Wikipedia (English)" />
		<link rel="copyright" href="../../../COPYING.html" />
    <title>User:Akhilleus/scripts/compare.js - Wikipedia, the free encyclopedia</title>
    <style type="text/css">/*<![CDATA[*/ @import "../../../skins/htmldump/main.css"; /*]]>*/</style>
    <link rel="stylesheet" type="text/css" media="print" href="../../../skins/common/commonPrint.css" />
    <!--[if lt IE 5.5000]><style type="text/css">@import "../../../skins/monobook/IE50Fixes.css";</style><![endif]-->
    <!--[if IE 5.5000]><style type="text/css">@import "../../../skins/monobook/IE55Fixes.css";</style><![endif]-->
    <!--[if IE 6]><style type="text/css">@import "../../../skins/monobook/IE60Fixes.css";</style><![endif]-->
    <!--[if IE]><script type="text/javascript" src="../../../skins/common/IEFixes.js"></script>
    <meta http-equiv="imagetoolbar" content="no" /><![endif]-->
    <script type="text/javascript" src="../../../skins/common/wikibits.js"></script>
    <script type="text/javascript" src="../../../skins/htmldump/md5.js"></script>
    <script type="text/javascript" src="../../../skins/htmldump/utf8.js"></script>
    <script type="text/javascript" src="../../../skins/htmldump/lookup.js"></script>
    <script type="text/javascript" src="../../../raw/gen.js"></script>        <style type="text/css">/*<![CDATA[*/
@import "../../../raw/MediaWiki%7ECommon.css";
@import "../../../raw/MediaWiki%7EMonobook.css";
@import "../../../raw/gen.css";
/*]]>*/</style>          </head>
  <body
    class="ns-2">
    <div id="globalWrapper">
      <div id="column-content">
	<div id="content">
	  <a name="top" id="contentTop"></a>
	        <h1 class="firstHeading">User:Akhilleus/scripts/compare.js</h1>
	  <div id="bodyContent">
	    <h3 id="siteSub">From Wikipedia, the free encyclopedia</h3>
	    <div id="contentSub"><span class="subpages">&lt; <a href="../../../a/k/h/User%7EAkhilleus_723e.html" title="User:Akhilleus">User:Akhilleus</a> | scripts</span></div>
	    	    <div class="usermessage">You have <a href="../../../1/2/7/User_talk%7E127.0.0.1.html" title="User talk:127.0.0.1">new messages</a> (<a href="../../../1/2/7/User_talk%7E127.0.0.1.html" title="User talk:127.0.0.1">last change</a>).</div>	    <!-- start content -->
	    <p><span id="clearyourcache"><b>Note:</b> After saving, you have to <a href="../../../b/y/p/Wikipedia%7EBypass_your_cache_1dae.html" title="Wikipedia:Bypass your cache">bypass your browser's cache</a> to see the changes. <b>Firefox/Mozilla/Safari:</b> hold down <i>Shift</i> while clicking <i>Reload</i> (or press <i>Ctrl-Shift-R</i>), <b>Internet Explorer:</b> press <i>Ctrl-F5</i>, <b>Opera/Konqueror:</b> press <i>F5</i>. 
</span>
</p><pre>//copying from [[User:Voice of All/Specialadmin/monobook.js]] so I can use the non-admin bits

//NOTE: for security override HTTP request info for IP range and commons image duplicates script:
//For FF/NS, go enable, see &quot;http://esw.w3.org/topic/SparqlCalendarDemoUsage#FAQ&quot;
//Basically, enable &quot;signed.applets.codebase_principal_support&quot; in about:config 
//Reduce IE security settings for future versions (this does not support IE yet)

var cvrollbacklink='&lt;span style=&quot;color:red;&quot;&gt;Reverting...&lt;/span&gt;';

function checkall()
{
  if (document.getElementById('bodyContent'))
    {form = document.getElementById('bodyContent');}
  else if (document.getElementById('quickbar'))
    {form = document.getElementById('content');}
  l = form.getElementsByTagName('input');
  for (i = 0 ; i &lt; l.length; i++)
    {
    if (l[i].type == 'checkbox')
      {l[i].value = '1'; l[i].checked=true;}
    }
}
//END

//
Mvaluejs_class = 'DMalak1';
Rvaluejs_class = 'ERollen2';
Uvaluejs_class = 'DRaven2';
//

//MASTER rollback
function addmasterroll()
{
  if (location.href.indexOf(':Contributions') != -1 || location.href.indexOf('&amp;title=Special%3AContribution') != -1 &amp;&amp; location.href.search(/\d{1,3}(@|%40)\d{1,2}/) == -1) 
      { 
    masterlogview(100,'creation',&quot;pages&quot;,&quot;ca-npages&quot;,&quot;Views user's new pages&quot;);
    masterlogview(100,'move',&quot;moves&quot;,&quot;ca-viewpm&quot;,&quot;Views user's page moves&quot;);
    masterlogview(50,'upload',&quot;uploads&quot;, &quot;ca-viewup&quot;, &quot;Views user's image uploads&quot;);
    addTab(&quot;javascript:masterroll()&quot;, &quot;revert all edits&quot;, &quot;ca-massroll&quot;, &quot;Rollback user's top edits&quot;, &quot;&quot;);
    document.getElementById('ca-massroll').firstChild.innerHTML = '&lt;strong&gt;&lt;span style=&quot;color:darkred;&quot;&gt;revert all edits&lt;/span&gt;&lt;/strong&gt;';
    addTab(&quot;javascript:number_count()&quot;, &quot;#&quot;, &quot;ca-numb&quot;, &quot;Number edits&quot;, &quot;&quot;);
      }
  else if (location.href.indexOf(':Contributions') != -1 || location.href.indexOf('&amp;title=Special%3AContribution') != -1 &amp;&amp; location.href.search(/\d{1,3}(@|%40)\d{1,2}/) != -1) 
      { 
    addTab(&quot;javascript:masterroll()&quot;, &quot;revert all edits&quot;, &quot;ca-massroll&quot;, &quot;Rollback top edits&quot;, &quot;&quot;);
    document.getElementById('ca-massroll').firstChild.innerHTML = '&lt;strong&gt;&lt;span style=&quot;color:darkred;&quot;&gt;revert all edits&lt;/span&gt;&lt;/strong&gt;';
      }
  else if (document.title.indexOf('Move log') != -1 &amp;&amp; location.href.search('&amp;user=[^&amp;]') !=-1) 
      { 
    addTab(&quot;javascript:movemasterroll()&quot;, &quot;revert all moves&quot;, &quot;ca-rvmoves&quot;, &quot;Reverts user's page moves&quot;, &quot;&quot;);
    document.getElementById('ca-rvmoves').firstChild.innerHTML = '&lt;strong&gt;&lt;span style=&quot;color:darkred;&quot;&gt;revert all moves&lt;/span&gt;&lt;/strong&gt;';
      }
  else if (document.title.indexOf('Upload log') != -1 &amp;&amp; location.href.search('&amp;user=[^&amp;]') !=-1) 
      { 
    addTab(&quot;javascript:masterdelete()&quot;, &quot;revert all uploads&quot;, &quot;ca-rvuploads&quot;, &quot;Reverts uploads&quot;, &quot;&quot;);
    document.getElementById('ca-rvuploads').firstChild.innerHTML = '&lt;strong&gt;&lt;span style=&quot;color:darkred;&quot;&gt;revert all uploads&lt;/span&gt;&lt;/strong&gt;';
      }
  else if (location.href.search(/Special:Newpages.*[&amp;\?]username=[^&amp;]/) !=-1)
      {
    addTab(&quot;javascript:masternuke()&quot;, &quot;delete all pages&quot;, &quot;ca-delpages&quot;, &quot;Delete all pages&quot;, &quot;&quot;);
    document.getElementById('ca-delpages').firstChild.innerHTML = '&lt;strong&gt;&lt;span style=&quot;color:darkred;&quot;&gt;delete all pages&lt;/span&gt;&lt;/strong&gt;';
      }
  else if (document.title.indexOf('View and restore deleted pages') != -1 &amp;&amp; location.href.search(/&amp;timestamp=|&amp;action=submit/) == -1)
      {
    addTab(&quot;javascript:checkall()&quot;, &quot;Select all&quot;, &quot;ca-checkall&quot;, &quot;Check all deleted revisions&quot;, &quot;&quot;);
      }
  if (location.href.search(/&amp;action=history|title=Special:Log|title=Special%3ALog/) != -1)
    {addTab(&quot;javascript:number_count()&quot;, &quot;#&quot;, &quot;ca-numb&quot;, &quot;Number edits&quot;, &quot;&quot;);}
}
//END

function number_count()
{
//check for monobook then cologneblue
if (document.getElementById('bodyContent'))
  {
  if (!document.getElementById('bodyContent')){return;}
  var body = document.getElementById('bodyContent');
  }
else if (document.getElementById('quickbar'))
  {
  if (!document.getElementById('content')){return;}
  var body = document.getElementById('content');
  }
  if (!body.getElementsByTagName('ul')[0]){return;}
var l = body.getElementsByTagName('ul')[0].getElementsByTagName('li');
if (l[0].innerHTML.indexOf('&lt;strong&gt;#1&lt;/strong&gt; ') != -1) return;
   addTab(&quot;javascript:time_frame()&quot;, &quot;@&quot;, &quot;ca-frame&quot;, &quot;Time frame&quot;, &quot;&quot;);
for (var i=0; i &lt; l.length; i++)
   {
   var c = i+1;
   l[i].innerHTML = '&lt;strong&gt;#' + c + '&lt;/strong&gt; ' + l[i].innerHTML;
   }
}

function time_frame()
{
//check for monobook then cologneblue
if (document.getElementById('bodyContent'))
  {
  if (!document.getElementById('bodyContent')){return;}
  var body = document.getElementById('bodyContent');
  }
else if (document.getElementById('quickbar'))
  {
  if (!document.getElementById('content')){return;}
  var body = document.getElementById('content');
  }
var range = prompt('Select two edit numbers for the range.' + '\n' + 'Use the format: X-Y.' + '\n' + '(dates must show like &quot;09:12, April 8, 2001&quot;  in user preferences)')
if (!range || range == '' || range.split('-').length != 2){return;}
var r1 = 1*range.split('-')[0];
var r2 = 1*range.split('-')[1];
var limit = r2 - r1 + 1;
var offset = r1 - 1;
//logs can use offsets (and only offsets)
if (location.href.search(/Special:Log|Special%3ALog/) !=-1)
  {
  var URL = location.href.replace(/&amp;offset=\d+/g,'').replace(/&amp;limit=\d+/g,'') + '&amp;offset=' + offset + '&amp;limit=' + limit;
  location.href = URL;
  return;
  }
//others use timestamps
if (document.title.indexOf('User contributions') ==0)
   var yearloc = body.getElementsByTagName('li')[r1 - 1].innerHTML.split(' (&lt;a href=&quot;')[0].split('(&lt;A href=&quot;')[0];
else if (body.getElementsByTagName('li')[r1 - 1].innerHTML.search(/\(cur\) \(last\)/) !=-1)
   var yearloc = body.getElementsByTagName('li')[r1 - 1].getElementsByTagName('a')[0].innerHTML;
else if (body.getElementsByTagName('li')[r1 - 1].innerHTML.search(/\(cur\) | \(last\)/) !=-1)
   var yearloc = body.getElementsByTagName('li')[r1 - 1].getElementsByTagName('a')[1].innerHTML;
else if (body.getElementsByTagName('li')[r1 - 1].innerHTML.search(/\(cur\) | \(last\)/) ==-1)
   var yearloc = body.getElementsByTagName('li')[r1 - 1].getElementsByTagName('a')[2].innerHTML;
if (yearloc.indexOf('January ') !=-1)
{var LMonth = 'January'; var LMval = '01'; var LDay = yearloc.split('January ')[1].split(',')[0]; var LYear = yearloc.split('January ')[1].split(', ')[1]; var LTime = yearloc.split(', January ')[0];}
else if (yearloc.indexOf('February ') !=-1)
{var LMonth = 'February'; var LMval = '02'; var LDay = yearloc.split('February ')[1].split(',')[0]; var LYear = yearloc.split('February ')[1].split(', ')[1]; var LTime = yearloc.split(', February ')[0];}
else if (yearloc.indexOf('March ') !=-1)
{var LMonth = 'March'; var LMval = '03'; var LDay = yearloc.split('March ')[1].split(',')[0]; var LYear = yearloc.split('March ')[1].split(', ')[1]; var LTime = yearloc.split(', March ')[0];}
else if (yearloc.indexOf('April ') !=-1)
{var LMonth = 'April'; var LMval = '04'; var LDay = yearloc.split('April ')[1].split(',')[0]; var LYear = yearloc.split('April ')[1].split(', ')[1]; var LTime = yearloc.split(', April ')[0];}
else if (yearloc.indexOf('May ') !=-1)
{var LMonth = 'May'; var LMval = '05'; var LDay = yearloc.split('May ')[1].split(',')[0]; var LYear = yearloc.split('May ')[1].split(', ')[1]; var LTime = yearloc.split(', May ')[0];}
else if (yearloc.indexOf('June ') !=-1)
{var LMonth = 'June'; var LMval = '06'; var LDay = yearloc.split('June ')[1].split(',')[0]; var LYear = yearloc.split('June ')[1].split(', ')[1]; var LTime = yearloc.split(', June ')[0];}
else if (yearloc.indexOf('July ') !=-1)
{var LMonth = 'July'; var LMval = '07'; var LDay = yearloc.split('July ')[1].split(',')[0]; var LYear = yearloc.split('July ')[1].split(', ')[1]; var LTime = yearloc.split(', July ')[0];}
else if (yearloc.indexOf('August ') !=-1)
{var LMonth = 'August'; var LMval = '08'; var LDay = yearloc.split('August ')[1].split(',')[0]; var LYear = yearloc.split('August ')[1].split(', ')[1]; var LTime = yearloc.split(', August ')[0];}
else if (yearloc.indexOf('September ') !=-1)
{var LMonth = 'September'; var LMval = '09'; var LDay = yearloc.split('September ')[1].split(',')[0]; var LYear = yearloc.split('September ')[1].split(', ')[1]; var LTime = yearloc.split(', September ')[0];}
else if (yearloc.indexOf('October ') !=-1)
{var LMonth = 'October'; var LMval = '10'; var LDay = yearloc.split('October ')[1].split(',')[0]; var LYear = yearloc.split('October ')[1].split(', ')[1]; var LTime = yearloc.split(', October ')[0];}
else if (yearloc.indexOf('November ') !=-1)
{var LMonth = 'November'; var LMval = '11'; var LDay = yearloc.split('November ')[1].split(',')[0]; var LYear = yearloc.split('November ')[1].split(', ')[1]; var LTime = yearloc.split(', November ')[0];}
else if (yearloc.indexOf('December ') !=-1)
{var LMonth = 'December'; var LMval = '12'; var LDay = yearloc.split('December ')[1].split(',')[0]; var LYear = yearloc.split('December ')[1].split(', ')[1]; var LTime = yearloc.split(', December ')[0];}
if (LDay.search(/\d\d/) ==-1){LDay = '0' + LDay;}
var LTime = LTime.replace(/:/g,'');
var timestamp = LYear + '' + LMval + '' + LDay + '' + LTime + '59';
//target contribs
if (location.href.indexOf('Special:Contributions/') ==-1)
  {var URL = location.href.replace(/&amp;offset=\d+/g,'').replace(/&amp;limit=\d+/g,'') + '&amp;offset=' + timestamp + '&amp;limit=' + limit;}
//implicit taget
else if (location.href.indexOf('Special:Contributions/') !=-1)
  {
  var user = location.href.split('Special:Contributions/')[1];
  var URL = wgServer + '/w/index.php?title=Special:Contributions&amp;target=' + user + '&amp;offset=' + timestamp + '&amp;limit=' + limit;
  }
// history page
else if (location.href.indexOf('&amp;action=history') !=-1)
  {
  var URL = wgServer + '/w/index.php?title=' + wgTitle + '&amp;action=history&amp;offset=' + timestamp + '&amp;limit=' + limit;
  }
location.href = URL;
}

function masterlogview(number,type,name,ID,title)
{
    if (document.getElementById('contentSub'))
      {
    var c = document.getElementById('contentSub');
    var a = c.getElementsByTagName('a');
      }
    else
      {
    var c = document.getElementsByTagName('p')[0];
    var a = c.getElementsByTagName('a');
      }
    vandal = a[0].href;
    if (vandal.indexOf(&quot;User:&quot;) !=-1)
       {vandal = vandal.split(&quot;User:&quot;)[1];}
    else if (vandal.indexOf(&quot;User talk:&quot;) !=-1)
       {vandal = vandal.split(&quot;User talk:&quot;)[1];}
    else if (vandal.indexOf(&quot;User_talk:&quot;) !=-1)
       {vandal = vandal.split(&quot;User_talk:&quot;)[1];}
    if (vandal.indexOf(&quot;&amp;action=&quot;) !=-1)
       {vandal = vandal.split(&quot;&amp;action=&quot;)[0];}
    if (vandal.search(/\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}/) !==-1){return;}
//create URL
          if (type != 'creation')
             {
          URL = '/w/index.php?title=Special:Log&amp;type=' + type + '&amp;user=' + vandal + '&amp;page=&amp;limit=' + number;
             }
          else if (type == 'creation')
             {
          URL = '/wiki/Special:Newpages?username=' + vandal + '&amp;limit=' + number;
             }
   addTab(URL, name, ID, title, &quot;&quot;);
}
//END

//////////////Auto-actions//////////////
function winclosed()
{
//monobook
if (document.getElementById('bodyContent'))
  {
  var body = document.getElementById('bodyContent');
  }
//cologneblue
else if (document.getElementById('quickbar'))
  {
  if (!document.getElementById('content')){return;}
  var body = document.getElementById('content');
  }
//for master rollback for moves
 if (location.href.indexOf('&amp;fakaction=masterfill') != -1 &amp;&amp; document.title.indexOf('Move page') != -1)
    {
    document.getElementById('wpReason').value = 'Automated revert of mass page moving.';
    document.getElementById('movepage').submit();
    }
//for master rollback for image uploads
 else if (document.title.indexOf('Image:')==0 &amp;&amp; location.href.indexOf('&amp;jsaction=ImagevandalRV&amp;target=') !=-1)
  {
  var bad_user = unescape(location.href.split('&amp;target=')[1].split('&amp;')[0]);
  var reason = location.href.split('&amp;reason=')[1].split('&amp;')[0];
  var history_num = 1;
  var uls = body.getElementsByTagName('ul');
  for (h=0; h&lt;uls.length; h++)
  {
     if (uls[h].className == &quot;special&quot; &amp;&amp; uls[h].innerHTML.indexOf('action=delete') !=-1)
     {history_num = h; break;}
  }
  var history = body.getElementsByTagName('ul')[history_num].getElementsByTagName('li');
//check if user is the last contributor
  if (history[0].innerHTML.indexOf('&quot;&gt;' + bad_user + '&lt;/') == -1)
      {window.close(); return;}
//check if he is the only contributor
  var Delete = 1;
  for (var i=0; i&lt;history.length; i++)
      {
     if (history[i].innerHTML.indexOf('&quot;&gt;' + bad_user + '&lt;/a&gt; (') == -1)
         {
        var RV_linkURL = history[i].getElementsByTagName('a')[1].href;
        Delete = 0;
        if (RV_linkURL.indexOf('&amp;wpEditToken=') ==-1){alert('Parsing error!'); return;}
        document.getElementById('contentSub').innerHTML = '&lt;strong&gt;&lt;span style=&quot;color:blue;&quot;&gt;Reverting:&lt;/span&gt; ' + RV_linkURL + '&lt;/strong&gt;.';
        location.href = RV_linkURL;
        break;
         }
      }
//if user is the only contibutor
   if (Delete == 1)
    {
    var Delete_AllURL = history[0].getElementsByTagName('a')[0].href;
    if (Delete_AllURL.indexOf('&amp;action=delete') ==-1){alert('Parsing error!'); return;}
    Delete_AllURL += '&amp;jsaction=imagenuke&amp;reason=' + reason;
    document.getElementById('contentSub').innerHTML = '&lt;strong&gt;&lt;span style=&quot;color:red;&quot;&gt;Deleting:&lt;/span&gt; ' + Delete_AllURL + '&lt;/strong&gt;.';
    location.href = Delete_AllURL;
    }
  }
//for master rollback for images, last step
 else if (document.title.indexOf('Confirm delete')==0 &amp;&amp; location.href.indexOf('&amp;action=delete&amp;jsaction=imagenuke&amp;reason=') !=-1)
  {
  var reason = unescape(location.href.split('&amp;reason=')[1].split('&amp;')[0]);
  document.getElementById('wpReason').value = reason;
  var form = document.getElementsByTagName('input')[1];
  form.click();
  }
//for master delete for page creations
 else if (document.title.indexOf('Confirm delete')==0 &amp;&amp; location.href.indexOf('&amp;action=delete&amp;jsaction=nuke') !=-1)
    {
  if (document.getElementById('wpReason').value.length &lt; 1)
  {document.getElementById('wpReason').value = 'Deleted vandalism page with only one contributor.';}
  var form = document.getElementsByTagName('input')[1];
  form.click();
    }
 else if (document.title.indexOf('Confirm delete')==0 &amp;&amp; location.href.indexOf('&amp;jsaction=RollbackDelete') !=-1)
  {
  if (document.getElementById('wpReason').value.length &lt; 1)
  {document.getElementById('wpReason').value = 'Deleted test or vandalism page with only one contributor.';}
  var form = document.getElementsByTagName('input')[1];
  var message = 'Do you want to delete this page since it has only one author?';
  var return_value = confirm(message);
  if (return_value == true)
  {form.click();}
  }
  else if (document.title.indexOf('Rollback failed') == 0 &amp;&amp; body.innerHTML.indexOf(' last contributor is the only author of this page') != -1)
  {
  var article = location.href.split('?title=')[1].split('&amp;action')[0];
  location.href = wgServer + '/w/index.php?title=' + article + '&amp;action=delete&amp;jsaction=RollbackDelete';
  }
}
//////////////

function jswin_close()
{
//close JS action inputs
 if (document.title.search(/Action complete|Internal error/) ==0)
  {
  setTimeout('window.close()',1000);
  }
//close JS action inputs
 else if (document.title.indexOf('Move page')==0)
  {
  if (document.getElementById('contentSub').innerHTML == 'Move succeeded')
    {setTimeout('window.close()',1000);}
  }
//close JS launched rollbacks
 else if (location.href.search(/&amp;action=rollback.+&amp;jsaction=close/) !=-1)
  {
  window.close();
  }
}

//reverts edits
function masterroll()
{
//monobook
if (document.getElementById('bodyContent'))
  {
  if (!document.getElementById('bodyContent')){return;}
  var body = document.getElementById('bodyContent');
  }
//cologneblue
else if (document.getElementById('quickbar'))
  {
  if (!document.getElementById('content')){return;}
  var body = document.getElementById('content');
  }
if (!body.getElementsByTagName('ul')[0])
{alert('No edits found.'); return;}
  z=0;
  var oldloc = location.href;
  var message = &quot;Are you sure you want to revert all top edits shown on this page by this user? Use this only to revert a large wave of vandalism by a single user or IP address.&quot; + &quot;\n&quot; + &quot;To control how many edits this will revert, please set the number of articles on the list before performing this operation. You may also want to change the offset as well.&quot; + &quot;\n&quot; + &quot;Close all other programs if there is a large number of edits to be reverted, otherwise, this may cause memory problems. Press OK to continue.&quot;;
  var return_value = confirm(message);
  if (return_value == true)
   {
    var js_con_class = prompt(&quot;Secondary confirmation:&quot; + &quot;\n&quot; + &quot;All top edits by this user will be reverted!&quot; + &quot;\n&quot; + &quot;Confirm type:&quot;);
     if (js_con_class == Rvaluejs_class)
      {
    l = body.getElementsByTagName('li');
    document.getElementById('contentSub').innerHTML = &quot;&lt;strong&gt;All of the user's top edits are being reverted. This page will be refreshed automatically in 20 seconds&lt;/strong&gt;.&quot;;
    for (var i = 0; i &lt; l.length; i++) 
      {
      if (i == l.length-1){setTimeout(&quot;window.location.reload()&quot;,20000);}
      var t = l[i].innerHTML;
      if (t.indexOf('&lt;strong&gt; (') != -1)
         {
        var article = l[i].getElementsByTagName('a')[0].href.split('&amp;')[0].split('title=')[1].replace(/[^\/]*\/\/[^\/]*/, '');
        var li_a = l[i].getElementsByTagName('a');
        for (k = 3; k &lt; li_a.length; k++)  
        {
        if (l[i].getElementsByTagName('a')[k].href.indexOf('&amp;action=rollback') !=-1)
           {
z += 1;
var URL = l[i].getElementsByTagName('a')[k].href + '&amp;jsaction=close';
l[i].innerHTML += ' (' + cvrollbacklink + ')';
window.open(URL,'MasterrollJS' + z,'height=300,width=800,directories=yes,resizeable=yes,scrollbars=yes');
        break;
           }    
         }
        }
      }
  }
        else
          {
         alert(&quot;Operation aborted.&quot;);
         return;
          }
 }
        else
          {
         alert(&quot;Operation aborted.&quot;);
         return;
          }
}
//

//rollback moves
function movemasterroll()
{
//monobook
if (document.getElementById('bodyContent'))
  {
  if (!document.getElementById('bodyContent')){return;}
  var body = document.getElementById('bodyContent');
  }
//cologneblue
else if (document.getElementById('quickbar'))
  {
  if (!document.getElementById('content')){return;}
  var body = document.getElementById('content');
  }
if (!body.getElementsByTagName('ul')[0])
{alert('No page moves found.'); return;}
  var oldloc = location.href;
  var message = &quot;Are you sure you want to revert all page moves by this user? Use this only to revert a large wave of vandalism by a single user or IP address.&quot; + &quot;\n&quot; + &quot;To control how many moves this will revert, please set the number of articles on the list before performing this operation. You may also want to change the offset as well.&quot; + &quot;\n&quot; + &quot;Close all other programs if there is a large number of moves to be reverted, otherwise, this may cause memory problems. Press OK to continue.&quot;;
  var return_value = confirm(message);
  if (return_value == true)
   {
    var Val_type = prompt(&quot;Secondary confirmation:&quot; + &quot;\n&quot; + &quot;All top moves by this user will be reverted!&quot; + &quot;\n&quot; + &quot;Confirm type:&quot;);
     if (Val_type == Mvaluejs_class)
      {
    var c = document.getElementById('contentSub');
    var a = c.getElementsByTagName('a');
    l = body.getElementsByTagName('li');
    document.getElementById('contentSub').innerHTML = &quot;&lt;strong&gt;All of the user's top page moves are being reverted. This page will be refreshed automatically in 20 seconds&lt;/strong&gt;.&quot;;
    for (var i = l.length -1; i &gt;= 0; i--) 
      {
      if (i == 0){setTimeout(&quot;window.location.reload()&quot;,20000);}
      var t = l[i].innerHTML;
      if (t.indexOf('moved') != -1)
        {
        var li_a = l[i].getElementsByTagName('a');
        for (k = 1; k &lt;li_a.length; k++) 
           {
            if (li_a[k].href.indexOf('&amp;redirect=no') != -1)
              {var article = li_a[k].href;}
            if (li_a[k].href.indexOf('title=Special:Movepage&amp;wpOldTitle=') != -1)
              {
              var URL = li_a[k].href + '&amp;fakaction=masterfill';
              l[i].innerHTML += ' (' + cvrollbacklink + ')';
              window.open(URL,'MasterMoveRV:' + article,'height=300,width=800,resizeable=yes,scrollbars=yes');
              break;
              }    
           }
        }
   }
}
        else
          {
         alert(&quot;Operation aborted.&quot;);
         return;
          }
 }
        else
          {
         alert(&quot;Operation aborted.&quot;);
         return;
          }
}
//END

//deletes recent page creations
function masternuke()
{
//monobook
if (document.getElementById('bodyContent'))
  {
  if (!document.getElementById('bodyContent')){return;}
  var body = document.getElementById('bodyContent');
  }
//cologneblue
else if (document.getElementById('quickbar'))
  {
  if (!document.getElementById('content')){return;}
  var body = document.getElementById('content');
  }
if (body.getElementsByTagName('ol')[0] == undefined)
{alert('No page creations found.'); return;}
  var oldloc = location.href;
  var message = &quot;Are you sure you want to delete all pages created by this user? Use this only to revert a large wave of vandalism by a single user.&quot; + &quot;\n&quot; + &quot;To control how many pages this will delete, please set the number of articles on the list before performing this operation. You may also want to change the offset as well.&quot; + &quot;\n&quot; + &quot;Close all other programs if there is a large number of moves to be reverted, otherwise, this may cause memory problems. Press OK to continue.&quot;;
  var return_value = confirm(message);
  if (return_value == true)
   {
    var Val_type = prompt(&quot;Secondary confirmation:&quot; + &quot;\n&quot; + &quot;All recent pages created by this user will be deleted!&quot; + &quot;\n&quot; + &quot;Confirm type:&quot;);
     if (Val_type == Rvaluejs_class)
      {
    var c = document.getElementById('contentSub');
    var a = c.getElementsByTagName('a');
    l = body.getElementsByTagName('li');
    document.getElementById('contentSub').innerHTML = &quot;&lt;strong&gt;All of the user's recent page creations are being deleted. This page will be refreshed automatically in 20 seconds&lt;/strong&gt;.&quot;;
    for (var i = 0; i &lt; l.length; i++)
      {
      if (i == 0){setTimeout(&quot;window.location.reload()&quot;,20000);}
      var article = l[i].getElementsByTagName('a')[0].innerHTML;
      var URL = wgServer + '/w/index.php?title=' + article + '&amp;action=delete&amp;jsaction=nuke';
      l[i].innerHTML += ' (' + dvrollbacklink + ' )';
      window.open(URL,'MasterNUKE:' + article,'height=700,width=700,resizeable=yes,scrollbars=yes');
      }
   }
        else
          {
         alert(&quot;Operation aborted.&quot;);
         return;
          }
 }
        else
          {
         alert(&quot;Operation aborted.&quot;);
         return;
          }
}
//END

//reverts/deletes uploads
function masterdelete()
{
//monobook
if (document.getElementById('bodyContent'))
  {
  if (!document.getElementById('bodyContent')){return;}
  var body = document.getElementById('bodyContent');
  }
//cologneblue
else if (document.getElementById('quickbar'))
  {
  if (!document.getElementById('content')){return;}
  var body = document.getElementById('content');
  }
  if (!body.getElementsByTagName('ul')[0]){return;}
  var z = 0;
  var unique_img_list = '|';
//are there any?
if (body.getElementsByTagName('ul')[0] == undefined)
{alert('No file uploads found.'); return;}
  var oldloc = location.href;
  var message = &quot;Are you sure you want to revert all uploads shown on this page by this user? Use this only to revert a large wave of vandalism by a single user or IP address. Uploads of which this user is the only author will be deleted.&quot; + &quot;\n&quot; + &quot;To control how many uploads this will revert, please set the number of images on the list before performing this operation. You may also want to change the offset as well.&quot; + &quot;\n&quot; + &quot;Close all other programs if there is a large number of edits to be reverted. Unfortunetely, this script has to load the image pages to get the file histories, so it is STRONGLY recommended that you disable images in this browser first if there is a large number of images to be reverted. Press OK to continue.&quot;;
  var return_value = confirm(message);
  if (return_value == true)
   {
   var Val_type = prompt(&quot;Secondary confirmation:&quot; + &quot;\n&quot; + &quot;All uploads by this user will be reverted!&quot; + &quot;\n&quot; + &quot;Confirm type:&quot;);
     if (Val_type == Uvaluejs_class)
      {
    var reason = prompt('Enter an explanation:');
    if (!reason || reason.length &lt; 6){alert('Too short!'); return;}
    l = body.getElementsByTagName('ul')[0].getElementsByTagName('li');
    var vandal = l[0].getElementsByTagName('a')[0].innerHTML;
    document.getElementById('contentSub').innerHTML = &quot;&lt;strong&gt;All of the user's uploads are being reverted. This page will be refreshed automatically in 30 seconds&lt;/strong&gt;.&quot;;
    for (var i = 0; i &lt; l.length; i++) 
     {
        if (i == l.length-1){setTimeout(&quot;window.location.reload()&quot;,30000);}
//check for non-deleted images
        var li_a = l[i].getElementsByTagName('a');
        for (k = 2; k &lt;li_a.length; k++)  
        {
        if (l[i].getElementsByTagName('a')[k].innerHTML.indexOf('Image:') != -1 &amp;&amp; l[i].getElementsByTagName('a')[k].href.indexOf('&amp;action=edit') == -1)
           {
           z += 1;
           var name = l[i].getElementsByTagName('a')[k].innerHTML;
             if (unique_img_list.indexOf('|' + name + '|') ==-1)
               {
               unique_img_list += name + '|';
               var URL = wgServer + '/w/index.php?title=' + name;
               URL += '&amp;jsaction=ImagevandalRV&amp;target=' + escape(vandal) + '&amp;reason=' + escape(reason);
               l[i].innerHTML += ' (' + cvrollbacklink + ')';
               window.open(URL,'MasterrollImages' + z,'height=700,width=700,directories,resizeable,scrollbars');
               break;
               }
             else {l[i].innerHTML += ' (&lt;strong&gt;old&lt;/strong&gt;)';}
           }    
        }
     }
  }
        else
          {
         alert(&quot;Operation aborted.&quot;);
         return;
          }
 }
        else
          {
         alert(&quot;Operation aborted.&quot;);
         return;
          }
}
//

////////////Wikipedia:WikiProject User scripts/Scripts/RBL check////////////
// This script adds an &quot;[[DNSBL|RBL]] check&quot; link to the toolbox on IP user/talk/contribs pages.  &lt;pre&gt;&lt;nowiki&gt;

addOnloadHook(function () {
    var href = document.getElementById('t-contributions');
    if (href) href = href.getElementsByTagName('a');
    if (href) href = href[0];
    if (href) href = href.href;
    else href = window.location.href;

    var addr = /(\/wiki\/|[?&amp;]title=)Special:Contributions(\/([^\/?&amp;#]*)|[?&amp;#]|$)/.exec(href);
    if (!addr) return;
    addr = addr[3];
    if (!addr) {
        addr = /^[^?#]*\?([^&amp;#]*&amp;)*target=([^&amp;#]*)/.exec(href);
        if (!addr) return;
        addr = addr[2];
    }
    if (!/^[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+$/.test(addr)) return;

    addLink('p-tb', 'http://www.robtex.com/rbls/'+addr+'.html', 'RBL check', 't-rblcheck', 'Multi-RBL check', null, 't-contributions');
});
////////////

/////////////////////////////////IP range contribs check/////////////////////////////////
//globals
var starting_IP_trunk = '';
var starting_IP_end = 0;
var IP_num_JS_count = 0;
var IP_num_JS_static = 0;
//

function IPRange_contribs_tab()
{
if (location.href.search(/Special(:|%3A)Contributions/) != -1 &amp;&amp; location.href.search(/\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}/) != -1 &amp;&amp; location.href.search(/\d{1,3}(@|%40)\d{1,2}/) == -1)
  {
  addTab(&quot;javascript:IPRange_contribs_query()&quot;, &quot;/24 Range&quot;, &quot;ca-range&quot;, &quot;Check a medium or small IP range&quot;, &quot;&quot;);
  addTab(&quot;javascript:IPRange_contribs_query2()&quot;, &quot;/16 Range&quot;, &quot;ca-range2&quot;, &quot;Monitor a large IP range&quot;, &quot;&quot;);
  }
}

//for /24 ranges
function IPRange_contribs_query()
{
if (location.href.indexOf('/Special:Contributions/') != -1)
{var IP = location.href.split('/Special:Contributions/')[1];}
else
{var IP = location.href.split('&amp;target=')[1].split('&amp;')[0];}
var number = prompt('Consecutive IP range indexes?' + '\n' + 'Use format: X-Y' + '\n' + '(For fourth IP block)');
if (!number || number=='' || number.split('-').length !=2){return;}
var start = 1*number.split('-')[0];
var end = 1*number.split('-')[1];
var count = end - start;
if (end &gt; 255){end = 255;}
var IP = IP.split('.')[0] + '.' + IP.split('.')[1] + '.' + IP.split('.')[2] + '.' + start;
location.href = wgServer + '/w/index.php?&amp;limit=1&amp;target=' + IP + '@' + count + '&amp;title=Special%3AContributions&amp;namespace=';
}

//for /16 ranges
function IPRange_contribs_query2()
{
if (location.href.indexOf('/Special:Contributions/') != -1)
{var IP = location.href.split('/Special:Contributions/')[1];}
else
{var IP = location.href.split('&amp;target=')[1].split('&amp;')[0];}
var number = prompt('Consecutive IP range indexes?' + '\n' + 'Use format: X-Y' + '\n' + '(For third IP block)');
if (!number || number=='' || number.split('-').length !=2){return;}
var start = 1*number.split('-')[0];
var end = 1*number.split('-')[1];
var count = end - start;
if (end &gt; 255){end = 255;}
var IP = IP.split('.')[0] + '.' + IP.split('.')[1] + '.' + start;
location.href = wgServer + '/w/index.php?&amp;limit=1&amp;target=' + IP + '@' + count + '&amp;title=Special%3AContributions&amp;namespace=';
}

function IPRange_contribs()
{
//monobook
if (document.getElementById('bodyContent'))
  {
  var body = document.getElementById('bodyContent');
  }
//cologneblue
else if (document.getElementById('quickbar'))
  {
  if (!document.getElementById('content')){return;}
  var body = document.getElementById('content');
  }
//for /24 queries
if (location.href.search(/&amp;target=\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}%40\d{1,2}/) != -1 &amp;&amp; location.href.indexOf('&amp;title=Special%3AContributions') != -1)
  {
  var target = location.href.split('&amp;target=')[1].split('&amp;')[0];
  starting_IP_trunk = target.split('.')[0] + '.' + target.split('.')[1] + '.' + target.split('.')[2] + '.';
  var ending_num = target.split('%40')[1];
  starting_IP_end = target.split('.')[3].split('%40')[0];
//
  var IP_end_last_show = 1*starting_IP_end + 1*ending_num;
  var IP_start_show = starting_IP_trunk + starting_IP_end;
  var IP_last_show = starting_IP_trunk + IP_end_last_show;
  body.innerHTML = body.innerHTML.replace('No changes were found matching these criteria.','');
  document.getElementById('siteSub').innerHTML += &quot;&lt;br&gt;&lt;strong&gt;Checking IP range contributions from &lt;span style='color: darkblue'&gt;&quot; + IP_start_show + &quot;&lt;/span&gt; to &lt;span style='color: darkblue'&gt;&quot; + IP_last_show + &quot;&lt;/span&gt;&lt;/strong&gt;:&quot;;
  makeRangeRequestXML_DNS('GET', starting_IP_trunk + '0/24', null)
  }
//for /16 queries
else if (location.href.search(/&amp;target=\d{1,3}\.\d{1,3}\.\d{1,3}%40\d{1,2}/) != -1 &amp;&amp; location.href.indexOf('&amp;title=Special%3AContributions') != -1)
  {
  var target = location.href.split('&amp;target=')[1].split('&amp;')[0];
  starting_IP_trunk = target.split('.')[0] + '.' + target.split('.')[1] + '.';
  var ending_num = target.split('%40')[1];
  starting_IP_end = target.split('.')[2].split('%40')[0];
//
  var IP_end_last_show = 1*starting_IP_end + 1*ending_num;
  var IP_start_show = starting_IP_trunk + starting_IP_end;
  var IP_last_show = starting_IP_trunk + IP_end_last_show;
  var starting_IP_end_last = 1*starting_IP_end + 1*ending_num;
  var ip_reg = '';
  for (var i=starting_IP_end; i &lt;= starting_IP_end_last; i++)
     {
     if (i != starting_IP_end_last)
     {ip_reg += i + '|';}
     else
     {ip_reg += i;}
     }
  ip_reg = '&quot; title=&quot;Special:Contributions&quot;&gt;' + starting_IP_trunk + '(' + ip_reg + ')\\.\\d{1,3}&lt;\\/a&gt; ';
  ip_reg_RC_range = new RegExp(ip_reg,'i');
  body.innerHTML = body.innerHTML.replace('No changes were found matching these criteria.','');
  document.getElementById('siteSub').innerHTML += &quot;&lt;br&gt;&lt;strong&gt;Checking IP range contributions from &lt;span style='color: darkblue'&gt;&quot; + IP_start_show + &quot;&lt;/span&gt; to &lt;span style='color: darkblue'&gt;&quot; + IP_last_show + &quot;&lt;/span&gt;&lt;/strong&gt;:&quot;;
  var iterations = prompt('How many additional 10 minute checks?');
  if (!iterations){history.go(-1);}
  RC_XML_contribs_range(iterations);
  }
//for /24 UI
else if (location.href.search(/&amp;target=\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}@\d{1,2}/) != -1 &amp;&amp; location.href.indexOf('&amp;title=Special%3AContributions') != -1)
  {
  document.getElementById('siteSub').innerHTML += '&lt;br&gt;&lt;strong&gt;Select a namespace and press &quot;Go&quot; to check contribtutions from this IP range. This will only check back 20 edits however.&lt;/strong&gt;';
  }
//for /16 UI
else if (location.href.search(/&amp;target=\d{1,3}\.\d{1,3}\.\d{1,3}@\d{1,2}/) != -1 &amp;&amp; location.href.indexOf('&amp;title=Special%3AContributions') != -1)
  {
  document.getElementById('siteSub').innerHTML += '&lt;br&gt;&lt;strong&gt;Select a namespace and press &quot;Go&quot; to check contribtutions from this IP range. This will only check about 2-4 hours back of &lt;i&gt;recent changes&lt;/i&gt;. Subsequent edits will be monitored each minute for X iterations.&lt;/strong&gt;';
  }
}

//
var offset_RC_index = 0;
var timestamp_RC_index = 0;
function RC_XML_contribs_range(upper_limit)
{
upper_limit_RC_range = upper_limit;
//monobook
if (document.getElementById('bodyContent'))
  {
  var body = document.getElementById('bodyContent');
  }
//cologneblue
else if (document.getElementById('quickbar'))
  {
  if (!document.getElementById('content')){return;}
  var body = document.getElementById('content');
  }
body.innerHTML += '&lt;ul&gt;&lt;/ul&gt;';
RC_page_XML_range(0);
}

function RC_page_XML_range(offset_RC_index)
{
  document.getElementById('contentSub').innerHTML = &quot;&lt;strong&gt;Checking last 5000 IP &lt;i&gt;recent changes&lt;/i&gt; from timestamp '&quot; + timestamp_RC_index + &quot;' (&quot; + offset_RC_index + &quot;/&quot; + upper_limit_RC_range + &quot;)&lt;/strong&gt;:&quot;;
  var namespace = '&amp;namespace=';
  if (location.href.search(/&amp;namespace=\d/) != -1)
    {namespace = '&amp;namespace=' + location.href.split('&amp;namespace=')[1].split('&amp;')[0];}
//
  var URL = '/w/index.php?title=Special:Recentchanges&amp;hideliu=1&amp;limit=5000' + namespace + '&amp;from=' + timestamp_RC_index + '&amp;useskin=none';
  xml_http = HTTPClient();
  xml_http.open(&quot;GET&quot;, URL, true);
  xml_http.onreadystatechange = RC_page_XML_range_parse;
  xml_http.send(null);
}

function RC_page_XML_range_parse()
{
//monobook
if (document.getElementById('bodyContent'))
  {
  var body = document.getElementById('bodyContent');
  }
//cologneblue
else if (document.getElementById('quickbar'))
  {
  if (!document.getElementById('content')){return;}
  var body = document.getElementById('content');
  }
   if (xml_http.readyState != 4)
  {return;}
  xml_rc_contribs_xml = xml_http.responseText;
  document.getElementById('contentSub').innerHTML = &quot;&lt;strong&gt;Parsing &lt;i&gt;recent changes&lt;/i&gt; XML...(&quot; + offset_RC_index + &quot;/&quot; + upper_limit_RC_range + &quot;)&lt;/strong&gt;&quot;;
//timestamp
  if (xml_rc_contribs_xml.indexOf('/&gt;Show new changes starting from &lt;') !=-1)
    {timestamp_RC_index = xml_rc_contribs_xml.split('/&gt;Show new changes starting from &lt;')[1].split('from=')[1].split('&quot;')[0].split('&amp;')[0];}
  else
    {timestamp_RC_index = xml_rc_contribs_xml.split('name=&quot;from&quot; value=&quot;')[1].split('&quot;')[0];}
  timestamp_RC_index = timestamp_RC_index.substr(0,12) + '59';
//
  if (xml_rc_contribs_xml.indexOf('&lt;ul class=&quot;special&quot;&gt;') != -1)
    {xml_rc_contribs_xml = xml_rc_contribs_xml.split('&lt;ul class=&quot;special&quot;&gt;')[1].split('&lt;/ul&gt;')[0];}
  var li_sections = xml_rc_contribs_xml.split('&lt;li&gt;');
  var last_index = li_sections.length-1;
  var rewrite = false;
  for (var i=1; i&lt;li_sections.length; i++)
    {
    var html_li = li_sections[i].split('&lt;/li&gt;')[0];
    if (html_li.search(ip_reg_RC_range) != -1)
    body.getElementsByTagName('ul')[0].innerHTML = '&lt;li&gt;' + html_li + '&lt;/li&gt;' + body.getElementsByTagName('ul')[0].innerHTML;
    rewrite = true;
    }
  offset_RC_index = offset_RC_index + 1;
  if (offset_RC_index &gt; upper_limit_RC_range)
    {
    document.getElementById('contentSub').innerHTML = &quot;&lt;strong&gt;Done:&lt;span style='color: blue'&gt; edits retrieved.&lt;/span&gt;&lt;/strong&gt;&quot;;
  body.ranSetupTooltipsAlready=false;
  setupTooltips(body);
    return;
    }
  setTimeout(&quot;RC_page_XML_range()&quot;,600000);
  document.getElementById('contentSub').innerHTML = &quot;&lt;strong&gt;Waiting 10 minutes for next XML request...(&quot; + offset_RC_index + &quot;/&quot; + upper_limit_RC_range + &quot;)&lt;/strong&gt;&quot;;
//rewrite popups
  if (rewrite==true)
    {
    body.ranSetupTooltipsAlready=false;
    setupTooltips(body);
    }
  //RC_page_XML_range(offset_RC_index);
}

//////////////////////////////

//security override HTTP request
//ALSO, reduce IE security settings
//For FF/NS, go enable, see &quot;http://esw.w3.org/topic/SparqlCalendarDemoUsage#FAQ&quot;
//Basically, enable &quot;signed.applets.codebase_principal_support&quot; in about:config 

//
function makeRangeRequestXML_DNS(type, url, parameters)
{ 
  document.getElementById('contentSub').innerHTML = &quot;&lt;strong&gt;Checking DNS info for &quot; + url + &quot;. Please wait...&lt;/strong&gt;&quot;;
  if(window.XMLHttpRequest)
  {
try {netscape.security.PrivilegeManager.enablePrivilege(&quot;UniversalBrowserRead&quot;); } 
catch (e) {alert(&quot;Permission UniversalBrowserRead denied. Please enable 'signed.applets.codebase_principle_support' through 'about:config' in your browser.&quot;); } 
http_request = false;
http_request = new XMLHttpRequest(); 
if (http_request.overrideMimeType) 
{http_request.overrideMimeType('text/xml'); }
if (!http_request) 
{alert('Cannot create XMLHTTP instance'); return false;} 
http_request.onreadystatechange = IPRange_contribs_XML_ready;
http_request.open(type, 'http://www.dnsstuff.com/tools/ptr.ch?ip=' + url, true); 
http_request.send(parameters); 
  }
  else if (window.ActiveXObject)
  {
    try
    {http_request = new ActiveXObject(&quot;Msxml2.XMLHTTP&quot;);} 
    catch (e)
     {
      try
      {http_request = new ActiveXObject(&quot;Microsoft.XMLHTTP&quot;);} 
       catch (e){}
     }
  if (!http_request) {showError(ERROR_XML);}
  http_request.onreadystatechange = IPRange_contribs_XML_ready;
  http_request.open(type, 'http://www.dnsstuff.com/tools/ptr.ch?ip=' + url, true); 
  http_request.send(parameters); 
  }
}
//

//
function makeRangeRequestXML_WHOIS(type, url, parameters)
{ 
  document.getElementById('contentSub').innerHTML = &quot;&lt;strong&gt;Looking up WHOIS info for &quot; + current_IP_name + &quot; &lt;/strong&gt;:&quot;;
  if(window.XMLHttpRequest)
  {
try {netscape.security.PrivilegeManager.enablePrivilege(&quot;UniversalBrowserRead&quot;); } 
catch (e) {alert(&quot;Permission UniversalBrowserRead denied. Please enable 'signed.applets.codebase_principle_support' through 'about:config' in your browser.&quot;); } 
http_request = false;
http_request = new XMLHttpRequest(); 
if (http_request.overrideMimeType) 
{http_request.overrideMimeType('text/xml'); }
if (!http_request) 
{alert('Cannot create XMLHTTP instance'); return false;} 
http_request.onreadystatechange = parse_contribs_ready;
http_request.open(type, 'http://www.dnsstuff.com/tools/whois.ch?ip=' + url, true); 
http_request.send(parameters); 
  }
  else if (window.ActiveXObject)
  {
    try
    {http_request = new ActiveXObject(&quot;Msxml2.XMLHTTP&quot;);} 
    catch (e)
     {
      try
      {http_request = new ActiveXObject(&quot;Microsoft.XMLHTTP&quot;);} 
       catch (e){}
     }
  if (!http_request) {showError(ERROR_XML);}
  http_request.onreadystatechange = parse_contribs_ready;
  http_request.open(type, 'http://www.dnsstuff.com/tools/whois.ch?ip=' + url, true); 
  http_request.send(parameters); 
  }
}
//////////////////////////////

function IPRange_contribs_XML_ready()
{
  if (http_request.readyState != 4)
  {return;}
  xml_DNS_user_CU = http_request.responseText;
  if (xml_DNS_user_CU.indexOf('&lt;PRE&gt;') != -1)
    {xml_DNS_user_CU = xml_DNS_user_CU.split('&lt;PRE&gt;')[1].split('&lt;/PRE&gt;')[0];}
  IPRange_contribs_XML();
}

function IPRange_contribs_XML()
{
//monobook
if (document.getElementById('bodyContent'))
  {
  var body = document.getElementById('bodyContent');
  }
//cologneblue
else if (document.getElementById('quickbar'))
  {
  if (!document.getElementById('content')){return;}
  var body = document.getElementById('content');
  }
  var namespace = '&amp;namespace=';
  if (location.href.search(/&amp;namespace=\d/) != -1)
  {namespace = '&amp;namespace=' + location.href.split('&amp;namespace=')[1].split('&amp;')[0];}
  var target = location.href.split('&amp;target=')[1].split('&amp;')[0];
  if (target.indexOf('@') != -1)
  {var ending_num = target.split('@')[1];}
  else if (target.indexOf('%40') != -1)
  {var ending_num = target.split('%40')[1];}
  var current_num = 1*starting_IP_end + 1*IP_num_JS_count;
  if (IP_num_JS_count &gt; ending_num)
  {
  document.getElementById('contentSub').innerHTML = &quot;&lt;strong&gt;Done:&lt;span style='color: blue'&gt; edits retrieved.&lt;/span&gt;&lt;/strong&gt;&quot;;
  edits_page_compared_js = 1;
  addTab(&quot;javascript:compare_contribs_range()&quot;, &quot;Compare&quot;, &quot;ca-comp&quot;, &quot;Compare&quot;, &quot;&quot;);
  addTab(&quot;javascript:contribs_reset()&quot;, &quot;reset&quot;, &quot;ca-reset&quot;, &quot;Reset to range contribs&quot;, &quot;&quot;);
  body.ranSetupTooltipsAlready=false;
  setupTooltips(body);
  return;
  }
  if (current_num &gt; 255)
  {
  document.getElementById('contentSub').innerHTML = &quot;&lt;strong&gt;&lt;span style='color: darkred'&gt;IP bloc number exceeds 255, query stopped!&lt;/span&gt;&lt;/strong&gt;&quot;;
  edits_page_compared_js = 1;
  addTab(&quot;javascript:compare_contribs_range()&quot;, &quot;Compare&quot;, &quot;ca-comp&quot;, &quot;Compare&quot;, &quot;&quot;);
  addTab(&quot;javascript:contribs_reset()&quot;, &quot;reset&quot;, &quot;ca-reset&quot;, &quot;Reset to range contribs&quot;, &quot;&quot;);
  body.ranSetupTooltipsAlready=false;
  setupTooltips(body);
  return;
  }
  if (location.href.indexOf('Special:Contributions&amp;target=') != -1)
  {
  var URL = location.href.split('Special:Contributions&amp;target=')[0] + 'Special:Contributions&amp;target=' + starting_IP_trunk + current_num + namespace + '&amp;limit=20';
  }
  else
  {
  var URL = '/w/index.php?title=Special:Contributions&amp;target=' + starting_IP_trunk + current_num + namespace + '&amp;limit=20';
  }
  document.getElementById('contentSub').innerHTML = &quot;&lt;strong&gt;Checking: &quot; + starting_IP_trunk + current_num + &quot;&lt;/strong&gt;&quot;;
  current_IP_name = starting_IP_trunk + current_num;
  IPRange_contribs_edits();
}

function IPRange_contribs_edits()
{
  var namespace = '&amp;namespace=';
  if (location.href.search(/&amp;namespace=\d/) != -1)
  {namespace = '&amp;namespace=' + location.href.split('&amp;namespace=')[1].split('&amp;')[0];}
//
  document.getElementById('contentSub').innerHTML = &quot;&lt;strong&gt;Searching contributions info for &quot; + current_IP_name + &quot; &lt;/strong&gt;:&quot;;
  var URL = '/w/index.php?title=Special:Contributions&amp;target=' + current_IP_name + namespace + '&amp;limit=20&amp;useksin=standard';
  xml_http = HTTPClient();
  xml_http.open(&quot;GET&quot;, URL, true);
  xml_http.onreadystatechange = IPRange_contribs_WHOIS;
  xml_http.send(null);
}

function IPRange_contribs_WHOIS()
{
  if (xml_http.readyState != 4) return;
  xml_edits_user = xml_http.responseText;
  if (xml_edits_user.indexOf('No changes were found matching these criteria.') ==-1 &amp;&amp; xml_edits_user.indexOf('&lt;ul&gt;') !=-1)
    {makeRangeRequestXML_WHOIS('GET', current_IP_name, null);}
  else {xml_WHOIS_user_CU = ''; parse_contribs_xml();}
}

function parse_contribs_ready()
{
  if (http_request.readyState != 4)
  {return;}
  xml_WHOIS_user_CU = http_request.responseText;
  parse_contribs_xml();
}

function parse_contribs_xml()
{
//monobook
if (document.getElementById('bodyContent'))
  {
  var body = document.getElementById('bodyContent');
  }
//cologneblue
else if (document.getElementById('quickbar'))
  {
  if (!document.getElementById('content')){return;}
  var body = document.getElementById('content');
  }
//WHOIS
  if (xml_WHOIS_user_CU.indexOf('&lt;h3&gt;Whois Record&lt;/h3&gt;') !=-1)
    {xml_WHOIS_user_CU = xml_WHOIS_user_CU.split('&lt;h3&gt;Whois Record&lt;/h3&gt;')[1];}
  else if (xml_WHOIS_user_CU.indexOf('&lt;H3&gt;Whois Record&lt;/H3&gt;') !=-1)
    {xml_WHOIS_user_CU = xml_WHOIS_user_CU.split('&lt;H3&gt;Whois Record&lt;/H3&gt;')[1];}
  if (xml_WHOIS_user_CU.indexOf('&lt;p class=&quot;whois_record&quot;&gt;') != -1)
    {xml_WHOIS_user_CU = xml_WHOIS_user_CU.split('&lt;p class=&quot;whois_record&quot;&gt;')[1].split('&lt;/p&gt;')[0];}
  if (xml_WHOIS_user_CU.indexOf('&lt;TABLE ') != -1)
    {xml_WHOIS_user_CU = xml_WHOIS_user_CU.split('&lt;TABLE ')[1];}
//parse WHOIS results
  var OrgName = '';
  var Address = '';
  var City = '';
  var StateProv = '';
  var Country = '';
  if (xml_WHOIS_user_CU.indexOf('OrgName:') !=-1)
    {OrgName = xml_WHOIS_user_CU.split('OrgName:')[1].split('\n')[0].split('\r')[0].split(']')[0] + ', ';}
  if (xml_WHOIS_user_CU.split('Address:')[1] !=undefined)
    {Address = xml_WHOIS_user_CU.split('Address:')[1].split('\n')[0].split('\r')[0].split(']')[0] + ', ';}
  if (xml_WHOIS_user_CU.split('Address:')[2] !=undefined)
    {Address += xml_WHOIS_user_CU.split('Address:')[2].split('\n')[0].split('\r')[0].split(']')[0] + ', ';}
  if (xml_WHOIS_user_CU.split('Address:')[3] !=undefined)
    {Address += xml_WHOIS_user_CU.split('Address:')[3].split('\n')[0].split('\r')[0].split(']')[0] + ', ';}
  if (xml_WHOIS_user_CU.split('address:')[1] !=undefined)
    {Address = xml_WHOIS_user_CU.split('address:')[1].split('\n')[0].split('\r')[0].split(']')[0] + ', ';}
  if (xml_WHOIS_user_CU.split('address:')[2] !=undefined)
    {Address += xml_WHOIS_user_CU.split('address:')[2].split('\n')[0].split('\r')[0].split(']')[0] + ', ';}
  if (xml_WHOIS_user_CU.split('address:')[3] !=undefined)
    {Address += xml_WHOIS_user_CU.split('address:')[3].split('\n')[0].split('\r')[0].split(']')[0] + ', ';}
  if (xml_WHOIS_user_CU.indexOf('City:') !=-1)
    {City = '&lt;u&gt;' + xml_WHOIS_user_CU.split('City:')[1].split('\n')[0].split('\r')[0].split(']')[0] + '&lt;/u&gt;' + ', ';}
//DNS again...
  if (xml_DNS_user_CU.indexOf('City: ') !=-1)
    {City = '&lt;u&gt;' + xml_DNS_user_CU.split('City: ')[1].split('\n')[0].split('\r')[0].split(']')[0] + '&lt;/u&gt;' + ', ';}
//
  if (xml_WHOIS_user_CU.indexOf('StateProv:') !=-1)
    {StateProv = xml_WHOIS_user_CU.split('StateProv:')[1].split('\n')[0].split('\r')[0].split(']')[0] + ', ';}
  if (xml_WHOIS_user_CU.indexOf('OrgName:') !=-1)
    {Country = xml_WHOIS_user_CU.split('Country:')[1].split('\n')[0].split('\r')[0].split(']')[0] + ', ';}
  if (xml_WHOIS_user_CU.search(/(OrgName|Address|City|StateProv|Country):/) ==-1 &amp;&amp; xml_WHOIS_user_CU.indexOf('&lt;br&gt;') != -1)
    {OrgName = xml_WHOIS_user_CU.split('&lt;br&gt;')[1].split('&lt;/br&gt;')[0] + ', ';}
  var output_IP_info = '&lt;strong&gt;' + OrgName + '&lt;/strong&gt;' + Address + City + '&lt;strong&gt;' + StateProv + '&lt;/strong&gt;' + '&lt;i&gt;' + Country + '&lt;/i&gt;';
//parse DNS items
  document.getElementById('contentSub').innerHTML = '&lt;strong&gt;Parsing DNS XML page data for ' + current_IP_name + '...&lt;/strong&gt;';
  var rev_DNS_info = '?';
  if (xml_DNS_user_CU.indexOf(current_IP_name + ' - ') !=-1)
     {rev_DNS_info = '&lt;strong&gt;' + xml_DNS_user_CU.split(current_IP_name + ' - ')[1].split('\n')[0].split('\r')[0] + '&lt;/strong&gt;';}
  output_IP_info += '&lt;span style=&quot;color:darkred;&quot;&gt;DNS&lt;/span&gt;: ' + rev_DNS_info;
  output_IP_info = output_IP_info.replace(/Internet Assigned Numbers Authority/,'IANA');
//parse edits
  if (xml_edits_user.indexOf('No changes were found matching these criteria.') ==-1 &amp;&amp; xml_edits_user.indexOf('&lt;ul&gt;') !=-1)
  {
  var contribs = xml_edits_user.split('&lt;ul&gt;')[1].split('&lt;/ul&gt;')[0];
  var current_num = 1*starting_IP_end + 1*IP_num_JS_count;
  body.innerHTML += '&lt;p&gt;&lt;strong&gt;&lt;a href=&quot;/wiki/Special:Contributions/' + current_IP_name + '&quot;&gt;' + current_IP_name + '&lt;/a&gt;&lt;/strong&gt; &lt;span style=&quot;color: darkred&quot;&gt;||&lt;/span&gt; ' + output_IP_info + '&lt;/p&gt;' + '&lt;ul&gt;' + contribs + '&lt;/ul&gt;';
  }
  else
  {
  body.innerHTML += '&lt;p&gt;&lt;strong&gt;' + current_IP_name + '&lt;/strong&gt; &lt;i&gt;(no contribs exist)&lt;/i&gt; &lt;span style=&quot;color: darkred&quot;&gt;||&lt;/span&gt; ' + output_IP_info + '&lt;/p&gt;';
  }
  IP_num_JS_count += 1;
  IPRange_contribs_XML();
}
/////////////////////////////////

////////////////////Compare contribs////////////////////
function Compare_tab_add()
{
if (document.title.indexOf('User contributions') == 0 &amp;&amp; location.href.search(/\d{1,3}(@|%40)\d{1,2}/) == -1)
{addTab(&quot;javascript:compare_contribs()&quot;, &quot;Compare&quot;, &quot;ca-comp&quot;, &quot;Compare&quot;, &quot;&quot;);}
}

//globals
username_contribs_comp = '';
username_contribs_comp2 = '';
//
function compare_contribs()
{
username_contribs_comp2 = prompt('Compare with who?' + '\n' + '*for last 2000 edits' + '\n' + '*selected namespace' + '\n' + '*for last 15 (un)blocks');
if (!username_contribs_comp2){return;}
username_contribs_comp = document.getElementById('contentSub').getElementsByTagName('a')[0].innerHTML;
if (username_contribs_comp == 'Talk' &amp;&amp; location.href.indexOf('&amp;target=') != -1)
{username_contribs_comp = location.href.split('&amp;target=')[1].split('&amp;')[0];}
else if (username_contribs_comp == 'Talk' &amp;&amp; location.href.indexOf('/Special:Contributions/') != -1)
{username_contribs_comp = location.href.split('/Special:Contributions/')[1];}
if (username_contribs_comp == username_contribs_comp2){alert('Cannot compare a user with his/herself!'); return;}
  document.getElementById('contentSub').innerHTML += &quot;&lt;br&gt;&lt;strong&gt;Requesting block log and contribs XML for users...&lt;/strong&gt;&quot;;
  var namespace = '';
//get namespace
  if (document.getElementById('namespace'))
    {
    var inputs = document.getElementById('namespace').getElementsByTagName('option');
    for (i=0; i&lt;inputs.length; i++)
       {
       if (inputs[i].selected==true)
          {var namespace = '&amp;namespace=' + inputs[i].value; break;}
       }
    } 
//
  var URL = '/w/index.php?title=Special:Contributions&amp;target=' + username_contribs_comp + namespace + '&amp;limit=2000&amp;useksin=none';
  xml_http = HTTPClient();
  xml_http.open(&quot;GET&quot;, URL, true);
  xml_http.onreadystatechange = parse_xml_contribs2;
  xml_http.send(null);
}

function parse_xml_contribs2()
{
  if (xml_http.readyState != 4)
  {return;}
  doc1_xml_contribs_xml = xml_http.responseText;
  var namespace = '';
//get namespace
  if (document.getElementById('namespace'))
    {
    var inputs = document.getElementById('namespace').getElementsByTagName('option');
    for (i=0; i&lt;inputs.length; i++)
       {
       if (inputs[i].selected==true)
          {var namespace = '&amp;namespace=' + inputs[i].value; break;}
       }
    } 
//
  var URL = '/w/index.php?title=Special:Contributions&amp;target=' + username_contribs_comp2 + namespace + '&amp;limit=2000&amp;useksin=none';
  xml_http = HTTPClient();
  xml_http.open(&quot;GET&quot;, URL, true);
  xml_http.onreadystatechange = parse_xml_comparecontribs_log;
  xml_http.send(null);
}

function compare_contribs_range()
{
username_contribs_comp2 = prompt('Compare with who?' + '\n' + '*for last 2000 edits' + '\n' + '*current namespace');
if (!username_contribs_comp2){return;}
username_contribs_comp = 'Selected IP range';
  document.getElementById('contentSub').innerHTML += &quot;&lt;br&gt;&lt;strong&gt;Requesting contribs XML for other user...&lt;/strong&gt;&quot;;
  var namespace = '';
  if (location.href.search(/&amp;namespace=\d/) != -1)
     {var namespace = location.href.match(/&amp;namespace=\d/)[0];}
  var URL = '/w/index.php?title=Special:Contributions&amp;target=' + username_contribs_comp2 + namespace + '&amp;limit=2000&amp;useksin=none';
  xml_http = HTTPClient();
  xml_http.open(&quot;GET&quot;, URL, true);
  xml_http.onreadystatechange = parse_xml_contribs_range;
  xml_http.send(null);
}

//cache
doc_js_ipcontribs_range_cache = '';
//
function parse_xml_contribs_range()
{
  if (xml_http.readyState != 4)
  {return;}
//monobook
if (document.getElementById('bodyContent'))
  {
  var body = document.getElementById('bodyContent');
  }
//cologneblue
else if (document.getElementById('quickbar'))
  {
  if (!document.getElementById('content')){return;}
  var body = document.getElementById('content');
  }
  document.getElementById('contentSub').innerHTML += &quot;&lt;br&gt;&lt;strong&gt;Parsing contribs XML for other user...&lt;/strong&gt;&quot;;
  xml = xml_http.responseText;
  var doc2 = standard_XMLParse(xml);
  if (doc_js_ipcontribs_range_cache == '')
  {
  doc_js_ipcontribs_range_cache = body.innerHTML;
  }
  else
  {body.innerHTML = doc_js_ipcontribs_range_cache;}
  var doc1 = body;
//check for any contribs
  if (doc1.getElementsByTagName('li')[0] == undefined)
     {document.getElementById('contentSub').innerHTML += &quot;&lt;br&gt;&lt;strong&gt;&lt;span style='color: red'&gt;Note: One of these users has no contributions in this namespace!&lt;/span&gt;&lt;/strong&gt;&quot;; return;}
  else if (doc2.getElementById('bodyContent').getElementsByTagName('li')[0] == undefined)
     {document.getElementById('contentSub').innerHTML += &quot;&lt;br&gt;&lt;strong&gt;&lt;span style='color: red'&gt;Note: One of these users has no contributions in this namespace!&lt;/span&gt;&lt;/strong&gt;&quot;; return;}
//
  var l = doc1.getElementsByTagName('li');
  var name_list = '||';
  var list_common = '||';
  for (i=0; i&lt;l.length; i++)
  {
    if (l[i].getElementsByTagName('a')[2] != undefined)
    {
    var name = l[i].getElementsByTagName('a')[2].innerHTML;
    name_list += name + '||';
    }
  }
  if (doc2.getElementsByTagName('ul')[0] != undefined)
  {
  var h = doc2.getElementById('bodyContent').getElementsByTagName('ul')[0].getElementsByTagName('li');
     for (i=0; i&lt;h.length; i++)
     {
     var name = h[i].getElementsByTagName('a')[2].innerHTML;
     if (name_list.indexOf('||' + name + '||') != -1 &amp;&amp; list_common.indexOf('||' + name + '||') == -1)
     {list_common += name + '||';}
     }
  }
//
  if (list_common == '||' || doc2.getElementsByTagName('ul')[0] == undefined)
  {
  document.getElementById('contentSub').innerHTML += &quot;&lt;br&gt;&lt;strong&gt;Done:&lt;span style='color: blue'&gt; comparison between edits by &lt;/span&gt;&quot; + username_contribs_comp + &quot; &lt;span style='color: blue'&gt;and&lt;/span&gt; &quot; + username_contribs_comp2 + &quot; &lt;span style='color: blue'&gt;finished.&lt;/span&gt; (no matches)&lt;/strong&gt;&quot;;
  var uls = body.getElementsByTagName('ul');
  for (i=0; i&lt;uls.length; i++)
     {
     uls[i].innerHTML = '';
     }
  var ps = body.getElementsByTagName('p');
  for (i=1; i&lt;ps.length; i++)
     {
     ps[i].innerHTML = '';
     }
  return;
  }
//
  var txt_add = '';
  var common_names = list_common.split('||');
  for (i=1; i&lt; common_names.length-1; i++)
  {
  var pgname = common_names[i];
  var pglink = '&lt;a href=&quot;/wiki/' + pgname + '&quot; title=&quot;' + pgname + '&quot;&gt;' + pgname + '&lt;/a&gt;'; 
  txt_add += &quot;&lt;p&gt;&lt;strong&gt;Page: &quot; + pglink + &quot;&lt;/strong&gt;&lt;/p&gt;&lt;span style='color: purple'&gt;&lt;p&gt;&lt;strong&gt;&quot; + username_contribs_comp2 + &quot;&lt;/strong&gt;&lt;/p&gt;&lt;/span&gt;&lt;ul&gt;&quot;;
     for (k=0; k&lt;h.length; k++)
      {
      var name = h[k].getElementsByTagName('a')[2].innerHTML;
       if (name == pgname)
       {txt_add += '&lt;li&gt;' + h[k].innerHTML + '&lt;/li&gt;';}
      }
   txt_add += &quot;&lt;/ul&gt;&lt;p&gt;&lt;span style='color: darkred'&gt;&lt;strong&gt;&quot; + username_contribs_comp + &quot;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;ul&gt;&quot;;
     for (k=0; k&lt;l.length; k++)
      {
      if (l[k].getElementsByTagName('a')[2] != undefined)
        {
         var name = l[k].getElementsByTagName('a')[2].innerHTML;
         if (name == pgname)
         {txt_add += '&lt;li&gt;' + l[k].innerHTML + '&lt;/li&gt;';}
        }
      }
      txt_add += '&lt;/ul&gt;'
   }
//
  document.getElementById('contentSub').innerHTML += &quot;&lt;br&gt;&lt;strong&gt;Done:&lt;span style='color: blue'&gt; comparison between edits by &lt;/span&gt;&quot; + username_contribs_comp + &quot; &lt;span style='color: blue'&gt;and&lt;/span&gt; &quot; + username_contribs_comp2 + &quot; &lt;span style='color: blue'&gt;finished.&lt;/span&gt;&lt;/strong&gt;&quot;;
  body.getElementsByTagName('ul')[0].innerHTML = '';
  var uls = body.getElementsByTagName('ul');
  for (i=0; i&lt;uls.length; i++)
     {uls[i].innerHTML = '';}
  var ps = body.getElementsByTagName('p');
  for (i=1; i&lt;ps.length; i++)
     {ps[i].innerHTML = '';}
  body.innerHTML += txt_add;
  edits_page_compared_js = 1;
  addTab(&quot;javascript:date_highlight()&quot;, &quot;date&quot;, &quot;ca-datem&quot;, &quot;Highlight a date&quot;, &quot;&quot;);
  body.ranSetupTooltipsAlready=false;
  setupTooltips(body);
}

function contribs_reset()
{
//monobook
if (document.getElementById('bodyContent'))
  {
  var body = document.getElementById('bodyContent');
  }
//cologneblue
else if (document.getElementById('quickbar'))
  {
  if (!document.getElementById('content')){return;}
  var body = document.getElementById('content');
  }
  if (doc_js_ipcontribs_range_cache == '')
  {
  doc_js_ipcontribs_range_cache = body.innerHTML;
  }
  else
  {body.innerHTML = doc_js_ipcontribs_range_cache;}
  body.ranSetupTooltipsAlready=false;
  setupTooltips(body);
}

function parse_xml_comparecontribs_log()
{
  if (xml_http.readyState != 4)
  {return;}
  doc2_xml_contribs_xml = xml_http.responseText;
  var namespace = '';
  if (location.href.indexOf('&amp;namespace=') !=-1)
    {namespace = location.href.split('&amp;namespace=')[1].split('&amp;')[0];}
  URL = '/w/index.php?title=Special:Log&amp;type=block&amp;limit=15&amp;page=User%3A' + username_contribs_comp + '&amp;useskin=none';
  xml_http = HTTPClient();
  xml_http.open(&quot;GET&quot;, URL, true);
  xml_http.onreadystatechange = parse_xml_comparecontribs_log2;
  xml_http.send(null);
}

function parse_xml_comparecontribs_log2()
{
  if (xml_http.readyState != 4)
  {return;}
  doc1_xml_log_xml = xml_http.responseText;
  URL = '/w/index.php?title=Special:Log&amp;type=block&amp;limit=15&amp;page=User%3A' + username_contribs_comp2 + '&amp;useskin=none';
  xml_http = HTTPClient();
  xml_http.open(&quot;GET&quot;, URL, true);
  xml_http.onreadystatechange = parse_xml_comparecontribs;
  xml_http.send(null);
}

function parse_xml_comparecontribs()
{
  if (xml_http.readyState != 4)
  {return;}
//monobook
if (document.getElementById('bodyContent'))
  {
  var body = document.getElementById('bodyContent');
  }
//cologneblue
else if (document.getElementById('quickbar'))
  {
  if (!document.getElementById('content')){return;}
  var body = document.getElementById('content');
  }
  document.getElementById('contentSub').innerHTML += &quot;&lt;br&gt;&lt;strong&gt;Parsing block log and contribs XML for users...&lt;/strong&gt;&quot;;
  doc2_xml_log_xml = xml_http.responseText;
  var user1block_count = 0;
  var user2block_count = 0;
  var user1edit_count = 0;
  var user2edit_count = 0;
//
  var txt_add = '';
  if (doc1_xml_log_xml.indexOf('&lt;ul&gt;') != -1 || doc2_xml_log_xml.indexOf('&lt;ul&gt;') != -1)
  {
  txt_add += '&lt;div style=&quot;background-color: #f9f9f9; border: 2px solid red; padding: 10px;&quot;&gt;';
  txt_add += &quot;&lt;p&gt;&lt;span style='color: red'&gt;&lt;strong&gt;Block log (last 20):&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&quot;;
  }
//
  if (doc2_xml_log_xml.indexOf('&lt;ul&gt;') != -1)
  {
  user2block_ul = '&lt;ul&gt;' + doc2_xml_log_xml.split('&lt;ul&gt;')[1].split('&lt;/ul&gt;')[0] + '&lt;/ul&gt;';
  user2block_count = user2block_ul.split('&lt;/a&gt;) blocked &quot;&lt;a').length - 1;
  txt_add += &quot;&lt;p&gt;&lt;span style='color: purple'&gt;&lt;strong&gt;&quot; + username_contribs_comp2 + &quot;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&quot;;
  txt_add += user2block_ul;
  }
  if (doc1_xml_log_xml.indexOf('&lt;ul&gt;') != -1)
  {
  user1block_ul = '&lt;ul&gt;' + doc1_xml_log_xml.split('&lt;ul&gt;')[1].split('&lt;/ul&gt;')[0] + '&lt;/ul&gt;';
  user1block_count = user1block_ul.split('&lt;/a&gt;) blocked &quot;&lt;a').length - 1;
  txt_add += &quot;&lt;p&gt;&lt;span style='color: darkred'&gt;&lt;strong&gt;&quot; + username_contribs_comp + &quot;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;ul&gt;&quot;;
  txt_add += user1block_ul;
  }
  if (doc1_xml_log_xml.indexOf('&lt;ul&gt;') != -1 || doc2_xml_log_xml.indexOf('&lt;ul&gt;') != -1)
  {
  txt_add += '&lt;/div&gt;&lt;br style=&quot;clear:both;&quot;&gt;';
  }
//
  txt_add += '&lt;div style=&quot;background-color: #f9f9f9; border: 2px solid #8888aa; padding: 10px;&quot;&gt;';
  txt_add += &quot;&lt;p&gt;&lt;span style='color: darkblue'&gt;&lt;strong&gt;Pages edited in common by&lt;/span&gt; &quot; + username_contribs_comp + &quot; &lt;span style='color: darkblue'&gt;and&lt;/span&gt; &quot; + username_contribs_comp2 + &quot;&lt;span style='color: darkblue'&gt;:&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&quot;;
//
  if (doc1_xml_contribs_xml.indexOf('&lt;ul&gt;') != -1)
  {user1edit_count = doc1_xml_contribs_xml.split('&lt;ul&gt;')[1].split('&lt;/ul&gt;')[0].split('&lt;li&gt;').length - 1;}
  if (doc2_xml_contribs_xml.indexOf('&lt;ul&gt;') != -1)
  {user2edit_count = doc2_xml_contribs_xml.split('&lt;ul&gt;')[1].split('&lt;/ul&gt;')[0].split('&lt;li&gt;').length - 1;}
//
  var blocklink = '&lt;a href = &quot;/w/index.php?title=Special:Log&amp;type=block&amp;limit=20&amp;page=User%3A' + username_contribs_comp + '&quot;&gt;block(s)&lt;/a&gt;';
  var blocklink2 = '&lt;a href = &quot;/w/index.php?title=Special:Log&amp;type=block&amp;limit=20&amp;page=User%3A' + username_contribs_comp2 + '&quot;&gt;block(s)&lt;/a&gt;';
//parse
  var doc1 = standard_XMLParse(doc1_xml_contribs_xml);
  var doc2 = standard_XMLParse(doc2_xml_contribs_xml);
//check for any contribs
  if (doc1.getElementById('bodyContent').getElementsByTagName('li')[0] == undefined)
     {document.getElementById('contentSub').innerHTML += &quot;&lt;br&gt;&lt;strong&gt;&lt;span style='color: red'&gt;Note: One of these users has no contributions in this namespace!&lt;/span&gt;&lt;/strong&gt;&quot;; return;}
  else if (doc2.getElementById('bodyContent').getElementsByTagName('li')[0] == undefined)
     {document.getElementById('contentSub').innerHTML += &quot;&lt;br&gt;&lt;strong&gt;&lt;span style='color: red'&gt;Note: One of these users has no contributions in this namespace!&lt;/span&gt;&lt;/strong&gt;&quot;; return;}
//compile a list of pages edited
  var User_talk1 = 'User talk:' + username_contribs_comp;
  var User_talk2 = 'User talk:' + username_contribs_comp2;
  var l = doc1.getElementById('bodyContent').getElementsByTagName('ul')[0].getElementsByTagName('li');
  var name_list = '||';
  var list_common = '||';
  var list_talkbyuser1 = '';
  var list_talkbyuser2 = '';
  var list_afdbyuser1 = '';
  var list_afdbyuser2 = '';
  for (i=0; i&lt;l.length; i++)
  {
  var name = l[i].getElementsByTagName('a')[2].innerHTML;
  name_list += name + '||';
  if (name == User_talk2)
    {list_talkbyuser1 += '&lt;li&gt;' + l[i].innerHTML + '&lt;/li&gt;';}
  else if (name.search(/.+ for Deletion|(Redirects|Categories) for [Dd]iscussion|Deletion review/) ==0)
    {list_afdbyuser1 += '&lt;li&gt;' + l[i].innerHTML + '&lt;/li&gt;';}
  }
//compile a list of pages edited in common (along with second talk page run)
  if (doc2.getElementsByTagName('ul')[0] != undefined)
  {
  var h = doc2.getElementById('bodyContent').getElementsByTagName('ul')[0].getElementsByTagName('li');
     for (i=0; i&lt;h.length; i++)
     {
     var name = h[i].getElementsByTagName('a')[2].innerHTML;
     if (name_list.indexOf('||' + name + '||') != -1 &amp;&amp; list_common.indexOf('||' + name + '||') == -1)
       {list_common += name + '||';}
     if (name == User_talk1)
       {list_talkbyuser2 += '&lt;li&gt;' + h[i].innerHTML + '&lt;/li&gt;';}
     else if (name.search(/.+ for Deletion|(Redirects|Categories) for [Dd]iscussion|Deletion review/) ==0)
       {list_afdbyuser2 += '&lt;li&gt;' + h[i].innerHTML + '&lt;/li&gt;';}
     }
  }
//
  if (list_common == '||' || doc2.getElementsByTagName('ul')[0] == undefined)
  {
  document.getElementById('contentSub').innerHTML += &quot;&lt;br&gt;&lt;strong&gt;Done:&lt;span style='color: blue'&gt; edit comparison between&lt;/span&gt; &quot; + username_contribs_comp + &quot; (&lt;span style='color: blue'&gt;&quot; + user1edit_count + &quot;&lt;/span&gt; scanned) (&lt;span style='color: red'&gt;&quot; + user1block_count + &quot;&lt;/span&gt; &quot; + blocklink + &quot;) &lt;span style='color: blue'&gt;and&lt;/span&gt; &quot; + username_contribs_comp2 + &quot; (&lt;span style='color: blue'&gt;&quot; + user2edit_count + &quot;&lt;/span&gt; scanned) (&lt;span style='color: red'&gt;&quot; + user2block_count + &quot;&lt;/span&gt; &quot; + blocklink2 + &quot;) &lt;span style='color: blue'&gt;finished.&lt;/span&gt; (no matches)&lt;/strong&gt;&quot;;
  body.getElementsByTagName('ul')[0].innerHTML = '';
  document.getElementsByTagName('p')[1].innerHTML = '';
  document.getElementsByTagName('p')[2].innerHTML = '';
  return;
  }
//return list of edits to pages in common
  var common_names = list_common.split('||');
  for (i=1; i&lt; common_names.length-1; i++)
  {
  var pgname = common_names[i];
  var pglink = '&lt;a href=&quot;/wiki/' + pgname + '&quot; title=&quot;' + pgname + '&quot;&gt;' + pgname + '&lt;/a&gt;'; 
  txt_add += &quot;&lt;p&gt;&lt;strong&gt;Page: &quot; + pglink + &quot;&lt;/p&gt;&lt;/strong&gt;&lt;span style='color: purple'&gt;&lt;strong&gt;&lt;p&gt;&quot; + username_contribs_comp2 + &quot;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;ul&gt;&quot;;
     for (k=0; k&lt;h.length; k++)
      {
      var name = h[k].getElementsByTagName('a')[2].innerHTML;
       if (name == pgname)
       {txt_add += '&lt;li&gt;' + h[k].innerHTML + '&lt;/li&gt;';}
      }
   txt_add += &quot;&lt;/ul&gt;&lt;p&gt;&lt;span style='color: darkred'&gt;&lt;strong&gt;&quot; + username_contribs_comp + &quot;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;ul&gt;&quot;;
     for (k=0; k&lt;l.length; k++)
      {
      var name = l[k].getElementsByTagName('a')[2].innerHTML;
       if (name == pgname)
       {txt_add += '&lt;li&gt;' + l[k].innerHTML + '&lt;/li&gt;';}
      }
      txt_add += '&lt;/ul&gt;'
   }
  txt_add += '&lt;/div&gt;&lt;br style=&quot;clear:both;&quot;&gt;';
//talk edit parsing
  if (list_talkbyuser1 != '' || list_talkbyuser2 != '')
     {
     txt_add += '&lt;div style=&quot;background-color: #f9f9f9; border: 2px solid darkgreen; padding: 10px;&quot;&gt;';
     txt_add += &quot;&lt;p&gt;&lt;strong&gt;&lt;span style='color: darkgreen'&gt;User talk interaction&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&quot;;
     }
  if (list_talkbyuser2 != '')
     {
     txt_add += &quot;&lt;p&gt;&lt;strong&gt;&lt;span style='color: purple'&gt;Edits by&lt;/span&gt; &quot; + username_contribs_comp2 + &quot;&lt;span style='color: purple'&gt; to talk page of&lt;/span&gt; &quot; + username_contribs_comp + &quot;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;ul&gt;&quot; + list_talkbyuser2 + &quot;&lt;/ul&gt;&quot;;
     }
  if (list_talkbyuser1 != '')
     {
     txt_add += &quot;&lt;p&gt;&lt;strong&gt;&lt;span style='color: darkred'&gt;Edits by&lt;/span&gt; &quot; + username_contribs_comp + &quot;&lt;span style='color: darkred'&gt; to talk page of&lt;/span&gt; &quot; + username_contribs_comp2 + &quot;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;ul&gt;&quot; + list_talkbyuser1 + &quot;&lt;/ul&gt;&quot;;
     }
  txt_add += '&lt;/div&gt;&lt;br style=&quot;clear:both;&quot;&gt;';
//AFD parsing
  if (list_afdbyuser1 != '' &amp;&amp; list_afdbyuser2 != '')
     {
     txt_add += '&lt;div style=&quot;background-color: #f9f9f9; border: 2px solid #FF6600; padding: 10px;&quot;&gt;';
     txt_add += &quot;&lt;p&gt;&lt;strong&gt;&lt;span style='color: #FF6600'&gt;Edits to deletion pages&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&quot;;
     txt_add += &quot;&lt;p&gt;&lt;strong&gt;&lt;span style='color: purple'&gt;&quot; + username_contribs_comp2 + &quot;&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&lt;ul&gt;&quot; + list_afdbyuser2 + &quot;&lt;/ul&gt;&quot;;
     txt_add += &quot;&lt;p&gt;&lt;strong&gt;&lt;span style='color: darkred'&gt;&quot; + username_contribs_comp + &quot;&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&lt;ul&gt;&quot; + list_afdbyuser1 + &quot;&lt;/ul&gt;&quot;;
     }
  txt_add += '&lt;/div&gt;&lt;br style=&quot;clear:both;&quot;&gt;';
//Finish
  document.getElementById('contentSub').innerHTML += &quot;&lt;br&gt;&lt;strong&gt;Done:&lt;span style='color: blue'&gt; edit comparison between&lt;/span&gt; &quot; + username_contribs_comp + &quot; (&lt;span style='color: blue'&gt;&quot; + user1edit_count + &quot;&lt;/span&gt; scanned) (&lt;span style='color: red'&gt;&quot; + user1block_count + &quot;&lt;/span&gt; &quot; + blocklink + &quot;) &lt;span style='color: blue'&gt;and&lt;/span&gt; &quot; + username_contribs_comp2 + &quot; (&lt;span style='color: blue'&gt;&quot; + user2edit_count + &quot;&lt;/span&gt; scanned) (&lt;span style='color: red'&gt;&quot; + user2block_count + &quot;&lt;/span&gt; &quot; + blocklink2 + &quot;) &lt;span style='color: blue'&gt;finished.&lt;/span&gt;&lt;/strong&gt;&quot;;
  body.getElementsByTagName('ul')[0].innerHTML = '';
  document.getElementsByTagName('p')[1].innerHTML = '';
  document.getElementsByTagName('p')[2].innerHTML = '';
  body.innerHTML += txt_add;
  edits_page_compared_js = 1;
  addTab(&quot;javascript:date_highlight()&quot;, &quot;date&quot;, &quot;ca-datem&quot;, &quot;Highlight a date&quot;, &quot;f&quot;);
  body.ranSetupTooltipsAlready=false;
  setupTooltips(body);
}
////////////////////
function date_highlight()
{
//monobook
if (document.getElementById('bodyContent'))
  {
  var body = document.getElementById('bodyContent');
  }
//cologneblue
else if (document.getElementById('quickbar'))
  {
  if (!document.getElementById('content')){return;}
  var body = document.getElementById('content');
  }
if (!body.getElementsByTagName('li')[0]){return;}
var date = prompt('This will highlight a certain date.' + '\n' + 'Enter a date fragment:' + '\n' + '(example: &quot;August 7, 2006&quot;)');
if (!date){return;}
var l = body.getElementsByTagName('li');
  for (var i=0; i&lt;l.length; i++)
  {
  l[i].innerHTML = l[i].innerHTML.replace(/&lt;span style=&quot;background-color:.+&quot;&gt;&lt;i&gt;(.+)&lt;\/i&gt;&lt;\/span&gt;/i,'$1');
  if (l[i].innerHTML.split('(&lt;a href=&quot;')[0].indexOf(date) !=-1)
    {l[i].innerHTML = '&lt;span style=&quot;background-color: #FFFFCC&quot;&gt;&lt;i&gt;' + l[i].innerHTML + '&lt;/i&gt;&lt;/span&gt;';}
  }
  body.ranSetupTooltipsAlready=false;
  setupTooltips(body);
}

function deletehist()
{
  if (location.href.search(/Special:Log\/delete|&amp;type=delete/) !=-1)
  {
  var ul = document.getElementById('bodyContent').getElementsByTagName('ul')[0];
  if (!ul || !ul.getElementsByTagName('li')[0]){return;}
  var l = ul.getElementsByTagName('li');
//admin or sysop viewing this?
  if (l[0].innerHTML.indexOf('&quot;&gt;block&lt;/a&gt;)') ==-1){return;}
  for (var i=0; i&lt;l.length; i++)
     {
     var name = l[i].getElementsByTagName('a')[4].innerHTML;
     l[i].innerHTML = '&lt;a href=&quot;/wiki/Special:Undelete/' + name + '&quot;&gt;(review)&lt;/a&gt; ' + l[i].innerHTML;
     }
  }
}

function blockhist()
{
  if (location.href.search(/Special:(Log\/block|Blockip)|&amp;type=block/) !=-1)
  {
  var ul = document.getElementById('bodyContent').getElementsByTagName('ul')[0];
  if (!ul || !ul.getElementsByTagName('li')[0]){return;}
  var l = ul.getElementsByTagName('li');
//admin or sysop viewing this?
  if (l[0].innerHTML.indexOf('&quot;&gt;block&lt;/a&gt;)') ==-1){return;}
//unblock links
  if (location.href.search(/&amp;page=[^&amp;]/) ==-1)
     {
     for (var i=0; i&lt;l.length; i++)
       {
         if (l[i].getElementsByTagName('a')[4])
         {
     var name = l[i].getElementsByTagName('a')[4].innerHTML;
     l[i].innerHTML = '(&lt;a href=&quot;/w/index.php?title=Special%3ALog&amp;type=block&amp;page=User:' + name + '&quot;&gt;hist&lt;/a&gt;) (&lt;a href=&quot;/w/index.php?title=Special%3AIpblocklist&amp;action=search&amp;limit=&amp;ip=' + name + '&quot;&gt;status&lt;/a&gt;) ' + l[i].innerHTML;
         }
       }
     }
  else
     {
     var name = l[0].getElementsByTagName('a')[4].innerHTML;
     l[0].innerHTML = '(&lt;a href=&quot;/w/index.php?title=Special%3AIpblocklist&amp;action=search&amp;limit=&amp;ip=' + name + '&quot;&gt;status&lt;/a&gt;) ' + l[0].innerHTML;
     }
  }
}

//options
addOnloadHook(SA_main_functions)
function SA_main_functions()
{
jswin_close();
deletehist();
blockhist();
winclosed();
Compare_tab_add();
IPRange_contribs();
IPRange_contribs_tab();
}
//

//END&lt;/nowiki&gt;&lt;/pre&gt;
</pre><div class="printfooter">
Retrieved from "<a href="http://en.wikipedia.org../../../a/k/h/User%7EAkhilleus_scripts_compare.js_8659.html">http://en.wikipedia.org../../../a/k/h/User%7EAkhilleus_scripts_compare.js_8659.html</a>"</div>
	    	    <!-- end content -->
	    <div class="visualClear"></div>
	  </div>
	</div>
      </div>
      <div id="column-one">
	<div id="p-cactions" class="portlet">
	  <h5>Views</h5>
	  <ul>
	    <li id="ca-nstab-user"
	       class="selected"	       ><a href="../../../a/k/h/User%7EAkhilleus_scripts_compare.js_8659.html">User page</a></li><li id="ca-talk"
	       class="new"	       ><a href="../../../a/k/h/User_talk%7EAkhilleus_scripts_compare.js_8083.html">Discussion</a></li><li id="ca-current"
	       	       ><a href="http://en.wikipedia.org/wiki/User:Akhilleus/scripts/compare.js">Current revision</a></li>	  </ul>
	</div>
	<div class="portlet" id="p-logo">
	  <a style="background-image: url(../../../images/wiki-en.png);"
	    href="../../../index.html"
	    title="Main Page"></a>
	</div>
	<script type="text/javascript"> if (window.isMSIE55) fixalpha(); </script>
		<div class='portlet' id='p-navigation'>
	  <h5>Navigation</h5>
	  <div class='pBody'>
	    <ul>
	    	      <li id="n-Main-page"><a href="../../../index.html">Main page</a></li>
	     	      <li id="n-Contents"><a href="../../../c/o/n/Wikipedia%7EContents_3181.html">Contents</a></li>
	     	      <li id="n-Featured-content"><a href="../../../f/e/a/Wikipedia%7EFeatured_content_24ba.html">Featured content</a></li>
	     	      <li id="n-currentevents"><a href="../../../c/u/r/Portal%7ECurrent_events_bb60.html">Current events</a></li>
	     	    </ul>
	  </div>
	</div>
		<div class='portlet' id='p-interaction'>
	  <h5>interaction</h5>
	  <div class='pBody'>
	    <ul>
	    	      <li id="n-About-Wikipedia"><a href="../../../a/b/o/Wikipedia%7EAbout_8d82.html">About Wikipedia</a></li>
	     	      <li id="n-portal"><a href="../../../c/o/m/Wikipedia%7ECommunity_Portal_6a3c.html">Community portal</a></li>
	     	      <li id="n-contact"><a href="../../../c/o/n/Wikipedia%7EContact_us_afd6.html">Contact us</a></li>
	     	      <li id="n-sitesupport"><a href="http://wikimediafoundation.org/wiki/Fundraising">Make a donation</a></li>
	     	      <li id="n-help"><a href="../../../c/o/n/Help%7EContents_22de.html">Help</a></li>
	     	    </ul>
	  </div>
	</div>
		<div id="p-search" class="portlet">
	  <h5><label for="searchInput">Search</label></h5>
	  <div id="searchBody" class="pBody">
	    <form action="javascript:goToStatic(3)" id="searchform"><div>
	      <input id="searchInput" name="search" type="text"
	        accesskey="f" value="" />
	      <input type='submit' name="go" class="searchButton" id="searchGoButton"
	        value="Go" />
	    </div></form>
	  </div>
	</div>
	      </div><!-- end of the left (by default at least) column -->
      <div class="visualClear"></div>
      <div id="footer">
    <div id="f-poweredbyico"><a href="http://www.mediawiki.org/"><img src="../../../skins/common/images/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" /></a></div>	<div id="f-copyrightico"><a href="http://wikimediafoundation.org/"><img src="../../../images/wikimedia-button.png" border="0" alt="Wikimedia Foundation"/></a></div>	<ul id="f-list">
	  	  	  <li id="f-credits">This page was last modified 21:17, 21 February 2007 by Wikipedia user <a href="../../../a/k/h/User%7EAkhilleus_723e.html" title="User:Akhilleus">Akhilleus</a>. </li>	  <li id="f-copyright">All text is available under the terms of the <a class='internal' href="../../../t/e/x/Wikipedia%7EText_of_the_GNU_Free_Documentation_License_702a.html" title="Wikipedia:Text of the GNU Free Documentation License">GNU Free Documentation License</a>. (See <b><a class='internal' href="../../../c/o/p/Wikipedia%7ECopyrights_92c4.html" title="Wikipedia:Copyrights">Copyrights</a></b> for details.) <br /> Wikipedia&reg; is a registered trademark of the <a href="http://www.wikimediafoundation.org">Wikimedia Foundation, Inc</a>., a US-registered <a class='internal' href="../../../5/0/1/501%28c%29.html#501.28c.29.283.29" title="501(c)(3)">501(c)(3)</a> <a href="http://wikimediafoundation.org/wiki/Deductibility_of_donations">tax-deductible</a> <a class='internal' href="../../../n/o/n/Non-profit_organization.html" title="Non-profit organization">nonprofit</a> <a href="../../../c/h/a/Charitable_organization.html" title="Charitable organization">charity</a>.<br /></li>	  <li id="f-about"><a href="../../../a/b/o/Wikipedia%7EAbout_8d82.html" title="Wikipedia:About">About Wikipedia</a></li>	  <li id="f-disclaimer"><a href="../../../g/e/n/Wikipedia%7EGeneral_disclaimer_3e44.html" title="Wikipedia:General disclaimer">Disclaimers</a></li>	  	</ul>
      </div>
    </div>
  </body>
</html>
